$(function(){if(CurrentModuleIs("adminAppModule")){$(".adminAppTable .btnOpenWorkflow").on("click",function(){CurrentAppId=$(this).parents("tr").attr("appId");openMetablockForm=$("#openMetablockForm");openMetablockForm.find("input[name='appId']").val(CurrentAppId);openMetablockForm.submit()});$(".adminAppTable .btnOpenDbScheme").on("click",function(){CurrentAppId=$(this).parents("tr").attr("appId");openMetablockForm=$("#openDbSchemeForm");openMetablockForm.find("input[name='appId']").val(CurrentAppId);openMetablockForm.submit()});$(".adminAppTable .btnOpenMozaic").on("click",function(){CurrentAppId=$(this).parents("tr").attr("appId");openMetablockForm=$("#openMozaicForm");openMetablockForm.find("input[name='appId']").val(CurrentAppId);openMetablockForm.submit()});var n;$(".adminAppTable .actions .btnValidate").on("click",function(){if(CurrentAppId=$(this).parents("tr").attr("appId"),typeof WebSocket=="undefined"){ShowAppNotification("Váš prohlížeč nepodporuje webSockety, a nemůže být využit k aktualizaci aplikací","error");return}appBuildDialog.dialog("option",{title:"aktualizuji "+$(this).parents("tr").data("displayName")}).empty().dialog("open");var t={},i=new WebSocket("ws://"+window.location.hostname+":"+window.location.port+"/Master/AppAdminManager/BuildApp/"+CurrentAppId);n=i;i.onerror=function(){$(document).trigger("ajaxError",{})};i.onmessage=function(r){var u,f,e,o;if(n===i){try{u=JSON.parse(r.data)}catch(s){u={message:r.data,type:"error"}}u.id&&t[u.id]?f=t[u.id]:(e=u.childOf?t[u.childOf]:appBuildDialog,f=$("<div class='app-alert'><span>").data("messageId",u.id).appendTo(e),e.is("#app-build-dialog, .app-alert-odd")||f.addClass("app-alert-odd"),u.id&&(t[u.id]=f));u.message&&f.children("span").html(u.message);f.removeClass("app-alert-info app-alert-error app-alert-success app-alert-warning").addClass("app-alert-"+(u.type||"info"));u.abort&&f.nextAll().remove();u.done&&setTimeout(function(){appBuildDialog.dialog("close")},1e3);o=0;appBuildDialog.children().each(function(){o+=$(this).outerHeight()});appBuildDialog.css({height:o+32})}}});$(".adminAppTable .actions .btnProperties").on("click",function(){CurrentAppId=$(this).parents("tr").attr("appId");appPropertiesDialog.dialog("open")});$(".adminAppTable .actions .btnToggleEnabled").on("click",function(){thisButton=$(this);appId=thisButton.parents("tr").attr("appId");isEnabledCell=thisButton.parents("tr").find(".isEnabledColumn");thisButton.hasClass("btnDisable")?(postData={IsEnabled:!1},$.ajax({type:"POST",url:"/api/master/apps/"+appId+"/state",data:postData,success:function(){thisButton.removeClass("btnDisable");thisButton.addClass("btnEnable");thisButton.removeClass("btn-danger");thisButton.addClass("btn-primary");thisButton.text("Povolit");isEnabledCell.text("Ne")}})):(postData={IsEnabled:!0},$.ajax({type:"POST",url:"/api/master/apps/"+appId+"/state",data:postData,success:function(){thisButton.removeClass("btnEnable");thisButton.addClass("btnDisable");thisButton.removeClass("btn-primary");thisButton.addClass("btn-danger");thisButton.text("Zakázat");isEnabledCell.text("Ano")}}))});$("#btnAddApp").on("click",function(){addAppDialog.dialog("open")})}});var CurrentAppId;$(function(){function n(){appPropertiesDialog.dialog("close");postData={DisplayName:appPropertiesDialog.find("#app-name").val(),CSSTemplateId:appPropertiesDialog.find("#template").val(),TileWidth:appPropertiesDialog.find("#tile-width").val(),TileHeight:appPropertiesDialog.find("#tile-height").val(),Color:appPropertiesDialog.find("#bg-color").val(),Icon:appPropertiesDialog.find("#icon-class").val()};$.ajax({type:"POST",url:"/api/master/apps/"+CurrentAppId+"/properties",data:postData,success:function(){alert("OK");location.reload()}})}function t(){addAppDialog.dialog("close");postData={DisplayName:addAppDialog.find("#app-name").val(),Template:addAppDialog.find("#template").val(),TileWidth:addAppDialog.find("#tile-width").val(),TileHeight:addAppDialog.find("#tile-height").val(),Color:addAppDialog.find("#bg-color").val(),Icon:addAppDialog.find("#icon-class").val()};$.ajax({type:"POST",url:"/api/master/apps",data:postData,success:function(){location.reload()}})}appPropertiesDialog=$("#app-properties-dialog").dialog({autoOpen:!1,resizable:!1,width:600,height:320,buttons:{"Uložit":function(){n()},"Zrušit":function(){appPropertiesDialog.dialog("close")}},create:function(){$(this).keypress(function(t){if(t.keyCode==$.ui.keyCode.ENTER)return n(),!1})},open:function(){appPropertiesDialog.find("#app-name").val("");appPropertiesDialog.find("#template").val(1);appPropertiesDialog.find("#tile-width").val(2);appPropertiesDialog.find("#tile-height").val(1);appPropertiesDialog.find("#bg-color").val(0);appPropertiesDialog.find("#icon-class").val("");$.ajax({type:"GET",url:"/api/master/apps/"+CurrentAppId+"/properties",dataType:"json",success:function(n){appPropertiesDialog.find("#app-name").val(n.DisplayName);appPropertiesDialog.find("#template").val(n.CSSTemplateId);appPropertiesDialog.find("#tile-width").val(n.TileWidth);appPropertiesDialog.find("#tile-height").val(n.TileHeight);appPropertiesDialog.find("#bg-color").val(n.Color);appPropertiesDialog.find("#icon-class").val(n.Icon)}})}});addAppDialog=$("#new-app-dialog").dialog({autoOpen:!1,resizable:!1,width:600,height:320,buttons:{"Přidat":function(){t()},"Zrušit":function(){addAppDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return t(),!1})},open:function(){addAppDialog.find("#app-name").val("");addAppDialog.find("#template").val(1);addAppDialog.find("#tile-width").val(2);addAppDialog.find("#tile-height").val(1);addAppDialog.find("#bg-color").val(0);addAppDialog.find("#icon-class").val("fa-question")}});appBuildDialog=$("#app-build-dialog").dialog({autoOpen:!1,resizable:!1,width:640,height:320})});