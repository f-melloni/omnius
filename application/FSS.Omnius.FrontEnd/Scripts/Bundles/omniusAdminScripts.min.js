function CreateJsPlumbInstanceForRule(n){return newInstance=jsPlumb.getInstance({Endpoint:["Blank",{}],HoverPaintStyle:{strokeStyle:"#ff4000",lineWidth:2},ConnectionOverlays:[["Arrow",{location:1,length:12,width:15,height:12,foldback:.8}]]}),n.attr("id")||n.attr("id",AssingID()),newInstance.setContainer(n),newInstance.bind("click",function(n){this.detach(n);ChangedSinceLastSave=!0}),n.data("jsPlumbInstance",newInstance),newInstance}function AddToJsPlumb(n){n.attr("id")?itemId=n.attr("id"):(itemId=AssingID(),n.attr("id",itemId));n.draggable({revert:!1,drag:function(n,t){if(element=$(this),rule=element.parents(".rule"),rule.data("jsPlumbInstance").repaintEverything(),resourceRuleMode=rule.hasClass("resourceRule"),t.position.left=Math.round((t.position.left+element.width()/2)/20)*20-element.width()/2,t.position.top=Math.round((t.position.top+element.height()/2)/20)*20-element.height()/2,rightEdge=t.position.left+element.width()+(resourceRuleMode?20:122),bottomEdge=t.position.top+element.height()+20,limitChecked=!1,rule.width()<rightEdge+30&&(limits=CheckRuleResizeLimits(rule,resourceRuleMode),limitChecked=!0,rule.width(rightEdge+30)),rule.height()<bottomEdge&&(limitChecked||(limits=CheckRuleResizeLimits(rule,resourceRuleMode),limitChecked=!0),rule.height(bottomEdge)),limitChecked&&(rule.width()>limits.horizontal-10&&rule.width(limits.horizontal-10),rule.height()>limits.vertical-10&&rule.height(limits.vertical-10),limitChecked=!1),resourceRuleMode)t.position.left<10?t.position.left=10:t.position.left+element.width()+40>rule.width()&&(t.position.left=rule.width()-element.width()-40),t.position.top<10?t.position.top=10:t.position.top+element.height()+20>rule.height()&&(t.position.top=rule.height()-element.height()-20);else if(swimlane=element.parents(".swimlane"),t.position.left<0?t.position.left=0:t.position.left+element.width()+40>swimlane.width()&&(t.position.left=swimlane.width()-element.width()-40),t.position.top<0&&t.position.top>-50)t.position.top=0;else if(t.position.top<=-50){if(currentSwimlaneIndex=swimlane.index(),swimlaneCount=rule.find(".swimlane").length,currentSwimlaneIndex>0)return higherSwimlane=rule.find(".swimlane").eq(currentSwimlaneIndex-1).find(".swimlaneContentArea"),element.detach(),higherSwimlane.append(element),element.position.top=0,!1;t.position.top=0}else if(t.position.top+element.height()>swimlane.height()-20&&t.position.top+element.height()<=swimlane.height()+30)t.position.top=swimlane.height()-element.height()-20;else if(t.position.top+element.height()>swimlane.height()+30){if(currentSwimlaneIndex=swimlane.index(),swimlaneCount=rule.find(".swimlane").length,currentSwimlaneIndex<swimlaneCount-1)return lowerSwimlane=rule.find(".swimlane").eq(currentSwimlaneIndex+1).find(".swimlaneContentArea"),element.detach(),lowerSwimlane.append(element),element.position.top=lowerSwimlane.height()-element.height(),!1;t.position.top=swimlane.height()-element.height()-20}},stop:function(){instance=$(this).parents(".rule").data("jsPlumbInstance");instance.recalculateOffsets();instance.repaintEverything();ChangedSinceLastSave=!0}});n.css({left:Math.round((n.position().left+n.width()/2)/20)*20-n.width()/2,top:Math.round((n.position().top+n.height()/2)/20)*20-n.height()/2});instance=n.parents(".rule").data("jsPlumbInstance");specialEndpointsType=n.attr("endpoints");specialEndpointsType=="gateway"?(instance.addEndpoint(itemId,trueEndpoint,{anchor:"RightMiddle",uuid:itemId+"RightMiddle"}),instance.addEndpoint(itemId,falseEndpoint,{anchor:"BottomCenter",uuid:itemId+"BottomCenter"})):specialEndpointsType=="final"||n.hasClass("targetItem")||instance.addEndpoint(itemId,sourceEndpoint,{anchor:"RightMiddle",uuid:itemId+"RightMiddle"});instance.makeTarget(n,{dropOptions:{hoverClass:"dragHover"},anchor:"Continuous",allowLoopback:!1})}function ToolboxItemDraggable(n){n.find(".toolboxItem").draggable({helper:"clone",appendTo:"#tapestryWorkspace",containment:"window",tolerance:"fit",revert:!0,scroll:!0,start:function(){dragModeActive=!0}})}function AssingID(){return LastAssignedNumber++,"tapestryElement"+LastAssignedNumber}function AddIconToItem(n){item=$(n);item.hasClass("attribute")?item.prepend($('<i class="fa fa-database" style="margin-right: 6px;"><\/i>')):item.hasClass("port")?item.prepend($('<i class="fa fa-sign-out" style="margin-left: 1px; margin-right: 5px;"><\/i>')):item.hasClass("role")?item.prepend($('<i class="fa fa-user" style="margin-left: 1px; margin-right: 6px;"><\/i>')):item.hasClass("view")?item.prepend($('<i class="fa fa-paint-brush" style="margin-left: 1px; margin-right: 6px;"><\/i>')):item.hasClass("action")?item.prepend($('<i class="fa fa-cogs" style="margin-left: 1px; margin-right: 6px;"><\/i>')):item.hasClass("state")&&item.prepend($('<i class="fa fa-ellipsis-v" style="margin-left: 4px; margin-right: 8px;"><\/i>'))}function CheckRuleResizeLimits(n,t){return horizontalLimit=1e6,verticalLimit=1e6,ruleLeft=n.position().left,ruleRight=ruleLeft+n.width(),ruleTop=n.position().top,ruleBottom=n.position().top+n.height(),$(t?"#resourceRulesPanel .resourceRule":"#workflowRulesPanel .workflowRule").each(function(t,i){otherRule=$(i);otherRule.attr("id")!=n.attr("id")&&(otherRuleLeft=otherRule.position().left,otherRuleRight=otherRuleLeft+otherRule.width(),otherRuleTop=otherRule.position().top,otherRuleBottom=otherRule.position().top+otherRule.height(),otherRuleTop<ruleBottom&&otherRuleBottom>ruleTop&&otherRuleLeft+30>ruleRight&&otherRuleLeft-ruleLeft<horizontalLimit&&(horizontalLimit=otherRuleLeft-ruleLeft),otherRuleLeft<ruleRight&&otherRuleRight>ruleLeft&&otherRuleTop+20>ruleBottom&&otherRuleTop-ruleTop<verticalLimit&&(verticalLimit=otherRuleTop-ruleTop))}),{horizontal:horizontalLimit,vertical:verticalLimit}}function GetIsBootstrap(n){var t=n.attr("isbootstrap");return t&&(t==!0||t=="true")?!0:!1}function GetItemTypeClass(n){return typeClass=n.hasClass("actionItem")?"actionItem":n.hasClass("attributeItem")?"attributeItem":n.hasClass("uiItem")?"uiItem":n.hasClass("roleItem")?"roleItem":n.hasClass("stateItem")?"stateItem":n.hasClass("targetItem")?"targetItem":n.hasClass("templateItem")?"templateItem":n.hasClass("symbol")?"symbol":""}function RecalculateToolboxHeight(){var i=$("#tapestryLeftBar"),r=$(window).scrollTop(),n=$("#lowerPanel").offset().top,u=$("#topBar").height()+$("#appNotificationArea").height(),t;t=r>n-u?window.innerHeight-u:$(window).height()+r-n-i.position().top;i.height(t);$("#lowerPanelSpinnerOverlay").height(t);$("#workflowRulesPanel").height($(window).height()-105);$("#tapestryLeftBarMinimized").height($("#workflowRulesPanel").offset().top+$("#workflowRulesPanel").height()-n)}function LoadConditionColumns(n){for(columnSelect=n.find(".conditionVariableCell select"),i=0;i<CurrentTableColumnArray.length;i++){cData=CurrentTableColumnArray[i];switch(cData.Type){case"varchar":columnType="string";break;case"boolean":columnType="bool";break;case"integer":columnType="int";break;default:columnType="unknown"}columnSelect.append($('<option varType="'+columnType+'">'+cData.Name+"<\/option>"))}var t=$("option:selected",columnSelect);varType=t.attr("varType");currentCondition=columnSelect.parents("tr");currentCondition.find(".conditionOperatorCell select, .conditionValueCell select, .conditionValueCell input").remove();switch(varType){case"bool":currentCondition.find(".conditionValueCell").append($('<select><option selected="selected">b$true<\/option><option>b$false<\/option><\/select>'));currentCondition.find(".conditionOperatorCell").append($('<select><option selected="selected">==<\/option><option>!=<\/option><\/select>'));break;case"int":currentCondition.find(".conditionValueCell").append($('<input type="number"><\/input>'));currentCondition.find(".conditionOperatorCell").append($('<select><option selected="selected">==<\/option><option>!=<\/option><option>&gt;<\/option><option>&gt;=<\/option><option>&lt;<\/option><option>&lt;=<\/option>'));break;case"string":currentCondition.find(".conditionValueCell").append($('<input type="text"><\/input>'));currentCondition.find(".conditionOperatorCell").append($('<select><option selected="selected">==<\/option><option>!=<\/option><option>contains<\/option><option inputType="none">is empty<\/option><option inputType="none">is not empty<\/option><\/select>'));break;case"unknown":default:currentCondition.find(".conditionValueCell").append($('<input type="text"><\/input>'));currentCondition.find(".conditionOperatorCell").append($('<select><option selected="selected">==<\/option><option>!=<\/option><option>&gt;<\/option><option>&gt;=<\/option><option>&lt;<\/option><option>&lt;=<\/option><option>contains<\/option><option inputType="none">is empty<\/option><option inputType="none">is not empty<\/option><\/select>'))}}function SaveBlock(n){pageSpinner.show();resourceRulesArray=[];workflowRulesArray=[];portTargetsArray=[];saveId=0;$(".activeItem, .processedItem").removeClass("activeItem processedItem");$("#resourceRulesPanel .resourceRule").each(function(n,t){for(itemArray=[],connectionArray=[],currentRule=$(t),currentRule.find(".item").each(function(n,t){currentItem=$(t);currentItem.attr("saveId",saveId);saveId++;itemArray.push({Id:currentItem.attr("saveId"),Label:currentItem.text(),TypeClass:GetItemTypeClass(currentItem),PositionX:parseInt(currentItem.css("left")),PositionY:parseInt(currentItem.css("top")),ActionId:currentItem.attr("actionid"),StateId:currentItem.attr("stateid"),PageId:GetIsBootstrap(currentItem)?null:currentItem.attr("pageId"),ComponentName:currentItem.attr("componentName"),IsBootstrap:GetIsBootstrap(currentItem),BootstrapPageId:GetIsBootstrap(currentItem)?currentItem.attr("pageId"):null,TableName:currentItem.attr("tableName"),IsShared:currentItem.attr("shared")==="true",ColumnName:currentItem.attr("columnName"),ColumnFilter:currentItem.data("columnFilter"),ConditionSets:currentItem.data("conditionSets")})}),currentInstance=currentRule.data("jsPlumbInstance"),jsPlumbConnections=currentInstance.getAllConnections(),i=0;i<jsPlumbConnections.length;i++)currentConnection=jsPlumbConnections[i],sourceDiv=$(currentConnection.source),targetDiv=$(currentConnection.target),connectionArray.push({SourceId:sourceDiv.attr("saveId"),SourceSlot:0,TargetId:targetDiv.attr("saveId"),TargetSlot:0});resourceRulesArray.push({Id:n,Width:parseInt(currentRule.css("width")),Height:parseInt(currentRule.css("height")),PositionX:parseInt(currentRule.css("left")),PositionY:parseInt(currentRule.css("top")),ResourceItems:itemArray,Connections:connectionArray})});$("#workflowRulesPanel .workflowRule").each(function(n,t){for(swimlanesArray=[],currentRule=$(t),currentRule.find(".swimlane").each(function(n,t){currentSwimlane=$(t);currentSwimlane.attr("swimlaneIndex",n);rolesArray=[];itemArray=[];symbolArray=[];connectionArray=[];currentSwimlane.find(".swimlaneRolesArea .roleItem").each(function(n,t){rolesArray.push($(t).text())});currentSwimlane.find(".item, .symbol").each(function(n,t){currentItem=$(t);currentItem.attr("saveId",saveId);saveId++;itemArray.push({Id:currentItem.attr("saveId"),Label:currentItem.find(".itemLabel").length?currentItem.find(".itemLabel").text():currentItem.data("label"),TypeClass:GetItemTypeClass(currentItem),DialogType:currentItem.attr("dialogType"),StateId:currentItem.attr("stateid"),TargetId:currentItem.attr("targetid"),PositionX:parseInt(currentItem.css("left")),PositionY:parseInt(currentItem.css("top")),ActionId:currentItem.attr("actionid"),InputVariables:currentItem.data("inputVariables"),OutputVariables:currentItem.data("outputVariables"),PageId:currentItem.attr("pageId"),ComponentName:currentItem.attr("componentName"),IsBootstrap:GetIsBootstrap(currentItem),isAjaxAction:currentItem.data("isAjaxAction"),Condition:currentItem.data("condition"),ConditionSets:currentItem.data("conditionSets"),SymbolType:currentItem.attr("symbolType")})});swimlanesArray.push({SwimlaneIndex:n,Height:parseInt(currentSwimlane.css("height")),Roles:rolesArray,WorkflowItems:itemArray})}),currentInstance=currentRule.data("jsPlumbInstance"),jsPlumbConnections=currentInstance.getAllConnections(),i=0;i<jsPlumbConnections.length;i++)currentConnection=jsPlumbConnections[i],sourceDiv=$(currentConnection.source),targetDiv=$(currentConnection.target),sourceEndpointUuid=currentConnection.endpoints[0].getUuid(),sourceSlot=sourceEndpointUuid.match("BottomCenter$")?1:0,sourceDiv.hasClass("subSymbol")||connectionArray.push({SourceId:sourceDiv.attr("saveId"),SourceSlot:sourceSlot,TargetId:targetDiv.attr("saveId"),TargetSlot:0});workflowRulesArray.push({Id:n,Name:currentRule.find(".workflowRuleHeader .verticalLabel").text(),Width:parseInt(currentRule.css("width")),Height:parseInt(currentRule.css("height")),PositionX:parseInt(currentRule.css("left")),PositionY:parseInt(currentRule.css("top")),Swimlanes:swimlanesArray,Connections:connectionArray})});toolboxState={Actions:[],Attributes:[],UiComponents:[],Roles:[],States:[],Targets:[],Templates:[],Integrations:[]};$(".tapestryToolbox .toolboxItem").each(function(n,t){toolboxItem=$(t);toolboxItemData={Label:toolboxItem.find(".itemLabel").text(),ActionId:toolboxItem.attr("ActionId"),TableName:toolboxItem.attr("TableName")?toolboxItem.attr("TableName"):null,IsShared:toolboxItem.attr("shared")==="true",ColumnName:toolboxItem.attr("ColumnName")?toolboxItem.attr("ColumnName"):null,PageId:toolboxItem.attr("PageId"),ComponentName:toolboxItem.attr("ComponentName")?toolboxItem.attr("ComponentName"):null,IsBootstrap:GetIsBootstrap(toolboxItem),StateId:toolboxItem.attr("StateId"),TargetName:toolboxItem.attr("TargetName")?toolboxItem.attr("TargetName"):null,TargetId:toolboxItem.attr("TargetId")};toolboxItem.hasClass("actionItem")?(toolboxItemData.TypeClass="actionItem",toolboxState.Actions.push(toolboxItemData)):toolboxItem.hasClass("attributeItem")?(toolboxItemData.TypeClass="attributeItem",toolboxState.Attributes.push(toolboxItemData)):toolboxItem.hasClass("uiItem")?(toolboxItemData.TypeClass="uiItem",toolboxState.UiComponents.push(toolboxItemData)):toolboxItem.hasClass("roleItem")?(toolboxItemData.TypeClass="roleItem",toolboxState.Roles.push(toolboxItemData)):toolboxItem.hasClass("stateItem")?(toolboxItemData.TypeClass="stateItem",toolboxState.States.push(toolboxItemData)):toolboxItem.hasClass("targetItem")?(toolboxItemData.TypeClass="targetItem",toolboxState.Targets.push(toolboxItemData)):toolboxItem.hasClass("templateItem")?(toolboxItemData.TypeClass="templateItem",toolboxState.Templates.push(toolboxItemData)):toolboxItem.hasClass("integrationItem")&&(toolboxItemData.TypeClass="integrationItem",toolboxState.Integrations.push(toolboxItemData))});postData={CommitMessage:n,Name:$("#blockHeaderBlockName").text(),ResourceRules:resourceRulesArray,WorkflowRules:workflowRulesArray,PortTargets:portTargetsArray,ModelTableName:ModelTableName,AssociatedTableName:AssociatedTableName,AssociatedPageIds:AssociatedPageIds,AssociatedBootstrapPageIds:AssociatedBootstrapPageIds,AssociatedTableIds:AssociatedTableIds,RoleWhitelist:RoleWhitelist,ToolboxState:toolboxState,ParentMetablockId:$("#parentMetablockId").val()};appId=$("#currentAppId").val();blockId=$("#currentBlockId").val();$.ajax({type:"POST",url:"/api/tapestry/apps/"+appId+"/blocks/"+blockId,data:postData,complete:function(){pageSpinner.hide()},success:function(){ChangedSinceLastSave=!1;alert("OK")}})}function LoadBlock(n){console.log("LOADING BLOCKSS");pageSpinner.show();appId=$("#currentAppId").val();blockId=$("#currentBlockId").val();url=n?"/api/tapestry/apps/"+appId+"/blocks/"+blockId+"/commits/"+n:"/api/tapestry/apps/"+appId+"/blocks/"+blockId;$.ajax({type:"GET",url:url,dataType:"json",complete:function(){pageSpinner.hide()},success:function(n){for(ChangedSinceLastSave=!1,$("#resourceRulesPanel .resourceRule").remove(),$("#workflowRulesPanel .workflowRule").remove(),$("#blockHeaderBlockName").text(n.Name),console.log("Obtained data from server."),i=0;i<n.ResourceRules.length;i++){for(console.log("Iterating resource rule"),currentRuleData=n.ResourceRules[i],newRule=$('<div class="rule resourceRule" style="width: '+currentRuleData.Width+"px; height: "+currentRuleData.Height+"px; left: "+currentRuleData.PositionX+"px; top: "+currentRuleData.PositionY+'px;"><\/div>'),newRule.attr("id",AssingID()),$("#resourceRulesPanel .scrollArea").append(newRule),newRule.draggable({containment:"parent",revert:function(){return $(this).collision("#resourceRulesPanel .resourceRule").length>1},stop:function(){ChangedSinceLastSave=!0}}),newRule.resizable({start:function(){rule=$(this);contentsWidth=120;contentsHeight=40;rule.find(".item").each(function(n,t){rightEdge=$(t).position().left+$(t).width();rightEdge>contentsWidth&&(contentsWidth=rightEdge);bottomEdge=$(t).position().top+$(t).height();bottomEdge>contentsHeight&&(contentsHeight=bottomEdge)});rule.css("min-width",contentsWidth+40);rule.css("min-height",contentsHeight+20);limits=CheckRuleResizeLimits(rule,!0);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},resize:function(){rule=$(this);limits=CheckRuleResizeLimits(rule,!0);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},stop:function(){instance=$(this).data("jsPlumbInstance");instance.recalculateOffsets();instance.repaintEverything();ChangedSinceLastSave=!0}}),CreateJsPlumbInstanceForRule(newRule),newRule.droppable({containment:".resourceRule",tolerance:"touch",accept:".toolboxItem",greedy:!0,drop:function(n,t){dragModeActive&&(dragModeActive=!1,droppedElement=t.helper.clone(),droppedElement.removeClass("toolboxItem"),droppedElement.addClass("item"),droppedElement.css({width:"",height:""}),$(this).append(droppedElement),ruleContent=$(this),leftOffset=$("#tapestryWorkspace").offset().left-ruleContent.offset().left+20,topOffset=$("#tapestryWorkspace").offset().top-ruleContent.offset().top,droppedElement.offset({left:droppedElement.offset().left+leftOffset,top:droppedElement.offset().top+topOffset}),t.helper.remove(),AddToJsPlumb(droppedElement),droppedElement.position().left+droppedElement.width()+35>ruleContent.width()&&(droppedElement.css("left",ruleContent.width()-droppedElement.width()-40),instance=ruleContent.data("jsPlumbInstance"),instance.repaintEverything()),droppedElement.position().top+droppedElement.height()+5>ruleContent.height()&&(droppedElement.css("top",ruleContent.height()-droppedElement.height()-15),instance=ruleContent.data("jsPlumbInstance"),instance.repaintEverything()),ChangedSinceLastSave=!0)}}),j=0;j<currentRuleData.ResourceItems.length;j++)console.log("Got item data:"),console.log(currentItemData),currentItemData=currentRuleData.ResourceItems[j],newItem=$('<div id="resItem'+currentItemData.Id+'" class="item" style="left: '+currentItemData.PositionX+"px; top: "+currentItemData.PositionY+'px;">'+currentItemData.Label+"<\/div>"),currentItemData.ActionId!=null&&newItem.attr("actionId",currentItemData.ActionId),currentItemData.StateId!=null&&newItem.attr("stateId",currentItemData.StateId),currentItemData.PageId!=null&&newItem.attr("pageId",currentItemData.PageId),currentItemData.ComponentName!=null&&newItem.attr("componentName",currentItemData.ComponentName),currentItemData.TableName!=null&&(newItem.data("columnFilter",currentItemData.ColumnFilter),newItem.attr("tableName",currentItemData.TableName),currentItemData.Label.indexOf("View:")==0?newItem.addClass("viewAttribute"):newItem.addClass("tableAttribute")),currentItemData.IsShared!=null&&currentItemData!=!1&&newItem.attr("shared",currentItemData.IsShared),currentItemData.ColumnName!=null&&newItem.attr("columnName",currentItemData.ColumnName),currentItemData.ConditionSets!=null&&newItem.data("conditionSets",currentItemData.ConditionSets),currentItemData.IsBootstrap!=null&&newItem.attr("isBootstrap",currentItemData.IsBootstrap),newItem.addClass(currentItemData.TypeClass),newRule.append(newItem),AddToJsPlumb(newItem);for(currentInstance=newRule.data("jsPlumbInstance"),j=0;j<currentRuleData.Connections.length;j++)currentConnectionData=currentRuleData.Connections[j],currentInstance.connect({uuids:["resItem"+currentConnectionData.SourceId+"RightMiddle"],target:"resItem"+currentConnectionData.TargetId})}for(i=0;i<n.WorkflowRules.length;i++){for(currentRuleData=n.WorkflowRules[i],newRule=$('<div class="rule workflowRule" style="width: '+currentRuleData.Width+"px; height: "+currentRuleData.Height+"px; left: "+currentRuleData.PositionX+"px; top: "+currentRuleData.PositionY+'px;"><div class="workflowRuleHeader"><div class="verticalLabel" style="margin-top: 0px;">'+currentRuleData.Name+'<\/div><\/div><div class="swimlaneArea"><\/div><\/div>'),newRule.attr("id",AssingID()),$("#workflowRulesPanel .scrollArea").append(newRule),newRule.draggable({containment:"parent",handle:".workflowRuleHeader",revert:function(){return $(this).collision("#workflowRulesPanel .workflowRule").length>1},stop:function(){ChangedSinceLastSave=!0}}),newRule.resizable({start:function(){rule=$(this);contentsWidth=120;contentsHeight=40;rule.find(".item").each(function(n,t){rightEdge=$(t).position().left+$(t).width();rightEdge>contentsWidth&&(contentsWidth=rightEdge);bottomEdge=$(t).position().top+$(t).height();bottomEdge>contentsHeight&&(contentsHeight=bottomEdge)});rule.css("min-width",contentsWidth+40);rule.css("min-height",contentsHeight+20);limits=CheckRuleResizeLimits(rule,!1);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},resize:function(){rule=$(this);instance=rule.data("jsPlumbInstance");instance.recalculateOffsets();instance.repaintEverything();limits=CheckRuleResizeLimits(rule,!1);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},stop:function(){ChangedSinceLastSave=!0}}),CreateJsPlumbInstanceForRule(newRule),j=0;j<currentRuleData.Swimlanes.length;j++){for(currentSwimlaneData=currentRuleData.Swimlanes[j],newSwimlane=$('<div class="swimlane" style="height: '+100/currentRuleData.Swimlanes.length+'%;"><div class="swimlaneRolesArea"><div class="roleItemContainer"><\/div><div class="rolePlaceholder"><div class="rolePlaceholderLabel">Pokud chcete specifikovat roli<br />přetáhněte ji do této oblasti<\/div><\/div><\/div><div class="swimlaneContentArea"><\/div><\/div>'),newRule.find(".swimlaneArea").append(newSwimlane),currentSwimlaneData.Roles.length>0&&newSwimlane.find(".swimlaneRolesArea .rolePlaceholder").remove(),k=0;k<currentSwimlaneData.Roles.length;k++)newSwimlane.find(".swimlaneRolesArea .roleItemContainer").append($('<div class="roleItem">'+currentSwimlaneData.Roles[k]+"<\/div>"));for(k=0;k<currentSwimlaneData.WorkflowItems.length;k++)currentItemData=currentSwimlaneData.WorkflowItems[k],newItem=currentItemData.TypeClass==="symbol"&&currentItemData.SymbolType==="comment"?$('<div id="wfItem'+currentItemData.Id+'" class="symbol" symbolType="comment" endpoints="final" style="left: '+currentItemData.PositionX+"px; top: "+currentItemData.PositionY+'px; width: 30px; padding: 3px; border: 2px solid grey; border-right: none; min-height: 60px;"> <span class="itemLabel">'+currentItemData.Label+"<\/span><\/div>"):currentItemData.TypeClass=="symbol"?$('<img id="wfItem'+currentItemData.Id+'" class="symbol" symbolType="'+currentItemData.SymbolType+'" src="/Content/images/TapestryIcons/'+currentItemData.SymbolType+'.png" style="left: '+currentItemData.PositionX+"px; top: "+currentItemData.PositionY+'px;" />'):$('<div id="wfItem'+currentItemData.Id+'" class="item" style="left: '+currentItemData.PositionX+"px; top: "+currentItemData.PositionY+'px;"><span class="itemLabel">'+currentItemData.Label+"<\/span><\/div>"),newItem.addClass(currentItemData.TypeClass),currentItemData.ActionId!=null&&newItem.attr("actionId",currentItemData.ActionId),currentItemData.InputVariables!=null&&newItem.data("inputVariables",currentItemData.InputVariables),currentItemData.OutputVariables!=null&&newItem.data("outputVariables",currentItemData.OutputVariables),currentItemData.PageId!=null&&newItem.attr("pageId",currentItemData.PageId),currentItemData.ComponentName!=null&&newItem.attr("componentName",currentItemData.ComponentName),currentItemData.TargetId!=null&&newItem.attr("targetId",currentItemData.TargetId),currentItemData.StateId!=null&&newItem.attr("stateId",currentItemData.StateId),currentItemData.isAjaxAction!=null&&newItem.data("isAjaxAction",currentItemData.isAjaxAction),currentItemData.TypeClass=="circle-thick"&&newItem.attr("endpoints","final"),currentItemData.SymbolType&&currentItemData.SymbolType.substr(0,8)=="gateway-"&&newItem.attr("endpoints","gateway"),currentItemData.Condition!=null&&newItem.data("condition",currentItemData.Condition),currentItemData.ConditionSets!=null&&newItem.data("conditionSets",currentItemData.ConditionSets),currentItemData.IsBootstrap!=null&&newItem.attr("isBootstrap",currentItemData.IsBootstrap),targetSwimlane=newRule.find(".swimlane").eq(currentSwimlaneData.SwimlaneIndex).find(".swimlaneContentArea"),targetSwimlane.append(newItem),AddToJsPlumb(newItem)}for(newRule.find(".swimlaneRolesArea").droppable({tolerance:"touch",accept:".toolboxItem.roleItem",greedy:!0,drop:function(n,t){dragModeActive&&(dragModeActive=!1,roleExists=!1,$(this).find(".roleItem").each(function(n,i){$(i).text()==t.helper.text()&&(roleExists=!0)}),roleExists||(droppedElement=t.helper.clone(),$(this).find(".rolePlaceholder").remove(),$(this).find(".roleItemContainer").append($('<div class="roleItem">'+droppedElement.text()+"<\/div>")),t.helper.remove(),ChangedSinceLastSave=!0))}}),newRule.find(".swimlaneContentArea").droppable({containment:".swimlaneContentArea",tolerance:"touch",accept:".toolboxSymbol, .toolboxItem",greedy:!1,drop:function(n,t){if(dragModeActive){if(dragModeActive=!1,droppedElement=t.helper.clone(),droppedElement.hasClass("roleItem"))return t.draggable.draggable("option","revert",!0),!1;ruleContent=$(this);ruleContent.append(droppedElement);droppedElement.hasClass("toolboxSymbol")?(droppedElement.removeClass("toolboxSymbol ui-draggable ui-draggable-dragging"),droppedElement.addClass("symbol"),droppedElement.css({height:""}),leftOffset=$("#tapestryWorkspace").offset().left-ruleContent.offset().left,topOffset=$("#tapestryWorkspace").offset().top-ruleContent.offset().top):(droppedElement.removeClass("toolboxItem"),droppedElement.addClass("item"),droppedElement.css({width:"",height:""}),leftOffset=$("#tapestryWorkspace").offset().left-ruleContent.offset().left+38,topOffset=$("#tapestryWorkspace").offset().top-ruleContent.offset().top-18);droppedElement.offset({left:droppedElement.offset().left+leftOffset,top:droppedElement.offset().top+topOffset});t.helper.remove();AddToJsPlumb(droppedElement);droppedElement.position().top+droppedElement.height()+10>ruleContent.height()&&(droppedElement.css("top",ruleContent.height()-droppedElement.height()-20),instance=ruleContent.parents(".workflowRule").data("jsPlumbInstance"),instance.repaintEverything());ChangedSinceLastSave=!0}}}),currentInstance=newRule.data("jsPlumbInstance"),j=0;j<currentRuleData.Connections.length;j++)currentConnectionData=currentRuleData.Connections[j],sourceId="wfItem"+currentConnectionData.SourceId,targetId="wfItem"+currentConnectionData.TargetId,sourceEndpointUuid=currentConnectionData.SourceSlot==1?"BottomCenter":"RightMiddle",currentInstance.connect({uuids:[sourceId+sourceEndpointUuid],target:targetId})}for(RoleWhitelist=n.RoleWhitelist,$("#blockHeaderRolesCount").text(RoleWhitelist.length),appId=$("#currentAppId").val(),pageSpinner.show(),$.ajax({type:"GET",url:"/api/database/apps/"+appId+"/commits/latest",dataType:"json",complete:function(){pageSpinner.hide()},success:function(t){for(console.log("Got tables data:"),console.log(t),attributesInToolboxState=n.ToolboxState?n.ToolboxState.Attributes:[],$(".tapestryToolbox .toolboxLi_Attributes").remove(),tableIndex=0;tableIndex<t.Tables.length;tableIndex++)attributeLibId=++lastLibId,attributeLibraryItem=$('<div libId="'+ ++attributeLibId+'" libType="table-attribute" class="libraryItem tableAttribute" tableName="'+t.Tables[tableIndex].Name+'">Table: '+t.Tables[tableIndex].Name+"<\/div>"),$("#libraryCategory-Attributes").append(attributeLibraryItem),attributeMatch=attributesInToolboxState.filter(function(n){return!n.ColumnName&&n.TableName==t.Tables[tableIndex].Name}).length,attributeMatch&&(newToolboxLiAttribute=$('<li libId="'+attributeLibId+'" class="toolboxLi toolboxLi_Attributes"><div class="toolboxItem attributeItem tableAttribute" tableName="'+t.Tables[tableIndex].Name+'"><span class="itemLabel">Table: '+t.Tables[tableIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_UI").before(newToolboxLiAttribute),ToolboxItemDraggable(newToolboxLiAttribute),attributeLibraryItem.addClass("highlighted"));for(viewIndex=0;viewIndex<t.Views.length;viewIndex++)attributeLibId=++lastLibId,attributeLibraryItem=$('<div libId="'+ ++attributeLibId+'" libType="view-attribute" class="libraryItem viewAttribute" tableName="'+t.Views[viewIndex].Name+'">View: '+t.Views[viewIndex].Name+"<\/div>"),$("#libraryCategory-Attributes").append(attributeLibraryItem),attributeMatch=attributesInToolboxState.filter(function(n){return!n.ColumnName&&n.TableName==t.Views[viewIndex].Name}).length,attributeMatch&&(newToolboxLiAttribute=$('<li libId="'+attributeLibId+'" class="toolboxLi toolboxLi_Attributes"><div class="toolboxItem attributeItem viewAttribute" tableName="'+t.Views[viewIndex].Name+'"><span class="itemLabel">View: '+t.Views[viewIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_UI").before(newToolboxLiAttribute),ToolboxItemDraggable(newToolboxLiAttribute),attributeLibraryItem.addClass("highlighted"));for(AssociatedTableIds=n.AssociatedTableIds,AssociatedTableName=n.AssociatedTableName,ModelTableName=n.ModelTableName,$("#blockHeaderDbResCount").text(n.AssociatedTableName.length),somethingWasAdded=!1,tableIndex=0;tableIndex<n.AssociatedTableName.length;tableIndex++){if(currentTable=t.Tables.filter(function(t){return t.Name==n.AssociatedTableName[tableIndex]})[0],currentTable!=undefined)for(columnIndex=0;columnIndex<currentTable.Columns.length;columnIndex++)attributeLibId=++lastLibId,attributeLibraryItem=$('<div libId="'+attributeLibId+'" libType="column-attribute" class="libraryItem columnAttribute" tableName="'+currentTable.Name+'" columnName="'+currentTable.Columns[columnIndex].Name+'">'+currentTable.Name+"."+currentTable.Columns[columnIndex].Name+"<\/div>"),$("#libraryCategory-Attributes").append(attributeLibraryItem),attributeMatch=attributesInToolboxState.filter(function(n){return n.ColumnName==currentTable.Columns[columnIndex].Name&&n.TableName==currentTable.Name}).length,attributeMatch&&(newToolboxLiAttribute=$('<li libId="'+attributeLibId+'" class="toolboxLi toolboxLi_Attributes"><div class="toolboxItem attributeItem tableAttribute" tableName="'+currentTable.Name+'" columnName="'+currentTable.Columns[columnIndex].Name+'"><span class="itemLabel">'+currentTable.Name+"."+currentTable.Columns[columnIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_UI").before(newToolboxLiAttribute),ToolboxItemDraggable(newToolboxLiAttribute),attributeLibraryItem.addClass("highlighted"));if(systemTable=SystemTables.filter(function(t){return t.Name==n.AssociatedTableName[tableIndex]})[0],systemTable)for(i=0;i<systemTable.Columns.length;i++)$("#libraryCategory-Attributes").append($('<div libId="'+ ++lastLibId+'" libType="column-attribute" class="libraryItem columnAttribute" tableName="'+systemTable.Name+'" columnName="'+systemTable.Columns[i]+'">'+systemTable.Name+"."+systemTable.Columns[i]+"<\/div>"))}}}),pageSpinner.show(),$(".libraryItem").remove(),$.ajax({type:"GET",url:"/api/tapestry/actions",dataType:"json",complete:function(){pageSpinner.hide()},success:function(t){for(actionsInToolboxState=n.ToolboxState?n.ToolboxState.Actions:[],$(".tapestryToolbox .toolboxLi_Actions").remove(),actionIndex=0;actionIndex<t.Items.length;actionIndex++)actionLibId=++lastLibId,actionLibraryItem=$('<div libId="'+actionLibId+'" libType="action" class="libraryItem" actionId="'+t.Items[actionIndex].Id+'">'+t.Items[actionIndex].Name+"<\/div>"),$("#libraryCategory-Actions").append(actionLibraryItem),actionMatch=actionsInToolboxState.filter(function(n){return n.ActionId==t.Items[actionIndex].Id}).length,actionMatch&&(newToolboxLiAction=$('<li libId="'+actionLibId+'" class="toolboxLi toolboxLi_Actions"><div class="toolboxItem actionItem" actionId="'+t.Items[actionIndex].Id+'"><span class="itemLabel">'+t.Items[actionIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Attributes").before(newToolboxLiAction),ToolboxItemDraggable(newToolboxLiAction),actionLibraryItem.addClass("highlighted"))}}),pageSpinner.show(),$.ajax({type:"GET",url:"/api/Persona/app-roles/"+appId,dataType:"json",complete:function(){pageSpinner.hide()},success:function(t){for(rolesInToolboxState=n.ToolboxState?n.ToolboxState.Roles:[],$(".tapestryToolbox .toolboxLi_Roles").remove(),roleIndex=0;roleIndex<t.Roles.length;roleIndex++)roleLibId=++lastLibId,roleLibraryItem=$('<div libId="'+roleLibId+'" libType="role" class="libraryItem">'+t.Roles[roleIndex].Name+"<\/div>"),$("#libraryCategory-Roles").append(roleLibraryItem),roleMatch=rolesInToolboxState.filter(function(n){return n.Label==t.Roles[roleIndex].Name}).length,roleMatch&&(newToolboxLiRole=$('<li libId="'+roleLibId+'" class="toolboxLi toolboxLi_Roles"><div class="toolboxItem roleItem"><span class="itemLabel">'+t.Roles[roleIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_States").before(newToolboxLiRole),ToolboxItemDraggable(newToolboxLiRole),roleLibraryItem.addClass("highlighted"))}}),pageSpinner.show(),$.ajax({type:"GET",url:"/api/Persona/app-states/"+appId,dataType:"json",complete:function(){pageSpinner.hide()},success:function(t){for(statesInToolboxState=n.ToolboxState?n.ToolboxState.States:[],$(".tapestryToolbox .toolboxLi_States").remove(),stateIndex=0;stateIndex<t.States.length;stateIndex++)stateLibId=++lastLibId,stateLibraryItem=$('<div libId="'+stateLibId+'" libType="state" class="libraryItem" stateId="'+t.States[stateIndex].Id+'">'+t.States[stateIndex].Name+"<\/div>"),$("#libraryCategory-States").append(stateLibraryItem),stateMatch=statesInToolboxState.filter(function(n){return n.StateId==t.States[stateIndex].Id}).length,stateMatch&&(newToolboxLiState=$('<li libId="'+stateLibId+'" class="toolboxLi toolboxLi_States"><div class="toolboxItem stateItem" stateId="'+t.States[stateIndex].Id+'"><span class="itemLabel">'+t.States[stateIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Targets").before(newToolboxLiState),ToolboxItemDraggable(newToolboxLiState),stateLibraryItem.addClass("highlighted"))}}),pageSpinner.show(),$.ajax({type:"GET",url:"/api/tapestry/apps/"+appId+"/blocks",dataType:"json",complete:function(){pageSpinner.hide()},success:function(t){for(targetsInToolboxState=n.ToolboxState?n.ToolboxState.Targets:[],$(".tapestryToolbox .toolboxLi_Targets").remove(),targetIndex=0;targetIndex<t.ListItems.length;targetIndex++)targetLibId=++lastLibId,targetLibraryItem=$('<div libId="'+targetLibId+'" libType="target" class="libraryItem" targetId="'+t.ListItems[targetIndex].Id+'">'+t.ListItems[targetIndex].Name+"<\/div>"),$("#libraryCategory-Targets").append(targetLibraryItem),targetMatch=targetsInToolboxState.filter(function(n){return n.TargetId==t.ListItems[targetIndex].Id}).length,targetMatch&&(newToolboxLiTarget=$('<li libId="'+targetLibId+'" class="toolboxLi toolboxLi_Targets"><div class="toolboxItem targetItem" targetId="'+t.ListItems[targetIndex].Id+'"><span class="itemLabel">'+t.ListItems[targetIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Templates").before(newToolboxLiTarget),ToolboxItemDraggable(newToolboxLiTarget),targetLibraryItem.addClass("highlighted"))}}),pageSpinner.show(),$.ajax({type:"GET",url:"/api/hermes/"+appId+"/templates",dataType:"json",complete:function(){pageSpinner.hide()},success:function(t){for(templatesInToolboxState=n.ToolboxState?n.ToolboxState.Templates:[],$(".tapestryToolbox .toolboxLi_Templates").remove(),templateIndex=0;templateIndex<t.length;templateIndex++)templateLibId=++lastLibId,templateLibraryItem=$('<div libId="'+templateLibId+'" libType="template" class="libraryItem">'+t[templateIndex].Name+"<\/div>"),$("#libraryCategory-Templates").append(templateLibraryItem),templateMatch=templatesInToolboxState.filter(function(n){return n.Label==t[templateIndex].Name}).length,templateMatch&&(newToolboxLiIntegration=$('<li libId="'+templateLibId+'" class="toolboxLi toolboxLi_Templates"><div class="toolboxItem templateItem"><span class="itemLabel">'+t[templateIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Integrations").before(newToolboxLiIntegration),ToolboxItemDraggable(newToolboxLiIntegration),templateLibraryItem.addClass("highlighted"))}}),pageSpinner.show(),$.ajax({type:"GET",url:"/api/nexus/"+appId+"/gateways",dataType:"json",complete:function(){pageSpinner.hide()},success:function(t){for(integrationsInToolboxState=n.ToolboxState?n.ToolboxState.Integrations:[],$(".tapestryToolbox .toolboxLi_Integrations").remove(),integrationIndex=0;integrationIndex<t.Ldap.length;integrationIndex++)integrationLibId=++lastLibId,integrationLibraryItem=$('<div libId="'+integrationLibId+'" libType="ldap" class="libraryItem">LDAP: '+t.Ldap[integrationIndex].Name+"<\/div>"),$("#libraryCategory-Integration").append(integrationLibraryItem),integrationMatch=integrationsInToolboxState.filter(function(n){return n.Label=="LDAP: "+t.Ldap[integrationIndex].Name}).length,integrationMatch&&(newToolboxLiIntegration=$('<li libId="'+integrationLibId+'" class="toolboxLi toolboxLi_Integrations"><div class="toolboxItem integrationItem"><span class="itemLabel">LDAP: '+t.Ldap[integrationIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox").append(newToolboxLiIntegration),ToolboxItemDraggable(newToolboxLiIntegration),integrationLibraryItem.addClass("highlighted"));for(integrationIndex=0;integrationIndex<t.WS.length;integrationIndex++)integrationLibId=++lastLibId,integrationLibraryItem=$('<div libId="'+integrationLibId+'" libType="ws" libSubType="'+t.WS[integrationIndex].Type+'" class="libraryItem">WS: '+t.WS[integrationIndex].Name+"<\/div>"),$("#libraryCategory-Integration").append(integrationLibraryItem),integrationMatch=integrationsInToolboxState.filter(function(n){return n.Label=="WS: "+t.WS[integrationIndex].Name}).length,integrationMatch&&(newToolboxLiIntegration=$('<li libId="'+integrationLibId+'" class="toolboxLi toolboxLi_Integrations"><div class="toolboxItem integrationItem"><span class="itemLabel">WS: '+t.WS[integrationIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox").append(newToolboxLiIntegration),ToolboxItemDraggable(newToolboxLiIntegration),integrationLibraryItem.addClass("highlighted"));for(integrationIndex=0;integrationIndex<t.SMTP.length;integrationIndex++)integrationLibId=++lastLibId,integrationLibraryItem=$('<div libId="'+integrationLibId+'" libType="smtp" class="libraryItem">SMTP: '+t.SMTP[integrationIndex].Name+"<\/div>"),$("#libraryCategory-Integration").append(integrationLibraryItem),integrationMatch=integrationsInToolboxState.filter(function(n){return n.Label=="SMTP: "+t.SMTP[integrationIndex].Name}).length,integrationMatch&&(newToolboxLiIntegration=$('<li libId="'+integrationLibId+'" class="toolboxLi toolboxLi_Integrations"><div class="toolboxItem integrationItem"><span class="itemLabel">SMTP: '+t.SMTP[integrationIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox").append(newToolboxLiIntegration),ToolboxItemDraggable(newToolboxLiIntegration),integrationLibraryItem.addClass("highlighted"));for(integrationIndex=0;integrationIndex<t.WebDAV.length;integrationIndex++)integrationLibId=++lastLibId,integrationLibraryItem=$('<div libId="'+integrationLibId+'" libType="smtp" class="libraryItem">WebDAV: '+t.WebDAV[integrationIndex].Name+"<\/div>"),$("#libraryCategory-Integration").append(integrationLibraryItem),integrationMatch=integrationsInToolboxState.filter(function(n){return n.Label=="WebDAV: "+t.WebDAV[integrationIndex].Name}).length,integrationMatch&&(newToolboxLiIntegration=$('<li libId="'+integrationLibId+'" class="toolboxLi toolboxLi_Integrations"><div class="toolboxItem integrationItem"><span class="itemLabel">WebDAV: '+t.WebDAV[integrationIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox").append(newToolboxLiIntegration),ToolboxItemDraggable(newToolboxLiIntegration),integrationLibraryItem.addClass("highlighted"))}}),AssociatedPageIds=n.AssociatedPageIds,$("#blockHeaderScreenCount").text(n.AssociatedPageIds.length),uicInToolboxState=n.ToolboxState?n.ToolboxState.UiComponents:[],$(".tapestryToolbox .toolboxLi_UI").remove(),pageIndex=0;pageIndex<n.AssociatedPageIds.length;pageIndex++)pageId=n.AssociatedPageIds[pageIndex],pageSpinner.show(),$.ajax({type:"GET",url:"/api/mozaic-editor/apps/"+appId+"/pages/"+pageId,dataType:"json",complete:function(){pageSpinner.hide()},success:function(n){for(componentIndex=0;componentIndex<n.Components.length;componentIndex++)if(componentIndex==0&&(uicLibId=++lastLibId,uicLibraryItem=$('<div libId="'+uicLibId+'" pageId="'+n.Id+'" libType="ui" class="libraryItem">Screen: '+n.Name+"<\/div>"),$("#libraryCategory-UI").append(uicLibraryItem),uicMatch=uicInToolboxState.filter(function(t){return t.PageId==n.Id&&(!t.ComponentName||t.ComponentName=="undefined")}).length,uicMatch&&(newToolboxLiUic=$('<li libId="'+uicLibId+'" class="toolboxLi toolboxLi_UI"><div class="toolboxItem uiItem pageUi" pageId="'+n.Id+'"><span class="itemLabel">Screen: '+n.Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Roles").before(newToolboxLiUic),ToolboxItemDraggable(newToolboxLiUic),uicLibraryItem.addClass("highlighted"))),uicLibId=++lastLibId,uicLibraryItem=$('<div libId="'+uicLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].Name+'" libType="ui" class="libraryItem">'+n.Components[componentIndex].Name+"<\/div>"),$("#libraryCategory-UI").append(uicLibraryItem),uicMatch=uicInToolboxState.filter(function(t){return t.PageId==n.Id&&t.ComponentName==n.Components[componentIndex].Name}).length,uicMatch&&(newToolboxLiUic=$('<li libId="'+uicLibId+'" class="toolboxLi toolboxLi_UI"><div class="toolboxItem uiItem" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].Name+'"><span class="itemLabel">'+n.Components[componentIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Roles").before(newToolboxLiUic),ToolboxItemDraggable(newToolboxLiUic),uicLibraryItem.addClass("highlighted")),n.Components[componentIndex].Type=="data-table-with-actions"&&($("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].Name+'_EditAction" libType="ui" class="libraryItem">'+n.Components[componentIndex].Name+"_EditAction<\/div>"),$("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].Name+'_DetailsAction" libType="ui" class="libraryItem">'+n.Components[componentIndex].Name+"_DetailsAction<\/div>"),$("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].Name+'_DeleteAction" libType="ui" class="libraryItem">'+n.Components[componentIndex].Name+"_DeleteAction<\/div>"),$("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].Name+'_A_Action" libType="ui" class="libraryItem">'+n.Components[componentIndex].Name+"_A_Action<\/div>"),$("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].Name+'_B_Action" libType="ui" class="libraryItem">'+n.Components[componentIndex].Name+"_B_Action<\/div>")),n.Components[componentIndex].ChildComponents)for(childComponentIndex=0;childComponentIndex<n.Components[componentIndex].ChildComponents.length;childComponentIndex++)uicLibId=++lastLibId,uicLibraryItem=$('<div libId="'+uicLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+'" libType="ui" class="libraryItem">'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+"<\/div>"),$("#libraryCategory-UI").append(uicLibraryItem),uicMatch=uicInToolboxState.filter(function(t){return t.PageId==n.Id&&t.ComponentName==n.Components[componentIndex].ChildComponents[childComponentIndex].Name}).length,uicMatch&&(newToolboxLiUic=$('<li libId="'+uicLibId+'" class="toolboxLi toolboxLi_UI"><div class="toolboxItem uiItem" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+'"><span class="itemLabel">'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Roles").before(newToolboxLiUic),ToolboxItemDraggable(newToolboxLiUic),uicLibraryItem.addClass("highlighted")),n.Components[componentIndex].ChildComponents[childComponentIndex].Type=="data-table-with-actions"&&($("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+'_EditAction" libType="ui" class="libraryItem">'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+"_EditAction<\/div>"),$("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+'_DetailsAction" libType="ui" class="libraryItem">'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+"_DetailsAction<\/div>"),$("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+'_DeleteAction" libType="ui" class="libraryItem">'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+"_DeleteAction<\/div>"),$("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+'_A_Action" libType="ui" class="libraryItem">'+n.Components[componentIndex].Name+"_A_Action<\/div>"),$("#libraryCategory-UI").append('<div libId="'+ ++lastLibId+'" pageId="'+n.Id+'" componentName="'+n.Components[componentIndex].ChildComponents[childComponentIndex].Name+'_B_Action" libType="ui" class="libraryItem">'+n.Components[componentIndex].Name+"_B_Action<\/div>"))}})}})}function FillConditionsForLogicTableRow(n){for(n.find(".selectRelation option").remove(),i=0;i<ConditionsRelationList.length;i++)n.find(".selectRelation").append($('<option value="'+ConditionsRelationList[i]+'">'+ConditionsRelationList[i]+"<\/option>"));for(n.find(".selectField option").remove(),i=0;i<FakeInputsForTesting.length;i++)n.find(".selectField").append($('<option value="'+FakeInputsForTesting[i]+'">'+FakeInputsForTesting[i]+"<\/option>"));for(n.find(".selectOperator option").remove(),i=0;i<ConditionsOperatorList.length;i++)n.find(".selectOperator").append($('<option value="'+ConditionsOperatorList[i]+'">'+ConditionsOperatorList[i]+"<\/option>"))}function LoadModuleAdminScript(){$("#moduleAdminPanel .moduleSquare").on("click",function(){$("#moduleAdminPanel .moduleSquare").removeClass("selectedSquare");$(this).addClass("selectedSquare");$("#moduleConfigPanel .currentModuleIcon").css("background-image",$(this).css("background-image"));$("#moduleConfigPanel .currentModuleName").text($(this).attr("moduleName"))})}function SaveModulePermissions(){var t,n,i;for(permissionArray=[],t=$("#moduleAccessTable").dataTable().fnGetNodes(),n=0;n<t.length;n++)i=parseInt($(t[n]).find("td:eq(0)").text()),permissionArray.push({UserId:i,Core:$(t[n]).find("td[moduleId=Core]").hasClass("yesCell"),Master:$(t[n]).find("td[moduleId=Master]").hasClass("yesCell"),Tapestry:$(t[n]).find("td[moduleId=Tapestry]").hasClass("yesCell"),Entitron:$(t[n]).find("td[moduleId=Entitron]").hasClass("yesCell"),Persona:$(t[n]).find("td[moduleId=Persona]").hasClass("yesCell"),Nexus:$(t[n]).find("td[moduleId=Nexus]").hasClass("yesCell"),Sentry:$(t[n]).find("td[moduleId=Sentry]").hasClass("yesCell"),Hermes:$(t[n]).find("td[moduleId=Hermes]").hasClass("yesCell"),Athena:$(t[n]).find("td[moduleId=Athena]").hasClass("yesCell"),Watchtower:$(t[n]).find("td[moduleId=Watchtower]").hasClass("yesCell"),Cortex:$(t[n]).find("td[moduleId=Cortex]").hasClass("yesCell"),Mozaic:$(t[n]).find("td[moduleId=Mozaic]").hasClass("yesCell")});postData={PermissionList:permissionArray};$.ajax({type:"POST",url:"/api/persona/module-permissions",data:postData,success:function(){alert("Module permissions has been updated!")}})}function SaveMetablock(n,t){pageSpinner.show();blockArray=[];metablockArray=[];$("#overviewPanel .block").each(function(n,t){currentBlock=$(t);currentBlock.attr("tempId",n);currentBlock.attr("blockId")==undefined?(isNew=!0,currentBlock.attr("blockId",n)):isNew=!1;blockArray.push({Id:currentBlock.attr("blockId"),Name:currentBlock.find(".blockName").text(),AssociatedTableName:"",AssociatedTableId:currentBlock.attr("tableId"),PositionX:parseInt(currentBlock.css("left")),PositionY:parseInt(currentBlock.css("top")),IsNew:isNew,IsInitial:currentBlock.attr("isInitial")=="true",IsInMenu:currentBlock.data("IsInMenu")?!0:!1})});$("#overviewPanel .metablock").each(function(n,t){currentMetablock=$(t);currentMetablock.attr("tempId",n);currentMetablock.attr("metablockId")==undefined?(isNew=!0,currentMetablock.attr("metablockId",n)):isNew=!1;metablockArray.push({Id:currentMetablock.attr("metablockId"),Name:currentMetablock.find(".metablockName").text(),PositionX:parseInt(currentMetablock.css("left")),PositionY:parseInt(currentMetablock.css("top")),IsNew:isNew,IsInitial:currentMetablock.attr("isInitial")=="true",IsInMenu:currentMetablock.data("IsInMenu")?!0:!1})});postData={Name:$("#headerMetablockName").text(),Blocks:blockArray,Metablocks:metablockArray};appId=$("#currentAppId").val();metablockId=$("#currentMetablockId").val();$.ajax({type:"POST",url:"/api/tapestry/apps/"+appId+"/metablocks/"+metablockId,dataType:"json",data:postData,async:!t,complete:function(){pageSpinner.hide()},success:function(t){for(i=0;i<t.BlockIdPairs.length;i++)temporaryId=t.BlockIdPairs[i].TemporaryId,realId=t.BlockIdPairs[i].RealId,$("#overviewPanel .block[tempId='"+temporaryId+"']").attr("blockId",realId);for(i=0;i<t.MetablockIdPairs.length;i++)temporaryId=t.MetablockIdPairs[i].TemporaryId,realId=t.MetablockIdPairs[i].RealId,$("#overviewPanel .metablock[tempId='"+temporaryId+"']").attr("metablockId",realId);ChangedSinceLastSave=!1;n&&n()}})}function LoadMetablock(){pageSpinner.show();appId=$("#currentAppId").val();metablockId=$("#currentMetablockId").val();url="/api/tapestry/apps/"+appId+"/metablocks/"+metablockId;$.ajax({type:"GET",url:url,dataType:"json",complete:function(){pageSpinner.hide()},success:function(n){for($("#headerMetablockName").text(n.Name),$("#overviewPanel .block, #overviewPanel .metablock").each(function(n,t){instance.removeAllEndpoints(t,!0);$(t).remove()}),i=0;i<n.Blocks.length;i++){currentBlockData=n.Blocks[i];newBlock=$('<div class="block" id="block'+currentBlockData.Id+'" isInitial="'+currentBlockData.IsInitial+'" style="left: '+currentBlockData.PositionX+"px; top: "+currentBlockData.PositionY+'px;" blockId="'+currentBlockData.Id+'" tableId="'+currentBlockData.AssociatedTableId+'"><div class="blockName">'+currentBlockData.Name+'<\/div><div class="blockInfo">'+(currentBlockData.IsInitial?"Initial":"")+"<\/div><\/div>");newBlock.data("IsInMenu",currentBlockData.IsInMenu);$("#overviewPanel .scrollArea").append(newBlock);instance.draggable(newBlock,{containment:"parent",stop:function(){ChangedSinceLastSave=!0}});newBlock.on("dblclick",function(){blockToOpen=$(this);SaveMetablock(function(){openBlockForm=$("#openBlockForm");openBlockForm.find("input[name='blockId']").val(blockToOpen.attr("blockId"));openBlockForm.submit()})})}for(i=0;i<n.Metablocks.length;i++){currentMetablockData=n.Metablocks[i];newMetablock=$('<div class="metablock" id="metablock'+currentMetablockData.Id+'" isInitial="'+currentMetablockData.IsInitial+'"style="left: '+currentMetablockData.PositionX+"px; top: "+currentMetablockData.PositionY+'px;" metablockId="'+currentMetablockData.Id+'"><div class="metablockName">'+currentMetablockData.Name+'<\/div><div class="metablockSymbol fa fa-th-large"><\/div><div class="metablockInfo">'+(currentMetablockData.IsInitial?"Initial":"")+"<\/div><\/div>");newMetablock.data("IsInMenu",currentMetablockData.IsInMenu);$("#overviewPanel .scrollArea").append(newMetablock);instance.draggable(newMetablock,{containment:"parent",stop:function(){ChangedSinceLastSave=!0}});newMetablock.on("dblclick",function(){metablockToOpen=$(this);SaveMetablock(function(){openMetablockForm=$("#openMetablockForm");openMetablockForm.find("input[name='metablockId']").val(metablockToOpen.attr("metablockId"));openMetablockForm.submit()})})}for(i=0;i<n.Connections.length;i++)console.log("Connection"),currentConnectonData=n.Connections[i],sourceId=currentConnectonData.SourceType==1?"metablock"+currentConnectonData.SourceId:"block"+currentConnectonData.SourceId,targetId=currentConnectonData.TargetType==1?"metablock"+currentConnectonData.TargetId:"block"+currentConnectonData.TargetId,instance.connect({source:sourceId,target:targetId,editable:!1,paintStyle:connectorPaintStyle})}})}function ShowWsdlButtonClick(n){encodedString=$(n).parents("td").find(".wsdlFileString").text();CurrentWsdlFile=$("<div/>").html(encodedString).text();showWsdlDialog.dialog("open")}function RecalculateMozaicToolboxHeight(){var r=$("#mozaicLeftBar"),u=$("#mozaicLeftBarMinimized"),n=$(window).scrollTop(),t=$("#lowerPanel").offset().top,f=$("#topBar").height()+$("#appNotificationArea").height(),i;i=n>t-f?window.innerHeight-f:$(window).height()+n-t-r.position().top;r.height(i);$("#lowerPanelSpinnerOverlay").height(i);u.height($(window).height()+n-t-u.position().top)}function CreateDroppableMozaicContainer(n,t){n.droppable({containment:"parent",tolerance:"fit",accept:".toolboxItem",greedy:!0,accept:function(n){return n.hasClass("toolboxItem")&&(!n.hasClass("panel-component")||t)?!0:!1},drop:function(t,i){droppedElement=i.helper.clone();droppedElement.removeClass("toolboxItem");droppedElement.removeClass("ui-draggable-dragging");droppedElement.addClass("uic");var r=droppedElement;droppedElement.hasClass("radio-control")||droppedElement.attr("uicName","");droppedElement.attr("uicStyles","");droppedElement.attr("placeholder","");thisContainer=$(this);thisContainer.append(droppedElement);thisContainer.hasClass("panel-component")&&(droppedElement.css("left",parseInt(droppedElement.css("left"))-parseInt(thisContainer.css("left"))),droppedElement.css("top",parseInt(droppedElement.css("top"))-parseInt(thisContainer.css("top"))));droppedElement.hasClass("breadcrumb-navigation")?droppedElement.css("width","600px"):droppedElement.hasClass("data-table")?(CreateCzechDataTable(droppedElement,droppedElement.hasClass("data-table-simple-mode")),droppedElement.css("width","1000px"),wrapper=droppedElement.parents(".dataTables_wrapper"),r=wrapper,wrapper.css("position","absolute"),wrapper.css("left",droppedElement.css("left")),wrapper.css("top",droppedElement.css("top")),droppedElement.css("position","relative"),droppedElement.css("left","0px"),droppedElement.css("top","0px")):droppedElement.hasClass("color-picker")?(droppedElement.val("#f00"),CreateColorPicker(droppedElement),newReplacer=n.find(".sp-replacer:last"),r=newReplacer,newReplacer.css("position","absolute"),newReplacer.css("left",droppedElement.css("left")),newReplacer.css("top",droppedElement.css("top")),droppedElement.removeClass("uic"),newReplacer.addClass("uic color-picker"),newReplacer.attr("uicClasses","color-picker")):droppedElement.hasClass("wizard-phases")?droppedElement.css("width",""):droppedElement.hasClass("bootstrap-row")?(droppedElement.css({left:20,right:20,width:"auto"}),CreateDroppableMozaicContainer(droppedElement,!1)):droppedElement.hasClass("panel-component")&&(droppedElement.css("width",500),droppedElement.css("height",120),CreateDroppableMozaicContainer(droppedElement,!1));GridResolution>0&&(r.css("left",Math.round(r.position().left/GridResolution)*GridResolution),r.css("top",Math.round(r.position().top/GridResolution)*GridResolution));i.helper.remove();r.draggable({cancel:!1,containment:"parent",drag:function(n,t){GridResolution>0&&(t.position.left-=t.position.left%GridResolution,t.position.top-=t.position.top%GridResolution)}})}})}function SaveMozaicPage(){pageSpinner.show();SaveRequested=!1;componentArray=GetMozaicContainerComponentArray($("#mozaicPageContainer"),!1);postData={Name:$("#headerPageName").text(),IsModal:$("#currentPageIsModal").prop("checked"),ModalWidth:$("#modalWidthInput").val(),ModalHeight:$("#modalHeightInput").val(),Components:componentArray};appId=$("#currentAppId").val();pageId=$("#currentPageId").val();$.ajax({type:"POST",url:"/api/mozaic-editor/apps/"+appId+"/pages/"+pageId,data:postData,complete:function(){pageSpinner.hide()},success:function(){alert("OK")},error:function(n){alert(n.responseText)}})}function GetMozaicContainerComponentArray(n,t){return t?componentArrayLevel2=[]:componentArrayLevel1=[],n.find(".uic").each(function(n,i){if(currentUic=$(i),!t&&currentUic.parents(".panel-component").length>0)return!0;if(tag=null,label=null,content=null,currentUic.hasClass("button-simple")||currentUic.hasClass("button-dropdown")?label=currentUic.text():currentUic.hasClass("info-container")&&(label=currentUic.find(".info-container-header").text(),content=currentUic.find(".info-container-body").text()),currentUic.hasClass("info-container"))type="info-container";else if(currentUic.hasClass("breadcrumb-navigation"))type="breadcrumb";else if(currentUic.hasClass("button-simple"))type="button-simple";else if(currentUic.hasClass("button-dropdown"))type="button-dropdown";else if(currentUic.hasClass("button-browse"))type="button-browse";else if(currentUic.hasClass("checkbox-control"))type="checkbox",label=currentUic.find(".checkbox-label").text();else if(currentUic.hasClass("radio-control"))type="radio",label=currentUic.find(".radio-label").text();else if(currentUic.hasClass("form-heading")||currentUic.hasClass("control-label"))label=currentUic.html(),content=currentUic.attr("contentTemplate"),type="label";else if(currentUic.hasClass("input-single-line"))type="input-single-line";else if(currentUic.hasClass("input-multiline"))type="input-multiline";else if(currentUic.hasClass("dropdown-select"))type="dropdown-select";else if(currentUic.hasClass("multiple-select"))type="multiple-select";else if(currentUic.hasClass("data-table-with-actions"))type="data-table-with-actions";else if(currentUic.hasClass("data-table"))type="data-table-read-only";else if(currentUic.hasClass("name-value-list"))type="name-value-list";else if(currentUic.hasClass("tab-navigation"))type="tab-navigation",tabString="",currentUic.find("li").each(function(n,t){n>0&&(tabString+=$(t).find("a").text()+";")}),content=tabString;else if(currentUic.hasClass("color-picker"))type="color-picker";else if(currentUic.hasClass("countdown-component"))type="countdown";else if(currentUic.hasClass("wizard-phases")){type="wizard-phases";var r="";currentUic.find(".phase-label").each(function(n,t){r+=$(t).text()+";"});r=r.slice(0,-1);content=r}else currentUic.hasClass("named-panel")?(type="panel",label=currentUic.find(".named-panel-header").text()):type=currentUic.hasClass("panel-component")?"panel":"control";currentUic.hasClass("data-table")?(wrapper=currentUic.parents(""),positionX=wrapper.css("left"),positionY=wrapper.css("top")):(positionX=currentUic.css("left"),positionY=currentUic.css("top"));tag=currentUic.hasClass("color-picker")?"input":currentUic.prop("tagName").toLowerCase();name=currentUic.attr("uicName");name&&name!=""||(name=type+n);componentData={Name:name,Type:type,PositionX:positionX,PositionY:positionY,Width:currentUic.css("width"),Height:currentUic.css("height"),Tag:tag,Attributes:currentUic.data("uicAttributes"),Classes:currentUic.attr("uicClasses"),Styles:currentUic.attr("uicStyles"),Properties:currentUic.attr("uicProperties")?currentUic.attr("uicProperties"):"",Content:content,Label:label,Placeholder:currentUic.attr("placeholder"),TabIndex:currentUic.attr("tabindex"),ChildComponents:currentUic.hasClass("panel-component")?GetMozaicContainerComponentArray(currentUic,!0):[]};t?componentArrayLevel2.push(componentData):componentArrayLevel1.push(componentData)}),t?componentArrayLevel2:componentArrayLevel1}function LoadMozaicPage(n){pageSpinner.show();appId=$("#currentAppId").val();n=="current"&&(n=$("#currentPageId").val());url="/api/mozaic-editor/apps/"+appId+"/pages/"+n;$.ajax({type:"GET",url:url,dataType:"json",complete:function(){pageSpinner.hide()},error:function(n){alert(n.responseText)},success:function(n){if($("body").hasClass("mozaicBootstrapEditorModule"))MBE.io.convert(n);else{for($("#mozaicPageContainer .uic").remove(),$("#mozaicPageContainer .dataTables_wrapper").remove(),$("#mozaicPageContainer .color-picker").remove(),i=0;i<n.Components.length;i++)LoadMozaicEditorComponents($("#mozaicPageContainer"),n.Components[i]);$("#currentPageId").val(n.Id);$("#headerPageName").text(n.Name);$("#currentPageIsModal").prop("checked",n.IsModal);$("#modalWidthInput").val(n.ModalWidth);$("#modalHeightInput").val(n.ModalHeight);$("#currentPageIsModal").is(":checked")&&($("#modalSizeVisualization").css("width",parseInt($("#modalWidthInput").val())),$("#modalSizeVisualization").css("height",parseInt($("#modalHeightInput").val())),$("#modalSizeVisualization").show());var t=$(".mozaicEditorAbsolute, .mozaicEditorBootstrap").removeClass("mozaicEditorAbsolute mozaicEditorBootstrap");switch(n.version){case"0":default:t.addClass("mozaicEditorAbsolute");break;case"1":t.addClass("mozaicEditorBootstrap")}}}})}function LoadMozaicEditorComponents(n,t){if(newComponent=$("<"+t.Tag+' id="'+t.Id+'" uicName="'+t.Name+'" class="uic '+t.Classes+'" uicClasses="'+t.Classes+'" uicStyles="'+t.Styles+'" style="left: '+t.PositionX+"; top: "+t.PositionY+"; width: "+t.Width+"; height: "+t.Height+"; "+t.Styles+'"><\/'+t.Tag+">"),newComponent.data("uicAttributes",t.Attributes),n.append(newComponent),t.Placeholder&&newComponent.attr("placeholder",t.Placeholder),t.TabIndex&&newComponent.attr("tabindex",t.TabIndex),t.Properties&&newComponent.attr("uicProperties",t.Properties),newComponent.hasClass("button-simple"))newComponent.text(t.Label);else if(newComponent.hasClass("button-dropdown"))newComponent.html(t.Label+'<i class="fa fa-caret-down"><\/i>');else if(newComponent.hasClass("info-container"))newComponent.append($('<div class="fa fa-info-circle info-container-icon"><\/div><div class="info-container-header"><\/div><div class="info-container-body"><\/div>')),newComponent.find(".info-container-header").text(t.Label),newComponent.find(".info-container-body").text(t.Content);else if(newComponent.hasClass("named-panel"))newComponent.append($('<div class="named-panel-header"><\/div>')),newComponent.find(".named-panel-header").text(t.Label);else if(newComponent.hasClass("multiple-select"))newComponent.append($('<option value="1">Multiple<\/option><option value="2">Choice<\/option><option value="3">Select<\/option>')),newComponent.attr("multiple","");else if(newComponent.hasClass("button-browse"))newComponent.attr("type","file");else if(newComponent.hasClass("form-heading")||newComponent.hasClass("control-label"))newComponent.html(t.Label),newComponent.attr("contentTemplate",t.Content);else if(newComponent.hasClass("checkbox-control"))newComponent.append($('<input type="checkbox" /><span class="checkbox-label">'+t.Label+"<\/span>"));else if(newComponent.hasClass("radio-control"))newComponent.append($('<input type="radio" name="'+t.Name+'" /><span class="radio-label">'+t.Label+"<\/span>"));else if(newComponent.hasClass("breadcrumb-navigation"))newComponent.append($('<div class="app-icon fa fa-question"><\/div><div class="nav-text">APP NAME &gt; Nav<\/div>'));else if(newComponent.hasClass("data-table"))newComponent.append($("<thead><tr><th>Column 1<\/th><th>Column 2<\/th><th>Column 3<\/th><\/tr><\/thead><tbody><tr><td>Value1<\/td><td>Value2<\/td><td>Value3<\/td><\/tr><tr><td>Value4<\/td><td>Value5<\/td><td>Value6<\/td><\/tr><tr><td>Value7<\/td><td>Value8<\/td><td>Value9<\/td><\/tr><\/tbody>")),CreateCzechDataTable(newComponent,newComponent.hasClass("data-table-simple-mode")),newComponent.css("width",t.Width),wrapper=newComponent.parents(".dataTables_wrapper"),wrapper.css("position","absolute"),wrapper.css("left",t.PositionX),wrapper.css("top",t.PositionY),newComponent.css("position","relative"),newComponent.css("left","0px"),newComponent.css("top","0px");else if(newComponent.hasClass("name-value-list"))newComponent.append($('<tr><td class="name-cell">Platform<\/td><td class="value-cell">Omnius<\/td><\/tr><tr><td class="name-cell">Country<\/td><td class="value-cell">Czech Republic<\/td><\/tr><tr><td class="name-cell">Year<\/td><td class="value-cell">2016<\/td><\/tr>'));else if(newComponent.hasClass("tab-navigation")){for(tabLabelArray=t.Content.split(";"),newComponent.append($('<li class="active"><a class="fa fa-home"><\/a><\/li>')),k=0;k<tabLabelArray.length;k++)tabLabelArray[k].length>0&&newComponent.append($("<li><a>"+tabLabelArray[k]+"<\/a><\/li>"));newComponent.css("width","auto")}else if(newComponent.hasClass("color-picker"))CreateColorPicker(newComponent),newReplacer=n.find(".sp-replacer:last"),newReplacer.css("position","absolute"),newReplacer.css("left",newComponent.css("left")),newReplacer.css("top",newComponent.css("top")),newComponent.removeClass("uic"),newReplacer.addClass("uic color-picker"),newReplacer.attr("uicClasses","color-picker"),newReplacer.attr("uicName",newComponent.attr("uicName"));else if(newComponent.hasClass("countdown-component"))newComponent.html('<span class="countdown-row countdown-show3"><span class="countdown-section"><span class="countdown-amount">0<\/span><span class="countdown-period">Hodin<\/span><\/span><span class="countdown-section"><span class="countdown-amount">29<\/span><span class="countdown-period">Minut<\/span><\/span><span class="countdown-section"><span class="countdown-amount">59<\/span><span class="countdown-period">Sekund<\/span><\/span><\/span>');else if(newComponent.hasClass("wizard-phases")){newComponent.html(WizardPhasesContentTemplate);var i=t.Content.split(";");newComponent.find(".phase1 .phase-label").text(i[0]?i[0]:"Fáze 1");newComponent.find(".phase2 .phase-label").text(i[1]?i[1]:"Fáze 2");newComponent.find(".phase3 .phase-label").text(i[2]?i[2]:"Fáze 3")}if(newComponent.hasClass("panel-component")&&CreateDroppableMozaicContainer(newComponent,!1),draggableElement=newComponent.hasClass("data-table")?wrapper:newComponent.hasClass("color-picker")?newReplacer:newComponent,draggableElement.draggable({cancel:!1,containment:"parent",drag:function(n,t){GridResolution>0&&(t.position.left-=t.position.left%GridResolution,t.position.top-=t.position.top%GridResolution)}}),t.ChildComponents)for(currentPanel=newComponent,j=0;j<t.ChildComponents.length;j++)LoadMozaicEditorComponents(currentPanel,t.ChildComponents[j])}function ClearDbScheme(){jQuery.each($("#database-container .dbTable"),function(n,t){instance.removeAllEndpoints(t,!0);t.remove()});jQuery.each($("#database-container .dbView"),function(n,t){t.remove()})}function AddColumnToJsPlumb(n){instance.makeSource(n,{anchor:["Continuous",{faces:["left","right"]}],faces:["left","right"],container:"database-container",connector:["Bezier",{curviness:150}],connectorStyle:{strokeStyle:"#1092bd",lineWidth:2,outlineColor:"transparent",outlineWidth:4}});instance.makeTarget(n,{dropOptions:{hoverClass:"dragHover"},anchor:["Continuous",{faces:["left","right"]}],faces:["left","right"],container:"database-container",allowLoopback:!1})}function EditRelation(n,t,i){n.removeOverlay("label0");n.removeOverlay("label1");n.addOverlay(["Label",{location:.1,id:"label0",cssClass:"relationLabel",label:t}]);n.addOverlay(["Label",{location:.9,id:"label1",cssClass:"relationLabel",label:i}])}function AddTable(n){var t=!0;if($("#database-container .dbTable").each(function(i,r){if($(r).find(".dbTableName").text().toLowerCase()==n.toLowerCase())return t=!1,alert("This table name is already used."),!1;if(!/^[0-9a-zA-Z_]+$/.test(n))return t=!1,alert("Incorrect table name."),!1}),t){newTable=$('<div class="dbTable"><div class="dbTableHeader"><div class="deleteTableIcon fa fa-remove"><\/div><div class="dbTableName">'+n+'<\/div><div class="editTableIcon fa fa-pencil"><\/div><div class="addColumnIcon fa fa-plus"><\/div><\/div><div class="dbTableBody"><div class="dbColumn idColumn dbPrimaryKey" dbColumnType="integer"><div class="dbColumnName">id<\/div><\/div><\/div><div class="dbTableIndexArea"><\/div><\/div>');newTable.find(".dbColumn").data("dbColumnType","integer");$("#database-container").append(newTable);newTable.find(".editTableIcon").on("click",function(){CurrentTable=$(this).parents(".dbTable");editTableDialog.dialog("open")});newTable.find(".deleteTableIcon").on("click",function(){$(this).parents(".dbTable").remove();instance.removeAllEndpoints($(this).parents(".dbTable"),!0)});newTable.find(".addColumnIcon").on("click",function(){addColumnDialog.data("currentTable",$(this).parents(".dbTable"));addColumnDialog.dialog("open")});instance.draggable(newTable);AddColumnToJsPlumb(newTable.find(".dbColumn"))}}function AddColumn(n,t,i,r,u,f,e,o,s,h){newColumn=$('<div class="dbColumn"><div class="deleteColumnIcon fa fa-remove"><\/div><div class="dbColumnName">'+t+'<\/div><div class="editColumnIcon fa fa-pencil"><\/div><\/div>');newColumn.children(".deleteColumnIcon").on("mousedown",function(){return $(this).parents(".dbColumn").remove(),instance.removeAllEndpoints($(this).parents(".dbColumn"),!0),instance.recalculateOffsets(),instance.repaintEverything(),!1});newColumn.children(".editColumnIcon").on("mousedown",function(){return CurrentColumn=$(this).parents(".dbColumn"),editColumnDialog.dialog("open"),!1});n.children(".dbTableBody").append(newColumn);r&&newColumn.addClass("dbPrimaryKey");newColumn.data("dbAllowNull",u);newColumn.data("dbUnique",s);newColumn.data("dbDefaultValue",f);newColumn.attr("dbColumnType",i);newColumn.data("dbColumnLength",e);newColumn.data("dbColumnLengthMax",o);newColumn.data("dbColumnDisplayName",h);AddColumnToJsPlumb(newColumn)}function AddIndex(n,t,r,u){for(indexLabel="Index: ",i=0;i<r.length-1;i++)indexLabel+=r[i]+", ";for(indexLabel+=r[r.length-1],u&&(indexLabel+=" - unique"),newIndex=$('<div class="dbIndex"><div class="deleteIndexIcon fa fa-remove"><\/div><div class="dbIndexText">'+indexLabel+'<\/div><div class="editIndexIcon fa fa-pencil"><\/div><\/div>'),newIndex.data("indexName",t),filteredIndexColumnArray=[],i=0;i<r.length;i++)r[i]!="-none-"&&filteredIndexColumnArray.push(r[i]);newIndex.data("indexColumnArray",filteredIndexColumnArray);newIndex.data("indexColumnArray",r);newIndex.data("unique",u);newIndex.children(".deleteIndexIcon").on("mousedown",function(){return $(this).parents(".dbIndex").remove(),!1});newIndex.children(".editIndexIcon").on("mousedown",function(){return CurrentIndex=$(this).parents(".dbIndex"),CurrentTable=$(this).parents(".dbTable"),editIndexDialog.dialog("open"),!1});n.children(".dbTableIndexArea").append(newIndex)}function AddView(n,t){newView=$('<div class="dbView" style="top: 100px; left: 20px;"><div class="dbViewHeader"><div class="deleteViewIcon fa fa-remove"><\/div><div class="dbViewName">View: '+n+'<\/div><div class="editViewIcon fa fa-pencil"><\/div><\/div><\/div>');$("#database-container").append(newView);newView.find(".editViewIcon").on("click",function(){CurrentView=$(this).parents(".dbView");editViewDialog.dialog("open")});newView.find(".deleteViewIcon").on("click",function(){$(this).parents(".dbView").remove()});newView.data("dbViewName",n);newView.data("dbViewQuery",t);instance.draggable(newView)}function CheckColumnLengthSupport(n,t){currentType=SqlServerDataTypes.filter(function(n){return n[0]==t});t?currentType[0][2]?(n.find("#columnLengthNotSupported").hide(),n.find("#column-length").show(),n.find("#column-length-max").show(),n.find("label[for=column-length-max]").show()):(n.find("#columnLengthNotSupported").show(),n.find("#column-length").hide(),n.find("#column-length-max").hide(),n.find("label[for=column-length-max]").hide()):(n.find("#columnLengthNotSupported").show(),n.find("#column-length").hide(),n.find("#column-length-max").hide(),n.find("label[for=column-length-max]").hide())}function SaveDbScheme(n){for(pageSpinner.show(),columnIdCounter=0,tableArray=[],relationArray=[],viewArray=[],$("#database-container .dbTable").each(function(n,t){columnArray=[];indexArray=[];$(t).data("dbTableId",n);$(t).find(".dbColumn").each(function(n,t){columnArray.push({Id:columnIdCounter,Name:$(t).find(".dbColumnName").text(),DisplayName:$(t).data("dbColumnDisplayName"),Type:$(t).attr("dbColumnType"),PrimaryKey:$(t).hasClass("dbPrimaryKey"),Unique:$(t).data("dbUnique"),AllowNull:$(t).data("dbAllowNull"),DefaultValue:$(t).data("dbDefaultValue"),ColumnLength:$(t).data("dbColumnLength"),ColumnLengthIsMax:$(t).data("dbColumnLengthMax")});$(t).data("dbColumnId",columnIdCounter);columnIdCounter++});$(t).find(".dbIndex").each(function(n,t){for(originalIndexColumnArray=$(t).data("indexColumnArray"),filteredIndexColumnArray=[],i=0;i<originalIndexColumnArray.length;i++)originalIndexColumnArray[i]!="-none-"&&filteredIndexColumnArray.push(originalIndexColumnArray[i]);indexArray.push({Id:n,Name:$(t).data("indexName"),ColumnNames:filteredIndexColumnArray,Unique:$(t).data("unique")})});tableArray.push({Id:n,Name:$(t).find(".dbTableName").text(),PositionX:parseInt($(t).css("left")),PositionY:parseInt($(t).css("top")),Columns:columnArray,Indices:indexArray})}),jsPlumbConnections=instance.getAllConnections(),i=0;i<jsPlumbConnections.length;i++)currentConnection=jsPlumbConnections[i],sourceDiv=$(currentConnection.source),targetDiv=$(currentConnection.target),relationArray.push({LeftTable:sourceDiv.parents(".dbTable").data("dbTableId"),rightTable:targetDiv.parents(".dbTable").data("dbTableId"),LeftColumn:sourceDiv.data("dbColumnId"),RightColumn:targetDiv.data("dbColumnId"),Type:$(currentConnection).data("relationType")});$("#database-container .dbView").each(function(n,t){viewArray.push({Id:n,Name:$(t).data("dbViewName"),Query:$(t).data("dbViewQuery"),PositionX:parseInt($(t).css("left")),PositionY:parseInt($(t).css("top"))})});postData={CommitMessage:n,Tables:tableArray,Relations:relationArray,Views:viewArray};appId=$("#currentAppId").val();$.ajax({type:"POST",url:"/api/database/apps/"+appId+"/commits",data:postData,complete:function(){pageSpinner.hide()},success:function(){alert("OK")}})}function LoadDbScheme(n){pageSpinner.show();appId=$("#currentAppId").val();$.ajax({type:"GET",url:"/api/database/apps/"+appId+"/commits/"+n,dataType:"json",complete:function(){pageSpinner.hide()},success:function(n){for(ClearDbScheme(),i=0;i<n.Tables.length;i++){newTable=$('<div class="dbTable"><div class="dbTableHeader"><div class="deleteTableIcon fa fa-remove"><\/div><div class="dbTableName">'+n.Tables[i].Name+'<\/div><div class="editTableIcon fa fa-pencil"><\/div><div class="addColumnIcon fa fa-plus"><\/div><\/div><div class="dbTableBody"><div class="dbColumn idColumn dbPrimaryKey" dbColumnType="integer" dbColumnId="'+n.Tables[i].Columns[0].Id+'"><div class="dbColumnName">id<\/div><\/div><\/div><div class="dbTableIndexArea"><\/div><\/div>');$("#database-container").append(newTable);$(".editTableIcon").on("click",function(){CurrentTable=$(this).parents(".dbTable");editTableDialog.dialog("open")});newTable.find(".deleteTableIcon").on("click",function(){$(this).parents(".dbTable").remove();instance.removeAllEndpoints($(this).parents(".dbTable"),!0)});newTable.find(".addColumnIcon").on("click",function(){addColumnDialog.data("currentTable",$(this).parents(".dbTable"));addColumnDialog.dialog("open")});newTable.find(".deleteColumnIcon").on("mousedown",function(){return $(this).parents(".dbColumn").remove(),instance.removeAllEndpoints($(this).parents(".dbColumn"),!0),!1});newTable.find(".editColumnIcon").on("mousedown",function(){return CurrentColumn=$(this).parents(".dbColumn"),editColumnDialog.dialog("open"),!1});for(newTable.css("left",n.Tables[i].PositionX),newTable.css("top",n.Tables[i].PositionY),instance.draggable(newTable),j=1;j<n.Tables[i].Columns.length;j++){defaultValue=n.Tables[i].Columns[j].DefaultValue!=null?n.Tables[i].Columns[j].DefaultValue:"";newColumn=$('<div class="dbColumn"><div class="deleteColumnIcon fa fa-remove"><\/div><div class="dbColumnName">'+n.Tables[i].Columns[j].Name+'<\/div><div class="editColumnIcon fa fa-pencil"><\/div><\/div>');newColumn.attr("dbColumnType",n.Tables[i].Columns[j].Type);newColumn.attr("dbColumnId",n.Tables[i].Columns[j].Id);newColumn.data("dbUnique",n.Tables[i].Columns[j].Unique);newColumn.data("dbAllowNull",n.Tables[i].Columns[j].AllowNull);newColumn.data("dbDefaultValue",defaultValue);newColumn.data("dbColumnLength",n.Tables[i].Columns[j].ColumnLength);newColumn.data("dbColumnLengthMax",n.Tables[i].Columns[j].ColumnLengthIsMax);newColumn.data("dbColumnDisplayName",n.Tables[i].Columns[j].DisplayName);newColumn.children(".deleteColumnIcon").on("mousedown",function(){return $(this).parents(".dbColumn").remove(),instance.removeAllEndpoints($(this).parents(".dbColumn"),!0),instance.recalculateOffsets(),instance.repaintEverything(),!1});newColumn.children(".editColumnIcon").on("mousedown",function(){return CurrentColumn=$(this).parents(".dbColumn"),editColumnDialog.dialog("open"),!1});newTable.children(".dbTableBody").append(newColumn);n.Tables[i].Columns[j].PrimaryKey&&newColumn.addClass("dbPrimaryKey");newColumn.attr("dbColumnType",n.Tables[i].Columns[j].Type)}for(AddColumnToJsPlumb(newTable.find(".dbColumn")),j=0;j<n.Tables[i].Indices.length;j++){for(indexLabel="Index: ",k=0;k<n.Tables[i].Indices[j].ColumnNames.length-1;k++)indexLabel+=n.Tables[i].Indices[j].ColumnNames[k]+", ";indexLabel+=n.Tables[i].Indices[j].ColumnNames[n.Tables[i].Indices[j].ColumnNames.length-1];n.Tables[i].Indices[j].Unique&&(indexLabel+=" - unique");newIndex=$('<div class="dbIndex"><div class="deleteIndexIcon fa fa-remove"><\/div><div class="dbIndexText">'+indexLabel+'<\/div><div class="editIndexIcon fa fa-pencil"><\/div><\/div>');newIndex.data("indexName",n.Tables[i].Indices[j].Name);newIndex.data("indexColumnArray",n.Tables[i].Indices[j].ColumnNames);newIndex.data("unique",n.Tables[i].Indices[j].Unique);newIndex.children(".deleteIndexIcon").on("mousedown",function(){return $(this).parents(".dbIndex").remove(),!1});newIndex.children(".editIndexIcon").on("mousedown",function(){return CurrentIndex=$(this).parents(".dbIndex"),CurrentTable=$(this).parents(".dbTable"),editIndexDialog.dialog("open"),!1});newTable.children(".dbTableIndexArea").append(newIndex)}}for(i=0;i<n.Relations.length;i++){sourceDiv=$("#database-container .dbColumn[dbColumnId='"+n.Relations[i].LeftColumn+"']");targetDiv=$("#database-container .dbColumn[dbColumnId='"+n.Relations[i].RightColumn+"']");newConnection=instance.connect({source:sourceDiv.attr("id"),target:targetDiv.attr("id"),editable:!0});$(newConnection).data("relationType",n.Relations[i].Type);switch(n.Relations[i].Type){case 2:EditRelation(newConnection,"1","N");break;case 3:EditRelation(newConnection,"N","1");break;case 4:EditRelation(newConnection,"M","N")}}for(i=0;i<n.Views.length;i++){newView=$('<div class="dbView"><div class="dbViewHeader"><div class="deleteViewIcon fa fa-remove"><\/div><div class="dbViewName">View: '+n.Views[i].Name+'<\/div><div class="editViewIcon fa fa-pencil"><\/div><\/div><\/div>');$("#database-container").append(newView);newView.find(".editViewIcon").on("click",function(){CurrentView=$(this).parents(".dbView");editViewDialog.dialog("open")});newView.find(".deleteViewIcon").on("click",function(){$(this).parents(".dbView").remove()});newView.css("left",n.Views[i].PositionX);newView.css("top",n.Views[i].PositionY);newView.data("dbViewName",n.Views[i].Name);newView.data("dbViewQuery",n.Views[i].Query);instance.draggable(newView)}}})}var LastAssignedNumber,TB,maintenanceModeActive,pageSpinner,currentBlock,currentMetablock,ChangedSinceLastSave,CurrentWsdlFile,GridResolution,CurrentComponent,SaveRequested,instance,ZoomFactor,CurrentTable,CurrentColumn,CurrentConnection,CurrentView,CurrentIndex,CurrentAppId,MBE;$(function(){$("#TimeSince,#TimeTo").datetimepicker({datepicker:!0,timepicker:!0,step:5,format:"d.m.Y H:i"});$("body.watchtowerModule #lowerPanel .getJsonRow").click(function(){var n=$(this).parent(),r=n.attr("data-id"),t=n.find('[data-data="Vars"]'),i=n.find('[data-data="StackTrace"]');$.getJSON("/Watchtower/Log/GetRow/"+r,function(r){var u,f,e;for(t.removeClass("getJsonRow").addClass("mytooltip"),t.html("Count: "+(r.Vars.match(/<tr>/g)||[]).length+'<div class="tooltiptext" >'+r.Vars+"<\/div>"),i.removeClass("getJsonRow").addClass("mytooltip"),i.html('Show<div class="tooltiptext" >'+r.StackTrace+"<\/div>"),u=r.Inner,f=n;u!=null;)e='<tr data-id="'+u.Id+'"><td>Inner<\/td><td>'+u.LogLevelString+"<\/td><td>"+u.UserName+"<\/td><td>"+u.Server+"<\/td><td>"+u.LogSourceString+"<\/td><td>"+u.Application+"<\/td><td>"+u.BlockName+"<\/td><td>"+u.ActionName+"<\/td><td>"+u.Message+'<\/td><td class="mytooltip">Show<div class="tooltiptext">'+u.Vars+'<\/div><\/td><td class="mytooltip">Show<div class="tooltiptext">'+u.StackTrace+"<\/div><\/td><\/tr>",f.after(e),u=u.ChildLogItems[0],f=f.next()})})});sourceEndpoint={endpoint:"Rectangle",paintStyle:{fillStyle:"#54c6f0",width:12,height:18},hoverPaintStyle:{fillStyle:"#f98e4b"},isSource:!0,connector:["Flowchart",{stub:[5,5],gap:4,cornerRadius:4}],connectorStyle:{lineWidth:2,strokeStyle:"#54c6f0",joinstyle:"round"},connectorHoverStyle:{strokeStyle:"#f98e4b"},cssClass:"sourceEndpoint",maxConnections:-1};trueEndpoint=$.extend({},sourceEndpoint,{overlays:[["Label",{location:[1.7,1.5],label:"True",cssClass:"endpointSourceLabel"}]]});falseEndpoint=$.extend({},sourceEndpoint,{paintStyle:{fillStyle:"#54c6f0",width:18,height:10},overlays:[["Label",{location:[1.5,2],label:"False",cssClass:"endpointSourceLabel"}]]});jsPlumb.ready(function(){CurrentModuleIs("tapestryModule")&&($(".resourceRule, .workflowRule").each(function(n,t){currentInstance=CreateJsPlumbInstanceForRule($(t))}),$("#resourceRulesPanel .item, #workflowRulesPanel .item, #workflowRulesPanel .symbol").each(function(n,t){AddToJsPlumb($(t))}))});LastAssignedNumber=0;SystemTables=[{Name:"Omnius::AppRoles",Columns:["Id","Name","Priority","ApplicationId"]},{Name:"Omnius::Users",Columns:["Id","DisplayName","Company","Job","Address","Email"]},{Name:"Omnius::LogItems",Columns:["Id","Timestamp","LogEventType","UserId","IsPlatformEvent","AppId","Message"]}];var ConditionSetTemplate='<div class="conditionSet"><div class="conditionSetHeading"><span class="conditionSetPrefix"> a<\/span>ll of these conditions must be met<\/div><div class="removeConditionSetIcon">X<\/div><table class="conditionTable"><\/table><\/div>',ConditionTemplate='<tr><td class="conditionOperator"><\/td><td class="conditionVariableCell"><select><\/select><\/td><td class="conditionOperatorCell"><select><option selected="selected">==<\/option><option>!=<\/option><option>&gt;<\/option><option>&gt;=<\/option><option>&lt;<\/option><option>&lt;=<\/option><option>is empty<\/option><option>is not empty<\/option><\/select><\/td><td class="conditionValueCell"><select><option selected="selected">True<\/option><\/select><\/td><td class="conditionActions"><div class="conditionActionIcon addAndConditionIcon">&<\/div><div class="conditionActionIcon addOrConditionIcon">|<\/div><div class="conditionActionIcon removeConditionIcon">X<\/div><\/td><\/tr>',ManualInputConditionTemplate='<tr><td class="conditionOperator"><\/td><td class="conditionVariableCell"><input type="text"><\/input><\/td><td class="conditionOperatorCell"><select><option selected="selected">==<\/option><option>!=<\/option><option>&gt;<\/option><option>&gt;=<\/option><option>&lt;<\/option><option>&lt;=<\/option><option inputType="none">is empty<\/option><option inputType="none">is not empty<\/option><option>contains<\/option><option inputType="none">exists<\/option><\/select><\/td><td class="conditionValueCell"><input type="text"><\/input><\/td><td class="conditionActions"><div class="conditionActionIcon addAndConditionIcon">&<\/div><div class="conditionActionIcon addOrConditionIcon">|<\/div><div class="conditionActionIcon removeConditionIcon">X<\/div><\/td><\/tr>',HermesConditionSetTemplate='<div class="conditionSet"><div class="conditionSetHeading"><span class="conditionSetPrefix"> a<\/span>ll of these conditions must be met<\/div><div class="removeConditionSetIcon">X<\/div><table class="conditionTable"><\/table><\/div>',HermesConditionTemplate='<tr><td class="conditionOperator"><\/td><td class="conditionVariableCell"><select class="form-control" style="width:auto"><option value="From">From<\/option><option value="CC">CC<\/option><option value="Subject">Subject<\/option><option value="Body">Body<\/option><\/select><\/td><td class="conditionOperatorCell"><select class="form-control" style="width:auto"><option value="contains" selected="selected">obsahuje<\/option><option value="BeginWith">začíná<\/option><option value="EndWith">končí<\/option><option value="IsEmpty" data-inputType="none">is empty<\/option><option value="IsNotEmpty" data-inputType="none">is not empty<\/option><\/select><\/td><td class="conditionValueCell"><input type="text" value="" class="form-control" /><\/td><td class="conditionActions"><div class="conditionActionIcon addAndConditionIcon">&<\/div><div class="conditionActionIcon addOrConditionIcon">|<\/div><div class="conditionActionIcon removeConditionIcon">X<\/div><\/td><\/tr>',AssociatedPageIds=[];$(function(){CurrentModuleIs("tapestryModule")&&($("#resourceRulesPanel .resourceRule").draggable({containment:"parent",revert:function(){return $(this).collision("#resourceRulesPanel .resourceRule").length>1},stop:function(){ChangedSinceLastSave=!0}}),$("#resourceRulesPanel .resourceRule").droppable({containment:".resourceRule",tolerance:"touch",accept:".toolboxItem",greedy:!0,drop:function(n,t){droppedElement=t.helper.clone();droppedElement.removeClass("toolboxItem");droppedElement.addClass("item");$(this).append(droppedElement);ruleContent=$(this);leftOffset=$("#tapestryWorkspace").offset().left-ruleContent.offset().left+20;topOffset=$("#tapestryWorkspace").offset().top-ruleContent.offset().top;droppedElement.offset({left:droppedElement.offset().left+leftOffset,top:droppedElement.offset().top+topOffset});t.helper.remove();AddToJsPlumb(droppedElement);ChangedSinceLastSave=!0}}),$("#resourceRulesPanel .resourceRule").resizable({start:function(){rule=$(this);contentsWidth=120;contentsHeight=40;rule.find(".item").each(function(n,t){rightEdge=$(t).position().left+$(t).width();rightEdge>contentsWidth&&(contentsWidth=rightEdge);bottomEdge=$(t).position().top+$(t).height();bottomEdge>contentsHeight&&(contentsHeight=bottomEdge)});rule.css("min-width",contentsWidth+40);rule.css("min-height",contentsHeight+20);limits=CheckRuleResizeLimits(rule,!0);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},resize:function(){rule=$(this);limits=CheckRuleResizeLimits(rule,!0);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},stop:function(){instance=$(this).data("jsPlumbInstance");instance.recalculateOffsets();instance.repaintEverything();ChangedSinceLastSave=!0}}),$("#workflowRulesPanel .workflowRule").draggable({containment:"parent",handle:".workflowRuleHeader",revert:function(){return $(this).collision("#workflowRulesPanel .workflowRule").length>1},stop:function(){ChangedSinceLastSave=!0}}),$(".swimlaneRolesArea").droppable({tolerance:"touch",accept:".toolboxItem.roleItem",greedy:!0,drop:function(n,t){droppedElement=t.helper.clone();$(this).find(".rolePlaceholder, .roleItem").remove();$(this).append($('<div class="roleItem">'+droppedElement.text()+"<\/div>"));t.helper.remove();ChangedSinceLastSave=!0}}),$(".swimlaneContentArea").droppable({containment:".swimlaneContentArea",tolerance:"touch",accept:".toolboxSymbol, .toolboxItem",greedy:!1,drop:function(n,t){if(droppedElement=t.helper.clone(),droppedElement.hasClass("roleItem"))return t.draggable.draggable("option","revert",!0),!1;$(this).append(droppedElement);ruleContent=$(this);droppedElement.hasClass("toolboxSymbol")?(droppedElement.removeClass("toolboxSymbol ui-draggable ui-draggable-dragging"),droppedElement.addClass("symbol"),leftOffset=$("#tapestryWorkspace").offset().left-ruleContent.offset().left,topOffset=$("#tapestryWorkspace").offset().top-ruleContent.offset().top):(droppedElement.removeClass("toolboxItem"),droppedElement.addClass("item"),leftOffset=$("#tapestryWorkspace").offset().left-ruleContent.offset().left+38,topOffset=$("#tapestryWorkspace").offset().top-ruleContent.offset().top-18);droppedElement.offset({left:droppedElement.offset().left+leftOffset,top:droppedElement.offset().top+topOffset});t.helper.remove();AddToJsPlumb(droppedElement);ChangedSinceLastSave=!0}}),$("#workflowRulesPanel .workflowRule").resizable({start:function(){rule=$(this);contentsWidth=120;contentsHeight=40;rule.find(".item").each(function(n,t){rightEdge=$(t).position().left+$(t).width();rightEdge>contentsWidth&&(contentsWidth=rightEdge);bottomEdge=$(t).position().top+$(t).height();bottomEdge>contentsHeight&&(contentsHeight=bottomEdge)});rule.css("min-width",contentsWidth+40);rule.css("min-height",contentsHeight+20);limits=CheckRuleResizeLimits(rule,!1);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},resize:function(){rule=$(this);instance=rule.data("jsPlumbInstance");instance.recalculateOffsets();instance.repaintEverything();limits=CheckRuleResizeLimits(rule,!1);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},stop:function(){ChangedSinceLastSave=!0}}))});var ZoomFactor=1,ChangedSinceLastSave=!1,dragModeActive=!1,lastLibId=1e3,AssociatedPageIds=[],AssociatedBootstrapPageIds=[];$(function(){if(CurrentModuleIs("tapestryModule")){RecalculateToolboxHeight();TB.load.loadBlock();$("#btnClear").on("click",function(){$("#resourceRulesPanel .resourceRule").remove();$("#workflowRulesPanel .workflowRule").remove();ChangedSinceLastSave=!0});$("#btnSave").on("click",function(){saveDialog.dialog("open")});$("#btnLoad").on("click",function(){confirmed=ChangedSinceLastSave?confirm("Máte neuložené změny, opravdu si přejete tyto změny zahodit?"):!0;confirmed&&TB.load.loadBlock()});$("#btnHistory").on("click",function(){historyDialog.dialog("open")});$("#btnOverview").on("click",function(){confirmed=ChangedSinceLastSave?confirm("Máte neuložené změny, opravdu si přejete opustit blok?"):!0;confirmed&&(ChangedSinceLastSave=!1,openMetablockForm=$("#openMetablockForm"),openMetablockForm.find("input[name='metablockId']").val($("#parentMetablockId").val()),openMetablockForm.submit())});window.onbeforeunload=function(){if(ChangedSinceLastSave)return pageSpinner.hide(),"Máte neuložené změny, opravdu si přejete opustit blok?"};$("#btnOpenTableConditions").on("click",function(){$("#conditions-dialog").dialog("open")});$(".toolboxCategoryHeader_Symbols").on("click",function(){$(this).toggleClass("hiddenCategory");$(".symbolToolboxSpace").slideToggle()});$(".toolboxCategoryHeader_Actions").on("click",function(){$(".toolboxLi_Actions").length>0?($(this).toggleClass("hiddenCategory"),$(".toolboxLi_Actions").slideToggle()):$(this).removeClass("hiddenCategory")});$(".toolboxCategoryHeader_Attributes").on("click",function(){$(".toolboxLi_Attributes").length>0?($(this).toggleClass("hiddenCategory"),$(".toolboxLi_Attributes").slideToggle()):$(this).removeClass("hiddenCategory")});$(".toolboxCategoryHeader_UI").on("click",function(){$(".toolboxLi_UI").length>0?($(this).toggleClass("hiddenCategory"),$(".toolboxLi_UI").slideToggle()):$(this).removeClass("hiddenCategory")});$(".toolboxCategoryHeader_Roles").on("click",function(){$(".toolboxLi_Roles").length>0?($(this).toggleClass("hiddenCategory"),$(".toolboxLi_Roles").slideToggle()):$(this).removeClass("hiddenCategory")});$(".toolboxCategoryHeader_States").on("click",function(){$(".toolboxLi_States").length>0?($(this).toggleClass("hiddenCategory"),$(".toolboxLi_States").slideToggle()):$(this).removeClass("hiddenCategory")});$(".toolboxCategoryHeader_Targets").on("click",function(){$(".toolboxLi_Targets").length>0?($(this).toggleClass("hiddenCategory"),$(".toolboxLi_Targets").slideToggle()):$(this).removeClass("hiddenCategory")});$(".toolboxCategoryHeader_Templates").on("click",function(){$(".toolboxLi_Templates").length>0?($(this).toggleClass("hiddenCategory"),$(".toolboxLi_Templates").slideToggle()):$(this).removeClass("hiddenCategory")});$(".toolboxCategoryHeader_Integrations").on("click",function(){$(".toolboxLi_Integrations").length>0?($(this).toggleClass("hiddenCategory"),$(".toolboxLi_Integrations").slideToggle()):$(this).removeClass("hiddenCategory")});$("#blockHeaderBlockName").on("click",function(){renameBlockDialog.dialog("open")});$("#blockHeaderDbResCount").on("click",function(){chooseTablesDialog.dialog("open")});$("#blockHeaderRolesCount").on("click",function(){chooseWhitelistRolesDialog.dialog("open")});$(window).scroll(function(){var i=$("#tapestryLeftBar"),r=$(window).scrollTop(),u=$("#lowerPanel").offset().top,n=$("#lowerPanelSpinnerOverlay"),t=$("#topBar").height()+$("#appNotificationArea").height();n.css({right:0,width:"auto"});r>u-t?(i.css({top:t,left:225,position:"fixed"}),n.css({top:t,left:225,position:"fixed"})):(i.css({top:0,left:0,position:"absolute"}),n.css({top:0,left:0,position:"absolute"}));RecalculateToolboxHeight()});$(window).resize(function(){RecalculateToolboxHeight()});$(".toolboxItem, .toolboxSymbol").draggable({helper:"clone",appendTo:"#tapestryWorkspace",containment:"window",tolerance:"fit",revert:!0,scroll:!0,start:function(){dragModeActive=!0}});$("#hideTapestryTooboxIcon").on("click",function(){$("#tapestryLeftBar").hide();$("#tapestryLeftBarMinimized").show();$("#tapestryWorkspace").css("left",32);RecalculateToolboxHeight()});$("#showTapestryTooboxIcon").on("click",function(){$("#tapestryLeftBar").show();$("#tapestryLeftBarMinimized").hide();$("#tapestryWorkspace").css("left",236);RecalculateToolboxHeight()});$("#btnAddResRule").on("click",function(){ChangedSinceLastSave=!0;rightmostRuleEdge=0;$("#resourceRulesPanel .resourceRule").each(function(n,t){edge=$(t).position().left+$(t).width()+$("#resourceRulesPanel .scrollContainer").scrollLeft();edge>rightmostRuleEdge&&(rightmostRuleEdge=edge)});newRule=$('<div class="rule resourceRule" style="width: 350px; height: 60px; left: '+(rightmostRuleEdge+10)+'px; top: 10px;"><\/div>');$("#resourceRulesPanel .scrollArea").append(newRule);newRule.draggable({containment:"parent",revert:function(){return $(this).collision("#resourceRulesPanel .resourceRule").length>1},stop:function(){ChangedSinceLastSave=!0}});newRule.resizable({start:function(){rule=$(this);contentsWidth=120;contentsHeight=40;rule.find(".item").each(function(n,t){rightEdge=$(t).position().left+$(t).width();rightEdge>contentsWidth&&(contentsWidth=rightEdge);bottomEdge=$(t).position().top+$(t).height();bottomEdge>contentsHeight&&(contentsHeight=bottomEdge)});rule.css("min-width",contentsWidth+40);rule.css("min-height",contentsHeight+20);limits=CheckRuleResizeLimits(rule,!0);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},resize:function(){rule=$(this);limits=CheckRuleResizeLimits(rule,!0);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},stop:function(){instance=$(this).data("jsPlumbInstance");instance.recalculateOffsets();instance.repaintEverything();ChangedSinceLastSave=!0}});CreateJsPlumbInstanceForRule(newRule);newRule.droppable({containment:".resourceRule",tolerance:"touch",accept:".toolboxItem",greedy:!0,drop:function(n,t){dragModeActive&&(dragModeActive=!1,droppedElement=t.helper.clone(),droppedElement.removeClass("toolboxItem"),droppedElement.addClass("item"),droppedElement.css({width:"",height:""}),$(this).append(droppedElement),ruleContent=$(this),leftOffset=$("#tapestryWorkspace").offset().left-ruleContent.offset().left+20,topOffset=$("#tapestryWorkspace").offset().top-ruleContent.offset().top,droppedElement.offset({left:droppedElement.offset().left+leftOffset,top:droppedElement.offset().top+topOffset}),t.helper.remove(),AddToJsPlumb(droppedElement),droppedElement.position().left+droppedElement.width()+35>ruleContent.width()&&(droppedElement.css("left",ruleContent.width()-droppedElement.width()-40),instance=ruleContent.data("jsPlumbInstance"),instance.repaintEverything()),droppedElement.position().top+droppedElement.height()+5>ruleContent.height()&&(console.log("matched"),droppedElement.css("top",ruleContent.height()-droppedElement.height()-15),instance=ruleContent.data("jsPlumbInstance"),instance.repaintEverything()),ChangedSinceLastSave=!0)}})});$("#btnAddWfRule").on("click",function(){ChangedSinceLastSave=!0;lowestRuleBottom=0;highestRuleNumber=0;$("#workflowRulesPanel .workflowRule").each(function(n,t){bottom=$(t).position().top+$(t).height()+$("#workflowRulesPanel .scrollContainer").scrollTop();bottom>lowestRuleBottom&&(lowestRuleBottom=bottom);name=$(t).find(".workflowRuleHeader .verticalLabel").text();name.startsWith("Pravidlo ")&&!isNaN(name.substring(9,name.length))&&(ruleNumber=parseInt(name.substring(9,name.length)),ruleNumber>highestRuleNumber&&(highestRuleNumber=ruleNumber))});newRule=$('<div class="rule workflowRule" style="width: 766px; height: 180px; left: 40px; top: '+(lowestRuleBottom+20)+'px;"><div class="workflowRuleHeader"><div class="verticalLabel" style="margin-top: 0px;">Pravidlo '+(highestRuleNumber+1)+'<\/div><\/div><div class="swimlaneArea"><div class="swimlane" style="height: 100%;"><div class="swimlaneRolesArea"><div class="roleItemContainer"><\/div><div class="rolePlaceholder"><div class="rolePlaceholderLabel">Pokud chcete specifikovat roli<br />přetáhněte ji do této oblasti<\/div><\/div><\/div><div class="swimlaneContentArea"><\/div><\/div><\/div><\/div>');$("#workflowRulesPanel .scrollArea").append(newRule);newRule.draggable({containment:"parent",handle:".workflowRuleHeader",revert:function(){return $(this).collision("#workflowRulesPanel .workflowRule").length>1},stop:function(){ChangedSinceLastSave=!0}});newRule.resizable({start:function(){rule=$(this);contentsWidth=120;contentsHeight=40;rule.find(".item").each(function(n,t){rightEdge=$(t).position().left+$(t).width();rightEdge>contentsWidth&&(contentsWidth=rightEdge);bottomEdge=$(t).position().top+$(t).height();bottomEdge>contentsHeight&&(contentsHeight=bottomEdge)});rule.css("min-width",contentsWidth+40);rule.css("min-height",contentsHeight+20);limits=CheckRuleResizeLimits(rule,!1);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},resize:function(){rule=$(this);instance=rule.data("jsPlumbInstance");instance.recalculateOffsets();instance.repaintEverything();limits=CheckRuleResizeLimits(rule,!1);rule.css("max-width",limits.horizontal-10);rule.css("max-height",limits.vertical-10)},stop:function(){ChangedSinceLastSave=!0}});CreateJsPlumbInstanceForRule(newRule);newRule.find(".swimlaneRolesArea").droppable({containment:".swimlaneContentArea",tolerance:"touch",accept:".toolboxItem.roleItem",greedy:!0,drop:function(n,t){dragModeActive&&(dragModeActive=!1,roleExists=!1,$(this).find(".roleItem").each(function(n,i){$(i).text()==t.helper.text()&&(roleExists=!0)}),roleExists||(droppedElement=t.helper.clone(),$(this).find(".rolePlaceholder").remove(),$(this).find(".roleItemContainer").append($('<div class="roleItem">'+droppedElement.text()+"<\/div>")),t.helper.remove(),ChangedSinceLastSave=!0))}});newRule.find(".swimlaneContentArea").droppable({containment:".swimlaneContentArea",tolerance:"touch",accept:".toolboxSymbol, .toolboxItem",greedy:!1,drop:function(n,t){if(dragModeActive){if(dragModeActive=!1,droppedElement=t.helper.clone(),droppedElement.hasClass("roleItem"))return t.draggable.draggable("option","revert",!0),!1;ruleContent=$(this);ruleContent.append(droppedElement);droppedElement.hasClass("toolboxSymbol")?(droppedElement.removeClass("toolboxSymbol ui-draggable ui-draggable-dragging"),droppedElement.addClass("symbol"),droppedElement.css({height:""}),leftOffset=$("#tapestryWorkspace").offset().left-ruleContent.offset().left,topOffset=$("#tapestryWorkspace").offset().top-ruleContent.offset().top):(droppedElement.removeClass("toolboxItem"),droppedElement.addClass("item"),droppedElement.css({width:"",height:""}),leftOffset=$("#tapestryWorkspace").offset().left-ruleContent.offset().left+38,topOffset=$("#tapestryWorkspace").offset().top-ruleContent.offset().top-18);droppedElement.offset({left:droppedElement.offset().left+leftOffset,top:droppedElement.offset().top+topOffset});t.helper.remove();AddToJsPlumb(droppedElement);droppedElement.position().top+droppedElement.height()+10>ruleContent.height()&&(console.log("matched"),droppedElement.css("top",ruleContent.height()-droppedElement.height()-20),instance=ruleContent.parents(".workflowRule").data("jsPlumbInstance"),instance.repaintEverything());ChangedSinceLastSave=!0}}})});$(document).on("click",".libraryItem",function(){var n;currentLibraryItem=$(this);libId=currentLibraryItem.attr("libId");libType=currentLibraryItem.attr("libType");libId&&(currentLibraryItem.hasClass("highlighted")?$('.tapestryToolbox .toolboxLi[libId="'+libId+'"]').remove():(newToolboxLi=null,libType=="action"?(newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_Actions"><div class="toolboxItem actionItem" actionId="'+currentLibraryItem.attr("actionId")+'"><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Attributes").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_Actions").hasClass("hiddenCategory")&&newToolboxLi.hide()):libType=="column-attribute"?(n="",currentLibraryItem.attr("isShared")==="true"&&(n='isShared="true"'),newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_Attributes"><div class="toolboxItem attributeItem tableAttribute" tableName="'+currentLibraryItem.attr("tableName")+'" '+n+' columnName="'+currentLibraryItem.attr("columnName")+'"><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_UI").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_Attributes").hasClass("hiddenCategory")&&newToolboxLi.hide()):libType=="table-attribute"?(n="",currentLibraryItem.attr("shared")==="true"&&(n='shared="true"'),console.log("Transpiling: "+n),newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_Attributes"><div class="toolboxItem attributeItem tableAttribute" tableName="'+currentLibraryItem.attr("tableName")+'" '+n+'><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_UI").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_Attributes").hasClass("hiddenCategory")&&newToolboxLi.hide()):libType=="view-attribute"?(n="",currentLibraryItem.attr("isShared")==="true"&&(n='isShared="true"'),newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_Attributes"><div class="toolboxItem attributeItem viewAttribute" tableName="'+currentLibraryItem.attr("tableName")+'" '+n+'><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_UI").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_Attributes").hasClass("hiddenCategory")&&newToolboxLi.hide()):libType=="ui"?(newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_UI"><div class="toolboxItem uiItem" pageId="'+currentLibraryItem.attr("pageId")+'" componentName="'+currentLibraryItem.attr("componentName")+'" isBootstrap="'+currentLibraryItem.attr("isBootstrap")+'"><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Roles").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_UI").hasClass("hiddenCategory")&&newToolboxLi.hide()):libType=="page-ui"?(newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_UI"><div class="toolboxItem uiItem pageUi" pageId="'+currentLibraryItem.attr("pageId")+'"><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Roles").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_UI").hasClass("hiddenCategory")&&newToolboxLi.hide()):libType=="role"?(newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_Roles"><div class="toolboxItem roleItem"><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_States").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_Roles").hasClass("hiddenCategory")&&newToolboxLi.hide()):libType=="state"?(newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_States"><div class="toolboxItem stateItem" stateId="'+currentLibraryItem.attr("stateId")+'"><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Targets").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_States").hasClass("hiddenCategory")&&newToolboxLi.hide()):libType=="target"?(newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_Targets"><div class="toolboxItem targetItem" targetId="'+currentLibraryItem.attr("targetId")+'"><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Templates").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_Targets").hasClass("hiddenCategory")&&newToolboxLi.hide()):libType=="template"?(newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_Templates"><div class="toolboxItem templateItem"><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox .toolboxCategoryHeader_Integrations").before(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_Templates").hasClass("hiddenCategory")&&newToolboxLi.hide()):["ldap","ws","smtp","webdav"].indexOf(libType)!=-1&&(newToolboxLi=$('<li libId="'+libId+'" class="toolboxLi toolboxLi_Integrations"><div class="toolboxItem integrationItem"><span class="itemLabel">'+currentLibraryItem.text()+"<\/span><\/div><\/li>"),$(".tapestryToolbox").append(newToolboxLi),$(".tapestryToolbox .toolboxCategoryHeader_Integrations").hasClass("hiddenCategory")&&newToolboxLi.hide()),newToolboxLi&&newToolboxLi.find(".toolboxItem").draggable({helper:"clone",appendTo:"#tapestryWorkspace",containment:"window",tolerance:"fit",revert:!0,scroll:!0,start:function(){dragModeActive=!0}})));$(this).toggleClass("highlighted")})}});var CurrentRule,CurrentItem,AssociatedPageIds=[],AssociatedTableName=[],AssociatedTableIds=[],CurrentTableColumnArray=[],RoleWhitelist=[],ModelTableIsShared,ModelTableName;$(function(){function y(){RoleWhitelist=[];roleCount=0;chooseWhitelistRolesDialog.find("#role-table:first tbody:nth-child(2) tr").each(function(n,t){$(t).hasClass("highlightedRow")&&(RoleWhitelist.push($(t).find("td").text()),roleCount++)});$("#blockHeaderRolesCount").text(roleCount);chooseWhitelistRolesDialog.dialog("close")}function e(){setArray=[];gatewayConditionsDialog.find(".conditionSet").each(function(n,t){currentSet=$(t);conditionArray=[];currentSet.find(".conditionTable tr").each(function(n,t){currentCondition=$(t);relationCellValue=currentCondition.find(".conditionOperator").text();relation=relationCellValue==""?"AND":relationCellValue.toUpperCase();conditionArray.push({Index:n,Relation:relation,Variable:currentCondition.find(".conditionVariableCell input").val(),Operator:currentCondition.find(".conditionOperatorCell select option:selected").text(),Value:currentCondition.find(".conditionValueCell input").val()})});setPrefix=currentSet.find(".conditionSetPrefix").text();setRelation=setPrefix=="OR a"?"OR":"AND";setArray.push({SetIndex:n,SetRelation:setRelation,Conditions:conditionArray})});CurrentItem.data("conditionSets",setArray).removeClass("activeItem");gatewayConditionsDialog.dialog("close")}function p(){CurrentItem.data("label",envelopeStartPropertiesDialog.find("#envelopeStartButtonName").val());envelopeStartPropertiesDialog.dialog("close");CurrentItem.removeClass("activeItem")}if(CurrentModuleIs("tapestryModule")){renameBlockDialog=$("#rename-block-dialog").dialog({autoOpen:!1,width:400,height:190,buttons:{Save:function(){n()},Cancel:function(){renameBlockDialog.dialog("close")}},create:function(){$(this).keypress(function(t){if(t.keyCode==$.ui.keyCode.ENTER)return n(),!1})},open:function(){renameBlockDialog.find("#block-name").val($("#blockHeaderBlockName").text())}});function n(){renameBlockDialog.dialog("close");$("#blockHeaderBlockName").text(renameBlockDialog.find("#block-name").val());ChangedSinceLastSave=!0}chooseTableDialog=$("#choose-table-dialog").dialog({autoOpen:!1,width:450,height:500,buttons:{Change:function(){o()},Cancel:function(){chooseTableDialog.dialog("close")}},open:function(){for($(this).find("#choice-table:first tbody:nth-child(2) tr").remove(),tbody=$(this).find("#choice-table tbody:nth-child(2)"),i=1;i<=5;i++)tbody.append($('<tr class="tableNameRow formRow"><td>Table'+i+"<\/td><\/tr>"));$(document).on("click","tr.tableNameRow",function(){chooseTableDialog.find("#choice-table tbody:nth-child(2) tr").removeClass("highlightedRow");$(this).addClass("highlightedRow")})}});function o(){somethingWasAdded=!1;selectedRow=chooseTableDialog.find("#choice-table:first tbody:nth-child(2) tr.highlightedRow");selectedRow.length?(chooseTableDialog.dialog("close"),$("#headerTableName").text(selectedRow.find("td").text()),ChangedSinceLastSave=!0):alert("No table selected")}chooseEmailTemplateDialog=$("#choose-email-template-dialog").dialog({autoOpen:!1,width:450,height:500,buttons:{Choose:function(){s()},Cancel:function(){chooseEmailTemplateDialog.dialog("close")}},open:function(){for($(this).find("#choice-template:first tbody:nth-child(2) tr").remove(),tbody=$(this).find("#choice-template tbody:nth-child(2)"),i=1;i<=5;i++)tbody.append($('<tr class="emailTemplateRow formRow" templateId="'+i+'"><td>Email template '+i+"<\/td><\/tr>"));CurrentItem.data("emailTemplate")&&tbody.find('tr[templateId="'+CurrentItem.data("emailTemplate")+'"]').addClass("highlightedRow");$(document).on("click","tr.emailTemplateRow",function(){chooseEmailTemplateDialog.find("#choice-template tbody:nth-child(2) tr").removeClass("highlightedRow");$(this).addClass("highlightedRow")})}});function s(){selectedRow=chooseEmailTemplateDialog.find("#choice-template:first tbody:nth-child(2) tr.highlightedRow");selectedRow.length?(CurrentItem.data("emailTemplate",selectedRow.attr("templateId")),chooseEmailTemplateDialog.dialog("close"),ChangedSinceLastSave=!0):alert("No template selected")}renameRuleDialog=$("#rename-rule-dialog").dialog({autoOpen:!1,width:400,height:190,buttons:{Save:function(){t()},Cancel:function(){renameRuleDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return t(),!1})},open:function(){renameRuleDialog.find("#rule-name").val(CurrentRule.find(".workflowRuleHeader .verticalLabel").text())}});function t(){renameRuleDialog.dialog("close");CurrentRule.find(".workflowRuleHeader .verticalLabel").text(renameRuleDialog.find("#rule-name").val());ChangedSinceLastSave=!0}historyDialog=$("#history-dialog").dialog({autoOpen:!1,width:700,height:540,buttons:{Load:function(){h()},Cancel:function(){historyDialog.dialog("close")}},open:function(){historyDialog.find("#commit-table:first tbody:nth-child(2) tr").remove();historyDialog.find(" .spinner-2").show();historyDialog.data("selectedCommitId",null);appId=$("#currentAppId").val();blockId=$("#currentBlockId").val();$.ajax({type:"GET",url:"/api/tapestry/apps/"+appId+"/blocks/"+blockId+"/commits",dataType:"json",success:function(n){for(tbody=historyDialog.find("#commit-table tbody:nth-child(2)"),commitIdArray=[],i=0;i<n.length;i++)commitIdArray.push(n[i].Id),n[i].CommitMessage!=null?tbody.append($('<tr class="commitRow"><td>'+n[i].TimeString+"<\/td><td>"+n[i].CommitMessage+"<\/td><\/tr>")):tbody.append($('<tr class="commitRow"><td>'+n[i].TimeString+'<\/td><td style="color: darkgrey;">(no message)<\/td><\/tr>'));$(document).on("click","tr.commitRow",function(){historyDialog.find("#commit-table tbody:nth-child(2) tr").removeClass("highlightedRow");$(this).addClass("highlightedRow");var n=$(this).index();historyDialog.data("selectedCommitId",commitIdArray[n])});historyDialog.find(".spinner-2").hide()}})}});function h(){historyDialog.data("selectedCommitId")?(historyDialog.dialog("close"),confirmed=ChangedSinceLastSave?confirm("Máte neuložené změny, opravdu si přejete tyto změny zahodit?"):!0,confirmed&&TB.load.loadBlock(historyDialog.data("selectedCommitId"))):alert("Please select a commit")}saveDialog=$("#save-dialog").dialog({autoOpen:!1,width:400,height:190,buttons:{Save:function(){r()},Cancel:function(){saveDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return r(),!1})},open:function(){saveDialog.find("#message").val("")}});function r(){saveDialog.dialog("close");SaveBlock(saveDialog.find("#message").val())}chooseScreensDialog=$("#choose-screens-dialog").dialog({autoOpen:!1,width:450,height:550,buttons:{Select:TB.screen.selectScreen,Cancel:TB.screen.closeDialog}});tableAttributePropertiesDialog=$("#table-attribute-properties-dialog").dialog({autoOpen:!1,width:450,height:500,buttons:{Change:function(){c()},Cancel:function(){tableAttributePropertiesDialog.dialog("close");CurrentItem.removeClass("activeItem")}},open:function(){var n=tableAttributePropertiesDialog.find(".columnFilterTable tbody");n.find("tr").remove();$("#table-attribute-properties-dialog .spinner-2").show();$("#btnOpenTableConditions").hide();appId=$("#currentAppId").val();url="/api/database/apps/"+appId+"/commits/latest";tableName=CurrentItem.attr("tableName");isShared=CurrentItem.attr("shared")==="true";$.ajax({type:"GET",url:url,dataType:"json",success:function(t){var r=t.Tables;for(isShared&&(r=t.Shared.Tables,console.log("Table is shared, targeting shared resources.")),CurrentTableColumnArray=[],columnFilter=CurrentItem.data("columnFilter"),columnFilter==undefined&&(columnFilter=[]),targetTable=r.filter(function(n){return console.log(n.Name+" == "+tableName+" = "+(n.Name==tableName)),n.Name==tableName})[0],targetTable==undefined&&alert("Požadovaná tabulka již není součástí schématu v Entitronu, nebo má nyní jiné Id."),i=0;i<targetTable.Columns.length;i++)newRow=$('<tr><td class="nameCell">'+targetTable.Columns[i].Name+'<\/td><td><input type="checkbox" class="showColumnCheckbox"><\/input>Show<\/td><\/tr>'),n.append(newRow),newRow.find(".showColumnCheckbox").prop("checked",columnFilter.indexOf(targetTable.Columns[i].Name)!=-1),CurrentTableColumnArray.push({Id:targetTable.Columns[i].Id,Name:targetTable.Columns[i].Name,Type:targetTable.Columns[i].Type});$("#btnOpenTableConditions").show();$("#table-attribute-properties-dialog .spinner-2").hide()}})}});function c(){columnFilter=[];formTable=tableAttributePropertiesDialog.find(".columnFilterTable .showColumnCheckbox").each(function(n,t){columnName=$(t).parents("tr").find(".nameCell").text();$(t).is(":checked")&&columnFilter.push(columnName)});CurrentItem.data("columnFilter",columnFilter).removeClass("activeItem");tableAttributePropertiesDialog.dialog("close")}uiitemPropertiesDialog=$("#uiItem-properties-dialog").dialog({autoOpen:!1,width:450,height:180,buttons:{Save:function(){l()},Cancel:function(){uiitemPropertiesDialog.dialog("close");CurrentItem.removeClass("activeItem")}},open:function(){uiitemPropertiesDialog.find("#ajax-action").prop("checked",CurrentItem.data("isAjaxAction"))}});function l(){CurrentItem.data("isAjaxAction",uiitemPropertiesDialog.find("#ajax-action").is(":checked"));uiitemPropertiesDialog.dialog("close");CurrentItem.removeClass("activeItem")}chooseTablesDialog=$("#choose-tables-dialog").dialog({autoOpen:!1,width:450,height:550,buttons:{Select:function(){a()},Cancel:function(){chooseTablesDialog.dialog("close")}},create:function(){$(document).on("click","tr.tableRow",function(){$(this).toggleClass("highlightedRow")})},open:function(){chooseTablesDialog.find("#table-table:first tbody:nth-child(2) tr").remove();chooseTablesDialog.find(".spinner-2").show();appId=$("#currentAppId").val();url="/api/database/apps/"+appId+"/commits/latest";$.ajax({type:"GET",url:url,dataType:"json",success:function(n){for(tbody=chooseTablesDialog.find("#table-table tbody:nth-child(2)"),i=0;i<n.Tables.length;i++)newTableRow=$('<tr class="tableRow" tableId="'+n.Tables[i].Id+'"><td><span class="tableName">'+n.Tables[i].Name+"<\/span><\/td><\/tr>"),AssociatedTableName.indexOf(n.Tables[i].Name)!=-1&&newTableRow.addClass("highlightedRow"),n.Tables[i].Name==ModelTableName&&newTableRow.find("td").append('<div class="modelMarker">Model<\/div>'),tbody.append(newTableRow);for(i=0;i<n.Shared.Tables.length;i++)newTableRow=$('<tr class="tableRow" tableId="'+n.Shared.Tables[i].Id+'"><td><span class="tableName" shared="true">'+n.Shared.Tables[i].Name+"<\/span><\/td><\/tr>"),AssociatedTableName.indexOf(n.Shared.Tables[i].Name)!=-1&&newTableRow.addClass("highlightedRow"),n.Shared.Tables[i].Name==ModelTableName&&newTableRow.find("td").append('<div class="modelMarker">Model<\/div>'),tbody.append(newTableRow);for(i=0;i<SystemTables.length;i++)newTableRow=$('<tr class="tableRow" tableId="'+SystemTables[i].Name+'"><td><span class="tableName">'+SystemTables[i].Name+"<\/span><\/td><\/tr>"),AssociatedTableName.indexOf(SystemTables[i].Name)!=-1&&newTableRow.addClass("highlightedRow"),SystemTables[i].Name==ModelTableName&&newTableRow.find("td").append('<div class="modelMarker">Model<\/div>'),tbody.append(newTableRow);chooseTablesDialog.find(".spinner-2").hide()}})}});function a(){chooseTablesDialog.find("#table-table:first tbody:nth-child(2) tr").hide();chooseTablesDialog.find(".spinner-2").show();appId=$("#currentAppId").val();url="/api/database/apps/"+appId+"/commits/latest";$.ajax({type:"GET",url:url,dataType:"json",success:function(n){$("#libraryCategory-Attributes .columnAttribute").remove();somethingWasAdded=!1;tableCount=0;AssociatedTableIds=[];AssociatedTableName=[];chooseTablesDialog.find("#table-table:first tbody:nth-child(2) tr").each(function(t,r){var u,f,e;if($(r).hasClass("highlightedRow")){if(tableCount++,tableId=$(r).attr("tableId"),isShared=$(r).find("td .tableName").attr("shared")==="true",tableName=$(r).find("td .tableName").text(),AssociatedTableIds.push(parseInt(tableId)),AssociatedTableName.push(tableName),u=n.Tables,isShared&&(u=n.Shared.Tables,console.log("Adding shared table columns")),console.log("Target:"),console.log($(r)),currentTable=u.filter(function(n){return n.Id==tableId})[0],console.log(currentTable),f="",e="",isShared&&(f='shared="true"',e="Shared: "),currentTable)for(i=0;i<currentTable.Columns.length;i++)console.log("Adding column: "+currentTable.Columns[i].Name),$("#libraryCategory-Attributes").append($('<div libId="'+ ++lastLibId+'" libType="column-attribute" class="libraryItem columnAttribute" tableName="'+currentTable.Name+'" columnName="'+currentTable.Columns[i].Name+'" '+f+">"+e+currentTable.Name+"."+currentTable.Columns[i].Name+"<\/div>"));if(systemTable=SystemTables.filter(function(n){return n.Name==tableName})[0],systemTable)for(i=0;i<systemTable.Columns.length;i++)$("#libraryCategory-Attributes").append($('<div libId="'+ ++lastLibId+'" libType="column-attribute" class="libraryItem columnAttribute" tableName="'+systemTable.Name+'" columnName="'+systemTable.Columns[i]+'">'+systemTable.Name+"."+systemTable.Columns[i]+"<\/div>"))}});modelMarker=chooseTablesDialog.find("#table-table:first tbody:nth-child(2) .modelMarker");modelMarker.length&&(ModelTableName=modelMarker.parents("td").find(".tableName").text(),ModelTableIsShared=modelMarker.parents("td").find(".tableName").attr("shared")==="true");$("#blockHeaderDbResCount").text(tableCount);chooseTablesDialog.dialog("close");chooseTablesDialog.find(".spinner-2").hide()}})}actionPropertiesDialog=$("#action-properties-dialog").dialog({autoOpen:!1,width:900,height:200,buttons:{Save:function(){u()},Cancel:function(){actionPropertiesDialog.dialog("close");CurrentItem.removeClass("activeItem")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return u(),!1})},open:function(){actionPropertiesDialog.find("#input-variables").val(CurrentItem.data("inputVariables"));actionPropertiesDialog.find("#output-variables").val(CurrentItem.data("outputVariables"))}});function u(){CurrentItem.data("inputVariables",actionPropertiesDialog.find("#input-variables").val());CurrentItem.data("outputVariables",actionPropertiesDialog.find("#output-variables").val());actionPropertiesDialog.dialog("close")}labelPropertyDialog=$("#label-property-dialog").dialog({autoOpen:!1,width:900,height:200,buttons:{Save:function(){v()},Cancel:function(){labelPropertyDialog.dialog("close");CurrentItem.removeClass("activeItem processedItem")}},open:function(){labelPropertyDialog.find("#label-input").val(CurrentItem.find(".itemLabel").text())}});function v(){CurrentItem.find(".itemLabel").text(labelPropertyDialog.find("#label-input").val());CurrentItem.removeClass("activeItem processedItem");labelPropertyDialog.dialog("close")}conditionsDialog=$("#conditions-dialog").dialog({autoOpen:!1,width:800,height:560,buttons:{Save:function(){f()},Cancel:function(){conditionsDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return f(),!1});$(this).find(".addAndConditionSetIcon").on("click",function(){newConditionSet=$(ConditionSetTemplate);newConditionSet.find(".conditionSetPrefix").text("AND a");newConditionSet.find(".conditionTable").append($(ConditionTemplate));LoadConditionColumns(newConditionSet);conditionsDialog.find(".conditionSetArea").append(newConditionSet);newConditionSet.index()==0&&newConditionSet.find(".conditionSetPrefix").text("A")});$(this).find(".addOrConditionSetIcon").on("click",function(){newConditionSet=$(ConditionSetTemplate);newConditionSet.find(".conditionSetPrefix").text("OR a");newConditionSet.find(".conditionTable").append($(ConditionTemplate));LoadConditionColumns(newConditionSet);conditionsDialog.find(".conditionSetArea").append(newConditionSet);newConditionSet.index()==0&&newConditionSet.find(".conditionSetPrefix").text("A")});$(this).on("click",".addAndConditionIcon",function(){newCondition=$(ConditionTemplate);newCondition.find(".conditionOperator").text("and");LoadConditionColumns(newCondition);$(this).parents("tr").after(newCondition)});$(this).on("click",".addOrConditionIcon",function(){newCondition=$(ConditionTemplate);newCondition.find(".conditionOperator").text("or");LoadConditionColumns(newCondition);$(this).parents("tr").after(newCondition)});$(this).on("click",".removeConditionIcon",function(){currentCondition=$(this).parents("tr");currentCondition.index()==0&&currentCondition.parents("table").find("tr:eq(1)").find(".conditionOperator").text("");currentCondition.parents("table").find("tr").length==1?(currentCondition.parents(".conditionSet").index()==0&&currentCondition.parents(".conditionSetArea").find(".conditionSet:eq(1)").find(".conditionSetPrefix").text("A"),currentCondition.parents(".conditionSet").remove()):currentCondition.remove()});$(this).on("click",".removeConditionSetIcon",function(){currentConditionSet=$(this).parents(".conditionSet");currentConditionSet.index()==0&&currentConditionSet.parents(".conditionSetArea").find(".conditionSet:eq(1)").find(".conditionSetPrefix").text("A");currentConditionSet.remove()});$(this).on("change",".conditionVariableCell select",function(){currentCondition=$(this).parents("tr");var n=$("option:selected",this);varType=n.attr("varType");currentCondition.find(".conditionOperatorCell select, .conditionValueCell select, .conditionValueCell input").remove();switch(varType){case"bool":currentCondition.find(".conditionValueCell").append($('<select><option selected="selected">b$true<\/option><option>b$false<\/option><\/select>'));currentCondition.find(".conditionOperatorCell").append($('<select><option selected="selected">==<\/option><option>!=<\/option><\/select>'));break;case"int":currentCondition.find(".conditionValueCell").append($('<input type="number"><\/input>'));currentCondition.find(".conditionOperatorCell").append($('<select><option selected="selected">==<\/option><option>!=<\/option><option>&gt;<\/option><option>&gt;=<\/option><option>&lt;<\/option><option>&lt;=<\/option>'));break;case"string":currentCondition.find(".conditionValueCell").append($('<input type="text"><\/input>'));currentCondition.find(".conditionOperatorCell").append($('<select><option selected="selected">==<\/option><option>!=<\/option><option>contains<\/option><option inputType="none">is empty<\/option><option inputType="none">is not empty<\/option><\/select>'));break;case"unknown":default:currentCondition.find(".conditionValueCell").append($('<input type="text"><\/input>'));currentCondition.find(".conditionOperatorCell").append($('<select><option selected="selected">==<\/option><option>!=<\/option><option>&gt;<\/option><option>&gt;=<\/option><option>&lt;<\/option><option>&lt;=<\/option><option>contains<\/option><option inputType="none">is empty<\/option><option inputType="none">is not empty<\/option><\/select>'))}});$(this).on("change",".conditionOperatorCell select",function(){currentCondition=$(this).parents("tr");var n=$("option:selected",this);inputType=n.attr("inputType");inputType==="none"?currentCondition.find(".conditionValueCell input, .conditionValueCell select").hide():currentCondition.find(".conditionValueCell input, .conditionValueCell select").show()})},open:function(){var n;for(conditionSetArea=conditionsDialog.find(".conditionSetArea"),conditionSetArea.find(".conditionSet").remove(),conditionSetData=CurrentItem.data("conditionSets"),conditionSetIndex=0;conditionSetIndex<conditionSetData.length;conditionSetIndex++)for(currentConditionSetData=conditionSetData[conditionSetIndex],prefix=currentConditionSetData.SetRelation=="OR"?"OR a":"AND a",newConditionSet=$(ConditionSetTemplate),newConditionSet.find(".conditionSetPrefix").text(prefix),conditionSetArea.append(newConditionSet),conditionSetIndex==0&&newConditionSet.find(".conditionSetPrefix").text("A"),conditionTable=newConditionSet.find(".conditionTable"),conditionIndex=0;conditionIndex<currentConditionSetData.Conditions.length;conditionIndex++){for(currentConditionData=currentConditionSetData.Conditions[conditionIndex],newCondition=$(ConditionTemplate),conditionIndex>0&&newCondition.find(".conditionOperator").text(currentConditionData.Relation.toLowerCase()),conditionTable.append(newCondition),columnSelect=newCondition.find(".conditionVariableCell select"),i=0;i<CurrentTableColumnArray.length;i++){cData=CurrentTableColumnArray[i];switch(cData.Type){case"varchar":columnType="string";break;case"boolean":columnType="bool";break;case"integer":columnType="int";break;default:columnType="unknown"}columnSelect.append($('<option varType="'+columnType+'">'+cData.Name+"<\/option>"))}columnSelect.val(currentConditionData.Variable);n=$("option:selected",columnSelect);varType=n.attr("varType");newCondition.find(".conditionOperatorCell select, .conditionValueCell select, .conditionValueCell input").remove();conditionValueCell=newCondition.find(".conditionValueCell");conditionOperatorCell=newCondition.find(".conditionOperatorCell");switch(varType){case"bool":conditionValueCell.append($('<select><option selected="selected">b$true<\/option><option>b$false<\/option><\/select>'));conditionOperatorCell.append($("<select><option>==<\/option><option>!=<\/option><\/select>"));conditionOperatorCell.find("select").val(currentConditionData.Operator);break;case"int":conditionValueCell.append($('<input type="number"><\/input>'));conditionOperatorCell.append($("<select><option>==<\/option><option>!=<\/option><option>&gt;<\/option><option>&gt;=<\/option><option>&lt;<\/option><option>&lt;=<\/option>"));conditionOperatorCell.find("select").val(currentConditionData.Operator);break;case"string":conditionValueCell.append($('<input type="text"><\/input>'));conditionOperatorCell.append($('<select><option>==<\/option><option>!=<\/option><option>contains<\/option><option inputType="none">is empty<\/option><option inputType="none">is not empty<\/option><\/select>'));conditionOperatorCell.find("select").val(currentConditionData.Operator);break;case"unknown":default:conditionValueCell.append($('<input type="text"><\/input>'));conditionOperatorCell.append($('<select><option>==<\/option><option>!=<\/option><option>&gt;<\/option><option>&gt;=<\/option><option>&lt;<\/option><option>&lt;=<\/option><option>contains<\/option><option inputType="none">is empty<\/option><option inputType="none">is not empty<\/option><\/select>'));conditionOperatorCell.find("select").val(currentConditionData.Operator)}n=$("option:selected",conditionOperatorCell);inputType=n.attr("inputType");inputType==="none"?conditionValueCell.find("input, select").hide():conditionValueCell.find("input").length>0?(conditionValueCell.find("input").show(),conditionValueCell.find("input").val(currentConditionData.Value)):conditionValueCell.find("select").length>0&&(conditionValueCell.find("select").show(),conditionValueCell.find("select").val(currentConditionData.Value))}}});function f(){setArray=[];conditionsDialog.find(".conditionSet").each(function(n,t){currentSet=$(t);conditionArray=[];currentSet.find(".conditionTable tr").each(function(n,t){currentCondition=$(t);relationCellValue=currentCondition.find(".conditionOperator").text();relation=relationCellValue==""?"AND":relationCellValue.toUpperCase();value=currentCondition.find(".conditionValueCell select").length>0?currentCondition.find(".conditionValueCell select option:selected").text():currentCondition.find(".conditionValueCell input").val();conditionArray.push({Index:n,Relation:relation,Variable:currentCondition.find(".conditionVariableCell select option:selected").text(),Operator:currentCondition.find(".conditionOperatorCell select option:selected").text(),Value:value})});setPrefix=currentSet.find(".conditionSetPrefix").text();setRelation=setPrefix=="OR a"?"OR":"AND";setArray.push({SetIndex:n,SetRelation:setRelation,Conditions:conditionArray})});CurrentItem.data("conditionSets",setArray);conditionsDialog.dialog("close")}}chooseWhitelistRolesDialog=$("#choose-whitelist-roles-dialog").dialog({autoOpen:!1,width:450,height:500,buttons:{Change:function(){y()},Cancel:function(){chooseWhitelistRolesDialog.dialog("close")}},open:function(){chooseWhitelistRolesDialog.find("#role-table:first tbody:nth-child(2) tr").remove();chooseWhitelistRolesDialog.find(".spinner-2").show();appId=$("#currentAppId").val();$.ajax({type:"GET",url:"/api/Persona/app-roles/"+appId,dataType:"json",success:function(n){for(tbody=chooseWhitelistRolesDialog.find("#role-table tbody:nth-child(2)"),i=0;i<n.Roles.length;i++){newTableRow=$('<tr class="roleRow"><td>'+n.Roles[i].Name+"<\/td><\/tr>");RoleWhitelist.indexOf(n.Roles[i].Name)!=-1&&newTableRow.addClass("highlightedRow");tbody.append(newTableRow);newTableRow.on("click",function(){$(this).toggleClass("highlightedRow")})}chooseWhitelistRolesDialog.find(".spinner-2").hide()}})}});gatewayConditionsDialog=$("#gateway-conditions-dialog").dialog({autoOpen:!1,width:800,height:560,buttons:{Save:function(){e()},Cancel:function(){gatewayConditionsDialog.dialog("close");CurrentItem.removeClass("activeItem")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return e(),!1});$(this).find(".addAndConditionSetIcon").on("click",function(){newConditionSet=$(ConditionSetTemplate);newConditionSet.find(".conditionSetPrefix").text("AND a");newConditionSet.find(".conditionTable").append($(ManualInputConditionTemplate));gatewayConditionsDialog.find(".conditionSetArea").append(newConditionSet);newConditionSet.index()==0&&newConditionSet.find(".conditionSetPrefix").text("A")});$(this).find(".addOrConditionSetIcon").on("click",function(){newConditionSet=$(ConditionSetTemplate);newConditionSet.find(".conditionSetPrefix").text("OR a");newConditionSet.find(".conditionTable").append($(ManualInputConditionTemplate));gatewayConditionsDialog.find(".conditionSetArea").append(newConditionSet);newConditionSet.index()==0&&newConditionSet.find(".conditionSetPrefix").text("A")});$(this).on("click",".addAndConditionIcon",function(){newCondition=$(ManualInputConditionTemplate);newCondition.find(".conditionOperator").text("and");$(this).parents("tr").after(newCondition)});$(this).on("click",".addOrConditionIcon",function(){newCondition=$(ManualInputConditionTemplate);newCondition.find(".conditionOperator").text("or");$(this).parents("tr").after(newCondition)});$(this).on("click",".removeConditionIcon",function(){currentCondition=$(this).parents("tr");currentCondition.index()==0&&currentCondition.parents("table").find("tr:eq(1)").find(".conditionOperator").text("");currentCondition.parents("table").find("tr").length==1?(currentCondition.parents(".conditionSet").index()==0&&currentCondition.parents(".conditionSetArea").find(".conditionSet:eq(1)").find(".conditionSetPrefix").text("A"),currentCondition.parents(".conditionSet").remove()):currentCondition.remove()});$(this).on("click",".removeConditionSetIcon",function(){currentConditionSet=$(this).parents(".conditionSet");currentConditionSet.index()==0&&currentConditionSet.parents(".conditionSetArea").find(".conditionSet:eq(1)").find(".conditionSetPrefix").text("A");currentConditionSet.remove()});$(this).on("change",".conditionOperatorCell select",function(){currentCondition=$(this).parents("tr");var n=$("option:selected",this);inputType=n.attr("inputType");inputType==="none"?currentCondition.find(".conditionValueCell input, .conditionValueCell select").hide():currentCondition.find(".conditionValueCell input, .conditionValueCell select").show()})},open:function(){for(conditionSetArea=gatewayConditionsDialog.find(".conditionSetArea"),conditionSetArea.find(".conditionSet").remove(),conditionSetData=CurrentItem.data("conditionSets"),conditionSetData||(conditionSetData=[]),conditionSetIndex=0;conditionSetIndex<conditionSetData.length;conditionSetIndex++)for(currentConditionSetData=conditionSetData[conditionSetIndex],prefix=currentConditionSetData.SetRelation=="OR"?"OR a":"AND a",newConditionSet=$(ConditionSetTemplate),newConditionSet.find(".conditionSetPrefix").text(prefix),conditionSetArea.append(newConditionSet),conditionSetIndex==0&&newConditionSet.find(".conditionSetPrefix").text("A"),conditionTable=newConditionSet.find(".conditionTable"),conditionIndex=0;conditionIndex<currentConditionSetData.Conditions.length;conditionIndex++){currentConditionData=currentConditionSetData.Conditions[conditionIndex];newCondition=$(ManualInputConditionTemplate);conditionIndex>0&&newCondition.find(".conditionOperator").text(currentConditionData.Relation.toLowerCase());conditionTable.append(newCondition);columnSelect=newCondition.find(".conditionVariableCell input");columnSelect.val(currentConditionData.Variable);conditionOperatorCell=newCondition.find(".conditionOperatorCell");conditionOperatorCell.find("select").val(currentConditionData.Operator);conditionValueCell=newCondition.find(".conditionValueCell");var n=$("option:selected",conditionOperatorCell);inputType=n.attr("inputType");inputType==="none"?conditionValueCell.find("input").hide():(conditionValueCell.find("input").show(),conditionValueCell.find("input").val(currentConditionData.Value))}}});envelopeStartPropertiesDialog=$("#envelopeStart-properties-dialog").dialog({autoOpen:!1,width:450,height:180,buttons:{Save:function(){p()},Cancel:function(){envelopeStartPropertiesDialog.dialog("close");CurrentItem.removeClass("activeItem")}},open:function(){envelopeStartPropertiesDialog.find("#envelopeStartButtonName").val(CurrentItem.data("label"))}})});$(function(){CurrentModuleIs("tapestryModule")});ConditionData=[];ConditionsRelationList=["AND","OR","XOR"];ConditionsOperatorList=["=","!=",">",">=","<","<="];FakeInputsForTesting=["Username.Value","Password.Value","LogIn.Success","LogIn.AttemptCount","LogIn.UserGroup","Global.BlockReferal","Global.BlockStartTimestamp"];TB={onInit:[],changedSinceLastSave:!1,init:function(){for(var t=TB,n=0;n<t.onInit.length;n++)t.onInit[n]()},checkRuleResizeLimits:function(n,t){var r=1e6,u=1e6,i=n.position().left,e=i+n.width(),f=n.position().top,o=n.position().top+n.height();return $(t?"#resourceRulesPanel .resourceRule":"#workflowRulesPanel .workflowRule").each(function(t,s){var h=$(s);if(h.attr("id")!=n.attr("id")){var c=h.position().left,a=c+h.width(),l=h.position().top,v=h.position().top+h.height();l<o&&v>f&&c+30>e&&c-i<r&&(r=c-i);c<e&&a>i&&l+20>o&&l-f<u&&(u=l-f)}}),{horizontal:r,vertical:u}},callHooks:function(n,t,i){for(var r=0;r<n.length;r++)n[r].apply(t,i)}};$(function(){function n(n,t){return n===t?0:n<t?-1:1}function t(n,t){for(var u,o=n.length,s=t.length,r=0,f=n.length>t.length?t.length:n.length,e=n.length<t.length?t.length:n.length,i=0;i<f;i++)n[i]==t[i]&&r++;return u=r/e,u*100}CurrentModuleIs("tapestryModule")&&TB.init();$(".librarySearchToggler").on("click",function(){var n=$(this).parent().parent().find(".librarySearch");n.hasClass("shown")?(n.addClass("hidden"),n.removeClass("shown")):(n.addClass("shown"),n.removeClass("hidden"))});$(".librarySearch").on("keyup",function(){var u=$(this).parent(),i=u.find(".libraryItem"),r=$(this).val();i.each(function(){$(this).detach()});i.sort(function(i,u){if(i=$(i).text(),u=$(u).text(),r!==""){var f=t(i,r),e=t(u,r);return f===e?n(i,u):f<e?1:-1}return n(i,u)});i.each(function(){u.append($(this))})})});TB.screen={init:function(){var n=TB.screen;$(document).on("click","#blockHeaderScreenCount",n.openDialog).on("click","#choose-screens-dialog tr.screenRow",n.toggleRow)},openDialog:function(){chooseScreensDialog.dialog("open");chooseScreensDialog.find("#screen-table tbody tr").remove();TB.screen.toggleSpinner(!0);var n=$("#currentAppId").val();$.ajax({type:"GET",url:"/api/mozaic-bootstrap/apps/"+n+"/pages",dataType:"json",success:TB.screen.setData})},closeDialog:function(){chooseScreensDialog.dialog("close")},toggleRow:function(){$(this).toggleClass("highlightedRow")},toggleSpinner:function(n){chooseScreensDialog.find(".spinner-2").toggle(n)},setData:function(n){var r=chooseScreensDialog.find("#screen-table tbody"),t;for(i=0;i<n.length;i++)t=$('<tr class="screenRow"><\/tr>'),t.attr({"data-pageid":n[i].Id,"data-isbootstrap":n[i].IsBootstrap}),t.append("<td>"+n[i].Name+"<\/td>"),t.append("<td>"+(n[i].IsBootstrap?"yes":"no")+"<\/td>"),n[i].IsBootstrap||AssociatedPageIds.indexOf(n[i].Id)==-1||t.addClass("highlightedRow"),n[i].IsBootstrap&&AssociatedBootstrapPageIds.indexOf(n[i].Id)!=-1&&t.addClass("highlightedRow"),r.append(t);TB.screen.toggleSpinner(!1)},selectScreen:function(){var n=TB.screen,t,i;n.toggleSpinner(!0);t=$("#screen-table tbody tr.highlightedRow").length;i=$("#currentAppId").val();AssociatedPageIds=[];AssociatedBootstrapPageIds=[];$("#libraryCategory-UI .libraryItem").remove();$("#screen-table tbody tr.highlightedRow").each(function(){var t=$(this).attr("data-pageid"),r=$(this).attr("data-isbootstrap")=="true",u=r?"/api/mozaic-bootstrap/apps/":"/api/mozaic-editor/apps/",f=r?n.loadBootstrapComponents:n.loadLegacyComponents;r?AssociatedBootstrapPageIds.push(parseInt(t)):AssociatedPageIds.push(parseInt(t));$.ajax({type:"GET",url:u+i+"/pages/"+t,dataType:"json",async:!1,success:f})});$("#blockHeaderScreenCount").text(t);n.toggleSpinner(!1);chooseScreensDialog.dialog("close")},loadBootstrapComponents:function(n,t){for(i=0;i<n.Components.length;i++){if(i==0){var r="Screen: "+n.Name,u={pageId:n.Id,isBootstrap:!0},f=t.filter?t.filter(function(t){return t.PageId==n.Id&&(!t.ComponentName||t.ComponentName=="undefined")}).length:!1,e=TB.library.createItem("UI","ui",u,r,"",f);f&&TB.toolbox.createItem(e,"UI","uiItem",u,r)}TB.screen.addComponent(n.Components[i],n.Id,t)}},addComponent:function(n,t,i){var o,s,c,e;if(n.ElmId!=""){var r=n.ElmId,u={pageId:t,componentName:r,isBootstrap:!0},f=i.filter?i.filter(function(n){return n.PageId==t&&n.ComponentName==r}).length:!1,h=TB.library.createItem("UI","ui",u,r,"",f,n);f&&TB.toolbox.createItem(h,"UI","uiItem",u,r)}if(n.UIC=="ui|data-table"&&(o=TB.screen.getAttribute(n.Attributes,"data-actions"),o!==-1)){s=JSON.parse(o.replace(/'/g,'"'));for(c in s){var r=n.ElmId+"_"+s[c].action,u={pageId:t,componentName:r,isBootstrap:!0},f=i.filter?i.filter(function(n){return n.PageId==t&&n.ComponentName==r}).length:!1,h=TB.library.createItem("UI","ui",u,r,"",f);f&&TB.toolbox.createItem(h,"UI","uiItem",u,r)}}if(n.ChildComponents)for(e=0;e<n.ChildComponents.length;e++)TB.screen.addComponent(n.ChildComponents[e],t,i)},loadLegacyComponents:function(n,t){for(i=0;i<n.Components.length;i++){if(i==0){var r="Screen: "+n.Name,u={pageId:n.Id,isBootstrap:!1},f=t.filter?t.filter(function(t){return t.PageId==n.Id&&(!t.ComponentName||t.ComponentName=="undefined")}).length:!1,e=TB.library.createItem("UI","ui",u,r,"",f);f&&TB.toolbox.createItem(e,"UI","uiItem",u,r)}TB.screen.addLegacyComponent(n.Components[i],n.Id,t)}},addLegacyComponent:function(n,t,i){var r=n.Name,u={pageId:t,componentName:r,isBootstrap:!1},f=i.filter?i.filter(function(n){return n.PageId==t&&n.ComponentName==r}).length:!1,h=TB.library.createItem("UI","ui",u,r,"",f,n),s,e,o;if(f&&TB.toolbox.createItem(h,"UI","uiItem",u,r),s=["_EditAction","_DetailsAction","_DeleteAction","_A_Action","_B_Action"],n.Type=="data-table-with-actions")for(e=0;e<s.length;e++){var r=n.Name+s[e],u={pageId:t,componentName:r,isBootstrap:!1},f=i.filter?i.filter(function(n){return n.PageId==t&&n.ComponentName==r}).length:!1,h=TB.library.createItem("UI","ui",u,r,"",f);f&&TB.toolbox.createItem(h,"UI","uiItem",u,r)}if(n.ChildComponents)for(o=0;o<n.ChildComponents.length;o++)TB.screen.addLegacyComponent(n.ChildComponents[o],t,i)},getAttribute:function(n,t){var i=JSON.parse(n);for(var r in i)if(i[r].name==t)return i[r].value;return-1}};TB.onInit.push(TB.screen.init);TB.load={libraryLoadList:{attributes:{url:"/api/database/apps/{appId}/commits/latest",success:"librarySetAttributes"},actions:{url:"/api/tapestry/actions",success:"librarySetActions"},roles:{url:"/api/Persona/app-roles/{appId}",success:"librarySetRoles"},states:{url:"/api/Persona/app-states/{appId}",success:"librarySetStates"},targets:{url:"/api/Tapestry/apps/{appId}/blocks",success:"librarySetTargets"},templates:{url:"/api/Hermes/{appId}/templates",success:"librarySetTemplates"},integrations:{url:"/api/Nexus/{appId}/gateways",success:"librarySetIntegrations"}},toolboxState:null,data:null,onAttributesLoad:[],init:function(){},loadBlock:function(n){pageSpinner.show();var t=$("#currentAppId").val(),i=$("#currentBlockId").val(),r="/api/tapestry/apps/"+t+"/blocks/"+i+(n?"/commits/"+n:"");$.ajax({type:"GET",url:r,dataType:"json",complete:pageSpinner.hide,success:TB.load.setData})},setData:function(n){var t=TB.load;ChangedSinceLastSave=!1;TB.changedSinceLastSave=!1;t.toolboxState=n.ToolboxState;t.data=n;t.clearBuilder();t.setBlockName(n.Name);t.setResourceRules(n.ResourceRules);t.setWorkflowRules(n.WorkflowRules);t.setRoleWhiteList(n.RoleWhitelist);t.loadPages();t.loadLibrary()},clearBuilder:function(){$("#resourceRulesPanel .resourceRule").remove();$("#workflowRulesPanel .workflowRule").remove()},setBlockName:function(n){$("#blockHeaderBlockName").text(n)},setResourceRules:function(n){for(var u,i,e,r,f,t=0;t<n.length;t++){for(u=TB.rr.create(n[t]),i=0;i<n[t].ResourceItems.length;i++)TB.rr.createItem(n[t].ResourceItems[i],u);for(e=u.data("jsPlumbInstance"),r=0;r<n[t].Connections.length;r++)f=n[t].Connections[r],e.connect({uuids:["resItem"+f.SourceId+"RightMiddle"],target:"resItem"+f.TargetId})}},setWorkflowRules:function(n){for(var u,i,e,r,t=0;t<n.length;t++){for(u=TB.wfr.create(n[t]),i=0;i<n[t].Swimlanes.length;i++)TB.wfr.createSwimlane(n[t].Swimlanes[i],n[t].Swimlanes.length,u);for(e=u.data("jsPlumbInstance"),r=0;r<n[t].Connections.length;r++){var f=n[t].Connections[r],s="wfItem"+f.SourceId,h="wfItem"+f.TargetId,o;o=f.SourceSlot==1?"BottomCenter":"RightMiddle";e.connect({uuids:[s+o],target:h})}}},setRoleWhiteList:function(n){$("#blockHeaderRolesCount").text(n.length);RoleWhitelist=n},loadLibrary:function(){var t,i,n;pageSpinner.show();t=$("#currentAppId").val();TB.library.clean();TB.toolbox.clean();for(i in TB.load.libraryLoadList)n=TB.load.libraryLoadList[i],$.ajax({type:"GET",url:n.url.replace(/\{appId\}/,t),dataType:"json",success:TB.load[n.success]});pageSpinner.hide()},loadPages:function(){var i=TB.load,n,t;for(AssociatedPageIds=i.data.AssociatedPageIds,AssociatedBootstrapPageIds=i.data.AssociatedBootstrapPageIds,$("#blockHeaderScreenCount").text(AssociatedPageIds.length+AssociatedBootstrapPageIds.length),n=0;n<AssociatedPageIds.length;n++)t=AssociatedPageIds[n],i.libraryLoadList["page"+t]={url:"/api/mozaic-editor/apps/{appId}/pages/"+t,success:"librarySetPage"};for(n=0;n<AssociatedBootstrapPageIds.length;n++)t=AssociatedBootstrapPageIds[n],i.libraryLoadList["bootstrapPage"+t]={url:"/api/mozaic-bootstrap/apps/{appId}/pages/"+t,success:"librarySetBootstrapPage"}},librarySetAttributes:function(n){var o=TB.load,c=o.toolboxState?o.toolboxState.Attributes:[],e,t,i,s,h,a;for(AssociatedTableIds=o.data.AssociatedTableIds,AssociatedTableName=o.data.AssociatedTableName,ModelTableName=o.data.ModelTableName,somethingWasAdded=!1,$("#blockHeaderDbResCount").text(o.data.AssociatedTableName.length),t=0;t<n.Tables.length;t++){var u=c.filter(function(i){return!i.ColumnName&&i.TableName==n.Tables[t].Name}).length,f={tableName:n.Tables[t].Name},r="Table: "+n.Tables[t].Name,l=TB.library.createItem("Attributes","table-attribute",f,r,"tableAttribute",u,n.Tables[t]);u&&TB.toolbox.createItem(l,"Attributes","attributeItem tableAttribute",f,r)}for(e=0;e<n.Views.length;e++){var u=c.filter(function(t){return!t.ColumnName&&t.TableName==n.Views[e].Name}).length,f={tableName:n.Views[e].Name},r="View: "+n.Views[e].Name,l=TB.library.createItem("Attributes","view-attribute",f,r,"viewAttribute",u,n.Views[e]);u&&TB.toolbox.createItem(l,"Attributes","attributeItem viewAttribute",f,r)}if(n.Shared!=null){for(t=0;t<n.Shared.Tables.length;t++){var u=c.filter(function(i){return!i.ColumnName&&i.TableName==n.Shared.Tables[t].Name}).length,f={tableName:n.Shared.Tables[t].Name,shared:!0},r="Shared table: "+n.Shared.Tables[t].Name,l=TB.library.createItem("Attributes","table-attribute",f,r,"tableAttribute sharedAttribute",u,n.Shared.Tables[t]);u&&TB.toolbox.createItem(l,"Attributes","attributeItem tableAttribute sharedAttribute",f,r)}for(e=0;e<n.Shared.Views.length;e++){var u=c.filter(function(t){return!t.ColumnName&&t.TableName==n.Shared.Views[e].Name}).length,f={tableName:n.Shared.Views[e].Name,shared:!0},r="Shared view: "+n.Shared.Views[e].Name,l=TB.library.createItem("Attributes","view-attribute",f,r,"viewAttribute sharedAttribute",u,n.Shared.Views[e]);u&&TB.toolbox.createItem(l,"Attributes","attributeItem viewAttribute sharedAttribute",f,r)}for(t=0;t<o.data.AssociatedTableName.length;t++)if(i=n.Shared.Tables.filter(function(n){return n.Name==o.data.AssociatedTableName[t]})[0],i)for(s=0;s<i.Columns.length;s++){var u=c.filter(function(n){return n.ColumnName==i.Columns[s].Name&&n.TableName==i.Name}).length,f={tableName:i.Name,columnName:i.Columns[s].Name,shared:!0},r=i.Name+"."+i.Columns[s].Name,l=TB.library.createItem("Attributes","column-attribute",f,r,"columnAttribute sharedAttribute",u,{Name:r});u&&TB.toolbox.createItem(l,"Attributes","attributeItem tableAttribute sharedAttribute",f,r)}}for(t=0;t<o.data.AssociatedTableName.length;t++){if(i=n.Tables.filter(function(n){return n.Name==o.data.AssociatedTableName[t]})[0],i)for(s=0;s<i.Columns.length;s++){var u=c.filter(function(n){return n.ColumnName==i.Columns[s].Name&&n.TableName==i.Name}).length,f={tableName:i.Name,columnName:i.Columns[s].Name},r=i.Name+"."+i.Columns[s].Name,l=TB.library.createItem("Attributes","column-attribute",f,r,"columnAttribute",u,{Name:r});u&&TB.toolbox.createItem(l,"Attributes","attributeItem tableAttribute",f,r)}if(h=SystemTables.filter(function(n){return n.Name==o.data.AssociatedTableName[t]})[0],h)for(a=0;a<h.Columns.length;a++){var u=c.filter(function(n){return n.ColumnName==h.Columns[a].Name&&n.TableName==h.Name}).length,f={tableName:h.Name,columnName:h.Columns[a].Name},r=h.Name+"."+h.Columns[a].Name,l=TB.library.createItem("Attributes","column-attribute",f,r,"columnAttribute",u,{Name:r});u&&TB.toolbox.createItem(l,"Attributes","attributeItem tableAttribute",f,r)}}TB.callHooks(o.onAttributesLoad,null,[n])},librarySetActions:function(n){for(var f=TB.load.toolboxState?TB.load.toolboxState.Actions:[],t=0;t<n.Items.length;t++){var i=f.filter(function(i){return i.ActionId==n.Items[t].Id}).length,r={actionId:n.Items[t].Id},u=n.Items[t].Name,e=TB.library.createItem("Actions","action",r,u,"",i,n.Items[t]);i&&TB.toolbox.createItem(e,"Actions","actionItem",r,u)}},librarySetRoles:function(n){for(var f=TB.load.toolboxState?TB.load.toolboxState.Roles:[],t=0;t<n.Roles.length;t++){var i=f.filter(function(i){return i.Label==n.Roles[t].Name}).length,r={},u=n.Roles[t].Name,e=TB.library.createItem("Roles","role",r,u,"",i);i&&TB.toolbox.createItem(e,"Roles","roleItem",r,u)}},librarySetStates:function(n){for(var f=TB.load.toolboxState?TB.load.toolboxState.States:[],t=0;t<n.States.length;t++){var i=f.filter(function(i){return i.StateId==n.States[t].Id}).length,r={stateId:n.States[t].Id},u=n.States[t].Name,e=TB.library.createItem("States","state",r,u,"",i);i&&TB.toolbox.createItem(e,"States","stateItem",r,u)}},librarySetTargets:function(n){for(var f=TB.load.toolboxState?TB.load.toolboxState.Targets:[],t=0;t<n.ListItems.length;t++){var i=f.filter(function(i){return i.TargetId==n.ListItems[t].Id}).length,r={targetId:n.ListItems[t].Id},u=n.ListItems[t].Name,e=TB.library.createItem("Targets","target",r,u,"",i);i&&TB.toolbox.createItem(e,"Targets","targetItem",r,u)}},librarySetTemplates:function(n){for(var f=TB.load.toolboxState?TB.load.toolboxState.Templates:[],t=0;t<n.length;t++){var i=f.filter(function(i){return i.Label==n[t].Name}).length,r={},u=n[t].Name,e=TB.library.createItem("Templates","template",r,u,"",i);i&&TB.toolbox.createItem(e,"Templates","templateItem",r,u)}},librarySetIntegrations:function(n){for(var f=TB.load.toolboxState?TB.load.toolboxState.Integrations:[],t=0;t<n.Ldap.length;t++){var r={},i="LDAP: "+n.Ldap[t].Name,u=f.filter(function(n){return n.Label==i}).length,e=TB.library.createItem("Integration","ldap",r,i,"",u);u&&TB.toolbox.createItem(e,"Integrations","integrationItem",r,i)}for(t=0;t<n.WS.length;t++){var r={libSubType:n.WS[t].Type},i="WS: "+n.WS[t].Name,u=f.filter(function(n){return n.Label==i}).length,e=TB.library.createItem("Integration","ws",r,i,"",u);u&&TB.toolbox.createItem(e,"Integrations","integrationItem",r,i)}for(t=0;t<n.SMTP.length;t++){var r={},i="SMTP: "+n.SMTP[t].Name,u=f.filter(function(n){return n.Label==i}).length,e=TB.library.createItem("Integration","smtp",r,i,"",u);u&&TB.toolbox.createItem(e,"Integrations","integrationItem",r,i)}for(t=0;t<n.WebDAV.length;t++){var r={},i="WebDAV: "+n.WebDAV[t].Name,u=f.filter(function(n){return n.Label==i}).length,e=TB.library.createItem("Integration","WebDAV",r,i,"",u);u&&TB.toolbox.createItem(e,"Integrations","integrationItem",r,i)}},librarySetPage:function(n){var t=TB.load.toolboxState?TB.load.toolboxState.UiComponents:[];TB.screen.loadLegacyComponents(n,t)},librarySetBootstrapPage:function(n){var t=TB.load.toolboxState?TB.load.toolboxState.UiComponents:[];TB.screen.loadBootstrapComponents(n,t)}};TB.onInit.push(TB.load.init);TB.rr={templates:{rule:'<div class="rule resourceRule"><\/div>',item:'<div class="item"><\/div>'},contextItems:{"delete":{name:"Delete rule",icon:"delete"}},create:function(n){var i=TB.rr,t=$(i.templates.rule);return t.css({width:n.Width,height:n.Height,left:n.PositionX,top:n.PositionY}).attr("id",AssingID()).appendTo("#resourceRulesPanel .scrollArea"),i.alive(t),t},createItem:function(n,t){var u=TB.rr,r=$(u.templates.item),i={};i.id="resItem"+n.Id;n.ActionId!=null&&(i.actionId=n.ActionId);n.StateId!=null&&(i.stateId=n.StateId);n.PageId!=null&&(i.pageId=n.PageId);n.ComponentName!=null&&(i.componentName=n.ComponentName);n.ColumnName!=null&&(i.columnName=n.ColumnName);n.IsShared!=null&&(i.shared=n.IsShared);n.IsBootstrap!=null&&(i.isBootstrap=n.IsBootstrap);n.BootstrapPageId!=null&&(i.pageId=n.BootstrapPageId);r.attr(i).css({left:n.PositionX,top:n.PositionY}).html(n.Label).addClass(n.TypeClass).appendTo(t);n.ConditionSets!=null&&r.data("conditionSets",n.ConditionSets);n.TableName!=null&&(r.data("columnFilter",n.ColumnFilter),r.attr("tableName",n.TableName),n.Label.indexOf("View:")==0?r.addClass("viewAttribute"):r.addClass("tableAttribute"));AddToJsPlumb(r)},alive:function(n){var t=TB.rr;n.draggable({containment:"parent",revert:t._draggableRevert,stop:t._draggableStop});n.resizable({start:t._resizableStart,stop:t._resizableStop});n.droppable({containment:".resourceRule",tolerance:"touch",accept:".toolboxItem",greedy:!0,drop:t._droppableDrop});CreateJsPlumbInstanceForRule(n)},_draggableRevert:function(){return $(this).collision("#resourceRulesPanel .resourceRule").length>1},_draggableStop:function(){ChangedSinceLastSave=!0;TB.changedSinceLastSave=!0},_resizableStart:function(){var i=$(this),n=120,t=40,r;i.find(".item").each(function(i,r){var u=$(r),f=u.position().left+u.width(),e=u.position().top+u.height();n=f>n?f:n;t=e>t?e:t});r=TB.checkRuleResizeLimits(i,!0);i.css({"min-width":n+40,"min-height":t+20,"max-width":r.horizontal-10,"max-height":r.vertical-10})},_resizableStop:function(){var n=$(this).data("jsPlumbInstance");n.recalculateOffsets();n.repaintEverything();ChangedSinceLastSave=!0;TB.changedSinceLastSave=!0},_droppableDrop:function(n,t){var u;if(dragModeActive){dragModeActive=!1;var r=$(this),f=$("#tapestryWorkspace").offset().left-r.offset().left+20,e=$("#tapestryWorkspace").offset().top-r.offset().top,i=t.helper.clone();i.removeClass("toolboxItem").addClass("item").css({width:"",height:""}).appendTo(r);i.offset({left:i.offset().left+f,top:i.offset().top+e});t.helper.remove();AddToJsPlumb(i);i.position().left+i.width()+35>r.width()&&(i.css("left",r.width()-i.width()-40),u=r.data("jsPlumbInstance"),u.repaintEverything());i.position().top+i.height()+5>r.height()&&(i.css("top",r.height()-i.height()-15),u=r.data("jsPlumbInstance"),u.repaintEverything());ChangedSinceLastSave=!0;TB.changedSinceLastSave=!0}},_contextAction:function(n,t){var i=t.$trigger;n=="delete"&&(i.remove(),ChangedSinceLastSave=!0,TB.changedSinceLastSave=!0)}};TB.wfr={onCreateItem:[],templates:{rule:'<div class="rule workflowRule"><div class="workflowRuleHeader"><div class="verticalLabel" style="margin-top: 0px;"><\/div><\/div><div class="swimlaneArea"><\/div><\/div>',swimlane:'<div class="swimlane"><div class="swimlaneRolesArea"><div class="roleItemContainer"><\/div><div class="rolePlaceholder"><div class="rolePlaceholderLabel">Pokud chcete specifikovat roli<br />přetáhněte ji do této oblasti<\/div><\/div><\/div><div class="swimlaneContentArea"><\/div><\/div>',item:""},contextItems:{"add-swimlane":{name:"Add swimlane",icon:"add"},rename:{name:"Rename rule",icon:"edit"},"delete":{name:"Delete rule",icon:"delete"}},swimlaneContextItems:{"remove-swimlane":{name:"Remove swimlane",icon:"delete"}},init:function(){},create:function(n){var i=TB.wfr,t=$(i.templates.rule);return t.css({width:n.Width,height:n.Height,left:n.PositionX,top:n.PositionY}).find(".verticalLabel").html(n.Name).end().attr("id",AssingID()).appendTo("#workflowRulesPanel .scrollArea"),i.aliveRule(t),t},remove:function(){this.remove();ChangedSinceLastSave=!0;TB.changedSinceLastSave=!0},rename:function(){CurrentRule=this;renameRuleDialog.dialog("open")},addSwimlane:function(){var n=this.find(".swimlane").length+1;TB.wfr.createSwimlane({Roles:[],WorkflowItems:[]},n,this);this.find(".swimlane").css("height",100/n+"%");this.data("jsPlumbInstance").recalculateOffsets();this.data("jsPlumbInstance").repaintEverything();ChangedSinceLastSave=!0;TB.changedSinceLastSave=!0},createSwimlane:function(n,t,i){var e=TB.wfr,r=$(e.templates.swimlane),u,f;if(r.css("height",100/t+"%").appendTo($(".swimlaneArea",i)),n.Roles.length>0)for(r.find(".swimlaneRolesArea .rolePlaceholder").remove(),u=0;u<n.Roles.length;u++)r.find(".swimlaneRolesArea .roleItemContainer").append('<div class="roleItem">'+n.Roles[u]+"<\/div>");for(f=0;f<n.WorkflowItems.length;f++)e.createItem(n.WorkflowItems[f],r);e.aliveSwimlane(r)},removeSwimlane:function(){var n=this.parents(".workflowRule"),t=n.find(".swimlane").length;t>1?(n.data("jsPlumbInstance").removeAllEndpoints(this,!0),this.remove(),n.find(".swimlane").css("height",100/(t-1)+"%"),n.data("jsPlumbInstance").recalculateOffsets(),n.data("jsPlumbInstance").repaintEverything(),ChangedSinceLastSave=!0,TB.changedSinceLastSave=!0):alert("Pravidlo musí mít alspoň jednu swimlane, nelze smazat všechny.")},createItem:function(n,t){var i;n.TypeClass==="symbol"&&n.SymbolType==="comment"?i=$('<div id="wfItem'+n.Id+'" class="symbol" symbolType="comment" endpoints="final" style="left: '+n.PositionX+"px; top: "+n.PositionY+'px; width: 30px; padding: 3px; border: 2px solid grey; border-right: none; min-height: 60px;"> <span class="itemLabel">'+n.Label+"<\/span><\/div>"):n.TypeClass=="symbol"?(i=$('<img id="wfItem'+n.Id+'" class="symbol" symbolType="'+n.SymbolType+'" src="/Content/Images/TapestryIcons/'+n.SymbolType+'.png" style="left: '+n.PositionX+"px; top: "+n.PositionY+'px;" />'),n.SymbolType=="envelope-start"&&i.data("label",n.Label)):i=$('<div id="wfItem'+n.Id+'" class="item" style="left: '+n.PositionX+"px; top: "+n.PositionY+'px;"><span class="itemLabel">'+n.Label+"<\/span><\/div>");i.addClass(n.TypeClass);n.ActionId!=null&&i.attr("actionId",n.ActionId);n.InputVariables!=null&&i.data("inputVariables",n.InputVariables);n.OutputVariables!=null&&i.data("outputVariables",n.OutputVariables);n.PageId!=null&&i.attr("pageId",n.PageId);n.ComponentName!=null&&i.attr("componentName",n.ComponentName);n.TargetId!=null&&i.attr("targetId",n.TargetId);n.StateId!=null&&i.attr("stateId",n.StateId);n.isAjaxAction!=null&&i.data("isAjaxAction",n.isAjaxAction);n.TypeClass=="circle-thick"&&i.attr("endpoints","final");n.SymbolType&&n.SymbolType.substr(0,8)=="gateway-"&&i.attr("endpoints","gateway");n.Condition!=null&&i.data("condition",n.Condition);n.ConditionSets!=null&&i.data("conditionSets",n.ConditionSets);n.IsBootstrap!=null&&i.attr("isBootstrap",n.IsBootstrap);i.appendTo(t.find(".swimlaneContentArea"));AddToJsPlumb(i);TB.callHooks(TB.wfr.onCreateItem,i,[])},aliveRule:function(n){var t=TB.wfr;n.draggable({containment:"parent",handle:".workflowRuleHeader",revert:t._ruleDraggableRevert,stop:t._ruleDraggableStop});n.resizable({start:t._ruleResizableStart,resize:t._ruleResizableResize,stop:t._ruleResizableStop});CreateJsPlumbInstanceForRule(n)},aliveSwimlane:function(n){var t=TB.wfr;n.find(".swimlaneRolesArea").droppable({tolerance:"touch",accept:".toolboxItem.roleItem",greedy:!0,drop:t._swimlaneRoleDrop});n.find(".swimlaneContentArea").droppable({containment:".swimlaneContentArea",tolerance:"touch",accept:".toolboxSymbol, .toolboxItem",greedy:!1,drop:t._swimlaneItemDrop})},_ruleDraggableRevert:function(){return $(this).collision("#workflowRulesPanel .workflowRule").length>1},_ruleDraggableStop:function(){ChangedSinceLastSave=!0;TB.changedSinceLastSave=!0},_ruleResizableStart:function(){var i=$(this),n=120,t=40,r=TB.checkRuleResizeLimits(i,!1);i.find(".item").each(function(i,r){var u=$(r).position().left+$(r).width(),f=$(r).position().top+$(r).height();n=u>n?u:n;t=f>t?f:t});i.css({"min-width":n+40,"min-height":t+20,"max-width":r.horizontal-10,"max-height":r.vertical-10})},_ruleResizableResize:function(){var n=$(this),t=n.data("jsPlumbInstance"),i=TB.checkRuleResizeLimits(n,!1);t.recalculateOffsets();t.repaintEverything();n.css({"max-width":i.horizontal-10,"max-height":i.vertical-10})},_ruleResizableStop:function(){ChangedSinceLastSave=!0;TB.changedSinceLastSave=!0},_swimlaneRoleDrop:function(n,t){var i,r;dragModeActive&&(dragModeActive=!1,i=!1,$(this).find(".roleItem").each(function(n,r){$(r).text()==t.helper.text()&&(i=!0)}),i||(r=t.helper.clone(),$(this).find(".rolePlaceholder").remove(),$(this).find(".roleItemContainer").append($('<div class="roleItem">'+r.text()+"<\/div>")),t.helper.remove(),ChangedSinceLastSave=!0,TB.changedSinceLastSave=!0))},_swimlaneItemDrop:function(n,t){var u,f,i,r,e;if(dragModeActive){if(dragModeActive=!1,i=t.helper.clone(),i.hasClass("roleItem"))return t.draggable.draggable("option","revert",!0),!1;r=$(this);r.append(i);i.hasClass("toolboxSymbol")?(i.removeClass("toolboxSymbol ui-draggable ui-draggable-dragging"),i.addClass("symbol"),i.css({height:""}),u=$("#tapestryWorkspace").offset().left-r.offset().left,f=$("#tapestryWorkspace").offset().top-r.offset().top):(i.removeClass("toolboxItem"),i.addClass("item"),i.css({width:"",height:""}),u=$("#tapestryWorkspace").offset().left-r.offset().left+38,f=$("#tapestryWorkspace").offset().top-r.offset().top-18);i.offset({left:i.offset().left+u,top:i.offset().top+f});t.helper.remove();AddToJsPlumb(i);i.position().top+i.height()+10>r.height()&&(i.css("top",r.height()-i.height()-20),e=r.parents(".workflowRule").data("jsPlumbInstance"),e.repaintEverything());ChangedSinceLastSave=!0;TB.changedSinceLastSave=!0}},_contextAction:function(n,t){var i=TB.wfr;switch(n){case"delete":i.remove.apply(t.$trigger,[]);break;case"rename":i.rename.apply(t.$trigger,[]);break;case"add-swimlane":i.addSwimlane.apply(t.$trigger,[])}},_swimlaneContextAction:function(n,t){n=="remove-swimlane"&&TB.wfr.removeSwimlane.apply(t.$trigger,[])}};TB.onInit.push(TB.wfr.init);TB.library={onCreate:[],onClean:[],clean:function(){$(".libraryItem").remove();TB.callHooks(TB.library.onClean,null,[])},createItem:function(n,t,i,r,u,f,e){var s=++lastLibId,o;return i.libId=s,i.libType=t,o=$('<div class="libraryItem"><\/div>'),o.attr(i).html(r).appendTo($("#libraryCategory-"+n)),u&&o.addClass(u),f&&o.addClass("highlighted"),TB.callHooks(TB.library.onCreate,e,[t]),s}};TB.toolbox={clean:function(){$(".tapestryToolbox .toolboxLi").remove()},createItem:function(n,t,i,r,u){var f=$('<li class="toolboxLi"><div class="toolboxItem"><span class="itemLabel"><\/span><\/div><\/li>'),e,o;f.attr("libId",n).addClass("toolboxLi_"+t).find("> div").addClass(i).attr(r).find(".itemLabel").html(u);e=$(".toolboxCategoryHeader_"+t).nextUntil("[class^=toolboxCategoryHeader]");o=e.length?e.last():$(".toolboxCategoryHeader_"+t);o.after(f);TB.toolbox.alive(f)},alive:function(n){n.find(".toolboxItem").draggable({helper:"clone",appendTo:"#tapestryWorkspace",containment:"window",tolerance:"fit",revert:!0,scroll:!0,start:function(){dragModeActive=!0}})}};TB.context={defaultSettings:{trigger:"right",zIndex:300},init:function(){var n=TB.context.defaultSettings;$.contextMenu($.extend(n,{selector:".resourceRule",callback:TB.rr._contextAction,items:TB.rr.contextItems}));$.contextMenu($.extend(n,{selector:".swimlane",callback:TB.wfr._swimlaneContextAction,items:TB.wfr.swimlaneContextItems}));$.contextMenu($.extend(n,{selector:".workflowRule",callback:TB.wfr._contextAction,items:TB.wfr.contextItems}));$.contextMenu($.extend(n,{selector:".tableRow",callback:function(n,t){if(n=="model"){var i=t.$trigger;i.addClass("highlightedRow");i.parents("table").find(".modelMarker").remove();i.find("td:first").append('<div class="modelMarker">Model<\/div>')}},items:{model:{name:"Set as model",icon:"edit"}}}));$.contextMenu($.extend(n,{selector:".swimlaneRolesArea .roleItem",callback:function(n,t){var r=t.$trigger,i;n=="delete"&&(i=r.parents(".swimlaneRolesArea"),r.remove(),i.find(".roleItem").length==0&&i.append($('<div class="rolePlaceholder"><div class="rolePlaceholderLabel">Pokud chcete specifikovat roli<br />přetáhněte ji do této oblasti<\/div><\/div>')),ChangedSinceLastSave=!0,TB.changedSinceLastSave=!0)},items:{"delete":{name:"Remove role",icon:"delete"}}}));$.contextMenu($.extend(n,{selector:".item:not(.actionItem), .symbol",callback:function(n,t){item=t.$trigger;n=="delete"?(currentInstance=item.parents(".rule").data("jsPlumbInstance"),currentInstance.removeAllEndpoints(item,!0),item.remove(),ChangedSinceLastSave=!0):n=="properties"&&(item.addClass("activeItem processedItem"),item.hasClass("tableAttribute")?(CurrentItem=item,tableAttributePropertiesDialog.dialog("open")):item.hasClass("viewAttribute")?(CurrentItem=item,gatewayConditionsDialog.dialog("open")):item.hasClass("actionItem")&&item.parents(".rule").hasClass("workflowRule")?(CurrentItem=item,actionPropertiesDialog.dialog("open")):item.hasClass("symbol")&&item.attr("symboltype")=="gateway-x"?(CurrentItem=item,gatewayConditionsDialog.dialog("open")):item.hasClass("symbol")&&item.attr("symboltype")=="envelope-start"?(CurrentItem=item,envelopeStartPropertiesDialog.dialog("open")):item.hasClass("uiItem")?(CurrentItem=item,uiitemPropertiesDialog.dialog("open")):item.hasClass("symbol")&&item.attr("symbolType")==="comment"?(CurrentItem=item,labelPropertyDialog.dialog("open")):(alert("Pro tento typ objektu nejsou dostupná žádná nastavení."),item.removeClass("activeItem")))},items:{properties:{name:"Properties",icon:"edit"},"delete":{name:"Delete",icon:"delete"}}}));$.contextMenu($.extend(n,{selector:".item.actionItem",callback:function(n,t){item=t.$trigger;n=="delete"?(currentInstance=item.parents(".rule").data("jsPlumbInstance"),currentInstance.removeAllEndpoints(item,!0),item.remove(),ChangedSinceLastSave=!0):n=="wizard"?(item.addClass("activeItem processedItem"),item.hasClass("actionItem")&&item.parents(".rule").hasClass("workflowRule")?(CurrentItem=item,TB.wizard.open.apply(item,[])):(alert("Pro tento typ objektu nejsou dostupná žádná nastavení."),item.removeClass("activeItem"))):n=="properties"&&(item.addClass("activeItem processedItem"),item.hasClass("actionItem")&&item.parents(".rule").hasClass("workflowRule")?(CurrentItem=item,actionPropertiesDialog.dialog("open")):(alert("Pro tento typ objektu nejsou dostupná žádná nastavení."),item.removeClass("activeItem")))},items:{wizard:{name:"Wizard",icon:"fa-magic"},properties:{name:"Properties",icon:"edit"},"delete":{name:"Delete",icon:"delete"}}}))}};TB.onInit.push(TB.context.init);TB.wizard={actions:{},dataTypeList:{s$:"string",b$:"boolean",i$:"integer",f$:"float",d$:"datetime",_var_:"variable"},variableList:[{label:"__Model__",category:"System"},{label:"__ModelId__",category:"System"},{label:"__TableName__",category:"System"},{label:"__CORE__",category:"System"},{label:"__User__",category:"System"},],dataPrefixList:{"ui|nv-list":["tableData"],"ui|data-table":["tableData"],"ui|countdown":["countdownTargetData"],"form|label":["inputData"],"form|input-text":["inputData"],"form|input-email":["inputData"],"form|input-color":["inputData"],"form|input-tel":["inputData"],"form|input-date":["inputData"],"form|input-number":["inputData"],"form|input-range":["inputData"],"form|input-hidden":["inputData"],"form|input-url":["inputData"],"form|input-search":["inputData"],"form|input-password":["inputData"],"form|input-file":["inputData"],"form|textarea":["inputData"],"form|checkbox":["checkboxData"],"form|radio":["checkboxData"],"form|select":["dropdownData","dropdownSelection"],checkbox:["checkboxData"],countdown:["countdownTargetData"],"data-table-read-only":["tableData"],"data-table-with-actions":["tableData"],"dropdown-select":["dropdownData","dropdownSelection"],"input-single-line":["inputData"],"input-multiline":["inputData"],label:["inputData"],"multiple-select":["dropdownData","dropdownSelection"],"name-value-list":["tableData"]},uiTypeList:{},target:null,init:function(){var n=TB.wizard;TB.load.onAttributesLoad.push(n._attributesLoad);TB.library.onClean.push(n._libraryClean);TB.library.onCreate.push(n._libraryCreateItem);TB.wfr.onCreateItem.push(n._workflowCreateItem);$.widget("custom.catcomplete",$.ui.autocomplete,{_create:function(){this._super();this.widget().menu("option","items","> :not(.ui-autocomplete-category)")},_renderMenu:function(n,t){var h=this,r=TB.wizard,e="",i,u,f,o=r.getRequestedWorkflow(),s=$(this.element).parents(".form-group").find("select[name=var_type]").val();if(s)switch(s){case"_var_":i="*";break;case"s$":i=r.getRequestedCategory.apply(this.element,[]);break;default:i=""}else i=r.getRequestedCategory.apply(this.element,[]);i=="Column"&&(u=r.getRequestedTable.apply(this.element,[]),f=r.getRequestedView.apply(this.element,[]));$.each(t,function(){var t;if(i=="*"||i==this.category||i.indexOf(this.category)!==-1||i.indexOf("Workflow")!==-1&&this.category.indexOf("Workflow")!==-1||i=="Column"&&(this.category=="Tables"&&u||this.category=="Views"&&f)){if(this.category!=e&&(this.category.indexOf("Workflow")===-1||this.category=="Workflow: "+o)&&(i!="Column"||this.category=="Tables"&&u||this.category=="Views"&&f)&&(n.append('<li class="ui-autocomplete-category bg-info">'+this.category+"<\/li>"),e=this.category),i=="Tables"&&this.label.indexOf(".")!==-1)return;if(i=="Column"&&this.category=="Tables"&&(!u||this.label.indexOf(u+".")===-1))return;if(i=="Column"&&this.category=="Views"&&(!f||this.label.indexOf(f+".")===-1))return;if(this.category.indexOf("Workflow")!==-1&&this.category!="Workflow: "+o)return;t=h._renderItemData(n,this)}})}})},open:function(){var n=TB.wizard,h=$(this),t=n.actions[h.attr("actionId")],c=$('<form class="form-horizontal" onsubmit="return false"><\/form>'),i=n.parseInputValue(h),o=n.parseOutputValue(h),l=[],v=[],e,f,s,u,a,y,r;if(n.target=h,e=$("<div title=\"Průvodce parametry akce '{action_name}'\"><\/div>"),e.attr("title",e.attr("title").replace(/\{action_name\}/,t.name)),e.append(c),e.dialog({autoOpen:!1,width:"50%",draggable:!0,resizable:!0,appendTo:"body",dialogClass:"dialog-wizard",buttons:[{text:"Použít",click:TB.wizard.validate}],create:function(){var n=$(this).parents(".ui-dialog").find(".ui-dialog-buttonset button");n.addClass("btn btn-primary").prepend('<span class="fa fa-check"><\/span> ')},close:function(){$(this).remove()}}),t.inputVars.length||t.outputVars.length||i.length||o.length){if(f=$('<fieldset class="inputVars"><legend>Input vars<\/legend><\/fieldset>'),s=$('<fieldset class="outputVars"><legend>Output vars<\/legend><\/fieldset>'),f.appendTo(c),s.appendTo(c),console.log(i),t.inputVars.length||i.length){for(r=0;r<t.inputVars.length;r++)if(u=t.inputVars[r],u.isArray){a=!1;y=new RegExp("^"+u.name+"\\[(\\d+)\\]$");for(k in i.items)(m=k.match(y))&&(n.createInputVar(u,f,i.items,m[1]),l.push(m[0]),a=!0);a||(n.createInputVar(u,f,i.items,0),l.push(u.name+"[0]"))}else n.createInputVar(u,f,i.items),l.push(u.name);for(k in i.items)$.inArray(k,l)==-1&&n.createInputVar({required:!1,type:null,name:k,isArray:!1,isEnum:!1,enumItems:[],unknown:!0},f,i.items)}else f.append('<div class="form-group no-vars"><div class="col-xs-12"><p class="alert alert-info">Tato akce nemá žádné vstupní parametry<\/p><\/div><\/div>');if(t.outputVars.length||o.length){for(r=0;r<t.outputVars.length;r++)n.createOutputVar(t.outputVars[r],s,o.items),v.push(t.outputVars[r].name);for(k in o.items)$.inArray(k,v)==-1&&n.createOutputVar({required:!1,type:null,name:k,isArray:!1,isEnum:!1,enumItems:[],unknown:!0},s,o.items)}else s.append('<div class="form-group no-vars"><div class="col-xs-12"><p class="alert alert-info">Tato akce nemá žádné výstupní parametry<\/p><\/div><\/div>')}else c.html('<div class="form-group no-vars"><div class="col-xs-12"><p class="alert alert-info">Tato akce nemá žádné vstupní ani výstupní parametry<\/p><\/div><\/div>');e.dialog("open")},validate:function(){var r=$(this),n=!0,t,i;r.find("fieldset.inputVars > .form-group:not(.no-vars)").each(function(){if($(this).data("required")=="true"){var t=$(this).find("input[name=var_value], select[name=var_value]").not(":disabled").val();n=n&&t.length>0}});n?TB.wizard.build.apply(this,[]):(t=$('<div title="Jste si jistí?"><p class="text-nowrap">Nemáte vyplněné všechny povinné proměnné.<br><b>Opravdu chcete parametry uložit?<\/b><\/p><\/div>'),i=this,t.dialog({autoOpen:!0,width:450,draggable:!1,resizable:!1,modal:!0,appendTo:"body",dialogClass:"dialog-wizard-confirm",buttons:[{text:"Ano",click:function(){TB.wizard.build.apply(i);$(this).dialog("close")}},{text:"Ne",click:function(){$(this).dialog("close")}}],create:function(){var n=$(this).parents(".ui-dialog").find(".ui-dialog-buttonset button");n.eq(0).addClass("btn btn-success pull-right").prepend('<span class="fa fa-check"><\/span> ');n.eq(1).addClass("btn btn-default").prepend('<span class="fa fa-times"><\/span> ');$(this).parents(".ui-dialog").find(".ui-dialog-buttonset").css("float","none")},close:function(){$(this).remove()}}))},build:function(){var n=$(this),t=[],i=[];n.find("fieldset.inputVars > .form-group:not(.no-vars)").each(function(){var u=$(this).find(".control-label").data("invar"),n=$(this).find(".control-label").data("index"),i=$(this).find("select[name=var_type]").val(),r=$(this).find("input[name=var_value], select[name=var_value]").not(":disabled").val();r.length&&t.push(u+(typeof n!="undefined"?"["+n+"]":"")+"="+(i=="_var_"?"":i)+r)});n.find("fieldset.outputVars > .form-group:not(.no-vars)").each(function(){var t=$(this).find(".input-group-addon:last-child").data("outvar"),n=$(this).find("input[name=out_value]").val();n.length&&i.push(n+"="+t)});TB.wizard.target.data("inputVariables",t.join(";"));TB.wizard.target.data("outputVariables",i.join(";"));TB.wizard.rebuildWorkflowVars();TB.wizard.target=null;n.dialog("close")},rebuildWorkflowVars:function(){var n=TB.wizard,i=n.getRequestedWorkflow(),t=[];$.each(n.variableList,function(){this.category!="Workflow: "+i&&t.push(this)});n.target.parents(".swimlaneArea").find(".actionItem").each(function(){var r=n.parseOutputValue($(this)),u;if(r.length>0)for(u in r.items)t.push({label:r.items[u],category:"Workflow: "+i})});n.variableList=t;n.variableList.sort(n.sort)},parseVars:function(n){var r=[],i,t;if(n)for(i=0;i<n.length;i++)t=n[i].match(/^(\?)?([a-z]\$)?([a-z0-9]+)(\[([^\]]*)\])?$/i),r.push({required:t[1]=="?"?!1:!0,type:t[2],name:t[3],isArray:t[4]&&(!t[5]||t[5]=="index")?!0:!1,isEnum:t[4]&&t[5]&&t[5]!="index"?!0:!1,enumItems:t[5]&&t[5]!="index"?t[5].split("|"):[],unknown:!1});return r},parseInputValue:function(n){var e=n.data("inputVariables"),i={length:0,items:{}},r,t,u,f;if(e)for(r=e.split(/;/),t=0;t<r.length;t++)u=r[t].split(/=/),f=u[1].match(/^([a-z]\$)?(.+)/),i.length++,i.items[u[0]]={dataType:f[1],value:f[2]};return i},parseOutputValue:function(n){var f=n.data("outputVariables"),i={length:0,items:{}},r,t,u;if(f)for(r=f.split(/;/),t=0;t<r.length;t++)u=r[t].split(/=/),i.length++,i.items[u[1]]=u[0];return i},createInputVar:function(n,t,i,r){var s=$('<div class="form-group form-group-sm" />'),k=$('<div class="col-md-2 col-sm-6" />'),d=$('<div class="col-md-7 col-sm-6" />'),f=$('<div class="input-group" />'),g=$('<label class="control-label col-md-3" data-invar="'+n.name+'">'+n.name+(n.isArray?"["+r+"]":"")+" =<\/label>"),u=$('<select name="var_type" class="form-control"><\/select>'),h=$('<input type="text" name="var_value" class="form-control" />'),p=$('<select name="var_value" class="form-control enum-value"><\/select>'),c=$('<select name="var_value" class="form-control boolean-value"><\/select>'),y=$('<div class="input-group-addon"><\/div>'),l,e,a,v,w,b,o,tt;if(s.data("required",n.required?"true":"false"),g.appendTo(s),k.appendTo(s),d.appendTo(s),u.appendTo(k),f.appendTo(d),y.appendTo(f),h.appendTo(f),c.appendTo(f),s.appendTo(t),c.append('<option value="True">True<\/option>'),c.append('<option value="False">False<\/option>'),n.isEnum){for(f.append(p),l=0;l<n.enumItems.length;l++)p.append('<option value="'+n.enumItems[l]+'">'+n.enumItems[l]+"<\/option>");h.attr("disabled",!0).hide()}if(n.isArray){var e=$('<div class="input-group-addon"><\/div>'),nt=$('<span class="fa fa-plus fa-fw"><\/span>'),a=$('<span class="fa fa-times fa-fw"><\/span>');e.appendTo(f);nt.appendTo(e);a.appendTo(e);nt.click(TB.wizard._addArrayItem);a.click(TB.wizard._deleteArrayItem);g.attr("data-index",r)}n.required?y.append('<span class="fa fa-asterisk fa-fw"><\/span>'):n.unknown?(y.append('<span class="fa fa-warning fa-fw" title="Neočekávaná vstupní proměnná"><\/span>'),e=$('<div class="input-group-addon"><\/div>'),a=$('<span class="fa fa-times fa-fw"><\/span>'),e.appendTo(f),a.appendTo(e),a.click(TB.wizard._deleteUnexpectedVar)):y.append('<span class="fa fa-question fa-fw"><\/span>');u.data("hasEnum",n.isEnum);u.change(TB.wizard._changeType);for(v in TB.wizard.dataTypeList)w=$('<option value="'+v+'">'+TB.wizard.dataTypeList[v]+"<\/option>"),w.attr("disabled",n.type&&v!=n.type&&v!="_var_"),u.append(w);b=n.isArray?n.name+"["+r+"]":n.name;i[b]&&(o=i[b],u.val(o.dataType?o.dataType:"_var_"),n.isEnum&&u.val()!="_var_"?p.val(o.value):u.val()=="b$"?(tt=o.value.toLowerCase()=="true"?"True":"False",c.val(tt),h.attr("disabled",!0).hide()):h.val(o.value));c.attr("disabled",u.val()!="b$").toggle(u.val()=="b$");TB.wizard.setInputVarAutocomplete(h);u.change()},createOutputVar:function(n,t,i){var e=$('<div class="form-group form-group-sm" />'),o=$('<div class="col-xs-12"><\/div>'),r=$('<div class="input-group" />'),u=$('<input type="text" name="out_value" class="form-control text-right" />'),s=$('<div class="input-group-addon" data-outvar="'+n.name+'">= '+n.name+"<\/div>"),f;o.appendTo(e);r.appendTo(o);u.appendTo(r);s.appendTo(r);i[n.name]&&u.val(i[n.name]);n.unknown&&(f=$('<span class="fa fa-times fa-fw" style="margin-left: 7px" title="Smazat"><\/span>'),r.prepend('<div class="input-group-addon"><span class="fa fa-warning fa-fw" title="Neočekávaná výstupní proměnná"><\/span><\/div>'),s.append(f),f.click(TB.wizard._deleteUnexpectedVar));e.appendTo(t);u.catcomplete({delay:0,source:TB.wizard.variableList})},loadViewColumns:function(n){$.ajax({url:"/api/database/apps/"+$("#currentAppId").val()+"/viewscheme/"+n,type:"post",dataType:"json",success:function(t){for(var r=TB.wizard,i=0;i<t.Columns.length;i++)r.variableList.push({label:n+".["+t.Columns[i]+"]",category:"Views"})}})},sort:function(n,t){var i=n.category+"_"+n.label,r=t.category+"_"+t.label;return i.localeCompare(r)},getRequestedCategory:function(){var n=$(this).parents(".form-group").find(".control-label").data("invar"),t=$(this).parents(".form-group").find(".input-group-addon:last-child").data("outvar");if(n){switch(n){case"TableName":return"Tables";case"ViewName":return"Views"}if(n.indexOf("Column")!==-1)return"Column"}return t?"System|Workflow|UI input data":""},getRequestedWorkflow:function(){return TB.wizard.target.parents(".workflowRule").find(".workflowRuleHeader .verticalLabel").text()},getRequestedTable:function(){var n=$(this).parents(".inputVars").find(".control-label[data-invar=TableName]").parent();return n.find("select[name=var_type]").val()=="s$"?n.find("input[name=var_value]").val():""},getRequestedView:function(){var n=$(this).parents(".inputVars").find(".control-label[data-invar=ViewName]").parent();return n.find("select[name=var_type]").val()=="s$"?n.find("input[name=var_value]").val():""},setInputVarAutocomplete:function(n){n.catcomplete({delay:0,source:TB.wizard.variableList,search:TB.wizard._autocompleteSearch,select:TB.wizard._autocompleteSelect})},_libraryClean:function(){TB.wizard.actions={}},_libraryCreateItem:function(n){var t=TB.wizard,i;switch(n){case"action":t.actions[this.Id]={name:this.Name,inputVars:t.parseVars(this.InputVars),outputVars:t.parseVars(this.OutputVars)};break;case"ui":if(typeof this.ElmId!="undefined"||typeof this.ComponentName!="undefined"){if(t.variableList.push({label:typeof this.ElmId!="undefined"?this.ElmId:this.ComponentName,category:"UI elements"}),typeof this.UIC!="undefined"&&typeof t.dataPrefixList[this.UIC]!="undefined")for(i=0;i<t.dataPrefixList[this.UIC].length;i++)t.variableList.push({label:"_uic_"+t.dataPrefixList[this.UIC][i]+"_"+this.ElmId,category:"UI input data"});if(typeof this.ComponentName!="undefined"&&typeof t.dataPrefixList[this.Type]!="undefined")for(i=0;i<t.dataPrefixList[this.Type].length;i++)t.variableList.push({label:"_uic_"+t.dataPrefixList[this.Type][i]+"_"+this.ComponentName,category:"UI input data"});t.variableList.sort(t.sort)}}},_attributesLoad:function(n){for(var r,u,i=TB.wizard,t=0;t<n.Tables.length;t++)if(i.variableList.push({label:n.Tables[t].Name,category:"Tables"}),i.variableList.push({label:"__Model."+n.Tables[t].Name,category:"System"}),n.Tables[t].Columns.length)for(r=0;r<n.Tables[t].Columns.length;r++)i.variableList.push({label:n.Tables[t].Name+"."+n.Tables[t].Columns[r].Name,category:"Tables"}),i.variableList.push({label:"__Model."+n.Tables[t].Name+"."+n.Tables[t].Columns[r].Name,category:"System"});for(u=0;u<n.Views.length;u++)i.variableList.push({label:n.Views[u].Name,category:"Views"}),i.loadViewColumns(n.Views[u].Name);if(n.Shared!=null){for(t=0;t<n.Shared.Tables.length;t++)if(i.variableList.push({label:n.Shared.Tables[t].Name,category:"Tables"}),i.variableList.push({label:"__Model."+n.Shared.Tables[t].Name,category:"System"}),n.Shared.Tables[t].Columns.length)for(r=0;r<n.Shared.Tables[t].Columns.length;r++)i.variableList.push({label:n.Shared.Tables[t].Name+"."+n.Shared.Tables[t].Columns[r].Name,category:"Tables"}),i.variableList.push({label:"__Model."+n.Shared.Tables[t].Name+"."+n.Shared.Tables[t].Columns[r].Name,category:"System"});for(u=0;u<n.Shared.Views.length;u++)i.variableList.push({label:n.Shared.Views[u].Name,category:"Views"})}},_workflowCreateItem:function(){var t=TB.wizard,n,i;if(this.attr("actionId")&&this.attr("actionId").length&&this.data("outputVariables")&&(n=TB.wizard.parseOutputValue(this),n.length)){for(i in n.items)t.variableList.push({label:n.items[i],category:"Workflow: "+this.parents(".workflowRule").find(".workflowRuleHeader .verticalLabel").text()});t.variableList.sort(t.sort)}},_changeType:function(){var n=$(this).data("hasEnum");$(this).parents(".form-group").find("input[name=var_value]").attr("disabled",this.value!="_var_"&&n||this.value=="b$").toggle((this.value=="_var_"||!n)&&this.value!="b$").end().find("select.enum-value").attr("disabled",this.value=="_var_"||!n).toggle(this.value!="_var_"&&n).end().find("select.boolean-value").attr("disabled",this.value!="b$").toggle(this.value=="b$");this.value=="f$"||this.value=="i$"?$(this).parents(".form-group").find("input[name=var_value]").attr("type","number"):$(this).parents(".form-group").find("input[name=var_value]").attr("type","text")},_deleteUnexpectedVar:function(){$(this).parents(".form-group").remove()},_autocompleteSearch:function(){var n,t=$(this).parents(".form-group").find("select[name=var_type]").val();switch(t){case"_var_":n="*";break;case"s$":n=TB.wizard.getRequestedCategory.apply(this,[]);break;default:n=""}if(n=="")return!1},_autocompleteSelect:function(n,t){var i=TB.wizard.getRequestedCategory.apply(this,[]);if(i=="Column")return this.value=t.item.value.replace(/^[^\.]+\./,""),!1},_addArrayItem:function(){var u=$(this).parents(".form-group"),f=u.find(".control-label"),e=f.data("invar"),n=$(".control-label[data-invar="+e+"]").last().parents(".form-group"),o=Number(n.find(".control-label").data("index"));n.find("input[name=var_value]").catcomplete("destroy");var i=o+1,t=n.clone(!0),r=t.find(".control-label");r.attr("data-index",i).html(r.html().replace(/\[\d+\]/,"["+i+"]"));t.find("[name=var_value]").val("");t.insertAfter(n);TB.wizard.setInputVarAutocomplete(t.find("input[name=var_value]"));TB.wizard.setInputVarAutocomplete(n.find("input[name=var_value]"))},_deleteArrayItem:function(){var n=$(this).parents(".form-group"),t=n.find(".control-label"),i=t.data("invar");n.remove();$(".control-label[data-invar="+i+"]").each(function(n){$(this).attr("data-index",n).html(this.innerHTML.replace(/\[\d+\]/,"["+n+"]"))})}};TB.onInit.push(TB.wizard.init);$(function(){$("#moduleAdminPanel").length&&LoadModuleAdminScript()});maintenanceModeActive=!1;pageSpinner=function(){var t=!1,n=1;return{show:function(i){arguments.length||(i=1);n+=i;n>0&&$(document.body).addClass("pageSpinnerShown");t&&(console.log("page spinner shown %d times, %d total",i,n),console.trace())},hide:function(i){arguments.length||(i=1);n-=i;n<=0&&$(document.body).removeClass("pageSpinnerShown");t&&(console.log("page spinner hidden %d times, %d remaining",i,n),console.trace())}}}();$(function(){var n=document.body.getAttribute("data-module");$(document).on("ajaxError",function(n,t){ShowAppNotification(t.responseText||"nastala chyba sítě","error")});$(window).on("error",function(){ShowAppNotification("Nastala neočekávaná chyba","error")});$("[data-ajax='true']").data("ajax-failure",function(n){ShowAppNotification(n.responseText||"nastala chyba sítě","error")}.toString());pageSpinner.hide();$(window).on("beforeunload",function(){pageSpinner.show()});$("#identitySuperMenu").on("click",function(){$("#leftBar .leftMenu li.identitySubMenu").slideToggle()});$("#appSuperMenu").on("click",function(){$("#leftBar .leftMenu li.appSubMenu").slideToggle()});CurrentModuleIs("portalModule")?$("#adminMenuPortal").addClass("active"):CurrentModuleIs("adminAppModule")?$("#adminMenuApps").addClass("active"):CurrentModuleIs("nexusModule")?$("#adminMenuNexus").addClass("active"):CurrentModuleIs("tapestryModule")||CurrentModuleIs("overviewModule")?($("#adminMenuTapestry").addClass("active"),$("#leftBar .leftMenu li.appSubMenu").show()):CurrentModuleIs("mozaicModule")||CurrentModuleIs("mozaicEditorModule")?($("#adminMenuMozaic").addClass("active"),$("#leftBar .leftMenu li.appSubMenu").show()):CurrentModuleIs("dbDesignerModule")?($("#adminMenuDbDesigner").addClass("active"),$("#leftBar .leftMenu li.appSubMenu").show()):CurrentModuleIs("personaModule")||CurrentModuleIs("personaRolesModule")?($("#adminMenuPersona").addClass("active"),$("#leftBar .leftMenu li.identitySubMenu").show()):CurrentModuleIs("personaModulesModule")?($("#adminMenuPersonaModules").addClass("active"),$("#leftBar .leftMenu li.identitySubMenu").show()):CurrentModuleIs("watchtowerModule")?$("#adminMenuWatchtower").addClass("active"):CurrentModuleIs("hermesModule")?$("#adminMenuHermes").addClass("active"):CurrentModuleIs("cortexModule")&&$("#adminMenuCortex").addClass("active");$("#usersOnlineIndicator").on("click",function(){$(".clickableIndicatorRectangle").removeClass("highlighted");$("#usersOnlineIndicator").addClass("highlighted");$.get("/CORE/Portal/UsersOnline").success(function(n){$("#lowerPanelDynamicContainer").html(n)})});$("#activeProfileIndicator").on("click",function(){$(".clickableIndicatorRectangle").removeClass("highlighted");$("#activeProfileIndicator").addClass("highlighted");$.get("/CORE/Portal/ActiveProfile").success(function(n){$("#lowerPanelDynamicContainer").html(n)})});$("#activeModulesIndicator").on("click",function(){$(".clickableIndicatorRectangle").removeClass("highlighted");$("#activeModulesIndicator").addClass("highlighted");$.get("/CORE/Portal/ModuleAdmin").success(function(n){$("#lowerPanelDynamicContainer").html(n);LoadModuleAdminScript()})});$("#maintenanceIndicator").on("click",function(){maintenanceModeActive?($("#maintenanceIndicator").removeClass("maintenanceActive"),$("#maintenanceIndicator .indicatorLabel").text("vypnuta"),maintenanceModeActive=!1):($("#maintenanceIndicator").addClass("maintenanceActive"),$("#maintenanceIndicator .indicatorLabel").text("zapnuta"),maintenanceModeActive=!0)});$("#notificationArea .indicatorBar").on("click",function(){$(this).remove()});$("#hideUpperPanelIcon").on("click",function(){$("#minimizedUpperPanel").show();$("#lowerPanel").css({top:"+="+$("#minimizedUpperPanel").height()+"px"});$("#lowerPanel").css({top:"-="+$("#upperPanel").height()+"px"});$("#upperPanel").hide();CurrentModuleIs("tapestryModule")?RecalculateToolboxHeight():CurrentModuleIs("mozaicEditorModule")&&RecalculateMozaicToolboxHeight()});$("#showUpperPanelIcon").on("click",function(){$("#upperPanel").show();$("#lowerPanel").css({top:"+="+$("#upperPanel").height()+"px"});$("#lowerPanel").css({top:"-="+$("#minimizedUpperPanel").height()+"px"});$("#minimizedUpperPanel").hide();CurrentModuleIs("tapestryModule")?RecalculateToolboxHeight():CurrentModuleIs("mozaicEditorModule")&&RecalculateMozaicToolboxHeight()});$("#topBar").width($(window).width());$("#upperPanel").width($(window).width()-225);$("#minimizedUpperPanel").width($(window).width()-225);$(window).on("resize",function(){$("#topBar").width($(window).width());$("#upperPanel").width($(window).width()-225);$("#minimizedUpperPanel").width($(window).width()-225)})});$(function(){if(CurrentModuleIs("personaModulesModule")||CurrentModuleIs("personaRolesModule"))$("body").on("click",".checkboxCell",function(){checkboxCell=$(this);checkboxCell.hasClass("yesCell")?(checkboxCell.removeClass("yesCell"),checkboxCell.addClass("noCell"),checkboxCell.find(".fa").removeClass("fa-check").addClass("fa-times")):(checkboxCell.removeClass("noCell"),checkboxCell.addClass("yesCell"),checkboxCell.find(".fa").removeClass("fa-times").addClass("fa-check"))});if(CurrentModuleIs("personaModulesModule")){$("body").on("click","#btnSaveModuleAccessTable",function(){SaveModulePermissions()});$("body").on("click","#btnReloadModuleAccessTable",function(){location.reload()})}});jsPlumb.ready(function(){CurrentModuleIs("overviewModule")&&(instance=jsPlumb.getInstance({ConnectionOverlays:[["Arrow",{location:1}]],Container:"#overviewPanel .scrollArea",Endpoint:"Blank",Anchor:"Continuous",Connector:["Straight",{stub:[0,0],gap:0}]}),connectorPaintStyle={lineWidth:3,strokeStyle:"#455d73"},LoadMetablock())});$(function(){if($("body").hasClass("menuOrderModule")){$("ul.sortable").sortable();$("#menuOrderForm").on("submit",function(){return!1});$("#btnOverview").click(function(){$("#openMetablockForm").submit()});$("#btnSave").click(function(){var r;pageSpinner.show();var t={},i={},n=1;$(".sortable input[type=hidden]").each(function(){$(this).is(".metablock")?t[this.value]=n:i[this.value]=n;n++});r={Blocks:i,Metablocks:t};$.ajax({type:"POST",url:"/api/tapestry/saveMenuOrder",contentType:"application/json; charset=UTF-8",data:JSON.stringify(r),complete:function(){pageSpinner.hide()},success:function(){ChangedSinceLastSave=!0}})})}});ZoomFactor=1;ChangedSinceLastSave=!1;$(function(){if(CurrentModuleIs("overviewModule")){$("#headerMetablockName").on("click",function(){renameMetablockDialog.dialog("open")});$("#btnAddBlock").on("click",function(){addBlockDialog.dialog("open")});$("#btnAddMetablock").on("click",function(){addMetablockDialog.dialog("open")});$("#btnLoad").on("click",function(){confirmed=ChangedSinceLastSave?confirm("Máte neuložené změny, opravdu si přejete tyto změny zahodit?"):!0;confirmed&&LoadMetablock()});$("#btnMenuOrder").on("click",function(){location.href="/Tapestry/Overview/MenuOrder/"+$("#currentMetablockId").val()});$("#btnSave").on("click",function(){SaveMetablock()});$("#btnClear").on("click",function(){$("#overviewPanel .block, #overviewPanel .metablock").each(function(n,t){instance.removeAllEndpoints(t,!0);$(t).remove()})});$("#btnGoUp").on("click",function(){SaveMetablock(function(){openMetablockForm=$("#openMetablockForm");openMetablockForm.find("input[name='metablockId']").val($("#parentMetablockId").val());openMetablockForm.submit()})});window.onbeforeunload=function(){return ChangedSinceLastSave&&SaveMetablock(null,!0),null};$("#btnTrash").on("click",function(){trashDialog.dialog("open")});$("#btnZoomIn").on("click",function(){ZoomFactor+=.1;$("#overviewPanel .scrollArea").css("transform","scale("+ZoomFactor+")");$("#zoomLabel").text("Zoom "+Math.floor(ZoomFactor*100)+"%")});$("#btnZoomOut").on("click",function(){ZoomFactor>=.2&&(ZoomFactor-=.1);$("#overviewPanel .scrollArea").css("transform","scale("+ZoomFactor+")");$("#zoomLabel").text("Zoom "+Math.floor(ZoomFactor*100)+"%")});$.contextMenu({selector:".block, .metablock",trigger:"right",zIndex:300,callback:function(n,t){switch(n){case"delete":instance.removeAllEndpoints(t.$trigger,!0);t.$trigger.remove();ChangedSinceLastSave=!0;SaveMetablock();break;case"initial":t.$trigger.hasClass("metablock")?($("#overviewPanel .metablock").each(function(n,t){$(t).attr("isInitial",!1);$(t).find(".metablockInfo").text("")}),t.$trigger.attr("isInitial",!0),t.$trigger.find(".metablockInfo").text("Initial")):($("#overviewPanel .block").each(function(n,t){$(t).attr("isInitial",!1);$(t).find(".blockInfo").text("")}),t.$trigger.attr("isInitial",!0),t.$trigger.find(".blockInfo").text("Initial"));ChangedSinceLastSave=!0;break;case"properties":t.$trigger.hasClass("metablock")?(currentMetablock=t.$trigger,metablockPropertiesDialog.dialog("open")):(currentBlock=t.$trigger,blockPropertiesDialog.dialog("open"))}},items:{properties:{name:"Properties",icon:"cog"},initial:{name:"Set as initial",icon:"edit"},"delete":{name:"Delete",icon:"delete"}}})}});$(function(){if(CurrentModuleIs("overviewModule")){addBlockDialog=$("#add-block-dialog").dialog({autoOpen:!1,resizable:!1,width:400,height:140,buttons:{Add:function(){n()},Cancel:function(){addBlockDialog.dialog("close")}},create:function(){$(this).keypress(function(t){if(t.keyCode==$.ui.keyCode.ENTER)return n(),!1})},open:function(){$(this).find("#block-name").val("")}});function n(){blockName=addBlockDialog.find("#block-name").val();newBlock=$('<div class="block"><div class="blockName">'+blockName+'<\/div><div class="blockInfo"><\/div><\/div>');$("#overviewPanel .scrollArea").append(newBlock);instance.draggable(newBlock,{containment:"parent"});newBlock.css("top",$("#overviewPanel").scrollTop()+20);newBlock.css("left",$("#overviewPanel").scrollLeft()+20);newBlock.on("dblclick",function(){blockToOpen=$(this);SaveMetablock(function(){openBlockForm=$("#openBlockForm");openBlockForm.find("input[name='blockId']").val(blockToOpen.attr("blockId"));openBlockForm.submit()})});ChangedSinceLastSave=!0;addBlockDialog.dialog("close")}addMetablockDialog=$("#add-metablock-dialog").dialog({autoOpen:!1,resizable:!1,width:400,height:140,buttons:{Add:function(){t()},Cancel:function(){addMetablockDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return t(),!1})},open:function(){$(this).find("#metablock-name").val("")}});function t(){metablockName=addMetablockDialog.find("#metablock-name").val();newMetablock=$('<div class="metablock"><div class="metablockName">'+metablockName+'<\/div><div class="metablockSymbol fa fa-th-large"><\/div><div class="metablockInfo"><\/div><\/div>');$("#overviewPanel .scrollArea").append(newMetablock);instance.draggable(newMetablock,{containment:"parent"});newMetablock.css("top",$("#overviewPanel").scrollTop()+20);newMetablock.css("left",$("#overviewPanel").scrollLeft()+20);newMetablock.on("dblclick",function(){metablockToOpen=$(this);SaveMetablock(function(){openMetablockForm=$("#openMetablockForm");openMetablockForm.find("input[name='metablockId']").val(metablockToOpen.attr("metablockId"));openMetablockForm.submit()})});ChangedSinceLastSave=!0;addMetablockDialog.dialog("close")}trashDialog=$("#trash-dialog").dialog({autoOpen:!1,resizable:!1,width:700,height:540,buttons:{Load:function(){r()},Cancel:function(){trashDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return r(),!1})},open:function(){trashDialog.find("#metablock-table:first tbody:nth-child(2) tr").remove();trashDialog.find("#block-table:first tbody:nth-child(2) tr").remove();trashDialog.find(" .spinner-2").show();trashDialog.data("selectedMetablock",null);trashDialog.data("selectedBlock",null);appId=$("#currentAppId").val();blockId=$("#currentBlockId").val();$.ajax({type:"GET",url:"/api/database/apps/"+appId+"/trashDialog",dataType:"json",success:function(n){for(tBlockBody=trashDialog.find("#block-table tbody:nth-child(2)"),tMetablockBody=trashDialog.find("#metablock-table tbody:nth-child(2)"),blockIdArray=[],metablockIdArray=[],i=0;i<n[0].length;i++)blockIdArray.push(n[0][i].Id),newRow=$('<tr class="blockRow"><td>'+n[0][i].Name+"<\/td><\/tr>"),tBlockBody.append(newRow);$(document).on("click","#block-table tr.blockRow",function(){trashDialog.find("#block-table tbody:nth-child(2) tr").removeClass("highlightedBlockRow");trashDialog.find("#metablock-table tbody:nth-child(2) tr").removeClass("highlightedBlockRow");$(this).addClass("highlightedBlockRow");var t=$(this).index();trashDialog.data("selectedBlockOrMetablock",n[0][t]);trashDialog.data("selectedTypeOfBlock","block")});for(i=0;i<n[1].length;i++)metablockIdArray.push(n[1][i].Id),newRow=$('<tr class="blockRow"><td>'+n[1][i].Name+"<\/td><\/tr>"),tMetablockBody.append(newRow);$(document).on("click","#metablock-table tr.blockRow",function(){trashDialog.find("#block-table tbody:nth-child(2) tr").removeClass("highlightedBlockRow");trashDialog.find("#metablock-table tbody:nth-child(2) tr").removeClass("highlightedBlockRow");$(this).addClass("highlightedBlockRow");var t=$(this).index();trashDialog.data("selectedBlockOrMetablock",n[1][t]);trashDialog.data("selectedTypeOfBlock","metablock")});trashDialog.find(".spinner-2").hide()}})}});function r(){if(trashDialog.data("selectedBlockOrMetablock")){if(trashDialog.dialog("close"),confirmed=ChangedSinceLastSave?confirm("You have unsaved changes. Do you really want to discard unsaved changes?"):!0,confirmed)if(trashDialog.data("selectedTypeOfBlock")=="block"){currentBlockData=trashDialog.data("selectedBlockOrMetablock");newBlock=$('<div class="block" id="block'+currentBlockData.Id+'" isInitial="'+currentBlockData.IsInitial+'" style="left: '+currentBlockData.PositionX+"px; top: "+currentBlockData.PositionY+'px;" blockId="'+currentBlockData.Id+'" tableId="'+currentBlockData.AssociatedTableId+'"><div class="blockName">'+currentBlockData.Name+'<\/div><div class="blockInfo">'+(currentBlockData.IsInitial?"Initial":"")+"<\/div><\/div>");newBlock.data("IsInMenu",currentBlockData.IsInMenu);$("#overviewPanel .scrollArea").append(newBlock);instance.draggable(newBlock,{containment:"parent",stop:function(){ChangedSinceLastSave=!0}});newBlock.on("dblclick",function(){blockToOpen=$(this);SaveMetablock(function(){openBlockForm=$("#openBlockForm");openBlockForm.find("input[name='blockId']").val(blockToOpen.attr("blockId"));openBlockForm.submit()})});SaveMetablock()}else{currentMetablockData=trashDialog.data("selectedBlockOrMetablock");newMetablock=$('<div class="metablock" id="metablock'+currentMetablockData.Id+'" isInitial="'+currentMetablockData.IsInitial+'"style="left: '+currentMetablockData.PositionX+"px; top: "+currentMetablockData.PositionY+'px;" metablockId="'+currentMetablockData.Id+'"><div class="metablockName">'+currentMetablockData.Name+'<\/div><div class="metablockSymbol fa fa-th-large"><\/div><div class="metablockInfo">'+(currentMetablockData.IsInitial?"Initial":"")+"<\/div><\/div>");newMetablock.data("IsInMenu",currentMetablockData.IsInMenu);$("#overviewPanel .scrollArea").append(newMetablock);instance.draggable(newMetablock,{containment:"parent",stop:function(){ChangedSinceLastSave=!0}});newMetablock.on("dblclick",function(){metablockToOpen=$(this);SaveMetablock(function(){openMetablockForm=$("#openMetablockForm");openMetablockForm.find("input[name='metablockId']").val(metablockToOpen.attr("metablockId"));openMetablockForm.submit()})});SaveMetablock()}}else alert("Please select a block")}renameMetablockDialog=$("#rename-metablock-dialog").dialog({autoOpen:!1,width:400,height:190,buttons:{Save:function(){u()},Cancel:function(){renameMetablockDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return u(),!1})},open:function(){renameMetablockDialog.find("#metablock-name").val($("#headerMetablockName").text())}});function u(){renameMetablockDialog.dialog("close");$("#headerMetablockName").text(renameMetablockDialog.find("#metablock-name").val());ChangedSinceLastSave=!0}blockPropertiesDialog=$("#block-properties-dialog").dialog({autoOpen:!1,width:500,height:250,buttons:{Save:function(){f()},Cancel:function(){blockPropertiesDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return f(),!1})},open:function(){blockPropertiesDialog.find("#p-block-name").val(currentBlock.find(".blockName").text());blockPropertiesDialog.find("#block-is-in-menu").prop("checked",currentBlock.data("IsInMenu"));blockPropertiesDialog.find("#block-set-as-initial").prop("checked",currentBlock.attr("isinitial")=="true")}});function f(){blockPropertiesDialog.dialog("close");currentBlock.data("IsInMenu",blockPropertiesDialog.find("#block-is-in-menu").is(":checked"));var n=blockPropertiesDialog.find("#block-set-as-initial").is(":checked")?!0:!1;n&&$("#overviewPanel .block").each(function(n,t){$(t).attr("isInitial",!1);$(t).find(".blockInfo").text("")});currentBlock.attr("isInitial",n);currentBlock.find(".blockInfo").text(n?"Initial":"");blockPropertiesDialog.find("#p-block-name").val().length&&currentBlock.find(".blockName").html(blockPropertiesDialog.find("#p-block-name").val());ChangedSinceLastSave=!0}metablockPropertiesDialog=$("#metablock-properties-dialog").dialog({autoOpen:!1,width:500,height:250,buttons:{Save:function(){e()},Cancel:function(){metablockPropertiesDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return e(),!1})},open:function(){metablockPropertiesDialog.find("#p-metablock-name").val(currentMetablock.find(".metablockName").text());metablockPropertiesDialog.find("#metablock-is-in-menu").prop("checked",currentMetablock.data("IsInMenu"));metablockPropertiesDialog.find("#metablock-set-as-initial").prop("checked",currentMetablock.attr("isinitial")=="true")}});function e(){metablockPropertiesDialog.dialog("close");var n=metablockPropertiesDialog.find("#metablock-set-as-initial").is(":checked")?!0:!1;n&&$("#overviewPanel .metablock").each(function(n,t){$(t).attr("isInitial",!1);$(t).find(".metablockInfo").text("")});currentMetablock.attr("isInitial",n);currentMetablock.find(".metablockInfo").text(n?"Initial":"");currentMetablock.data("IsInMenu",metablockPropertiesDialog.find("#metablock-is-in-menu").is(":checked"));metablockPropertiesDialog.find("#p-metablock-name").val().length&&currentMetablock.find(".metablockName").html(metablockPropertiesDialog.find("#p-metablock-name").val());ChangedSinceLastSave=!0}}});$(function(){CurrentModuleIs("nexusModule")&&($("#ldapMenuArea").length?$("#nexusMenuLDAP").addClass("highlighted"):$("#wsMenuArea").length?$("#nexusMenuWebServices").addClass("highlighted"):$("#extDbMenuArea").length?$("#nexusMenuExtDB").addClass("highlighted"):$("#webDavMenuArea").length&&$("#nexusMenuWebDav").addClass("highlighted"))});$(function(){CurrentModuleIs("nexusModule")&&(showWsdlDialog=$("#show-wsdl-dialog").dialog({autoOpen:!1,resizable:!1,width:800,height:600,buttons:{"Zavřít":function(){showWsdlDialog.dialog("close")}},open:function(){$(this).find("#wsdlFileText").text(CurrentWsdlFile)}}))});WizardPhasesContentTemplate='<div class="wizard-phases-frame"><\/div><svg class="phase-background" width="846px" height="84px"><defs><linearGradient id="grad-light" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#dceffa ;stop-opacity:1" /><stop offset="100%" style="stop-color:#8dceed;stop-opacity:1" /><\/linearGradient><linearGradient id="grad-blue" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:#0099cc;stop-opacity:1" /><stop offset="100%" style="stop-color:#0066aa;stop-opacity:1" /><\/linearGradient><\/defs><path d="M0 0 L0 88 L 280 88 L324 44 L280 0 Z" fill="url(#grad-blue)" /><path d="M280 88 L324 44 L280 0 L560 0 L604 44 L560 88 Z" fill="url(#grad-light)" /><path d="M560 0 L604 44 L560 88 L850 88 L850 0 Z" fill="url(#grad-light)" /><\/svg><div class="phase phase1 phase-active"><div class="phase-icon-circle"><div class="phase-icon-number">1<\/div><\/div><div class="phase-label">Fáze 1<\/div><\/div><div class="phase phase2"><div class="phase-icon-circle"><div class="phase-icon-number">2<\/div><\/div><div class="phase-label">Fáze 2<\/div><\/div><div class="phase phase3"><div class="phase-icon-circle"><div class="phase-icon-number">3<\/div><\/div><div class="phase-label">Fáze 3<\/div><\/div>';GridResolution=0;$(function(){if(CurrentModuleIs("mozaicEditorModule")&&!$("body").hasClass("mozaicBootstrapEditorModule")){RecalculateMozaicToolboxHeight();pageId=$("#currentPageId").val();pageId&&LoadMozaicPage(pageId);$("#headerPageName").on("click",function(){renamePageDialog.dialog("open")});$("#btnNewPage").on("click",function(){newPageDialog.dialog("open")});$("#btnChoosePage").on("click",function(){choosePageDialog.dialog("open")});$("#btnClear").on("click",function(){$("#mozaicPageContainer .uic").remove();$("#mozaicPageContainer .dataTables_wrapper").remove();$("#mozaicPageContainer .color-picker").remove()});$("#btnSave").on("click",function(){pageId=$("#currentPageId").val();pageId==0?(SaveRequested=!0,newPageDialog.dialog("open")):SaveMozaicPage()});$("#btnLoad").on("click",function(){LoadMozaicPage("current")});$("#btnTrashPage").on("click",function(){trashPageDialog.dialog("open")});$("#btnToBootstrap").on("click",function(){$(".mozaicEditorAbsolute").removeClass("mozaicEditorAbsolute").addClass("mozaicEditorBootstrap");RecalculateMozaicToolboxHeight();n()});$("#hideMozaicTooboxIcon").on("click",function(){$("#mozaicLeftBar").hide();$("#mozaicLeftBarMinimized").show();$("#mozaicPageContainer").css("left",32);$("#mozaicPageContext").css("left",257);RecalculateMozaicToolboxHeight()});$("#showMozaicTooboxIcon").on("click",function(){$("#mozaicLeftBar").show();$("#mozaicLeftBarMinimized").hide();$("#mozaicPageContainer").css("left",$("body").hasClass("mozaicBootstrapEditorModule")?250:300);$("#mozaicPageContext").css("left",475);RecalculateMozaicToolboxHeight()});$("#gridShowCheckbox").prop("checked",!1);$("#gridResolutionDropdown").val("off");$("#gridShowCheckbox").on("change",function(){$(this).is(":checked")?(grid=$("#gridResolutionDropdown").val(),grid!="off"&&(resolutionValue=parseInt(grid),$("#mozaicPageContainer").addClass("showGrid"),$("#mozaicPageContainer").css("background-size",resolutionValue))):$("#mozaicPageContainer").removeClass("showGrid")});$("#currentPageIsModal").is(":checked")&&($("#modalSizeVisualization").css("width",parseInt($("#modalWidthInput").val())),$("#modalSizeVisualization").css("height",parseInt($("#modalHeightInput").val())),$("#modalSizeVisualization").show());$("#currentPageIsModal").on("change",function(){$(this).is(":checked")?($("#modalSizeVisualization").css("width",parseInt($("#modalWidthInput").val())),$("#modalSizeVisualization").css("height",parseInt($("#modalHeightInput").val())),$("#modalSizeVisualization").show()):$("#modalSizeVisualization").hide()});$("#modalWidthInput").on("change",function(){$("#modalSizeVisualization").css("width",parseInt($("#modalWidthInput").val()))});$("#modalHeightInput").on("change",function(){$("#modalSizeVisualization").css("height",parseInt($("#modalHeightInput").val()))});$("#gridResolutionDropdown").on("change",function(){grid=$(this).val();grid=="off"?($("#mozaicPageContainer").removeClass("showGrid"),$("#gridShowCheckbox").prop("checked",!1),GridResolution=0):(resolutionValue=parseInt(grid),GridResolution=resolutionValue,$("#gridShowCheckbox").is(":checked")&&($("#mozaicPageContainer").addClass("showGrid"),$("#mozaicPageContainer").css("background-size",resolutionValue)))});$("#mozaicContainer button").off("click");$("#mozaicLeftBar .toolboxItem").draggable({helper:"clone",appendTo:"#mozaicPageContainer",containment:"window",revert:!0,scroll:!0,cancel:!1});CreateDroppableMozaicContainer($("#mozaicPageContainer"),!0);$("#mozaicPageContainer .uic").draggable({cancel:!1,containment:"parent",drag:function(n,t){GridResolution>0&&(t.position.left=Math.round(t.position.left/GridResolution)*GridResolution,t.position.top=Math.round(t.position.top/GridResolution)*GridResolution)}});$.contextMenu({selector:".uic",trigger:"right",zIndex:300,callback:function(n,t){item=t.$trigger;n=="delete"?item.hasClass("data-table")?item.parents(".dataTables_wrapper").remove():item.remove():n=="properties"&&(CurrentComponent=item,componentPropertiesDialog.dialog("open"))},items:{properties:{name:"Properties",icon:"edit"},"delete":{name:"Delete",icon:"delete"}}});$(window).scroll(function(){var i=$("#mozaicLeftBar"),f=$(window).scrollTop(),e=$("#lowerPanel").offset().top,n=$("#topBar").height()+$("#appNotificationArea").height(),t=$("#lowerPanelSpinnerOverlay"),r=$("#mozaicPageContext"),u=$("#mozaicPageTree");t.css({right:0,width:"auto"});f>e-n?(i.css({top:n,left:225,position:"fixed"}),t.css({top:n,left:225,position:"fixed"}),r.css({top:n,right:0,left:$("#mozaicLeftBar").is(":visible")?475:257,position:"fixed",zIndex:1}),u.css({top:n,right:0,position:"fixed"})):(i.css({top:0,left:0,position:"absolute"}),t.css({top:0,left:0,position:"absolute"}),r.css({position:"static"}),u.css({top:0,right:0,position:"absolute"}));RecalculateMozaicToolboxHeight()});$(window).resize(function(){RecalculateMozaicToolboxHeight()});function n(){}}else if(CurrentModuleIs("mozaicComponentManagerModule"))$(window).on("scroll resize",function(){var i=$(window).scrollTop(),t=$("#upperPanel").offset().top+$("#upperPanel").height(),n=$("#lowerPanelSpinnerOverlay");n.css({left:225,top:0,right:0,width:"auto"});i>t?(n.css({top:0,position:"fixed"}),n.css({height:window.innerHeight})):(n.css({top:t+1,position:"absolute"}),n.css({height:window.innerHeight-t+i-20}))})});SaveRequested=!1;$(function(){if(CurrentModuleIs("mozaicEditorModule")&&!$("body").hasClass("mozaicBootstrapEditorModule")){componentPropertiesDialog=$("#component-properties-dialog").dialog({autoOpen:!1,width:700,height:"auto",buttons:{Save:function(){n()},Cancel:function(){componentPropertiesDialog.dialog("close")}},create:function(){$(this).keypress(function(t){if(t.keyCode==$.ui.keyCode.ENTER)return n(),!1})},open:function(){if(componentPropertiesDialog.find("#component-name").val(CurrentComponent.attr("uicName")),componentPropertiesDialog.find("#component-width").val(CurrentComponent.css("width")),componentPropertiesDialog.find("#component-height").val(CurrentComponent.css("height")),componentPropertiesDialog.find("#component-styles").val(CurrentComponent.attr("uicStyles")),componentPropertiesDialog.find("#component-props").val(CurrentComponent.attr("uicProperties")),componentPropertiesDialog.find("#component-tabindex").val(CurrentComponent.attr("tabindex")),componentPropertiesDialog.find("#component-attributes").val(CurrentComponent.data("uicAttributes")),componentPropertiesDialog.find("#component-placeholder").parents("tr").show(),componentPropertiesDialog.find("#component-tabindex").parents("tr").show(),componentPropertiesDialog.find("#component-label").parents("tr").show(),CurrentComponent.hasClass("input-single-line")||CurrentComponent.hasClass("input-multiline"))componentPropertiesDialog.find("#component-placeholder").val(CurrentComponent.attr("placeholder")),componentPropertiesDialog.find("#component-label").parents("tr").hide();else if(CurrentComponent.hasClass("info-container"))componentPropertiesDialog.find("#component-label").val(CurrentComponent.find(".info-container-header").text()),componentPropertiesDialog.find("#component-content").val(CurrentComponent.find(".info-container-body").text()),componentPropertiesDialog.find("#component-placeholder").parents("tr").hide(),componentPropertiesDialog.find("#component-tabindex").parents("tr").hide();else if(CurrentComponent.hasClass("named-panel"))componentPropertiesDialog.find("#component-label").val(CurrentComponent.find(".named-panel-header").text());else if(CurrentComponent.hasClass("form-heading")||CurrentComponent.hasClass("control-label"))componentPropertiesDialog.find("#component-label").val(CurrentComponent.html()),componentPropertiesDialog.find("#component-content").val(CurrentComponent.attr("contentTemplate")),componentPropertiesDialog.find("#component-placeholder").parents("tr").hide(),componentPropertiesDialog.find("#component-tabindex").parents("tr").hide();else if(CurrentComponent.hasClass("checkbox-control"))componentPropertiesDialog.find("#component-label").val(CurrentComponent.find(".checkbox-label").text()),componentPropertiesDialog.find("#component-content").val(""),componentPropertiesDialog.find("#component-placeholder").parents("tr").hide();else if(CurrentComponent.hasClass("radio-control"))componentPropertiesDialog.find("#component-label").val(CurrentComponent.find(".radio-label").text()),componentPropertiesDialog.find("#component-content").val(""),componentPropertiesDialog.find("#component-placeholder").parents("tr").hide();else if(CurrentComponent.hasClass("tab-navigation"))componentPropertiesDialog.find("#component-label").val(""),tabString="",CurrentComponent.find("li").each(function(n,t){n>0&&(tabString+=$(t).find("a").text()+";")}),componentPropertiesDialog.find("#component-content").val(tabString),componentPropertiesDialog.find("#component-placeholder").parents("tr").hide(),componentPropertiesDialog.find("#component-label").parents("tr").hide();else if(CurrentComponent.hasClass("wizard-phases")){componentPropertiesDialog.find("#component-label").val("");var n="";CurrentComponent.find(".phase-label").each(function(t,i){n+=$(i).text()+";"});n=n.slice(0,-1);componentPropertiesDialog.find("#component-content").val(n);componentPropertiesDialog.find("#component-placeholder").parents("tr").hide();componentPropertiesDialog.find("#component-label").parents("tr").hide()}else CurrentComponent.hasClass("button-simple")||CurrentComponent.hasClass("button-dropdown")?(componentPropertiesDialog.find("#component-label").val(CurrentComponent.text()),componentPropertiesDialog.find("#component-placeholder").parents("tr").hide()):CurrentComponent.hasClass("name-value-list")||CurrentComponent.hasClass("panel-component")||CurrentComponent.hasClass("countdown-component")?(componentPropertiesDialog.find("#component-label").val(""),componentPropertiesDialog.find("#component-content").val(""),componentPropertiesDialog.find("#component-placeholder").parents("tr").hide(),componentPropertiesDialog.find("#component-tabindex").parents("tr").hide()):(componentPropertiesDialog.find("#component-label").val(""),componentPropertiesDialog.find("#component-content").val(""),componentPropertiesDialog.find("#component-placeholder").parents("tr").hide())}});function n(){if(CurrentComponent.attr("uicName",componentPropertiesDialog.find("#component-name").val()),CurrentComponent.css("width",componentPropertiesDialog.find("#component-width").val()),CurrentComponent.parents(".dataTables_wrapper").css("width",CurrentComponent.css("width")),CurrentComponent.css("height",componentPropertiesDialog.find("#component-height").val()),CurrentComponent.attr("uicStyles",componentPropertiesDialog.find("#component-styles").val()),CurrentComponent.attr("uicProperties",componentPropertiesDialog.find("#component-props").val()),CurrentComponent.attr("tabindex",componentPropertiesDialog.find("#component-tabindex").val()),CurrentComponent.data("uicAttributes",componentPropertiesDialog.find("#component-attributes").val()),CurrentComponent.hasClass("button-simple"))CurrentComponent.text(componentPropertiesDialog.find("#component-label").val());else if(CurrentComponent.hasClass("button-dropdown"))CurrentComponent.html(componentPropertiesDialog.find("#component-label").val()+'<i class="fa fa-caret-down">');else if(CurrentComponent.hasClass("input-single-line")||CurrentComponent.hasClass("input-multiline"))CurrentComponent.attr("placeholder",componentPropertiesDialog.find("#component-placeholder").val());else if(CurrentComponent.hasClass("info-container"))CurrentComponent.find(".info-container-header").text(componentPropertiesDialog.find("#component-label").val()),CurrentComponent.find(".info-container-body").text(componentPropertiesDialog.find("#component-content").val());else if(CurrentComponent.hasClass("named-panel"))CurrentComponent.find(".named-panel-header").text(componentPropertiesDialog.find("#component-label").val());else if(CurrentComponent.hasClass("form-heading")||CurrentComponent.hasClass("control-label"))CurrentComponent.html(componentPropertiesDialog.find("#component-label").val()),CurrentComponent.attr("contentTemplate",componentPropertiesDialog.find("#component-content").val());else if(CurrentComponent.hasClass("checkbox-control"))CurrentComponent.find(".checkbox-label").text(componentPropertiesDialog.find("#component-label").val()),CurrentComponent.css("width","auto");else if(CurrentComponent.hasClass("radio-control"))CurrentComponent.find(".radio-label").text(componentPropertiesDialog.find("#component-label").val()),CurrentComponent.find("input").attr("name",componentPropertiesDialog.find("#component-name").val()),CurrentComponent.css("width","auto");else if(CurrentComponent.hasClass("tab-navigation")){for(tabString=componentPropertiesDialog.find("#component-content").val(),tabLabelArray=tabString.split(";"),CurrentComponent.find("li").remove(),CurrentComponent.append($('<li class="active"><a class="fa fa-home"><\/a><\/li>')),i=0;i<tabLabelArray.length;i++)tabLabelArray[i].length>0&&CurrentComponent.append($("<li><a>"+tabLabelArray[i]+"<\/a><\/li>"));CurrentComponent.css("width","auto")}else if(CurrentComponent.hasClass("wizard-phases")){var n=componentPropertiesDialog.find("#component-content").val().split(";");CurrentComponent.find(".phase1 .phase-label").text(n[0]?n[0]:"Fáze 1");CurrentComponent.find(".phase2 .phase-label").text(n[1]?n[1]:"Fáze 2");CurrentComponent.find(".phase3 .phase-label").text(n[2]?n[2]:"Fáze 3")}componentPropertiesDialog.dialog("close")}renamePageDialog=$("#rename-page-dialog").dialog({autoOpen:!1,width:400,height:190,buttons:{Save:function(){t()},Cancel:function(){renamePageDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return t(),!1})},open:function(){renamePageDialog.find("#page-name").val($("#headerPageName").text())}});function t(){renamePageDialog.dialog("close");$("#headerPageName").text(renamePageDialog.find("#page-name").val());ChangedSinceLastSave=!0}choosePageDialog=$("#choose-page-dialog").dialog({autoOpen:!1,width:700,height:540,buttons:{Open:function(){u()},Delete:function(){confirm("Are you sure you want to delete this page?")&&f()},Cancel:function(){choosePageDialog.dialog("close")}},open:function(){choosePageDialog.find("#page-table:first tbody tr").remove();$("#choose-page-dialog .spinner-2").show();choosePageDialog.data("selectedPageId",null);appId=$("#currentAppId").val();$.ajax({type:"GET",url:"/api/mozaic-editor/apps/"+appId+"/pages",dataType:"json",error:function(n){alert(n.responseText)},success:function(n){for(tbody=choosePageDialog.find("#page-table tbody:nth-child(2)"),i=0;i<n.length;i++)tbody.append($('<tr class="pageRow" pageId="'+n[i].Id+'"><td>'+n[i].Name+"<\/td><\/tr>"));$(document).on("click","tr.pageRow",function(){choosePageDialog.find("#page-table tbody:nth-child(2) tr").removeClass("highlightedRow");$(this).addClass("highlightedRow");choosePageDialog.data("selectedPageId",$(this).attr("pageId"))});$("#choose-page-dialog .spinner-2").hide()}})}});function u(){choosePageDialog.data("selectedPageId")?(choosePageDialog.dialog("close"),LoadMozaicPage(choosePageDialog.data("selectedPageId"))):alert("Please select a commit")}function f(){pageSpinner.show();appId=$("#currentAppId").val();pageId=choosePageDialog.data("selectedPageId");$.ajax({type:"POST",url:"/api/mozaic-editor/apps/"+appId+"/pages/"+pageId+"/delete",complete:function(){pageSpinner.hide()},success:function(){alert("OK. Page deleted.");choosePageDialog.dialog("close");$("#currentPageId").val()==pageId&&($("#mozaicPageContainer .uic").remove(),$("#mozaicPageContainer .dataTables_wrapper").remove(),$("#mozaicPageContainer .color-picker").remove(),$("#headerPageName").remove())},error:function(n){alert(n.responseText)}})}newPageDialog=$("#new-page-dialog").dialog({autoOpen:!1,width:400,height:170,buttons:{Save:function(){r()},Cancel:function(){newPageDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return r(),!1})},open:function(){newPageDialog.find("#new-page-name").val("")}});function r(){pageSpinner.show();newPageDialog.dialog("close");postData={Name:newPageDialog.find("#new-page-name").val(),Components:[]};appId=$("#currentAppId").val();newPageName=newPageDialog.find("#new-page-name").val();$.ajax({type:"POST",url:"/api/mozaic-editor/apps/"+appId+"/pages",data:postData,error:function(n){alert(n.responseText)},success:function(n){$("#currentPageId").val(n);newPageName==""?$("#headerPageName").text("Nepojmenovaná stránka"):$("#headerPageName").text(newPageName);SaveRequested?SaveMozaicPage():pageSpinner.hide()}})}trashPageDialog=$("#trash-page-dialog").dialog({autoOpen:!1,width:700,height:540,buttons:{Load:function(){e()},Cancel:function(){trashPageDialog.dialog("close")}},open:function(){trashPageDialog.find("#trash-page-table:first tbody tr").remove();$("#trash-page-dialog .spinner-2").show();trashPageDialog.data("selectedPageId",null);appId=$("#currentAppId").val();$.ajax({type:"GET",url:"/api/mozaic-editor/apps/"+appId+"/deletedPages",dataType:"json",error:function(n){alert(n.responseText)},success:function(n){for(tbody=trashPageDialog.find("#trash-page-table tbody:nth-child(2)"),i=0;i<n.length;i++)tbody.append($('<tr class="pageRow" pageId="'+n[i].Id+'"><td>'+n[i].Name+"<\/td><\/tr>"));$(document).on("click","tr.pageRow",function(){trashPageDialog.find("#trash-page-table tbody:nth-child(2) tr").removeClass("highlightedRow");$(this).addClass("highlightedRow");trashPageDialog.data("selectedPageId",$(this).attr("pageId"))});$("#trash-page-dialog .spinner-2").hide()}})}});function e(){trashPageDialog.data("selectedPageId")?(trashPageDialog.dialog("close"),LoadMozaicPage(trashPageDialog.data("selectedPageId"))):alert("Please select a commit")}}});$(function(){CurrentModuleIs("hermesModule")&&($("#smtpMenuArea").length&&$("#hermesMenuSMTP").addClass("highlighted"),$("#templateMenuArea").length&&$("#hermesMenuTemplate").addClass("highlighted"),$("#queueMenuArea").length&&$("#hermesMenuQueue").addClass("highlighted"))});jsPlumb.ready(function(){CurrentModuleIs("dbDesignerModule")&&(instance=jsPlumb.getInstance({Endpoint:["Blank",{}],HoverPaintStyle:{strokeStyle:"#ff4000",lineWidth:2},ConnectionOverlays:[["Arrow",{location:1,id:"arrow",length:14,foldback:.8}],],Container:"database-container"}),instance.bind("click",function(n){CurrentConnection=n;editRelationDialog.dialog("open")}),instance.bind("connection",function(n){if($(n.connection.source).attr("dbColumnType")!=$(n.connection.target).attr("dbColumnType"))return instance.detach(n.connection),alert("These columns have different types. Relation can only be created between columns of the same type."),!1;n.connection.addClass("relationConnection");n.connection.removeOverlay("arrow");n.connection.addOverlay(["Arrow",{location:0,id:"arrow0",length:8,width:8,height:8,foldback:.8,direction:-1}]);n.connection.addOverlay(["Arrow",{location:1,id:"arrow1",length:8,width:8,height:8,foldback:.8}]);n.connection.addOverlay(["Label",{location:.1,id:"label0",cssClass:"relationLabel",label:"1"}]);n.connection.addOverlay(["Label",{location:.9,id:"label1",cssClass:"relationLabel",label:"1"}])}),instance.batch(function(){$(".dbTable").each(function(n,t){instance.draggable(t)});$(".dbColumn").each(function(n,t){AddColumnToJsPlumb(t)})}))});SqlServerDataTypes=[["varchar","Varchar",!0],["boolean","Boolean",!1],["integer","Integer",!1],["float","Float",!1],["currency","Currency",!1],["decimal","Decimal",!1],["date","Date",!1],["time","Time",!1],["datetime","DateTime",!1],["timestamp","Timestamp",!1],["xml","XML",!0],["blob","Blob",!0],];ZoomFactor=1;$(function(){if(CurrentModuleIs("dbDesignerModule")){$("#btnAddTable").on("click",function(){addTableDialog.dialog("open")});$("#btnAddView").on("click",function(){addViewDialog.dialog("open")});$("#switchToWorkflow").on("click",function(){window.location="/workflow"});$("#btnSaveScheme").on("click",function(){saveDialog.dialog("open")});$("#btnLoadScheme").on("click",function(){LoadDbScheme("latest")});$("#btnOpenHistory").on("click",function(){historyDialog.dialog("open")});$("#btnClearScheme").on("click",function(){ClearDbScheme()});$("#btnZoomIn").on("click",function(){ZoomFactor+=.1;$(".database-container").css("transform","scale("+ZoomFactor+")");$("#zoomLabel").text("Zoom "+Math.floor(ZoomFactor*100)+"%");instance.repaintEverything()});$("#btnZoomOut").on("click",function(){ZoomFactor>=.2&&(ZoomFactor-=.1);$(".database-container").css("transform","scale("+ZoomFactor+")");$("#zoomLabel").text("Zoom "+Math.floor(ZoomFactor*100)+"%");instance.repaintEverything()});LoadDbScheme("latest")}});$(function(){if(CurrentModuleIs("dbDesignerModule")){var n={},t={lineNumbers:!0,lineWrapping:!0,mode:"sql",extraKeys:{"Ctrl-Space":"autocomplete"}};addTableDialog=$("#add-table-dialog").dialog({autoOpen:!1,resizable:!1,width:400,height:150,buttons:{Add:function(){r()},Cancel:function(){addTableDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return r(),!1})},open:function(){addTableDialog.find("#new-table-name").val("")}});function r(){AddTable(addTableDialog.find("#new-table-name").val());addTableDialog.dialog("close")}editTableDialog=$("#edit-table-dialog").dialog({autoOpen:!1,resizable:!1,width:400,height:170,buttons:{Save:function(){u()},Cancel:function(){editTableDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return u(),!1});$(this).find("#add-index-button").on("click",function(){addIndexDialog.dialog("open")})},open:function(){editTableDialog.find("#table-name").val(CurrentTable.find(".dbTableName").text())}});function u(){CurrentTable.find(".dbTableName").text(editTableDialog.find("#table-name").val());editTableDialog.dialog("close")}addColumnDialog=$("#add-column-dialog").dialog({autoOpen:!1,resizable:!1,width:400,height:330,buttons:{Add:function(){f()},Cancel:function(){addColumnDialog.dialog("close")}},create:function(){for(i=0;i<SqlServerDataTypes.length;i++)$("#add-column-dialog #column-type-dropdown").append($('<option value="'+SqlServerDataTypes[i][0]+'">'+SqlServerDataTypes[i][1]+"<\/option>"));$("#add-column-dialog #column-type-dropdown").change(function(){CheckColumnLengthSupport(addColumnDialog,this.value);addColumnDialog.find("#column-length-max").is(":checked")&&addColumnDialog.find("#column-length").hide()});$("#add-column-dialog #column-length-max").change(function(){$(this).is(":checked")?addColumnDialog.find("#column-length").hide():addColumnDialog.find("#column-length").show()});$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return f(),!1})},open:function(){addColumnDialog.find("#column-name").val("");addColumnDialog.find("#column-display-name").val("");addColumnDialog.find("#primary-key-checkbox").prop("checked",!1);addColumnDialog.find("#unique-checkbox").prop("checked",!1);addColumnDialog.find("#allow-null-checkbox").prop("checked",!1);addColumnDialog.find("#column-type-dropdown").val("varchar");addColumnDialog.find("#default-value").val("");addColumnDialog.find("#column-length").val(100);addColumnDialog.find("#column-length-max").prop("checked",!0);addColumnDialog.find("#columnLengthNotSupported").hide();CheckColumnLengthSupport(addColumnDialog,"varchar");addColumnDialog.find("#column-length").hide()}});function f(){AddColumn(addColumnDialog.data("currentTable"),addColumnDialog.find("#column-name").val(),addColumnDialog.find("#column-type-dropdown").val(),addColumnDialog.find("#primary-key-checkbox").prop("checked"),addColumnDialog.find("#allow-null-checkbox").prop("checked"),addColumnDialog.find("#default-value").val(),addColumnDialog.find("#column-length").val(),addColumnDialog.find("#column-length-max").prop("checked"),addColumnDialog.find("#unique-checkbox").prop("checked"),addColumnDialog.find("#column-display-name").val());addColumnDialog.dialog("close")}editColumnDialog=$("#edit-column-dialog").dialog({autoOpen:!1,resizable:!1,width:400,height:330,buttons:{Save:function(){e()},Cancel:function(){editColumnDialog.dialog("close")}},create:function(){for(i=0;i<SqlServerDataTypes.length;i++)$("#edit-column-dialog #column-type-dropdown").append($('<option value="'+SqlServerDataTypes[i][0]+'">'+SqlServerDataTypes[i][1]+"<\/option>"));$("#edit-column-dialog #column-type-dropdown").change(function(){CheckColumnLengthSupport(editColumnDialog,this.value);editColumnDialog.find("#column-length-max").is(":checked")&&editColumnDialog.find("#column-length").hide()});$("#edit-column-dialog #column-length-max").change(function(){$(this).is(":checked")?editColumnDialog.find("#column-length").hide():editColumnDialog.find("#column-length").show()});$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return e(),!1})},open:function(){editColumnDialog.find("#column-name").val(CurrentColumn.find(".dbColumnName").text());editColumnDialog.find("#column-display-name").val(CurrentColumn.data("dbColumnDisplayName"));editColumnDialog.find("#primary-key-checkbox").prop("checked",CurrentColumn.hasClass("dbPrimaryKey"));editColumnDialog.find("#unique-checkbox").prop("checked",CurrentColumn.data("dbUnique"));editColumnDialog.find("#allow-null-checkbox").prop("checked",CurrentColumn.data("dbAllowNull"));editColumnDialog.find("#column-type-dropdown").val(CurrentColumn.attr("dbColumnType"));editColumnDialog.find("#default-value").val(CurrentColumn.data("dbDefaultValue"));editColumnDialog.find("#column-length").val(CurrentColumn.data("dbColumnLength"));editColumnDialog.find("#column-length-max").prop("checked",CurrentColumn.data("dbColumnLengthMax"));CheckColumnLengthSupport(editColumnDialog,CurrentColumn.attr("dbColumnType"));CurrentColumn.data("dbColumnLengthMax")&&editColumnDialog.find("#column-length").hide()}});function e(){CurrentColumn.find(".dbColumnName").text(editColumnDialog.find("#column-name").val());CurrentColumn.attr("dbColumnType",editColumnDialog.find("#column-type-dropdown").val());CurrentColumn.data("dbUnique",editColumnDialog.find("#unique-checkbox").prop("checked"));CurrentColumn.data("dbAllowNull",editColumnDialog.find("#allow-null-checkbox").prop("checked"));CurrentColumn.data("dbDefaultValue",editColumnDialog.find("#default-value").val());CurrentColumn.data("dbColumnLength",editColumnDialog.find("#column-length").val());CurrentColumn.data("dbColumnLengthMax",editColumnDialog.find("#column-length-max").prop("checked"));CurrentColumn.data("dbColumnDisplayName",editColumnDialog.find("#column-display-name").val());CurrentColumn.hasClass("dbPrimaryKey")&&!editColumnDialog.find("#primary-key-checkbox").prop("checked")?CurrentColumn.removeClass("dbPrimaryKey"):!CurrentColumn.hasClass("dbPrimaryKey")&&editColumnDialog.find("#primary-key-checkbox").prop("checked")&&CurrentColumn.addClass("dbPrimaryKey");editColumnDialog.dialog("close")}editRelationDialog=$("#edit-relation-dialog").dialog({autoOpen:!1,resizable:!1,width:400,height:250,buttons:{Save:function(){o()},Cancel:function(){editRelationDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return o(),!1})},open:function(){$(CurrentConnection).data("relationType")?editRelationDialog.find("input:radio[value="+$(CurrentConnection).data("relationType")+"]").prop("checked","checked"):editRelationDialog.find("input:radio[value=1]").prop("checked","checked")}});function o(){$(CurrentConnection).data("relationType",editRelationDialog.find("input[type='radio']:checked").val());switch(editRelationDialog.find("input[type='radio']:checked").val()){case"1":EditRelation(CurrentConnection,"1","1");break;case"2":EditRelation(CurrentConnection,"1","N");break;case"3":EditRelation(CurrentConnection,"N","1");break;case"4":EditRelation(CurrentConnection,"M","N");break;case"Delete":instance.detach(CurrentConnection)}editRelationDialog.dialog("close")}historyDialog=$("#history-dialog").dialog({autoOpen:!1,width:700,height:540,buttons:{Load:function(){v()},Cancel:function(){historyDialog.dialog("close")}},open:function(){historyDialog.data("selectedCommitId",null);appId=$("#currentAppId").val();$.ajax({type:"GET",url:"/api/database/apps/"+appId+"/commits",dataType:"json",error:function(n){alert(n.responseText)},success:function(n){for(historyDialog.find("#commit-table:first tbody:nth-child(2) tr").remove(),tbody=historyDialog.find("#commit-table tbody:nth-child(2)"),commitIdArray=[],i=0;i<n.length;i++)commitIdArray.push(n[i].Id),n[i].CommitMessage!=null?tbody.append($('<tr class="commitRow"><td>'+n[i].TimeString+"<\/td><td>"+n[i].CommitMessage+"<\/td><\/tr>")):tbody.append($('<tr class="commitRow"><td>'+n[i].TimeString+'<\/td><td style="color: darkgrey;">(no message)<\/td><\/tr>'));$(document).on("click","tr.commitRow",function(){historyDialog.find("#commit-table tbody:nth-child(2) tr").removeClass("highlightedCommitRow");$(this).addClass("highlightedCommitRow");var n=$(this).index();historyDialog.data("selectedCommitId",commitIdArray[n])})}})}});function v(){historyDialog.data("selectedCommitId")?(LoadDbScheme(historyDialog.data("selectedCommitId")),historyDialog.dialog("close")):alert("Please select a commit")}saveDialog=$("#save-dialog").dialog({autoOpen:!1,width:400,height:190,buttons:{Save:function(){s()},Cancel:function(){saveDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return s(),!1})},open:function(){saveDialog.find("#message").val("")}});function s(){saveDialog.dialog("close");SaveDbScheme(saveDialog.find("#message").val())}addViewDialog=$("#add-view-dialog").dialog({autoOpen:!1,resizable:!1,width:"75%",buttons:{Add:function(){h()},Cancel:function(){addViewDialog.dialog("close")}},create:function(){$(this).find("#new-view-name").keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return h(),!1})},open:function(){if(addViewDialog.find("#new-view-name").val(""),addViewDialog.find("#new-view-query").val(""),typeof n["new-view-query"]=="undefined"){n["new-view-query"]=CodeMirror.fromTextArea(document.getElementById("new-view-query"),t);n["new-view-query"].on("blur",function(n){n.save()})}else n["new-view-query"].setValue("")}});function h(){AddView(addViewDialog.find("#new-view-name").val(),addViewDialog.find("#new-view-query").val());addViewDialog.dialog("close")}editViewDialog=$("#edit-view-dialog").dialog({autoOpen:!1,resizable:!1,width:"75%",buttons:{Save:function(){c()},Cancel:function(){editViewDialog.dialog("close")}},create:function(){$(this).find("#view-name").keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return c(),!1})},open:function(){if(editViewDialog.find("#view-name").val(CurrentView.data("dbViewName")),editViewDialog.find("#view-query").val(CurrentView.data("dbViewQuery")),typeof n["view-query"]=="undefined"){n["view-query"]=CodeMirror.fromTextArea(document.getElementById("view-query"),t);n["view-query"].on("blur",function(n){n.save()})}else n["view-query"].setValue(CurrentView.data("dbViewQuery"))}});function c(){CurrentView.find(".dbViewName").text("View: "+editViewDialog.find("#view-name").val());CurrentView.data("dbViewName",editViewDialog.find("#view-name").val());CurrentView.data("dbViewQuery",editViewDialog.find("#view-query").val());editViewDialog.dialog("close")}addIndexDialog=$("#add-index-dialog").dialog({autoOpen:!1,resizable:!1,width:400,height:260,buttons:{Add:function(){l()},Cancel:function(){addIndexDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return l(),!1});$("#add-index-dialog #btn-add-index-column").on("click",function(){newColumnNumber=addIndexDialog.data("columnsShown")+1;newFormRow=$('<tr class="additionalFormRow"><td><label for="additional-column">'+newColumnNumber+'. column<\/label><\/td><td><select name="additional-column" class="additionalColumn"><\/select><\/td><\/tr>');newFormRow.find(".additionalColumn").append($('<option value="-none-">-none-<\/option>'));CurrentTable.find(".dbColumn").each(function(n,t){newFormRow.find(".additionalColumn").append($('<option value="'+$(t).find(".dbColumnName").text()+'">'+$(t).find(".dbColumnName").text()+"<\/option>"))});$("#add-index-dialog").find("#addIndexColumnFormRow").before(newFormRow);addIndexDialog.data("columnsShown",newColumnNumber)})},open:function(){addIndexDialog.find("#first-column option").remove();CurrentTable.find(".dbColumn").each(function(n,t){addIndexDialog.find("#first-column").append($('<option value="'+$(t).find(".dbColumnName").text()+'">'+$(t).find(".dbColumnName").text()+"<\/option>"))});addIndexDialog.find("#second-column option").remove();addIndexDialog.find("#second-column").append($('<option value="-none-">-none-<\/option>'));CurrentTable.find(".dbColumn").each(function(n,t){addIndexDialog.find("#second-column").append($('<option value="'+$(t).find(".dbColumnName").text()+'">'+$(t).find(".dbColumnName").text()+"<\/option>"))});addIndexDialog.find("#index-name").val("");addIndexDialog.find("#first-column").val("id");addIndexDialog.find("#second-column").val("-none-");addIndexDialog.find("#unique-checkbox").prop("checked",!1);addIndexDialog.find(".additionalFormRow").remove();addIndexDialog.data("columnsShown",1)}});function l(){for(indexColumnArray=[addIndexDialog.find("#first-column").val()],addIndexDialog.find(".additionalFormRow .additionalColumn").each(function(n,t){indexColumnArray.push($(t).val())}),filteredIndexColumnArray=[],i=0;i<indexColumnArray.length;i++)indexColumnArray[i]!="-none-"&&filteredIndexColumnArray.push(indexColumnArray[i]);AddIndex(CurrentTable,addIndexDialog.find("#index-name").val(),filteredIndexColumnArray,addIndexDialog.find("#unique-checkbox").prop("checked"));addIndexDialog.dialog("close")}editIndexDialog=$("#edit-index-dialog").dialog({autoOpen:!1,resizable:!1,width:400,height:230,buttons:{Save:function(){a()},Cancel:function(){editIndexDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return a(),!1});$("#edit-index-dialog #btn-add-index-column").on("click",function(){newColumnNumber=editIndexDialog.data("columnsShown")+1;newFormRow=$('<tr class="additionalFormRow"><td><label for="additional-column">'+newColumnNumber+'. column<\/label><\/td><td><select name="additional-column" class="additionalColumn"><\/select><\/td><\/tr>');newFormRow.find(".additionalColumn").append($('<option value="-none-">-none-<\/option>'));CurrentTable.find(".dbColumn").each(function(n,t){newFormRow.find(".additionalColumn").append($('<option value="'+$(t).find(".dbColumnName").text()+'">'+$(t).find(".dbColumnName").text()+"<\/option>"))});$("#edit-index-dialog").find("#addIndexColumnFormRow").before(newFormRow);editIndexDialog.data("columnsShown",newColumnNumber)})},open:function(){for(editIndexDialog.find("#first-column option").remove(),CurrentTable.find(".dbColumn").each(function(n,t){editIndexDialog.find("#first-column").append($('<option value="'+$(t).find(".dbColumnName").text()+'">'+$(t).find(".dbColumnName").text()+"<\/option>"))}),editIndexDialog.find("#second-column option").remove(),editIndexDialog.find("#second-column").append($('<option value="-none-">-none-<\/option>')),CurrentTable.find(".dbColumn").each(function(n,t){editIndexDialog.find("#second-column").append($('<option value="'+$(t).find(".dbColumnName").text()+'">'+$(t).find(".dbColumnName").text()+"<\/option>"))}),indexColumnArray=CurrentIndex.data("indexColumnArray"),indexColumnArray||(indexColumnArray=["id"]),editIndexDialog.data("columnsShown",indexColumnArray.length),editIndexDialog.find("#index-name").val(CurrentIndex.data("indexName")),editIndexDialog.find("#first-column").val(indexColumnArray[0]),editIndexDialog.find("#second-column").val(indexColumnArray[1]),editIndexDialog.find("#unique-checkbox").prop("checked",CurrentIndex.data("unique")),editIndexDialog.find(".additionalFormRow").remove(),i=1;i<indexColumnArray.length;i++)newFormRow=$('<tr class="additionalFormRow"><td><label for="additional-column">'+(i+1)+'. column<\/label><\/td><td><select name="additional-column" class="additionalColumn"><\/select><\/td><\/tr>'),newFormRow.find(".additionalColumn").append($('<option value="-none-">-none-<\/option>')),CurrentTable.find(".dbColumn").each(function(n,t){newFormRow.find(".additionalColumn").append($('<option value="'+$(t).find(".dbColumnName").text()+'">'+$(t).find(".dbColumnName").text()+"<\/option>"))}),newFormRow.find(".additionalColumn").val(indexColumnArray[i]),$("#edit-index-dialog").find("#addIndexColumnFormRow").before(newFormRow)}});function a(){for(indexColumnArray=[editIndexDialog.find("#first-column").val()],editIndexDialog.find(".additionalFormRow .additionalColumn").each(function(n,t){indexColumnArray.push($(t).val())}),filteredIndexColumnArray=[],i=0;i<indexColumnArray.length;i++)indexColumnArray[i]!="-none-"&&filteredIndexColumnArray.push(indexColumnArray[i]);for(indexLabel="Index: ",i=0;i<filteredIndexColumnArray.length-1;i++)indexLabel+=filteredIndexColumnArray[i]+", ";indexLabel+=filteredIndexColumnArray[filteredIndexColumnArray.length-1];editIndexDialog.find("#unique-checkbox").prop("checked")&&(indexLabel+=" - unique");newIndex=$('<div class="dbIndex"><div class="deleteIndexIcon fa fa-remove"><\/div><span class="dbIndexText">'+indexLabel+'<\/span><div class="editIndexIcon fa fa-pencil"><\/div><\/div>');newIndex.children(".deleteIndexIcon").on("click",function(){$(this).parents(".dbIndex").remove()});newIndex.children(".editIndexIcon").on("click",function(){CurrentIndex=$(this).parents(".dbIndex");CurrentTable=$(this).parents(".dbTable");editIndexDialog.dialog("open")});newIndex.data("indexName",editIndexDialog.find("#index-name").val());newIndex.data("indexColumnArray",filteredIndexColumnArray);newIndex.data("unique",editIndexDialog.find("#unique-checkbox").prop("checked"));CurrentIndex.replaceWith(newIndex);editIndexDialog.dialog("close")}}});$(function(){function n(){appPropertiesDialog.dialog("close");postData={DisplayName:appPropertiesDialog.find("#app-name").val(),CSSTemplateId:appPropertiesDialog.find("#template").val(),TileWidth:appPropertiesDialog.find("#tile-width").val(),TileHeight:appPropertiesDialog.find("#tile-height").val(),Color:appPropertiesDialog.find("#bg-color").val(),Icon:appPropertiesDialog.find("#icon-class").val(),IsAllowedForAll:$("#cbAllowAll").is(":checked")==!0?!0:!1};$.ajax({type:"POST",url:"/api/master/apps/"+CurrentAppId+"/properties",data:postData,success:function(){alert("OK");location.reload()}})}function t(){addAppDialog.dialog("close");postData={DisplayName:addAppDialog.find("#app-name").val(),Template:addAppDialog.find("#template").val(),TileWidth:addAppDialog.find("#tile-width").val(),TileHeight:addAppDialog.find("#tile-height").val(),Color:addAppDialog.find("#bg-color").val(),Icon:addAppDialog.find("#icon-class").val()};$.ajax({type:"POST",url:"/api/master/apps",data:postData,success:function(){location.reload()}})}appPropertiesDialog=$("#app-properties-dialog").dialog({autoOpen:!1,resizable:!1,width:600,height:320,buttons:{"Uložit":function(){n()},"Zrušit":function(){appPropertiesDialog.dialog("close")}},create:function(){$(this).keypress(function(t){if(t.keyCode==$.ui.keyCode.ENTER)return n(),!1})},open:function(){appPropertiesDialog.find("#app-name").val("");appPropertiesDialog.find("#cbAllowAll").val("");appPropertiesDialog.find("#template").val(1);appPropertiesDialog.find("#tile-width").val(2);appPropertiesDialog.find("#tile-height").val(1);appPropertiesDialog.find("#bg-color").val(0);appPropertiesDialog.find("#icon-class").val("");$.ajax({type:"GET",url:"/api/master/apps/"+CurrentAppId+"/properties",dataType:"json",success:function(n){n.IsAllowedForAll?$("#cbAllowAll").prop("checked",!0):$("#cbAllowAll").prop("checked",!1);appPropertiesDialog.find("#app-name").val(n.DisplayName);appPropertiesDialog.find("#template").val(n.CSSTemplateId);appPropertiesDialog.find("#tile-width").val(n.TileWidth);appPropertiesDialog.find("#tile-height").val(n.TileHeight);appPropertiesDialog.find("#bg-color").val(n.Color);appPropertiesDialog.find("#icon-class").val(n.Icon)}})}});addAppDialog=$("#new-app-dialog").dialog({autoOpen:!1,resizable:!1,width:600,height:320,buttons:{"Přidat":function(){t()},"Zrušit":function(){addAppDialog.dialog("close")}},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return t(),!1})},open:function(){addAppDialog.find("#app-name").val("");addAppDialog.find("#template").val(1);addAppDialog.find("#tile-width").val(2);addAppDialog.find("#tile-height").val(1);addAppDialog.find("#bg-color").val(0);addAppDialog.find("#icon-class").val("fa-question")}});appBuildDialog=$("#app-build-dialog").dialog({autoOpen:!1,resizable:!1,width:640,height:320})});$(function(){if(CurrentModuleIs("adminAppModule")){$(".adminAppTable .btnOpenWorkflow").on("click",function(){CurrentAppId=$(this).parents("tr").attr("appId");openMetablockForm=$("#openMetablockForm");openMetablockForm.find("input[name='appId']").val(CurrentAppId);openMetablockForm.submit()});$(".adminAppTable .btnOpenDbScheme").on("click",function(){CurrentAppId=$(this).parents("tr").attr("appId");openMetablockForm=$("#openDbSchemeForm");openMetablockForm.find("input[name='appId']").val(CurrentAppId);openMetablockForm.submit()});$(".adminAppTable .btnOpenMozaic").on("click",function(){CurrentAppId=$(this).parents("tr").attr("appId");openMetablockForm=$("#openMozaicForm");openMetablockForm.find("input[name='appId']").val(CurrentAppId);openMetablockForm.submit()});var n;$(".adminAppTable .actions .btnValidate").on("click",function(){if(CurrentAppId=$(this).parents("tr").attr("appId"),typeof WebSocket=="undefined"){ShowAppNotification("Váš prohlížeč nepodporuje webSockety, a nemůže být využit k aktualizaci aplikací","error");return}appBuildDialog.dialog("option",{title:"aktualizuji "+$(this).parents("tr").data("displayName")}).empty().dialog("open");var t={},i=new WebSocket("ws://"+window.location.hostname+":"+window.location.port+"/Master/AppAdminManager/BuildApp/"+CurrentAppId);n=i;i.onerror=function(){$(document).trigger("ajaxError",{})};i.onmessage=function(r){var u,f,e,o;if(n===i){try{u=JSON.parse(r.data)}catch(s){u={message:r.data,type:"error"}}u.id&&t[u.id]?f=t[u.id]:(e=u.childOf?t[u.childOf]:appBuildDialog,f=$("<div class='app-alert'><span>").data("messageId",u.id).appendTo(e),e.is("#app-build-dialog, .app-alert-odd")||f.addClass("app-alert-odd"),u.id&&(t[u.id]=f));u.message&&f.children("span").html(u.message);f.removeClass("app-alert-info app-alert-error app-alert-success app-alert-warning").addClass("app-alert-"+(u.type||"info"));u.abort&&f.nextAll().remove();u.done&&setTimeout(function(){appBuildDialog.dialog("close")},1e3);o=0;appBuildDialog.children().each(function(){o+=$(this).outerHeight()});appBuildDialog.css({height:o+32})}}});$(".adminAppTable .actions .btnRebuild").on("click",function(){if(CurrentAppId=$(this).parents("tr").attr("appId"),typeof WebSocket=="undefined"){ShowAppNotification("Váš prohlížeč nepodporuje webSockety, a nemůže být využit k aktualizaci aplikací","error");return}appBuildDialog.dialog("option",{title:"aktualizuji "+$(this).parents("tr").data("displayName")}).empty().dialog("open");var t={},i=new WebSocket("ws://"+window.location.hostname+":"+window.location.port+"/Master/AppAdminManager/RebuildApp/"+CurrentAppId);n=i;i.onerror=function(){$(document).trigger("ajaxError",{})};i.onmessage=function(r){var u,f,e,o;if(n===i){try{u=JSON.parse(r.data)}catch(s){u={message:r.data,type:"error"}}u.id&&t[u.id]?f=t[u.id]:(e=u.childOf?t[u.childOf]:appBuildDialog,f=$("<div class='app-alert'><span>").data("messageId",u.id).appendTo(e),e.is("#app-build-dialog, .app-alert-odd")||f.addClass("app-alert-odd"),u.id&&(t[u.id]=f));u.message&&f.children("span").html(u.message);f.removeClass("app-alert-info app-alert-error app-alert-success app-alert-warning").addClass("app-alert-"+(u.type||"info"));u.abort&&f.nextAll().remove();u.done&&setTimeout(function(){appBuildDialog.dialog("close")},1e3);o=0;appBuildDialog.children().each(function(){o+=$(this).outerHeight()});appBuildDialog.css({height:o+32})}}});$(".adminAppTable .actions .btnProperties").on("click",function(){CurrentAppId=$(this).parents("tr").attr("appId");appPropertiesDialog.dialog("open")});$(".adminAppTable .actions .btnToggleEnabled").on("click",function(){thisButton=$(this);appId=thisButton.parents("tr").attr("appId");isEnabledCell=thisButton.parents("tr").find(".isEnabledColumn");thisButton.hasClass("btnDisable")?(postData={IsEnabled:!1},$.ajax({type:"POST",url:"/api/master/apps/"+appId+"/state",data:postData,success:function(){thisButton.removeClass("btnDisable");thisButton.addClass("btnEnable");thisButton.removeClass("btn-danger");thisButton.addClass("btn-primary");thisButton.text("Povolit");isEnabledCell.text("Ne")}})):(postData={IsEnabled:!0},$.ajax({type:"POST",url:"/api/master/apps/"+appId+"/state",data:postData,success:function(){thisButton.removeClass("btnEnable");thisButton.addClass("btnDisable");thisButton.removeClass("btn-primary");thisButton.addClass("btn-danger");thisButton.text("Zakázat");isEnabledCell.text("Ano")}}))});$("#btnAddApp").on("click",function(){addAppDialog.dialog("open")})}});
/**!
 * Sortable
 * @author	RubaXa   <trash@rubaxa.org>
 * @license MIT
 */
(function(n){typeof define=="function"&&define.amd?define(n):typeof module!="undefined"&&typeof module.exports!="undefined"?module.exports=n():typeof Package!="undefined"?Sortable=n():window.Sortable=n()})(function(){"use strict";function c(n,t){var u,r,i;if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(n);this.el=n;this.options=t=ui({},t);n[nt]=this;u={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(n.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,animation:0,setData:function(n,t){n.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0}};for(r in u)r in t||(t[r]=u[r]);dt(t);for(i in this)i.charAt(0)==="_"&&typeof this[i]=="function"&&(this[i]=this[i].bind(this));this.nativeDraggable=t.forceFallback?!1:ei;f(n,"mousedown",this._onTapStart);f(n,"touchstart",this._onTapStart);this.nativeDraggable&&(f(n,"dragover",this),f(n,"dragenter",this));ut.push(this._onDragOver);t.store&&this.sort(t.store.get(this))}function pt(i){o&&o.state!==i&&(r(o,"display",i?"none":""),!i&&o.state&&t.insertBefore(o,n),o.state=i)}function b(n,t,i){if(n){i=i||u;do if(t===">*"&&n.parentNode===i||ii(n,t))return n;while(n=hi(n))}return null}function hi(n){var t=n.host;return t&&t.nodeType?t:n.parentNode}function ci(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move");n.preventDefault()}function f(n,t,i){n.addEventListener(t,i,!1)}function e(n,t,i){n.removeEventListener(t,i,!1)}function p(n,t,i){if(n)if(n.classList)n.classList[i?"add":"remove"](t);else{var r=(" "+n.className+" ").replace(wt," ").replace(" "+t+" "," ");n.className=(r+(i?" "+t:"")).replace(wt," ")}}function r(n,t,i){var r=n&&n.style;if(r){if(i===void 0)return u.defaultView&&u.defaultView.getComputedStyle?i=u.defaultView.getComputedStyle(n,""):n.currentStyle&&(i=n.currentStyle),t===void 0?i:i[t];t in r||(t="-webkit-"+t);r[t]=i+(typeof i=="string"?"":"px")}}function gt(n,t,i){if(n){var u=n.getElementsByTagName(t),r=0,f=u.length;if(i)for(;r<f;r++)i(u[r],r);return u}return[]}function l(n,t,i,r,f,e,s){n=n||t[nt];var h=u.createEvent("Event"),c=n.options,l="on"+i.charAt(0).toUpperCase()+i.substr(1);h.initEvent(i,!0,!0);h.to=t;h.from=f||t;h.item=r||t;h.clone=o;h.oldIndex=e;h.newIndex=s;t.dispatchEvent(h);c[l]&&c[l].call(n,h)}function ni(n,t,i,r,f,e,o){var s,h=n[nt],c=h.options.onMove,l;return s=u.createEvent("Event"),s.initEvent("move",!0,!0),s.to=t,s.from=n,s.dragged=i,s.draggedRect=r,s.related=f||t,s.relatedRect=e||t.getBoundingClientRect(),n.dispatchEvent(s),c&&(l=c.call(h,s,o)),l}function ti(n){n.draggable=!1}function li(){yt=!1}function ai(n,t){var r=n.lastElementChild,i=r.getBoundingClientRect();return(t.clientY-(i.top+i.height)>5||t.clientX-(i.right+i.width)>5)&&r}function vi(n){for(var t=n.tagName+n.className+n.src+n.href+n.textContent,i=t.length,r=0;i--;)r+=t.charCodeAt(i);return r.toString(36)}function ot(n,t){var i=0;if(!n||!n.parentNode)return-1;while(n&&(n=n.previousElementSibling))n.nodeName.toUpperCase()!=="TEMPLATE"&&(t===">*"||ii(n,t))&&i++;return i}function ii(n,t){if(n){t=t.split(".");var i=t.shift().toUpperCase(),r=new RegExp("\\s("+t.join("|")+")(?=\\s)","g");return(i===""||n.nodeName.toUpperCase()==i)&&(!t.length||((" "+n.className+" ").match(r)||[]).length==t.length)}return!1}function ri(n,t){var i,r;return function(){i===void 0&&(i=arguments,r=this,setTimeout(function(){i.length===1?n.call(r,i[0]):n.apply(r,i);i=void 0},t))}}function ui(n,t){if(n&&t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function fi(n){return rt?rt(n).clone(!0)[0]:vt&&vt.dom?vt.dom(n).cloneNode(!0):n.cloneNode(!0)}if(typeof window=="undefined"||!window.document)return function(){throw new Error("Sortable.js requires a window with a document");};var n,k,i,o,t,it,h,st,ht,ct,ft,lt,a,s,g,at,w={},d,v,et,wt=/\s+/g,nt="Sortable"+(new Date).getTime(),y=window,u=y.document,bt=y.parseInt,rt=y.jQuery||y.Zepto,vt=y.Polymer,ei=!!("draggable"in u.createElement("div")),kt=function(n){return!navigator.userAgent.match(/Trident.*rv[ :]?11\./)?(n=u.createElement("x"),n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"):!1}(),yt=!1,tt=Math.abs,oi=Math.min,pi=[].slice,ut=[],si=ri(function(n,t,i){if(i&&t.scroll){var r,o,u=t.scrollSensitivity,v=t.scrollSpeed,s=n.clientX,c=n.clientY,p=window.innerWidth,b=window.innerHeight,f,e,l,a;if(st!==i&&(h=t.scroll,st=i,ht=t.scrollFn,h===!0)){h=i;do if(h.offsetWidth<h.scrollWidth||h.offsetHeight<h.scrollHeight)break;while(h=h.parentNode)}h&&(r=h,o=h.getBoundingClientRect(),f=(tt(o.right-s)<=u)-(tt(o.left-s)<=u),e=(tt(o.bottom-c)<=u)-(tt(o.top-c)<=u));f||e||(f=(p-s<=u)-(s<=u),e=(b-c<=u)-(c<=u),(f||e)&&(r=y));(w.vx!==f||w.vy!==e||w.el!==r)&&(w.el=r,w.vx=f,w.vy=e,clearInterval(w.pid),r&&(w.pid=setInterval(function(){if(a=e?e*v:0,l=f?f*v:0,"function"==typeof ht)return ht.call(_this,l,a,n);r===y?y.scrollTo(y.pageXOffset+l,y.pageYOffset+a):(r.scrollTop+=a,r.scrollLeft+=l)},24)))}},30),dt=function(n){function r(n,t){return(n===void 0||n===!0)&&(n=i.name),typeof n=="function"?n:function(i,r){var u=r.options.group.name;return t?n:n&&(n.join?n.indexOf(u)>-1:u==n)}}var i={},t=n.group;t&&typeof t=="object"||(t={name:t});i.name=t.name;i.checkPull=r(t.pull,!0);i.checkPut=r(t.put);n.group=i};return c.prototype={constructor:c,_onTapStart:function(t){var s=this,e=this.el,r=this.options,c=t.type,h=t.touches&&t.touches[0],i=(h||t).target,u=t.target.shadowRoot&&t.path[0]||i,f=r.filter,o;if(!n&&(c!=="mousedown"||t.button===0)&&!r.disabled&&(!r.handle||b(u,r.handle,e))&&(i=b(i,r.draggable,e),i)){if(o=ot(i,r.draggable),typeof f=="function"){if(f.call(this,t,i,this)){l(s,u,"filter",i,e,o);t.preventDefault();return}}else if(f&&(f=f.split(",").some(function(n){return n=b(u,n.trim(),e),n?(l(s,n,"filter",i,e,o),!0):void 0}),f&&!rt(u).is(r.handle))){t.preventDefault();return}r.handle&&rt(u).is(r.handle)&&(i=rt(u).parent()[0]);this._prepareDragStart(t,h,i,o)}},_prepareDragStart:function(i,r,u,e){var o=this,c=o.el,h=o.options,s=c.ownerDocument,v;u&&!n&&u.parentNode===c&&(d=i,t=c,n=u,k=n.parentNode,it=n.nextSibling,g=h.group,a=e,this._lastX=(r||i).clientX,this._lastY=(r||i).clientY,n.style["will-change"]="transform",v=function(){o._disableDelayedDrag();n.draggable=o.nativeDraggable;p(n,h.chosenClass,!0);o._triggerDragStart(r);l(o,t,"choose",n,t,a)},h.ignore.split(",").forEach(function(t){gt(n,t.trim(),ti)}),f(s,"mouseup",o._onDrop),f(s,"touchend",o._onDrop),f(s,"touchcancel",o._onDrop),h.delay?(f(s,"mouseup",o._disableDelayedDrag),f(s,"touchend",o._disableDelayedDrag),f(s,"touchcancel",o._disableDelayedDrag),f(s,"mousemove",o._disableDelayedDrag),f(s,"touchmove",o._disableDelayedDrag),o._dragStartTimer=setTimeout(v,h.delay)):v())},_disableDelayedDrag:function(){var n=this.el.ownerDocument;clearTimeout(this._dragStartTimer);e(n,"mouseup",this._disableDelayedDrag);e(n,"touchend",this._disableDelayedDrag);e(n,"touchcancel",this._disableDelayedDrag);e(n,"mousemove",this._disableDelayedDrag);e(n,"touchmove",this._disableDelayedDrag)},_triggerDragStart:function(i){i?(d={target:n,clientX:i.clientX,clientY:i.clientY},this._onDragStart(d,"touch")):this.nativeDraggable?(f(n,"dragend",this),f(t,"dragstart",this._onDragStart)):this._onDragStart(d,!0);try{u.selection?setTimeout(function(){u.selection.empty()}):window.getSelection().removeAllRanges()}catch(r){}},_dragStarted:function(){if(t&&n){var i=this.options;p(n,i.ghostClass,!0);p(n,i.dragClass,!1);c.active=this;l(this,t,"start",n,t,a)}},_emulateDragOver:function(){if(v){if(this._lastX===v.clientX&&this._lastY===v.clientY)return;this._lastX=v.clientX;this._lastY=v.clientY;kt||r(i,"display","none");var t=u.elementFromPoint(v.clientX,v.clientY),n=t,f=ut.length;if(n)do{if(n[nt]){while(f--)ut[f]({clientX:v.clientX,clientY:v.clientY,target:t,rootEl:n});break}t=n}while(n=n.parentNode);kt||r(i,"display","")}},_onTouchMove:function(n){if(d){var f=this.options,e=f.fallbackTolerance,o=f.fallbackOffset,t=n.touches?n.touches[0]:n,s=t.clientX-d.clientX+o.x,h=t.clientY-d.clientY+o.y,u=n.touches?"translate3d("+s+"px,"+h+"px,0)":"translate("+s+"px,"+h+"px)";if(!c.active){if(e&&oi(tt(t.clientX-this._lastX),tt(t.clientY-this._lastY))<e)return;this._dragStarted()}this._appendGhost();et=!0;v=t;r(i,"webkitTransform",u);r(i,"mozTransform",u);r(i,"msTransform",u);r(i,"transform",u);n.preventDefault()}},_appendGhost:function(){if(!i){var f=n.getBoundingClientRect(),s=r(n),e=this.options,o;i=n.cloneNode(!0);p(i,e.ghostClass,!1);p(i,e.fallbackClass,!0);p(i,e.dragClass,!0);r(i,"top",f.top-bt(s.marginTop,10));r(i,"left",f.left-bt(s.marginLeft,10));r(i,"width",f.width);r(i,"height",f.height);r(i,"opacity","0.8");r(i,"position","fixed");r(i,"zIndex","100000");r(i,"pointerEvents","none");e.fallbackOnBody&&u.body.appendChild(i)||t.appendChild(i);o=i.getBoundingClientRect();r(i,"width",f.width*2-o.width);r(i,"height",f.height*2-o.height)}},_onDragStart:function(i,e){var s=i.dataTransfer,h=this.options;this._offUpEvents();g.checkPull(this,this,n,i)=="clone"&&(o=fi(n),r(o,"display","none"),t.insertBefore(o,n),l(this,t,"clone",n));p(n,h.dragClass,!0);e?(e==="touch"?(f(u,"touchmove",this._onTouchMove),f(u,"touchend",this._onDrop),f(u,"touchcancel",this._onDrop)):(f(u,"mousemove",this._onTouchMove),f(u,"mouseup",this._onDrop)),this._loopId=setInterval(this._emulateDragOver,50)):(s&&(s.effectAllowed="move",h.setData&&h.setData.call(this,s,n)),f(u,"drop",this),setTimeout(this._dragStarted,0))},_onDragOver:function(u){var e=this.el,f,l,s,tt,h=this.options,rt=h.group,ut=c.active,y=g===rt,ot=h.sort,w,d;if(u.preventDefault!==void 0&&(u.preventDefault(),h.dragoverBubble||u.stopPropagation()),et=!0,g&&!h.disabled&&(y?ot||(tt=!t.contains(n)):at===this||g.checkPull(this,ut,n,u)&&rt.checkPut(this,ut,n,u))&&(u.rootEl===void 0||u.rootEl===this.el)){if(si(u,h,this.el),yt)return;if(f=b(u.target,h.draggable,e),l=n.getBoundingClientRect(),at=this,typeof h.onDragOver=="function")h.onDragOver(e);if(tt){pt(!0);k=t;o||it?t.insertBefore(n,o||it):ot||t.appendChild(n);return}if(e.children.length===0||e.children[0]===i||e===u.target&&(f=ai(e,u))){if(f){if(f.animated)return;s=f.getBoundingClientRect()}pt(y);ni(t,e,n,l,f,s,u)!==!1&&(n.contains(e)||(e.appendChild(n),k=e),this._animate(l,n),f&&this._animate(s,f))}else if(f&&!f.animated&&f!==n&&f.parentNode[nt]!==void 0){ct!==f&&(ct=f,ft=r(f),lt=r(f.parentNode));s=f.getBoundingClientRect();var kt=s.right-s.left,st=s.bottom-s.top,ht=/left|right|inline/.test(ft.cssFloat+ft.display)||lt.display=="flex"&&lt["flex-direction"].indexOf("row")===0,vt=f.offsetWidth>n.offsetWidth,wt=f.offsetHeight>n.offsetHeight,bt=(ht?(u.clientX-s.left)/kt:(u.clientY-s.top)/st)>.5,p=f.nextElementSibling,v=ni(t,e,n,l,f,s,u),a;v!==!1&&(yt=!0,setTimeout(li,30),pt(y),v===1||v===-1?a=v===1:ht?(w=n.offsetTop,d=f.offsetTop,a=w===d?f.previousElementSibling===n&&!vt||bt&&vt:f.previousElementSibling===n||n.previousElementSibling===f?(u.clientY-s.top)/st>.5:d>w):a=p!==n&&!wt||bt&&wt,n.contains(e)||(a&&!p?e.appendChild(n):f.parentNode.insertBefore(n,a?p:f)),k=n.parentNode,this._animate(l,n),this._animate(s,f))}}},_animate:function(n,t){var i=this.options.animation,u;i&&(u=t.getBoundingClientRect(),r(t,"transition","none"),r(t,"transform","translate3d("+(n.left-u.left)+"px,"+(n.top-u.top)+"px,0)"),t.offsetWidth,r(t,"transition","all "+i+"ms"),r(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=setTimeout(function(){r(t,"transition","");r(t,"transform","");t.animated=!1},i))},_offUpEvents:function(){var n=this.el.ownerDocument;e(u,"touchmove",this._onTouchMove);e(n,"mouseup",this._onDrop);e(n,"touchend",this._onDrop);e(n,"touchcancel",this._onDrop)},_onDrop:function(r){var h=this.el,f=this.options;clearInterval(this._loopId);clearInterval(w.pid);clearTimeout(this._dragStartTimer);e(u,"mousemove",this._onTouchMove);this.nativeDraggable&&(e(u,"drop",this),e(h,"dragstart",this._onDragStart));this._offUpEvents();r&&(et&&(r.preventDefault(),f.dropBubble||r.stopPropagation()),i&&i.parentNode.removeChild(i),n&&(this.nativeDraggable&&e(n,"dragend",this),ti(n),n.style["will-change"]="",p(n,this.options.ghostClass,!1),p(n,this.options.chosenClass,!1),t!==k?(s=ot(n,f.draggable),s>=0&&(l(null,k,"add",n,t,a,s),l(this,t,"remove",n,t,a,s),l(null,k,"sort",n,t,a,s),l(this,t,"sort",n,t,a,s))):(o&&o.parentNode.removeChild(o),n.nextSibling!==it&&(s=ot(n,f.draggable),s>=0&&(l(this,t,"update",n,t,a,s),l(this,t,"sort",n,t,a,s)))),c.active&&((s==null||s===-1)&&(s=a),l(this,t,"end",n,t,a,s),this.save())));this._nulling()},_nulling:function(){t=n=k=i=it=o=h=st=d=v=et=s=ct=ft=at=g=c.active=null},handleEvent:function(t){var i=t.type;i==="dragover"||i==="dragenter"?n&&(this._onDragOver(t),ci(t)):(i==="drop"||i==="dragend")&&this._onDrop(t)},toArray:function(){for(var i=[],n,r=this.el.children,t=0,f=r.length,u=this.options;t<f;t++)n=r[t],b(n,u.draggable,this.el)&&i.push(n.getAttribute(u.dataIdAttr)||vi(n));return i},sort:function(n){var t={},i=this.el;this.toArray().forEach(function(n,r){var u=i.children[r];b(u,this.options.draggable,i)&&(t[n]=u)},this);n.forEach(function(n){t[n]&&(i.removeChild(t[n]),i.appendChild(t[n]))})},save:function(){var n=this.options.store;n&&n.set(this)},closest:function(n,t){return b(n,t||this.options.draggable,this.el)},option:function(n,t){var i=this.options;if(t===void 0)return i[n];i[n]=t;n==="group"&&dt(i)},destroy:function(){var n=this.el;n[nt]=null;e(n,"mousedown",this._onTapStart);e(n,"touchstart",this._onTapStart);this.nativeDraggable&&(e(n,"dragover",this),e(n,"dragenter",this));Array.prototype.forEach.call(n.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")});ut.splice(ut.indexOf(this._onDragOver),1);this._onDrop();this.el=n=null}},c.utils={on:f,off:e,css:r,find:gt,is:function(n,t){return!!b(n,t,n)},extend:ui,throttle:ri,closest:b,toggleClass:p,clone:fi,index:ot},c.create=function(n,t){return new c(n,t)},c.version="1.4.2",c});MBE={types:{},options:{},sortableOptions:{},onInit:[],onBeforeDelete:{"*":[]},workspace:null,workspaceDoc:null,changedSinceLastSave:!1,saveRequested:!1,preInit:function(){setTimeout(function(){var n=$("#mozaicPageWorkspace > iframe")[0].contentWindow;MBE.workspaceDoc=n.document?n.document:n.contentDocument;MBE.workspace=$("body",MBE.workspaceDoc);MBE.workspace.html("").css({"min-width":"100%","min-height":"100%"}).addClass("mozaicEditorBody").parent().css({width:"100%",height:"100%"});MBE.init()},2e3)},init:function(){$(document).on("click","ul.category li",MBE.toggleCategory).on("dblclick",".mbe-text-node",MBE.editText).on("blur","[contenteditable]",MBE.editTextDone).on("click","[data-uic]",MBE.onClick).on("dblclick","[data-uic]",MBE.options.openDialog).on("keydown",MBE.onKeyDown).on("click",'[data-action="fullscreen"]',MBE.toggleFullscreen).on("click",".device-button",MBE.setDevice).on("webkitfullscreenchange mozfullscreenchange msfullscreenchange ofullscreenchange fullscreenchange",MBE.fullscreenResize).on("click","#btnChoosePage",MBE.dialogs.choosePage).on("click","#btnTrashPage",MBE.dialogs.trash).on("click","#btnNewPage",MBE.dialogs.newPage).on("click","#headerPageName",MBE.dialogs.rename).on("click","tr.pageRow",MBE.selectPage).on("click","#btnClear",MBE.clearWorkspace).on("click","#btnLoad",MBE.io.reloadPage).on("click","#btnSave",MBE.io.savePage);$(MBE.workspaceDoc).on("keydown",MBE.onKeyDown).on("dblclick",".mbe-text-node",MBE.editText).on("blur","[contenteditable]",MBE.editTextDone).on("click","[data-uic]",MBE.onClick).on("dblclick","[data-uic]",MBE.options.openDialog);for($("ul.category > li ul").hide(),$("ul.category > li").prepend('<span class="fa fa-caret-right fa-fw"><\/span>'),$("ul.category > li > ul > li").prepend('<span class="fa fa-square fa-fw"><\/span>'),i=0;i<MBE.onInit.length;i++){var n=MBE.onInit[i];n()}},onClick:function(n){n.preventDefault()},onKeyDown:function(n){var t,i;if(n.which==46&&(t=$(".mbe-active",MBE.workspace),t.length&&!t.is("[locked]")&&!t.is("[contenteditable=true]")&&!t.find("[contenteditable=true]").length)){for(typeof MBE.onBeforeDelete[t.data("uic")]=="function"&&MBE.onBeforeDelete[t.data("uic")].apply(t[0],[]),i=0;i<MBE.onBeforeDelete["*"].length;i++)MBE.onBeforeDelete["*"][i].apply(t[0],[]);$(".mbe-active",MBE.workspace).remove();$(".mbe-drag-handle",MBE.workspace).remove();MBE.path.update.apply(MBE.workspace,[]);MBE.DnD.updateDOM()}},toggleCategory:function(n){if(!$(this).parent().hasClass("category"))return n.stopImmediatePropagation(),!1;$("> ul",this).slideToggle();$("> .fa",this).toggleClass("fa-caret-right fa-caret-down")},editText:function(n){return n.stopImmediatePropagation(),$(this).attr("contenteditable",!0).focus(),!1},editTextDone:function(){$("[contenteditable]",MBE.workspace).attr("contenteditable",!1);$(".mbe-text-node > span",MBE.workspace).each(function(){$(this).parent().html(this.innerHTML)})},getComponentName:function(n){var t=$(n).data("uic").split(/\|/),i=t[1];return $('li[data-template="'+i+'"]').text()},setDevice:function(){$(".device-button").removeClass("active");$(this).addClass("active");$("#mozaicPageWorkspace > iframe").removeClass("xs sm md lg").addClass($(this).attr("data-action"))},toggleFullscreen:function(){return MBE.runPrefixMethod(document,"FullScreen")||MBE.runPrefixMethod(document,"IsFullScreen")?MBE.runPrefixMethod(document,"CancelFullScreen"):MBE.runPrefixMethod(document.body,"RequestFullScreen"),!1},isFullscreen:function(){return MBE.runPrefixMethod(document,"FullScreen")||MBE.runPrefixMethod(document,"IsFullScreen")},fullscreenResize:function(){$("#lowerPanel").toggleClass("fullscreen")},runPrefixMethod:function(n,t,i){for(var u=0,r,e,f=["webkit","moz","ms","o",""];u<f.length&&!n[r];){if(r=t,f[u]==""&&(r=r.substr(0,1).toLowerCase()+r.substr(1)),r=f[u]+r,e=typeof n[r],e!="undefined")return f=[f[u]],e=="function"?n[r]():n[r];u++}if(i)return-1},selectPage:function(){$(this).addClass("highlightedRow").siblings().removeClass("highlightedRow")},clearWorkspace:function(){MBE.workspace.html("");MBE.DnD.updateDOM()},ajaxError:function(n){alert(n.responseText)}};$("body").hasClass("mozaicBootstrapEditorModule")&&$(MBE.preInit);MBE.DnD={currentElement:null,placeholder:null,onDOMUpdate:[],onDragEnter:[],onDragLeave:[],onDragEnd:[],onDrop:[],onBeforeDrop:[],isNavNodeDragging:!1,isUICDragging:!1,domNeedUpdate:!1,init:function(){var n=MBE.DnD;n.placeholder=$("#drop-placeholder");n.placeholder.hide();$("ul.category > li > ul > li").attr("draggable",!0);$("ul.category > li > ul > li").each(function(){$(this).data("type",$(this).parent().data("type"))});$(document).on("dragstart","ul.category li[draggable=true]",n._componentDragStart).on("dragstart",".tree-nav .node-handle[draggable=true]",n._navNodeDragStart).on("dragover",".tree-nav .node:not(.dragged)",n._navNodeDragOver).on("drop",".tree-nav .node:not(.dragged)",n._navNodeDrop).on("dragend dragstop",n._dragEnd);$(MBE.workspaceDoc).on("dragover","body, [data-uic]:not(.dragged)",n._dragOver).on("dragenter","body, [data-uic]",n._dragEnter).on("dragleave","body, [data-uic]",n._dragLeave).on("dragstart",".mbe-drag-handle[draggable=true]",n._uicDragStart).on("drop","body, [data-uic]",n._workSpaceDrop).on("dragend dragstop",n._dragEnd)},getUIC:function(){var t=MBE.DnD,n=$(t.currentElement);return n.hasClass("node")?n.find("> .node-handle b").data("targetuic"):n.is("[data-uic]")?n:t.createUIC(n)},createUIC:function(n){var i=n.data("type"),r=n.data("template"),t=$(MBE.types[i].templates[r]);return t.data("uic")||t.attr("data-uic",i+"|"+r),t},createGhost:function(){var n=$('<span class="drag-ghost" style="position:absolute; left: -100000px; top: -100000px"><\/span>');return n.appendTo("body"),n[0]},_componentDragStart:function(n){var t=n.originalEvent,i;MBE.DnD.currentElement=this;i=MBE.DnD.createGhost();$("body").addClass("dragging");t.dataTransfer.setData("text/plain","...");t.dataTransfer.effectAllowed="all";t.dataTransfer.setDragImage(i,-12,-12)},_navNodeDragStart:function(n){var t=n.originalEvent,i;MBE.DnD.currentElement=$(this).parent();MBE.DnD.currentElement.addClass("dragged");MBE.DnD.isNavNodeDragging=!0;i=MBE.DnD.createGhost();$("body").addClass("dragging");t.dataTransfer.setData("text/plain","...");t.dataTransfer.effectAllowed="move";t.dataTransfer.setDragImage(i,-12,-12)},_uicDragStart:function(n){var t=n.originalEvent,i;MBE.DnD.currentElement=$(".mbe-active",MBE.workspace);MBE.DnD.currentElement.addClass("dragged");MBE.DnD.isUICDragging=!0;i=MBE.DnD.createGhost();$("body").addClass("dragging");t.dataTransfer.setData("text/plain","...");t.dataTransfer.effectAllowed="move";t.dataTransfer.setDragImage(i,-12,-12)},_dragOver:function(n){var r,t,u,i,f;if(n.preventDefault(),r=$(this),t=r.find(" > *"),r.is(".dragged")||r.parents(".dragged").length)return n.originalEvent.dataTransfer.effectAllowed="none",MBE.DnD.placeholder.hide(),!1;if(t.length)for(u=n.pageY,i=0;i<t.length;i++)if(f=t.eq(i).offset().top,f>=u-5&&f<=u+5){t.eq(i).before(MBE.DnD.placeholder);break}else t.eq(i).after(MBE.DnD.placeholder);else r.append(MBE.DnD.placeholder);return MBE.DnD.placeholder.show(),!1},_navNodeDragOver:function(n){n.preventDefault();var t=$(this),i=n.pageY,r=t.offset().top,u=t.outerHeight();return $("b.drop-target").removeClass("drop-target"),r>=i-3&&r<=i+3&&!t.hasClass("root")?t.before(MBE.DnD.placeholder):r+u>=i-3&&r+u<=i+3&&!t.hasClass("root")?t.after(MBE.DnD.placeholder):(t.find("> .sub-tree").append(MBE.DnD.placeholder),t.find("> .node-handle b").addClass("drop-target")),!1},_workSpaceDrop:function(n){n.stopImmediatePropagation();n.preventDefault();var t=MBE.DnD,i=t.getUIC();t.callListeners("onBeforeDrop",i[0],[t.placeholder.parent()]);t.placeholder.after(i);t.callListeners("onDrop",i[0],[t.placeholder.parent()]);t.domNeedUpdate=!0},_navNodeDrop:function(n){n.stopImmediatePropagation();n.preventDefault();var i=MBE.DnD,r=i.placeholder,u=$(i.currentElement),t;t=u.is(".node")?u.find("> .node-handle b").data("targetuic"):u.is("[data-uic]")?u:i.createUIC(u);i.callListeners("onBeforeDrop",$(t)[0],[$(t).parent()]);r.prev(".node").length?$(r.prev(".node").find("> .node-handle b").data("targetuic")).after(t):r.next(".node").length?$(r.next(".node").find("> .node-handle b").data("targetuic")).before(t):$(r.parents(".node").eq(0).find("> .node-handle b").data("targetuic")).append(t);i.callListeners("onDrop",$(t)[0],[$(t).parent()]);i.domNeedUpdate=!0},_dragEnter:function(n){(n.stopImmediatePropagation(),$(this).is(".dragged")||$(this).parents(".dragged").length)||($(this).addClass("drag-over"),MBE.DnD.callListeners("onDragEnter",this))},_dragLeave:function(n){(n.stopImmediatePropagation(),$(this).is(".dragged")||$(this).parents(".dragged").length)||($(this).removeClass("drag-over"),MBE.DnD.callListeners("onDragLeave",this))},_dragEnd:function(){$("body").removeClass("dragging");$(".drag-over").removeClass("drag-over");$(".drag-over",MBE.workspace).removeClass("drag-over");$(".drag-ghost").remove();$("#mozaicPageWorkspace").after(MBE.DnD.placeholder);MBE.DnD.placeholder.hide();MBE.DnD.isNavNodeDragging&&(MBE.DnD.currentElement.removeClass("dragged"),MBE.DnD.isNavNodeDragging=!1);MBE.DnD.isUICDragging&&(MBE.DnD.currentElement.removeClass("dragged"),MBE.DnD.isUICDragging=!1);MBE.DnD.currentElement=null;MBE.DnD.callListeners("onDragEnd",this);MBE.DnD.domNeedUpdate&&MBE.DnD.updateDOM()},updateDOM:function(){$("[data-uic]",MBE.workspace).removeClass("empty-element");$("[data-uic]:not(input, select, hr, img, .caret, li.divider, .fa, .glyphicon):empty",MBE.workspace).addClass("empty-element");MBE.workspace.find("*").contents().filter(function(){return this.nodeType==Node.TEXT_NODE&&!$(this).parent().hasClass("mbe-text-node")}).wrap('<span class="mbe-text-node" />');MBE.workspace.find(".has-feedback").each(function(){$(this).find(".form-control-feedback").length||$(this).removeClass("has-feedback")});MBE.DnD.callListeners("onDOMUpdate",MBE.workspace[0]);MBE.DnD.domNeedUpdate=!1},callListeners:function(n,t,i){for(var u,r=0;r<MBE.DnD[n].length;r++)u=MBE.DnD[n][r],u.apply(t,i?i:[])}};MBE.onInit.push(MBE.DnD.init);MBE.navigator={navBase:null,nodeTemplate:'<div class="node"><span class="node-handle" draggable="true"><b><\/b><\/span><div class="sub-tree"><\/div><\/div>',init:function(){var n=MBE.navigator;MBE.DnD.onDOMUpdate.push(n.rebuild);MBE.DnD.onDragEnter.push(n.addHighlight);MBE.DnD.onDragLeave.push(n.removeHighlight);MBE.DnD.onDragEnd.push(n.unHighlight);MBE.selection.onSelect.push(n._select);n.navBase=$(".tree-nav > .node");n.navBase.find("b").data("targetuic",MBE.workspace[0]);MBE.workspace.data("navitem",n.navBase.find("b"));$(document).on("click",".tree-nav .fa",n.toggle).on("click",".tree-nav b",n.selectNode).on("dblclick",".tree-nav b",n.showOptions)},rebuild:function(){var t=MBE.navigator,n=t.navBase.find("> .sub-tree");n.html("");t.buildSubNodes(MBE.workspace,n);MBE.workspace.data("navstate")=="collapsed"&&n.hide().prev().find("i.fa").toggleClass("fa-caret-down fa-caret-right")},buildSubNodes:function(n,t){n.children().each(function(){var n=$(this),i,r;n.is("[data-uic]")&&(i=$(MBE.navigator.nodeTemplate),r=i.find("b"),n.data("navitem",r),r.html(MBE.getComponentName(this)).data("targetuic",this),n.find("[data-uic]").length&&r.before('<i class="fa fa-caret-down fa-fw"><\/i>'),n.is("[locked]")&&(r.after('<span class="fa fa-lock fa-fw"><\/span>'),i.find(".node-handle").attr("draggable",!1)),n.attr("id")&&n.attr("id").length&&r.parent().append('<i class="item-id">#'+n.attr("id")+"<\/i>"),n.hasClass("mbe-active")&&r.addClass("active"),t.append(i),n.data("navstate")=="collapsed"&&(i.find("i.fa").toggleClass("fa-caret-down fa-caret-right"),i.find(".sub-tree").hide()));MBE.navigator.buildSubNodes(n,n.is("[data-uic]")?i.find(".sub-tree"):t)})},toggle:function(n){n.stopImmediatePropagation();$(this).parent().next().slideToggle();$(this).toggleClass("fa-caret-right fa-caret-down");$($(this).next().data("targetuic")).data("navstate",$(this).hasClass("fa-caret-down")?"expanded":"collapsed");console.log($($(this).next().data("targetuic")))},selectNode:function(n){n.stopImmediatePropagation();MBE.selection.select.apply($(this).data("targetuic"),[n])},addHighlight:function(){var n=$(this);n.data("navitem")&&n.data("navitem").addClass("drop-target")},removeHighlight:function(){var n=$(this);n.data("navitem")&&n.data("navitem").removeClass("drop-target")},unHighlight:function(){MBE.navigator.navBase.find(".drop-target").removeClass("drop-target")},showOptions:function(n){MBE.navigator.selectNode.apply(this,[n]);MBE.options.openDialog.apply($(this).data("targetuic"),[n])},_select:function(){MBE.navigator.navBase.find("b").removeClass("active");var n=$(this);n.is(".mbe-active")&&n.data("navitem").addClass("active")}};MBE.onInit.push(MBE.navigator.init);MBE.selection={onSelect:[],init:function(){$(MBE.workspaceDoc).on("click","[data-uic], body",MBE.selection.select);MBE.DnD.onDOMUpdate.push(MBE.selection._update)},select:function(n){typeof n!="undefined"&&n.stopImmediatePropagation();MBE.workspace.find(".mbe-active").removeClass("mbe-active");$(".mbe-drag-handle",MBE.workspace).remove();MBE.selection.selectElement(this);for(var t=0;t<MBE.selection.onSelect.length;t++)MBE.selection.onSelect[t].apply(this,[])},selectElement:function(n){if(n=$(n),n.is("[data-uic]")&&(n.addClass("mbe-active"),!n.is("[locked]"))){var t=$('<span class="mbe-drag-handle" draggable="true"><\/span>');t.css({top:n.offset().top-4,left:n.offset().left-4});MBE.workspace.append(t)}},_update:function(){var n=$(".mbe-active",MBE.workspace);n.length&&$(".mbe-drag-handle",MBE.workspace).css({top:n.offset().top-4,left:n.offset().left-4})}};MBE.onInit.push(MBE.selection.init);MBE.path={root:null,template:"<li><a><\/a><\/li>",init:function(){var n=MBE.path;n.root=$("#mozaicPageBreadcrumbs");MBE.selection.onSelect.push(MBE.path.update);$(document).on("click","#mozaicPageBreadcrumbs a",n.selectNode)},update:function(){var n=$(this);MBE.path.root.find("li:not(:first-child)").remove();n.is("[data-uic]")&&($(n.parentsUntil("#mozaicPageWorkspace").get().reverse()).each(function(){MBE.path.add(this)}),MBE.path.add(this))},add:function(n){if($(n).is("[data-uic]")){var t=$(MBE.path.template);t.find("a").html(MBE.getComponentName(n)).data("targetuic",n);t.appendTo(MBE.path.root)}},selectNode:function(n){MBE.selection.select.apply($(this).data("targetuic"),[n])}};MBE.onInit.push(MBE.path.init);MBE.options={target:null,targetType:null,targetTemplate:null,init:function(){$(document).on("click",".dialog-options legend",function(){$(".fa",this).toggleClass("fa-caret-down fa-caret-right");$(this).nextAll().toggle()})},openDialog:function(n){var t,o,u,f,i,r,e;if(n.stopImmediatePropagation(),t=MBE.options,t.target=this,o=$(this).data("uic").split(/\|/),t.targetType=o[0],t.targetTemplate=o[1],u=$("<div />"),f=[],typeof MBE.types[t.targetType].options[t.targetTemplate]!="undefined"){i=MBE.types[t.targetType].options[t.targetTemplate];for(r in i)u.append(t.createOptions(i[r])),typeof i[r].onBuild=="function"&&f.push(i[r].onBuild)}if(typeof MBE.types[t.targetType].options.common!="undefined"){i=MBE.types[t.targetType].options.common;for(r in i)u.append(t.createOptions(i[r]))}for(r in t.common)u.append(t.createOptions(t.common[r]));for(u.dialog({appendTo:"body",modal:!0,closeOnEscape:!0,draggable:!1,resizable:!1,width:"70%",title:"Options",dialogClass:"dialog-options",close:function(){$(this).remove()}}),e=0;e<f.length;e++)f[e]()},isAllowed:function(n){if(typeof n.allowFor!="undefined"&&$.inArray(MBE.options.targetTemplate,n.allowFor)==-1)return!1;if(typeof n.disallowFor!="undefined"){if(typeof n.disallowFor=="function")return n.disallowFor.apply(MBE.options.target,[]);if($.inArray(MBE.options.targetTemplate,n.disallowFor)!=-1)return!1}return!0},createCheckBoxList:function(n,t){var i,e,r,f,u;if(!MBE.options.isAllowed(n))return"";i=$('<div class="option-group"'+(n.id?' id="'+n.id+'"':"")+"><\/div>");e=n.set;for(r in n.options){f=$('<input type="checkbox" value="'+r+'"'+(n.get.apply(MBE.options.target,[r,n])?" checked":"")+">");u=$("<label />");f.on("click",function(){e.apply(MBE.options.target,[this]);MBE.selection._update()});u.append(f);u.append(" "+n.options[r]);i.append(u);i.append("<br>")}return t&&i.css("display","none"),i},createSelect:function(n,t){var u;if(!MBE.options.isAllowed(n))return"";var r=$('<div class="option-group form-group"'+(n.id?' id="'+n.id+'"':"")+"><\/div>"),f=n.set,e=$('<label class="control-label col-xs-2">'+n.label+"<\/label>"),i=$('<select class="form-control input-sm"><\/select>');for(u in n.options)i.append('<option value="'+u+'"'+(n.get.apply(MBE.options.target,[u,n])?" selected":"")+">"+n.options[u]+"<\/option>");typeof n.attr!="undefined"&&i.data("attr",n.attr);i.on("change",function(){f.apply(MBE.options.target,[this]);MBE.selection._update()});return r.append(e),r.append(i),i.wrap('<div class="col-xs-10"><\/div>'),t&&r.css("display","none"),r},createText:function(n,t){var u;if(!MBE.options.isAllowed(n))return"";var r=$('<div class="option-group form-group"'+(n.id?' id="'+n.id+'"':"")+"><\/div>"),f=n.set,e=$('<label class="control-label col-xs-2">'+n.label+"<\/label>"),i=$('<input type="'+n.type+'" value="'+n.get(!1,n)+'" class="form-control input-sm">');typeof n.attr!="undefined"&&i.data("attr",n.attr);i.on("change",function(){f.apply(MBE.options.target,[this]);MBE.selection._update()});if(typeof n.change=="function"){u=n.change;i.on("change",function(){u.apply(MBE.options.target,[this])})}return r.append(e),r.append(i),i.wrap('<div class="col-xs-10"><\/div>'),t&&r.css("display","none"),r},createCM:function(n,t){var u;if(!MBE.options.isAllowed(n))return"";var r=$('<div class="option-group form-group"'+(n.id?' id="'+n.id+'"':"")+"><\/div>"),f=n.set,i=$('<textarea class="form-control" rows="15">'+n.get.apply(MBE.options.target,[n])+"<\/textarea>");i.on("change",function(){f.apply(MBE.options.target,[this])});if(typeof n.change=="function"){u=n.change;i.on("change",function(){u.apply(MBE.options.target,[this]);MBE.selection._update()})}return r.append(i),t&&r.css("display","none"),setTimeout(function(){var n=CodeMirror.fromTextArea(i[0],{lineNumbers:!0,lineWrapping:!0,mode:"htmlmixed",autoCloseBrackets:!0,autoCloseTags:!0,matchBrackets:!0,matchTags:!0,extraKeys:{"Ctrl-Space":"autocomplete"}});n.on("blur",function(){n.save();i.change()})},10),r},createIcon:function(n,t){var o,s,a,h,v,y,c,b,k,f,d,l,e,p,i;if(!MBE.options.isAllowed(n))return"";var r=$('<div class="option-group form-group"'+(n.id?' id="'+n.id+'"':"")+"><\/div>"),g=n.set,nt=$('<label class="col-xs-2 control-label">'+n.label+"<\/label>"),w="",u={},tt=document.styleSheets;for(i in n.fontSets){for(o=$('<div class="icon-list col-xs-12 font-set-'+i+'"><\/div>'),s=0;s<tt.length;s++)for(a=document.styleSheets[s].cssRules,h=0;h<a.length;h++)for(v=a[h].selectorText,y=v?v.split(/, ?/):[],c=0;c<y.length;c++)b=y[c],k=new RegExp("^.("+i+"-[^ ]+)::before$"),(m=k.exec(b))&&(f=$('<a href="#"><\/a>'),f.append('<span class="'+i+" "+m[1]+'"><\/span>'),f.append('<span class="icon-name">'+i+" "+m[1]+"<\/span>"),o.append(f),d="."+i+"."+m[1],$(MBE.options.target).is(d)&&(f.addClass("active"),w=i));o.on("click","a",function(){return g.apply(MBE.options.target,[this]),MBE.selection._update(),!1});u[i]=o}l=$('<input type="text" value="" placeholder="Find icon..." class="form-control input-sm">');l.on("input",function(){var n=this.value;n.length?$(".icon-list").find("a").hide().each(function(){$(".icon-name",this).text().indexOf(n)!=-1&&$(this).show()}):$(".icon-list").find("a").show()});e=$('<select class="form-control input-sm"><\/select>');for(i in n.fontSets)p=$("<option><\/option>"),p.val(i).html(n.fontSets[i]).appendTo(e),w==i?(p.attr("selected",!0),u[i].show()):u[i].hide();e.change(function(){$('[class*="font-set-"]').hide();$(".font-set-"+this.value).show()});r.append(nt);r.append(e);r.append(l);r.append('<div class="clearfix"><\/div>');for(i in u)r.append(u[i]);return e.wrap('<div class="col-xs-4"><\/div>'),l.wrap('<div class="col-xs-6"><\/div>'),t&&r.css("display","none"),r},createOptions:function(n){var r=MBE.options,i=typeof n.state!="undefined"&&n.state=="collapsed",t,f,u;if(!MBE.options.isAllowed(n))return"";t=$("<fieldset />");t.append('<legend><span class="fa fa-caret-'+(i?"right":"down")+' fa-fw"><\/span>'+n.name+"<\/legend>");switch(n.type){case"boolean":t.append(r.createCheckBoxList(n,i));break;case"select":t.append(r.createSelect(n,i));break;case"icon":t.append(r.createIcon(n,i));break;case"cm":t.append(r.createCM(n,i));break;case"group":for(f=0;f<n.groupItems.length;f++){u=n.groupItems[f];switch(u.type){case"boolean":t.append(r.createCheckBoxList(u,i));break;case"select":t.append(r.createSelect(u,i));break;case"number":case"text":t.append(r.createText(u,i));break;case"icon":t.append(r.createIcon(u,i));break;case"cm":t.append(r.createCM(u,i));break;case"builder":t.append(u.builder(u,i))}}break;case"builder":t.append(n.builder(n,i))}return t},hasClass:function(n){return $(MBE.options.target).hasClass(n)},is:function(n){return $(MBE.options.target).is(n)},hasAttr:function(n,t){var i=$(MBE.options.target);return n!==!1?t.attr?i.attr(t.attr)==n:i.is("["+n+"]"):i.is("["+t.attr+"]")?i.attr(t.attr):""},setAttr:function(n){var t=$(n).data("attr"),i=$(MBE.options.target);t?(n.value.length?i.attr(t,n.value=="null"?"":n.value):i.removeAttr(t),t=="id"&&MBE.navigator.rebuild()):n.checked?i.attr(n.value,n.value):i.removeAttr(n.value)},hasProp:function(n,t){var i=$(MBE.options.target);return n!==!1?i.is(":"+n):i.is(":"+t.attr)},setProp:function(n){var t=$(n).data("attr"),i=$(MBE.options.target);t?i.prop(t,n.value=="null"?"":n.value):i.prop(n.value,n.checked)},toggleClass:function(n){if(n.tagName.toLowerCase()=="select"){var t=[];if($(n).find("option").each(function(){t.push(this.value)}),$(this).removeClass(t.join(" ")),n.value=="null")return}$(this).toggleClass(n.value);MBE.selection.select.apply(this,[])},toggleTagName:function(n){for(var r,u,t=$("<"+n.value+"><\/"+n.value+">"),f=this.attributes.length,i=0;i<f;i++)r=this.attributes.item(i).nodeName,u=this.attributes.item(i).nodeValue,t[0].setAttribute(r,u);t.html(this.innerHTML);$(this).replaceWith(t);MBE.options.target=t[0];MBE.DnD.updateDOM()},setIcon:function(n){var t=$(this),i=$(".icon-list a.active .icon-name").text(),r=$(".icon-name",n).text();t.removeClass(i).addClass(r);$(".icon-list .active").removeClass("active");$(n).addClass("active")},getCustomClasses:function(){var n=$(MBE.options.target).attr("data-custom-classes");return n?n:""},setCustomClasses:function(n){var t=$(this).attr("data-custom-classes");t&&$(this).removeClass(t);$(this).addClass(n.value).attr("data-custom-classes",n.value)},getCustomAttributes:function(){var f=$(MBE.options.target),t=f.attr("data-custom-attributes"),i,r,n,u,e;if(t&&t.length){for(i=[],r=t.split(/,/g),n=0;n<r.length;n++)u=r[n],e=f.attr(u),i.push(u+"="+e+"");return i.join(";")}return""},setCustomAttributes:function(n){var u=[],r,i,t;if(n.value.length)for(r=n.value.split(/; */g),i=0;i<r.length;i++)t=r[i].split(/=/),$(this).attr(t[0],t.length>1?t[1]:t[0]),u.push(t[0]);$(this).attr("data-custom-attributes",u.join(","))}};MBE.options.common={common:{name:"Common",type:"group",groupItems:[{label:"ID",type:"text",attr:"id",id:"AttrID",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Style",type:"text",attr:"style",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Tab index",type:"number",attr:"tabindex",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Custom classes",type:"text",get:MBE.options.getCustomClasses,set:MBE.options.setCustomClasses},{label:"Custom attributes",type:"text",get:MBE.options.getCustomAttributes,set:MBE.options.setCustomAttributes},{label:"Build properties",type:"text",attr:"data-properties",get:MBE.options.hasAttr,set:MBE.options.setAttr}]},visibility:{name:"Responsive visibility",disallowFor:["input-hidden"],type:"boolean",options:{"visible-xs-block":"visible-xs-block","visible-sm-block":"visible-sm-block","visible-md-block":"visible-md-block","visible-lg-block":"visible-lg-block","visible-xs-inline":"visible-xs-inline","visible-sm-inline":"visible-sm-inline","visible-md-inline":"visible-md-inline","visible-lg-inline":"visible-lg-inline","visible-xs-inline-block":"visible-xs-inline-block","visible-sm-inline-block":"visible-sm-inline-block","visible-md-inline-block":"visible-md-inline-block","visible-lg-inline-block":"visible-lg-inline-block","hidden-xs":"hidden-xs","hidden-sm":"hidden-sm","hidden-md":"hidden-md","hidden-lg":"hidden-lg"},set:MBE.options.toggleClass,get:MBE.options.hasClass,state:"collapsed"},accessibility:{name:"Accessibility",disallowFor:["input-hidden"],type:"boolean",options:{show:"show",hidden:"hidden","sr-only":"sr-only"},set:MBE.options.toggleClass,get:MBE.options.hasClass,state:"collapsed"}};MBE.onInit.push(MBE.options.init);MBE.toolbar={menu:{},toolbar:null,init:function(){MBE.selection.onSelect.push(MBE.toolbar._select);MBE.toolbar.toolbar=$("#mozaicPageContextToolbar .toolbar.pull-left")},_select:function(){var t=MBE.toolbar,i,u,o,r,f,n,e;if((t.clear(),i=$(this).data("uic"),i)&&(i=i.split("|"),u=i[0],o=i[1],typeof t.menu[u]!="undefined"&&typeof t.menu[u][o]!="undefined")&&(r=t.menu[u][o],typeof r.allowFor!="function"||r.allowFor.apply(this,[])))for(f=0;f<r.items.length;f++){n=r.items[f];switch(n.type){case"text":t.toolbar.append('<p class="navbar-text">'+n.label+"<\/p>");break;case"button":e=$('<button type="button" class="btn navbar-btn">'+n.label+"<\/button>");t.toolbar.append(e);e.click({callback:n.callback},function(n){n.data.callback.apply($(".mbe-active",MBE.workspaceDoc)[0],[])});typeof n.allowFor=="function"&&(n.allowFor.apply(this,[])||e.attr("disabled",!0))}}},clear:function(){MBE.toolbar.toolbar.html("")}};MBE.onInit.push(MBE.toolbar.init);MBE.io={allComponents:null,onLoad:[],loadPageList:function(){$("#page-table tbody tr").remove();$("#choose-page-dialog .spinner-2").show();var n=$("#currentAppId").val();$.ajax({type:"GET",url:"/api/mozaic-bootstrap/apps/"+n+"/pages",dataType:"json",error:MBE.ajaxError,success:function(n){var r=$("#page-table tbody"),t;for(i=0;i<n.length;i++)t=$('<tr class="pageRow">'),t.attr({"data-id":n[i].Id,"data-isbootstrap":n[i].IsBootstrap}),t.append('<td width="95%">'+n[i].Name+"<\/td>"),t.append('<td width="5%" align="center">'+(n[i].IsBootstrap?"yes":"no")+"<\/td>"),t.appendTo(r);$("#choose-page-dialog .spinner-2").hide()}})},loadDeletedPageList:function(){$("#trash-page-table tbody tr").remove();$("#trash-page-dialog .spinner-2").show();var n=$("#currentAppId").val();$.ajax({type:"GET",url:"/api/mozaic-bootstrap/apps/"+n+"/deletedPages",dataType:"json",error:MBE.ajaxError,success:function(n){var r=$("#trash-page-table tbody"),t;for(i=0;i<n.length;i++)t=$('<tr class="pageRow"><\/tr>'),t.attr({"data-id":n[i].Id,"data-isbootstrap":n[i].IsBootstrap}),t.append('<td width="95%">'+n[i].Name+"<\/td>"),t.append('<td width="5%" align="center">'+(n[i].IsBootstrap?"yes":"no")+"<\/td>"),t.appendTo(r);$("#trash-page-dialog .spinner-2").hide()}})},loadPage:function(){var n=$("#page-table tr.highlightedRow"),t;n.length?($("#choose-page-dialog").dialog("close"),t=n.attr("data-id"),n.attr("data-isbootstrap")=="true"?MBE.io.loadBootstrapPage(t):MBE.io.loadLegacyPage(t)):alert("Please select a page")},loadDeletedPage:function(){var n=$("#trash-page-table tr.highlightedRow"),t;n.length?($("#trash-page-dialog").dialog("close"),t=n.attr("data-id"),n.attr("data-isbootstrap")=="true"?MBE.io.loadBootstrapPage(t):MBE.io.loadLegacyPage(t)):alert("Please select a page")},reloadPage:function(){$("#currentPageVersion").val()=="Legacy"?MBE.io.loadLegacyPage("current"):MBE.io.loadBootstrapPage("current")},loadLegacyPage:function(n){pageSpinner.show();n=n=="current"?$("#currentPageId").val():n;var t=$("#currentAppId").val(),i="/api/mozaic-editor/apps/"+t+"/pages/"+n;$.ajax({type:"GET",url:i,dataType:"json",complete:function(){pageSpinner.hide()},error:MBE.ajaxError,success:function(n){MBE.io.convert(n)}})},loadBootstrapPage:function(n){pageSpinner.show();n=n=="current"?$("#currentPageId").val():n;var t=$("#currentAppId").val(),i="/api/mozaic-bootstrap/apps/"+t+"/pages/"+n;$.ajax({type:"GET",url:i,dataType:"json",complete:function(){pageSpinner.hide()},error:MBE.ajaxError,success:MBE.io.drawBootstrapPage})},createPage:function(){pageSpinner.show();$("#new-page-dialog").dialog("close");var t=$("#currentAppId").val(),n=$("#new-page-name").val(),i={Name:n,Content:"",IsDeleted:!1,Components:[]};$.ajax({type:"POST",url:"/api/mozaic-bootstrap/apps/"+t+"/pages",data:i,error:MBE.ajaxError,success:function(t){$("#currentPageId").val(t);$("#currentPageVersion").val("Bootstrap");$("#headerPageName").text(n==""?"Nepojmenovaná stránka":n);MBE.saveRequested?MBE.io.doSave():pageSpinner.hide()}})},deletePage:function(){var n=$("#page-table tr.highlightedRow");if(n.length){if(confirm("Are you sure you want to delete this page?")){pageSpinner.show();var i=$("#currentAppId").val(),t=n.attr("data-id"),r=n.attr("data-isbootstrap")=="true"?"mozaic-bootstrap":"mozaic-editor";$.ajax({type:"POST",url:"/api/"+r+"/apps/"+i+"/pages/"+t+"/delete",complete:function(){pageSpinner.hide()},success:function(){alert("OK. Page deleted.");$("#choose-page-dialog").dialog("close");$("#currentPageId").val()==t&&(MBE.clearWorkspace(),$("#headerPageName").html(""),$("#currentPageId").val(""))},error:MBE.ajaxError})}}else alert("Please select a page to delete.")},rename:function(){$("#headerPageName").text($(this).find("#page-name").val());$("#rename-page-dialog").dialog("close");MBE.changedSinceLastSave=!0},savePage:function(){var n=Number($("#currentPageId").val());!n||isNaN(n)?(MBE.saveRequested=!0,MBE.dialogs.newPage()):MBE.io.doSave()},doSave:function(){pageSpinner.show();MBE.saveRequested=!1;var n={Name:$("#headerPageName").text(),Content:MBE.io.getPageDOM(),IsDeleted:!1,Components:MBE.io.getComponentsArray(MBE.workspace.clone(!0))},t=$("#currentAppId").val(),i=$("#currentPageId").val();$.ajax({type:"POST",url:"/api/mozaic-bootstrap/apps/"+t+"/pages/"+i,data:n,complete:function(){pageSpinner.hide()},success:function(){alert("OK")},error:MBE.ajaxError})},getPageDOM:function(){var n=$(MBE.workspace).clone(!0);return n.find(".dataTables_wrapper").each(function(){$(this).replaceWith($("table",this))}),n.html()},getComponentsArray:function(n){var u=[],r,i,t,f;for(n.find(".dataTables_wrapper").each(function(){$(this).replaceWith($("table",this))}),r=n.find("> [data-uic]"),i=0;i<r.length;i++)t=r.eq(i),f={ElmId:t.attr("id")?t.attr("id"):"",Tag:t[0].tagName.toLowerCase(),UIC:t.attr("data-uic"),Attributes:MBE.io.filterAttrs(MBE.io.getAttrs(t[0])),Properties:t.attr("data-properties")?t.attr("data-properties"):"",Content:MBE.io.filterContent(t),ChildComponents:MBE.io.getComponentsArray(t)},u.push(f);return u},drawBootstrapPage:function(n){MBE.clearWorkspace();MBE.workspace.append(n.Content);for(var t=0;t<MBE.io.onLoad.length;t++)MBE.io.onLoad[t]();MBE.DnD.updateDOM();$("#currentPageId").val(n.Id);$("#currentPageVersion").val("Bootstrap");$("#headerPageName").text(n.Name)},convert:function(n){var e,o,s,u,t,r,f,i;if(n.Id){for(MBE.io.allComponents=[],MBE.clearWorkspace(),e=$(MBE.types.containers.templates.container),e.attr("data-uic","containers|container").appendTo(MBE.workspace),o=$(MBE.types.form.templates.form),o.attr("data-uic","form|form").appendTo(e),u=0;u<n.Components.length;u++)MBE.io.convertComponent(o,n.Components[u]);for(s=[],u=0;u<MBE.io.allComponents.length;u++)if(t=MBE.io.allComponents[u],t.item&&t.item.is('[data-uic="form|label"]')){for(r=null,t.PositionX=parseInt(t.PositionX),t.PositionY=parseInt(t.PositionY),t.Width=parseInt(t.Width),f=0;f<MBE.io.allComponents.length;f++)i=MBE.io.allComponents[f],i.item.is("input:not([type=radio],[type=checkbox]), textarea, select, .form-control-static")&&$.inArray(i.Id,s)===-1&&(i.PositionX=parseInt(i.PositionX),i.PositionY=parseInt(i.PositionY),t.PositionY+5>=i.PositionY&&t.PositionY-5<=i.PositionY&&(r==null?i.PositionX>t.PositionX+t.Width&&(r=i):i.PositionX<r.PositionX&&i.PositionX>t.PositionX+t.Width&&(r=i)));r!=null&&(t.item.next().append(r.item),t.item.attr("for",r.Name),s.push(r.Id))}$("#currentPageId").val(n.Id);$("#currentPageVersion").val("Legacy");$("#headerPageName").text(n.Name);MBE.DnD.updateDOM()}},convertDiv:function(n,t){var r,u;if(t.Classes.indexOf("panel-component")!==-1&&(n.item=$(MBE.types.containers.templates.panel),n.item.find(".panel-body").html("").end().find(".panel-footer").remove().end().attr("data-uic","containers|panel"),t.Name&&n.item.attr("id",t.Name),t.Classes.indexOf("named-panel")===-1?n.item.find(".panel-heading").remove():n.item.find(".panel-title").html(t.Label),n.newTarget=n.item.find(".panel-body")),t.Classes.indexOf("control-label")!==-1&&(t.Label=="{var1}"?(n.item=$(MBE.types.form.templates["static-control"]),n.item.html(t.Label).attr("data-uic","form|static-control")):(n.item=$(MBE.types.form.templates.label),n.item.html(t.Label).attr("data-uic","form|label").addClass("col-sm-2"),n.item.wrap('<div class="form-group" data-uic="form|form-group"><\/div>'),n.item.after('<div class="col-sm-10" data-uic="grid|column"><\/div>'))),t.Classes.indexOf("form-heading")!==-1&&(n.item=$('<h2 data-uic="text|heading">'+t.Label+"<\/h2>")),t.Classes.indexOf("checkbox-control")!==-1&&(n.item=$(MBE.types.form.templates.checkbox),n.item.attr({name:t.Name,"data-uic":"form|checkbox"}),n.item.wrap('<label for="'+t.Name+'" data-uic="form|label"><\/label>'),n.item.parent().append(" "+t.Label),n.item.parent().wrap('<div class="checkbox" data-uic="form|checkbox-group"><\/div>'),n.item.parent().parent().wrap('<div class="col-sm-10 col-sm-push-2" data-uic="grid|column"><\/div>'),n.item.parent().parent().parent().wrap('<div class="form-group" data-uic="form|form-group"><\/div>')),t.Classes.indexOf("radio-control")!==-1&&(n.item=$(MBE.types.form.templates.radio),n.item.attr({name:t.Name,"data-uic":"form|radio"}),n.item.wrap('<label for="'+t.Name+'" data-uic="form|label"><\/label>'),n.item.parent().append(" "+t.Label),n.item.parent().wrap('<div class="radio" data-uic="form|radio-group"><\/div>'),n.item.parent().parent().wrap('<div class="col-sm-10 col-sm-push-2" data-uic="grid|column"><\/div>'),n.item.parent().parent().parent().wrap('<div class="form-group" data-uic="form|form-group"><\/div>')),t.Classes.indexOf("info-container")!==-1&&(n.item=$(MBE.types.containers.templates.div),n.item.attr("data-uic","containers|div"),n.item.append('<div class="info-container-header" data-uic="containers|div"><span class="fa fa-info-circle" data-uic="image|icon"><\/span>'+t.Label+"<\/div>"),n.item.append('<div class="info-container-body" data-uic="containers|div">'+t.Content+"<\/div>")),t.Classes.indexOf("breadcrumb-navigation")!==-1){n.item=$(MBE.types.misc.templates.breadcrumbs);n.item.attr("data-uic","misc|breadcrumbs");var i=$(MBE.types.misc.templates["breadcrumbs-item"]),f=$(MBE.types.misc.templates["breadcrumbs-active"]),o=$(MBE.types.misc.templates["breadcrumbs-inactive"]),e=i.clone();e.append(f.clone());e.find("> span").addClass("fa fa-question app-icon").end().appendTo(n.item);r=i.clone();r.append(o.clone());r.find("> a").html("APP NAME").end().appendTo(n.item);u=i.clone();u.append(f.clone());u.find("> span").html("Nav").end().appendTo(n.item)}t.Classes.indexOf("countdown-component")!==-1&&(n.item=$(MBE.types.ui.templates.countdown));t.Classes.indexOf("wizard-phases")!==-1&&(n.item=$(MBE.types.ui.templates.wizzard),n.item.attr({"data-phases":t.Content,"data-activephase":MBE.io.getProperty("ActivePhase",t.Properties)}),n.afterAppend=MBE.types.ui.buildWizzard)},convertSelect:function(n,t){if(n.item=$(MBE.types.form.templates.select),n.item.attr({"data-uic":"form|select",name:t.Name}),t.Classes.indexOf("multiple-select")!==-1&&n.item.attr("multiple","multiple"),t.Properties&&t.Properties.indexOf("defaultoption")!==-1){var i=MBE.io.getProperty("defaultoption",t.Properties);n.item.append('<option value="">'+i+"<\/option>")}},convertInput:function(n,t){t.Classes.indexOf("input-single-line")!==-1&&(n.item=$(MBE.types.form.templates["input-text"]),n.item.attr("data-uic","form|input-text"));t.Classes.indexOf("button-browse")!==-1&&(n.item=$(MBE.types.form.templates["input-file"]),n.item.attr("data-uic","form|input-file"));t.Classes.indexOf("color-picker")!==-1&&(n.item=$(MBE.types.form.templates["input-color"]),n.item.attr({name:t.Name,"data-uic":"form|input-color"}));n.item.attr({name:t.Name})},convertTextArea:function(n,t){n.item=$(MBE.types.form.templates.textarea);n.item.attr({"data-uic":"form|textarea",name:t.Name,rows:5})},convertButton:function(n,t){n.item=$(MBE.types.controls.templates.button);n.item.attr({"data-uic":"controls|button",type:"submit",name:t.Name}).html(t.Label).addClass("btn-primary");t.Classes.indexOf("button-large")!==-1&&n.item.addClass("btn-lg");t.Classes.indexOf("button-small")!==-1&&n.item.addClass("btn-sm");t.Classes.indexOf("button-extra-small")!==-1&&n.item.addClass("btn-xs");t.Classes.indexOf("button-dropdown")!==-1&&(n.item.addClass("dropdown-toggle").append(' <span class="caret"><\/span>'),n.item.wrap('<div class="btn-group" data-uic="controls|button-dropdown"><\/div>'),n.item.parent().append('<ul class="dropdown-menu" data-uic="controls|dropdown-menu" locked><\/ul>'))},convertTable:function(n,t){var r,f,u,i;if(t.Classes.indexOf("data-table")!==-1&&(n.item=$(MBE.types.ui.templates["data-table"]),n.afterAppend=MBE.types.ui.buildDataTable,n.item.attr("data-uic","ui|data-table"),t.Classes.indexOf("data-table-simple-mode")!==-1&&n.item.attr({"data-dtpaging":"0","data-dtinfo":"0","data-dtfilter":"0","data-dtordering":"0"}),t.Classes.indexOf("data-table-with-actions")!==-1)){for(r=MBE.io.getProperty("actions",t.Properties),r=r&&r.length>0?r.split(/-/):["edit","detail","delete"],f=[],u=0;u<r.length;u++){i=null;switch(r[u]){case"edit":i={icon:"fa fa-edit",action:"edit",title:"upravit"};break;case"details":i={icon:"fa fa-search",action:"details",title:"detail"};break;case"delete":i={icon:"fa fa-remove",action:"delete",title:"smazat"};break;case"download":i={icon:"fa fa-download",action:"download",title:"stáhnout"};break;case"enter":i={icon:"fa fa-sign-in",action:"enter",title:"vstoupit"}}i!==null&&f.push(i)}n.item.attr("data-actions",JSON.stringify(f).replace(/"/g,"'"))}t.Classes.indexOf("name-value-list")!==-1&&(n.item=$(MBE.types.ui.templates["nv-list"]),n.afterAppend=MBE.types.ui.buildNVList)},convertUL:function(n,t){if(t.Classes.indexOf("tab-navigation")!==-1){var i=t.Content.split(";");i.unshift('<span class="fa fa-home" data-uic="image|icon"><\/span>');n.item=$(MBE.types.containers.templates.tabs);n.item.attr("data-uic","containers|tabs");MBE.types.containers.buildTabs.apply(n.item[0],i)}},convertComponent:function(n,t){var u=MBE.io,r={item:null,newTarget:null,afterAppend:null},i,h,y,e,c,l,o,a,v,f,s;switch(t.Tag.toLowerCase()){case"div":u.convertDiv(r,t);break;case"select":u.convertSelect(r,t);break;case"input":u.convertInput(r,t);break;case"textarea":u.convertTextArea(r,t);break;case"button":u.convertButton(r,t);break;case"table":u.convertTable(r,t);break;case"ul":u.convertUL(r,t)}if(i=r.item,h=r.newTarget,i){if(y=new RegExp("("+["panel-component","named-panel","control-label","dropdown-select","input-single-line","button-browse","input-multiline","uic","button-simple","button-large","button-small","button-extra-small","data-table"].join("( |$))|(")+"( |$))","g"),e=t.Classes.replace(y,""),e=e.replace(/ {2,}/," ").replace(/(^ )|( $)/g,""),e.length&&i.attr("data-custom-classes",e).addClass(e),t.Placeholder&&i.attr("placeholder",t.Placeholder),t.TabIndex&&i.attr("tabindex",t.TabIndex),t.Attributes){for(c=[],l=$("<span "+t.Attributes+"><\/span>")[0],f=0;f<l.attributes.length;f++)o=l.attributes[f],c.push(o.name),i.attr(o.name,o.value);i.attr("data-custom-attributes",c.join(","))}if(t.Properties){for(a=t.Properties.split(/; */g),v=[],f=0;f<a.length;f++)(s=a[f].split(/=/),s[0]!="defaultoption")&&v.push(s[0]+"="+s[1]);i.attr("data-properties",v.join(";"))}i.attr("id",t.Name);i.parents(".form-group").length?i.parents(".form-group").appendTo(n):i.parents(".btn-group").length?i.parents(".btn-group").appendTo(n):i.appendTo(n);typeof r.afterAppend=="function"&&r.afterAppend.apply(i[0],[])}if(t.ChildComponents)for(j=0;j<t.ChildComponents.length;j++)u.convertComponent(h?h:i,t.ChildComponents[j]);t.item=i;u.allComponents.push(t)},getProperty:function(n,t){for(var r,u=t?t.split(/; */g):[],i=0;i<u.length;i++)if(r=u[i].split(/=/),r[0]==n)return r[1];return""},getAttrs:function(n){return[].slice.call(n.attributes).map(function(n){return{name:n.name,value:n.value}})},filterAttrs:function(n){for(var i=[],t=0;t<n.length;t++)$.inArray(n[t].name,["data-uic","data-custom-classes","data-custom-attributes","data-properties","locked"])==-1&&i.push(n[t]);return JSON.stringify(i)},filterContent:function(n){var t=n.clone(!0),i;return t.find("span.mbe-text-node").each(function(){$(this).replaceWith(this.innerHTML)}),i=1,t.find("> [data-uic]").each(function(){$(this).replaceWith("__UIC_"+i+"__");i++}),t.html()}};MBE.history={undoStack:[],redoStack:[],btnUndo:null,btnRedo:null,init:function(){var n=MBE.history;n.btnUndo=$('[data-action="undo"]');n.btnRedo=$('[data-action="redo"]');MBE.DnD.onBeforeDrop.push(n._beforeAction);MBE.onBeforeDelete["*"].push(n._beforeAction);$(document).on("click",'[data-action="undo"]',n.undo).on("click",'[data-action="redo"]',n.redo);n.setButtonState()},_beforeAction:function(){var n=MBE.history;n.redoStack=[];n.undoStack.unshift(n.getCurrentDOM());n.undoStack.length>20&&delete n.undoStack[20];n.setButtonState()},getCurrentDOM:function(){var n=MBE.workspace.clone(!0);return n.find("#drop-placeholder").remove().end().find(".drag-over").removeClass("drag-over"),n.contents()},setButtonState:function(){var n=MBE.history;n.btnUndo.attr("disabled",n.undoStack.length==0);n.btnRedo.attr("disabled",n.redoStack.length==0)},undo:function(){var n=MBE.history,t=n.undoStack.shift();n.redoStack.unshift(n.getCurrentDOM());MBE.workspace.html("");MBE.workspace.append(t);MBE.DnD.updateDOM();n.setButtonState()},redo:function(){var n=MBE.history,t=n.redoStack.shift();n.undoStack.unshift(n.getCurrentDOM());MBE.workspace.html("");MBE.workspace.append(t);MBE.DnD.updateDOM();n.setButtonState()}};MBE.onInit.push(MBE.history.init);MBE.dialogs={choosePage:function(){$("#choose-page-dialog").dialog({autoOpen:!0,width:700,height:540,buttons:{Open:MBE.io.loadPage,Delete:MBE.io.deletePage,Cancel:MBE.dialogs.close},open:MBE.io.loadPageList})},trash:function(){$("#trash-page-dialog").dialog({autoOpen:!0,width:700,height:540,buttons:{Load:MBE.io.loadDeletedPage,Cancel:MBE.dialogs.close},open:MBE.io.loadDeletedPageList})},newPage:function(){$("#new-page-dialog").dialog({autoOpen:!0,width:400,height:170,buttons:{Save:MBE.io.createPage,Cancel:MBE.dialogs.close},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return MBE.io.createPage,!1})},open:function(){$("#new-page-name").val("")}})},rename:function(){$("#rename-page-dialog").dialog({autoOpen:!0,width:400,height:190,buttons:{Save:MBE.io.rename,Cancel:MBE.dialogs.close},create:function(){$(this).keypress(function(n){if(n.keyCode==$.ui.keyCode.ENTER)return MBE.io.rename.apply(document.getElementById("rename-page-dialog"),[]),!1})},open:function(){$(this).find("#page-name").val($("#headerPageName").text())}})},close:function(){$(this).dialog("close")}};MBE.types.containers={templates:{container:'<div class="container"><\/div>',panel:'<div class="panel panel-default"><div class="panel-heading" data-uic="containers|panel-heading" locked><h3 class="panel-title" data-uic="text|heading">Panel title<\/h3><\/div><div class="panel-body" data-uic="containers|panel-body" locked><p data-uic="text|paragraph">Panel body<\/p><\/div><div class="panel-footer" data-uic="containers|panel-footer" locked><span data-uic="text|span">Panel footer<\/span><\/div><\/div>',"panel-heading":'<div class="panel-heading" data-uic="containers|panel-heading" locked><span data-uic="text|span">Panel heading<\/span><\/div>',"panel-body":'<div class="panel-body" data-uic="containers|panel-body" locked><p data-uic="text|paragraph">Panel body<\/p><\/div>',"panel-footer":'<div class="panel-footer" data-uic="containers|panel-footer" locked><span data-uic="text|span">Panel footer<\/span><\/div>',tabs:"<div><\/div>",tab:'<li data-uic="containers|tab"><a href="" data-uic="controls|link" data-toggle="tab" locked><\/a><\/li>',"tab-items":'<ul class="nav nav-tabs" data-uic="containers|tab-items" locked><\/ul>',"tab-content":'<div class="tab-content" data-uic="containers|tab-content" locked><\/div>',"tab-pane":'<div class="tab-pane" data-uic="containers|tab-pane"><p data-uic="text|paragraph">Tab content<\/p><\/div>',accordion:'<div class="panel-group"><\/div>',well:'<div class="well"><span data-uic="text|span">Text of the well<\/span><\/div>',list:'<ul><li data-uic="containers|list-item">Item 1<\/li><li data-uic="containers|list-item">Item 2<\/li><\/ul>',"list-item":'<li data-uic="containers|list-item">Item<\/li>',div:"<div><\/div>","list-group":'<ul class="list-group"><\/ul>',"list-group-div":'<div class="list-group"><\/div>',"list-group-item":'<li class="list-group-item" data-uic="containers|list-group-item">List Group Item<\/li>',"list-group-item-link":'<a class="list-group-item" data-uic="containers|list-group-item-link">List Group Item<\/a>',"list-group-item-button":'<button type="button" class="list-group-item" data-uic="containers|list-group-item-button">List Group Item<\/button>'},options:{container:{containerOptions:{name:"Container options",type:"boolean",options:{"container-fluid":"Fluid"},set:function(){$(this).toggleClass("container container-fluid")},get:MBE.options.hasClass}},panel:{panelOptions:{name:"Panel options",type:"group",groupItems:[{label:"Style",type:"select",options:{"panel-default":"Default","panel-primary":"Primary","panel-success":"Success","panel-info":"Info","panel-warning":"Warning","panel-danger":"Danger"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"Show",type:"boolean",options:{"panel-heading":"Show panel heading","panel-body":"Show panel body","panel-footer":"Show panel footer"},get:function(n){return $("> ."+n,this).length>0},set:function(n){if(n.checked)switch(n.value){case"panel-heading":$(this).prepend(MBE.types.containers.templates["panel-heading"]);break;case"panel-footer":$(this).append(MBE.types.containers.templates["panel-footer"]);break;case"panel-body":$("> .panel-heading",this).length?$("> .panel-heading",this).after(MBE.types.containers.templates["panel-body"]):$(this).prepend(MBE.types.containers.templates["panel-body"])}else $("> ."+n.value,this).remove();MBE.DnD.updateDOM()}}]}},"tab-items":{tabItemsOptions:{name:"Tab items options",type:"group",groupItems:[{label:"Justified",type:"boolean",options:{"nav-justified":"Justified"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},"tab-content":{tabContentOptions:{name:"Tab content options",type:"group",groupItems:[{label:"Fade",type:"boolean",options:{fade:"Fade"},get:function(){return $("> .fade",MBE.options.target).length},set:function(n){n.checked?$("> .tab-pane",this).addClass("fade").filter(".active").addClass("in"):$("> .tab-pane",this).removeClass("fade in")}}]}},well:{wellOptions:{name:"Well options",type:"group",groupItems:[{label:"Size",type:"select",options:{"null":"Default","well-lg":"Large","well-sm":"Small"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},list:{listOptions:{name:"List options",type:"group",groupItems:[{id:"ListStyle",label:"Style",type:"select",options:{ul:"Unordered (UL)",ol:"Ordered (OL)","ul.list-unstyled":"Unstyled (UL)","ul.list-inline":"Inline (UL)"},get:MBE.options.is,set:function(n){var t=n.value.split("."),i=t[0],r=t.length>1?t[1]:"";$(this).removeClass().addClass(r);$(this).is(i)||MBE.options.toggleTagName.apply(this,[{value:i}]);n.value=="ol"?$("#ListNumberingType, #ListNumberingStart, #ListNumberingReversed").show():($("#ListNumberingType, #ListNumberingStart, #ListNumberingReversed").hide(),$(this).removeAttr("type start reversed"))}},{id:"ListNumberingType",label:"Numbering type",type:"select",options:{"1":"Number (1, 2, 3)",a:"Letters (a, b, c)",A:"Letters (A, B, C)",i:"Roman (i, ii, iii)",I:"Roman (I, II, III)"},attr:"type",get:MBE.options.hasAttr,set:MBE.options.setAttr},{id:"ListNumberingStart",label:"Start",type:"number",attr:"start",get:MBE.options.hasAttr,set:MBE.options.setAttr},{id:"ListNumberingReversed",label:"Reversed",type:"boolean",attr:"reversed",options:{reversed:"Reversed"},get:MBE.options.hasAttr,set:MBE.options.setAttr}],onBuild:function(){var n=$("#ListStyle select");$("#ListNumberingType, #ListNumberingStart, #ListNumberingReversed").toggle(n.val()=="ol")}}},"list-group":{listGroupOptions:{name:"List group options",type:"group",groupItems:[{label:"Type",type:"select",options:{ul:"Unordered list","div-links":"DIV with links","div-buttons":"DIV with buttons"},get:function(n){switch(n){case"ul":return $(this).is("ul");case"div-links":return $(this).is("div")&&$(this).find("> a").length>0;case"div-buttons":return $(this).is("div")&&$(this).find("> button").length>0}},set:function(n){var u=MBE.types.containers,f=$(this),i,r,t;switch(n.value){case"ul":i="list-group";r="list-group-item";break;case"div-links":i="list-group-div";r="list-group-item-link";break;case"div-buttons":i="list-group-div";r="list-group-item-button"}t=$(u.templates[i]);f.find("> a, > button, > li").each(function(){var n=$(u.templates[r]);n.html(this.innerHTML).addClass(this.className).appendTo(t)});t.attr("data-uic","containers|"+i);f.replaceWith(t);MBE.DnD.updateDOM();MBE.selection.select.apply(t[0],[]);MBE.options.target=t[0]}}]}},"list-group-item":{listGroupItemOptions:{name:"List group item options",type:"group",groupItems:[{label:"Style",type:"select",options:{"null":"Default","list-group-item-success":"Success","list-group-item-info":"Info","list-group-item-warning":"Warning","list-group-item-danger":"Danger"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"URL",type:"text",attr:"href",get:MBE.options.hasAttr,set:MBE.options.setAttr,allowFor:["list-group-item-link"]},{label:"Target",type:"select",options:{"null":"Default",_blank:"Blank",_parent:"Parent",_top:"Top"},attr:"target",get:MBE.options.hasAttr,set:MBE.options.setAttr,allowFor:["list-group-item-link"]},{label:"Options",type:"boolean",options:{active:"Active",disabled:"Disabled"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}}},init:function(){var n=MBE.types.containers,t=MBE.toolbar.menu;MBE.DnD.onDrop.push(MBE.types.containers._drop);MBE.types.controls.options.link.linkOptions.groupItems[0].change=n.tabIdChange;n.options.panel.panelOptions.groupItems[1].disallowFor=n.panelIsNotInAccordion;n.options["list-group-div"]=n.options["list-group"];n.options["list-group-item-link"]=n.options["list-group-item"];n.options["list-group-item-button"]=n.options["list-group-item"];t.containers={};t.containers.list={items:[{type:"text",label:"ADD TO LIST"},{type:"button",label:"BEGIN",callback:n.listAddToBegin},{type:"button",label:"END",callback:n.listAddToEnd},]};t.containers["list-item"]={items:[{type:"text",label:"ADD TO LIST"},{type:"button",label:"BEFORE",callback:n.listItemAddBefore},{type:"button",label:"AFTER",callback:n.listItemAddAfter},{type:"button",label:"BEGIN",callback:n.listAddToBegin},{type:"button",label:"END",callback:n.listAddToEnd},{type:"text",label:"ITEM"},{type:"button",label:"DELETE",callback:n.listItemDelete}]};t.containers["tab-items"]={items:[{type:"text",label:"ADD TAB"},{type:"button",label:"BEGIN",callback:n.tabAddToBegin},{type:"button",label:"END",callback:n.tabAddToEnd},]};t.containers.tab={items:[{type:"text",label:"TAB"},{type:"button",label:"SHOW",callback:n.tabShow},{type:"text",label:"ADD TAB"},{type:"button",label:"BEGIN",callback:n.tabAddToBegin},{type:"button",label:"END",callback:n.tabAddToEnd},{type:"button",label:"LEFT",callback:n.tabAddToLeft},{type:"button",label:"RIGHT",callback:n.tabAddToRight},]};t.containers.accordion={items:[{type:"text",label:"ADD ITEM"},{type:"button",label:"BEGIN",callback:n.accordionAddToBegin},{type:"button",label:"END",callback:n.accordionAddToEnd}]};t.containers.panel={allowFor:n.panelIsInAccordion,items:[{type:"text",label:"ADD ITEM"},{type:"button",label:"BEGIN",callback:n.accordionAddToBegin},{type:"button",label:"END",callback:n.accordionAddToEnd},{type:"button",label:"BEFORE",callback:n.accordionAddBefore},{type:"button",label:"AFTER",callback:n.accordionAddAfter},]};t.containers["list-group"]={items:[{type:"text",label:"ADD ITEM"},{type:"button",label:"BEFORE",callback:n.listGroupAddBefore,allowFor:n.listGroupIsItemSelected},{type:"button",label:"AFTER",callback:n.listGroupAddAfter,allowFor:n.listGroupIsItemSelected},{type:"button",label:"BEGIN",callback:n.listGroupAddToBegin},{type:"button",label:"END",callback:n.listGroupAddToEnd},{type:"text",label:"ITEM"},{type:"button",label:"ACTIVATE",callback:n.listGroupActivateItem,allowFor:n.listGroupIsInactiveItemSelected},{type:"button",label:"DEACTIVATE",callback:n.listGroupDeactivateItem,allowFor:n.listGroupIsActiveItemSelected},{type:"button",label:"DELETE",callback:n.listGroupDeleteItem,allowFor:n.listGroupIsItemSelected},]};t.containers["list-group-div"]=t.containers["list-group"];t.containers["list-group-item"]=t.containers["list-group"];t.containers["list-group-item-link"]=t.containers["list-group"];t.containers["list-group-item-button"]=t.containers["list-group"];MBE.onBeforeDelete["containers|tab"]=n._tabDelete},_drop:function(n){n.is(".panel-heading")&&$(this).is('[data-uic="text|heading"]')&&$(this).addClass("panel-title");$(this).is('[data-uic="containers|tabs"]')&&$(this).is(":empty")&&MBE.types.containers.buildTabs.apply(this,[]);$(this).is('[data-uic="containers|accordion"]')&&$(this).is(":empty")&&MBE.types.containers.buildAccordion.apply(this,[]);$(this).is(".list-group")&&$(this).is(":empty")&&MBE.types.containers.buildListGroup.apply(this,[])},buildListGroup:function(){for(var t,n=1;n<=3;n++)t=$(MBE.types.containers.templates["list-group-item"]),t.html("List Group Item "+n).appendTo(this)},listGroupIsItemSelected:function(){return console.log(this),$(this).is(".list-group-item")},listGroupIsActiveItemSelected:function(){return $(this).is(".list-group-item.active")},listGroupIsInactiveItemSelected:function(){return $(this).is(".list-group-item:not(.active)")},listGroupActivateItem:function(){$(this).addClass("active");MBE.selection.select.apply(this,[])},listGroupDeactivateItem:function(){$(this).removeClass("active");MBE.selection.select.apply(this,[])},listGroupDeleteItem:function(){$(this).remove();$(".mbe-drag-handle",MBE.workspaceDoc).remove();MBE.DnD.updateDOM();MBE.selection.select.apply(MBE.workspaceDoc.body,[])},listGroupAdd:function(n){var r=MBE.types.containers,t=$(r.templates["list-group-item"]),i=n=="before"||n=="after"?$(this):$(this).is(".list-group")?$(this):$(this).parent();switch(n){case"before":i.before(t);break;case"after":i.after(t);break;case"begin":i.prepend(t);break;case"end":i.append(t)}MBE.DnD.updateDOM()},listGroupAddAfter:function(){MBE.types.containers.listGroupAdd.apply(this,["after"])},listGroupAddBefore:function(){MBE.types.containers.listGroupAdd.apply(this,["before"])},listGroupAddToBegin:function(){MBE.types.containers.listGroupAdd.apply(this,["begin"])},listGroupAddToEnd:function(){MBE.types.containers.listGroupAdd.apply(this,["end"])},listItemAddBefore:function(){$(this).before($(MBE.types.containers.templates["list-item"]));MBE.DnD.updateDOM()},listItemAddAfter:function(){$(this).after($(MBE.types.containers.templates["list-item"]));MBE.DnD.updateDOM()},listItemDelete:function(){$(this).remove();MBE.DnD.updateDOM()},listAddToBegin:function(){var n=$(this).is("li")?$(this).parent():$(this);n.prepend($(MBE.types.containers.templates["list-item"]));MBE.DnD.updateDOM()},listAddToEnd:function(){var n=$(this).is("li")?$(this).parent():$(this);n.append($(MBE.types.containers.templates["list-item"]));MBE.DnD.updateDOM()},tabShow:function(){var n=$(this).siblings("li");n.each(function(){var n=$("a",this);$(n.attr("href")).removeClass("active");$(this).removeClass("active")});$(this).addClass("active");$($("a",this).attr("href")).addClass("active")},tabIdChange:function(){var n=$(this),i,t;n.parent().is('[data-uic="containers|tab"]')&&(i=n.data("prevId"),t=n.attr("href").replace("#",""),$("#"+i).attr("id",t),n.data("prevId",t),MBE.DnD.updateDOM())},tabAdd:function(n){var e=MBE.types.containers,o=$('[data-toggle="tab"]',MBE.workspace).length+1,r=$(this).is("li")?$(this):null,u=$(this).is(".nav-tabs")?$(this):$(this).parent(),s=u.next(),t=$(e.templates.tab),i=$(e.templates["tab-pane"]),f="tab-"+o;i.attr("id",f);t.find("a").attr("href","#"+f).data("prevId",f).html("Tab "+o);switch(n){case"begin":u.prepend(t);s.prepend(i);break;case"end":u.append(t);s.append(i);break;case"left":r.before(t);$(r.find("a").attr("href")).before(i);break;case"right":r.after(t);$(r.find("a").attr("href")).after(i)}MBE.DnD.updateDOM()},tabAddToLeft:function(){MBE.types.containers.tabAdd.apply(this,["left"])},tabAddToRight:function(){MBE.types.containers.tabAdd.apply(this,["right"])},tabAddToBegin:function(){MBE.types.containers.tabAdd.apply(this,["begin"])},tabAddToEnd:function(){MBE.types.containers.tabAdd.apply(this,["end"])},buildTabs:function(n){var r=MBE.types.containers,o=$(this),s=$(r.templates["tab-items"]),h=$(r.templates["tab-content"]),u=$('[data-toggle="tab"]',MBE.workspace).length+1,e=typeof n=="array"?n:["First tab","Second tab","Third tab"],t,f,i;for(o.append(s),o.append(h),t=0;t<e.length;t++)f=$(r.templates.tab),i=$(r.templates["tab-pane"]),f.find("a").attr("href","#tab-"+u).html(e[t]).data("prevId","tab-"+u),i.find("p").html(e[t]+" content"),i.attr("id","tab-"+u),t==0&&(f.addClass("active"),i.addClass("active")),s.append(f),h.append(i),u++},_tabDelete:function(){var n=$("a",this).attr("href");$(n).remove()},buildAccordion:function(){var f=MBE.types.containers,r=$(this),e=MBE.workspace.find(".panel-group").length,i="accordion-"+e,t,n,u;for(r.attr("id",i),t=1;t<=3;t++)n=$(f.templates.panel),n.attr("data-uic","containers|panel"),n.find(".panel-title").attr("locked","true").html("").append($(MBE.types.controls.templates.link)),n.find(".panel-title a").html("Accordion item").attr({locked:!0,"data-uic":"controls|link","data-toggle":"collapse","data-parent":"#"+i,href:"#"+i+" .item-"+t}),u=$('<div class="panel-collapse collapse item-'+t+(t==1?" in":"")+'"><\/div>'),n.find(".panel-body p").html("Item body.").parent().wrap(u),n.find(".panel-footer").remove(),r.append(n)},accordionAddItem:function(n){var o=MBE.types.containers,i=$(this).is(".panel-group")?$(this):$(this).parent(),r=$(this).is(".panel-group")?null:$(this),u=i.attr("id"),f=i.find(".panel-collapse").length+1,t=$(o.templates.panel),e;t.attr("data-uic","containers|panel");t.find(".panel-title").attr("locked","true").html("").append($(MBE.types.controls.templates.link));t.find(".panel-title a").html("Accordion item").attr({locked:!0,"data-uic":"controls|link","data-toggle":"collapse","data-parent":"#"+u,href:"#"+u+" .item-"+f});e=$('<div class="panel-collapse collapse item-'+f+'"><\/div>');t.find(".panel-body p").html("Item body.").parent().wrap(e);t.find(".panel-footer").remove();switch(n){case"begin":i.prepend(t);break;case"end":i.append(t);break;case"before":r.before(t);break;case"after":r.after(t)}MBE.DnD.updateDOM()},accordionAddToBegin:function(){MBE.types.containers.accordionAddItem.apply(this,["begin"])},accordionAddToEnd:function(){MBE.types.containers.accordionAddItem.apply(this,["end"])},accordionAddBefore:function(){MBE.types.containers.accordionAddItem.apply(this,["before"])},accordionAddAfter:function(){MBE.types.containers.accordionAddItem.apply(this,["after"])},panelIsNotInAccordion:function(){return $(this).parent().hasClass("panel-group")?!1:!0},panelIsInAccordion:function(){return $(this).parent().hasClass("panel-group")?!0:!1}};MBE.onInit.push(MBE.types.containers.init);MBE.types.text={templates:{heading:"<h1>Heading<\/h1>",paragraph:"<p>Paragraph<\/p>",alert:'<div class="alert alert-success">Alert text<\/div>',blockquote:'<blockquote><p data-uic="text|paragraph">Lorem ipsum dolor sit amet...<\/p><footer data-uic="page|footer">Someone famous in <cite title="Source Title">Source Title<\/cite><\/footer><\/blockquote>',small:"<small>Text<\/small>",strong:"<strong>Bold<\/strong>",italic:"<em>Italic<\/em>",span:"<span>Text<\/span>"},options:{heading:{headingOptions:{name:"Heading options",type:"select",label:"Type",options:{h1:"H1",h2:"H2",h3:"H3",h4:"H4",h5:"H5",h6:"H6"},set:MBE.options.toggleTagName,get:MBE.options.is}},paragraph:{paragraphOptions:{name:"Paragraph options",type:"boolean",options:{lead:"Lead"},set:MBE.options.toggleClass,get:MBE.options.hasClass}},alert:{alertOptions:{name:"Alert options",type:"group",groupItems:[{type:"select",label:"Style",options:{"alert-success":"Success","alert-info":"Info","alert-warning":"Warning","alert-danger":"Danger"},set:MBE.options.toggleClass,get:MBE.options.hasClass},{type:"boolean",options:{"alert-dismissible":"Dismissable"},set:function(n){var t=$(this);t.hasClass(n.value)?(t.removeClass(n.value),t.find(".close").remove()):(t.addClass(n.value),t.append('<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button>'))},get:MBE.options.hasClass}]}},blockquote:{blockquoteOptions:{name:"Blockquote options",type:"group",groupItems:[{type:"select",label:"Type",options:{"null":"Normal","blockquote-reverse":"Reverse"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{type:"boolean",label:"Show footer",options:{"show-footer":"Show footer"},get:function(){return $(this).find("footer").length>0},set:function(n){$(n).is(":checked")?$(this).append('<footer data-uic="page|footer">Some famous in <cite>Source Title<\/cite><\/footer>'):$(this).find("footer").remove();MBE.DnD.updateDOM()}}]}},strong:{strongOptions:{name:"Bold options",type:"group",groupItems:[{label:"Tag",type:"select",options:{strong:"Strong",b:"B"},get:MBE.options.is,set:MBE.options.toggleTagName}]}},italic:{italicOptions:{name:"Italic options",type:"group",groupItems:[{label:"Tag",type:"select",options:{em:"Em",i:"I"},get:MBE.options.is,set:MBE.options.toggleTagName}]}},common:{textOptions:{name:"Text options",type:"group",allowFor:["heading","paragraph","alert","small","strong","italic","span","link","help-text","caption","th","td","breadcrumbs-active","breadcrumbs-inactive"],groupItems:[{type:"select",label:"Alignment",allowFor:["heading","paragraph","alert","help-text","caption","th","td"],options:{"null":"Default","text-left":"Left","text-center":"Center","text-right":"Right","text-justify":"Justify"},set:MBE.options.toggleClass,get:MBE.options.hasClass},{type:"select",label:"Transformation",allowFor:["heading","paragraph","alert","small","strong","italic","span","link","help-text","caption","th","td","breadcrumbs-active","breadcrumbs-inactive"],options:{"null":"None","text-lowercase":"Lowercase","text-uppercase":"Uppercase","text-capitalize":"Capitalized"},set:MBE.options.toggleClass,get:MBE.options.hasClass},{type:"select",label:"Color",allowFor:["heading","paragraph","small","strong","italic","span","link","help-text","caption","th","td","breadcrumbs-active","breadcrumbs-inactive"],options:{"null":"Default","text-muted":"Muted","text-primary":"Primary","text-success":"Success","text-info":"Info","text-warning":"Warning","text-danger":"Danger"},set:MBE.options.toggleClass,get:MBE.options.hasClass},{type:"select",label:"Background",allowFor:["heading","paragraph","small","strong","italic","span","link","help-text","caption","breadcrumbs-active","breadcrumbs-inactive"],options:{"null":"Default","bg-primary":"Primary","bg-success":"Success","bg-info":"Info","bg-warning":"Warning","bg-danger":"Danger"},set:MBE.options.toggleClass,get:MBE.options.hasClass},{type:"boolean",allowFor:["heading","paragraph","alert","help-text","caption","th","td"],options:{"text-nowrap":"No wrap"},set:MBE.options.toggleClass,get:MBE.options.hasClass}]}}}};MBE.types.image={templates:{image:'<img src="" width="80" height="80" alt="">',icon:'<span class="fa fa-star"><\/span>',figure:"<figure><\/figure>",figcaption:"<figcaption>Caption<\/figcaption>"},options:{image:{imageOptions:{name:"Image options",type:"group",groupItems:[{label:"Source URL",type:"text",attr:"src",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Width",type:"text",attr:"width",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Height",type:"text",attr:"height",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Alt",type:"text",attr:"alt",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Style",type:"select",options:{"null":"Default","img-rounded":"Rounded","img-circle":"Circle","img-thumbnail":"Thumbnail"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"Responsive",type:"boolean",options:{"img-responsive":"Responsive"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},icon:{iconOptions:{name:"Icon options",type:"group",groupItems:[{label:"Icon",type:"icon",fontSets:{fa:"Font Awesome",glyphicon:"Glyphicons"},set:MBE.options.setIcon}]}}}};MBE.types.controls={templates:{button:'<button type="button" class="btn btn-default" name="button">Button<\/button>',"button-group":'<div class="btn-group" role="group"><button type="button" class="btn btn-default" data-uic="controls|button">Left<\/button><button type="button" class="btn btn-default" data-uic="controls|button">Middle<\/button><button type="button" class="btn btn-default" data-uic="controls|button">Right<\/button><\/div>',"button-toolbar":'<div class="btn-toolbar" role="toolbar"><div class="btn-group" role="group" data-uic="controls|button-group"><button type="button" class="btn btn-default" data-uic="controls|button">Button 1<\/button><button type="button" class="btn btn-default" data-uic="controls|button">Button 2<\/button><\/div><div class="btn-group" role="group" data-uic="controls|button-group"><button type="button" class="btn btn-default" data-uic="controls|button">Button 3<\/button><button type="button" class="btn btn-default" data-uic="controls|button">Button 4<\/button><\/div><\/div>',"split-button":'<div class="btn-group"><\/div>',"button-dropdown":'<div class="btn-group"><\/div>',"dropdown-menu":'<ul class="dropdown-menu" data-uic="controls|dropdown-menu" locked><\/ul>',"dropdown-menu-item":'<li data-uic="controls|dropdown-menu-item"><\/li>',"dropdown-menu-header":'<li class="dropdown-header" data-uic="controls|dropdown-menu-header">Header<\/li>',"dropdown-menu-divider":'<li class="divider" data-uic="controls|dropdown-menu-divider"><\/li>',link:'<a href="#" target="">Link<\/a>'},options:{button:{buttonOptions:{name:"Button options",type:"group",groupItems:[{id:"controls_button_element",label:"Element",type:"select",options:{button:"Button",a:"Link"},get:MBE.options.is,set:function(n){$("#controls_button_button_type").toggle(n.value=="button");$("#controls_button_link_url").toggle(n.value!="button");$("#controls_button_link_target").toggle(n.value!="button");n.value=="button"&&($(this).removeAttr("href target").attr("type","button"),$("#controls_button_button_type select").val("button"));n.value=="a"&&($(this).removeAttr("type").attr({href:"#",target:""}),$("#controls_button_link_url input").val("#"),$("#controls_button_link_target select").val("null"));MBE.options.toggleTagName.apply(this,[n])}},{id:"controls_button_button_type",label:"Button type",type:"select",options:{button:"Button",submit:"Submit",reset:"Reset"},attr:"type",get:MBE.options.hasAttr,set:MBE.options.setAttr},{id:"controls_button_link_url",label:"Link URL",type:"text",attr:"href",get:MBE.options.hasAttr,set:MBE.options.setAttr},{id:"controls_button_link_target",label:"Link target",type:"select",options:{"null":"Default",_blank:"Blank",_parent:"Parent",_top:"Top"},attr:"target",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Name",type:"text",attr:"name",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Value",type:"text",attr:"value",id:"AttrButtonValue",get:MBE.options.hasAttr,set:MBE.options.setAttr,change:function(n){$("#AttrID input").val(n.value).change()}},{label:"Style",type:"select",options:{"btn-default":"Default","btn-primary":"Primary","btn-success":"Success","btn-info":"Info","btn-warning":"Warning","btn-danger":"Danger","btn-link":"Link"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"Size",type:"select",options:{"null":"Default","btn-lg":"Large","btn-sm":"Small","btn-xs":"Extra small"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"Disabled",type:"boolean",options:{disabled:"Disabled"},get:function(){return $(this).is(":disabled")},set:function(n){$(this).attr("disabled",n.checked)}},{label:"Misc",type:"boolean",options:{active:"Active","btn-block":"Block"},get:MBE.options.hasClass,set:MBE.options.toggleClass}],onBuild:function(){var n=$("#controls_button_element select");console.log(n.val());$("#controls_button_button_type").toggle(n.val()=="button");$("#controls_button_link_url").toggle(n.val()!="button");$("#controls_button_link_target").toggle(n.val()!="button")}}},"button-group":{buttonGroupOptions:{name:"Button group options",type:"group",groupItems:[{label:"Justified",type:"boolean",options:{"btn-group-justified":"Justified"},get:MBE.options.hasClass,set:function(n){n.checked?$("> button",this).each(function(){for(var i,t=$("<a />"),n=0;n<this.attributes.length;n++)(i=this.attributes.item(n).nodeName,i!="type")&&t[0].setAttribute(i,this.attributes.item(n).nodeValue);t.attr({href:"#",target:""}).html(this.innerHTML);$(this).replaceWith(t)}):$("> a",this).each(function(){for(var t,i=$("<button />"),n=0;n<this.attributes.length;n++)(t=this.attributes.item(n).nodeName,t!="href"&&t!="target")&&i[0].setAttribute(t,this.attributes.item(n).nodeValue);i.attr("type","button").html(this.innerHTML);$(this).replaceWith(i)});$(this).toggleClass(n.value);MBE.DnD.updateDOM()}},{label:"Type",type:"select",options:{"btn-group":"Horizontal","btn-group-vertical":"Vertical"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"Size",type:"select",options:{"btn-group-lg":"Large","null":"Default","btn-group-sm":"Small","btn-group-xs":"Extra small"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},link:{linkOptions:{name:"Link options",type:"group",groupItems:[{label:"Link URL",type:"text",attr:"href",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Link target",type:"select",options:{"null":"Default",_blank:"Blank",_parent:"Parent",_top:"Top"},attr:"target",get:MBE.options.hasAttr,set:MBE.options.setAttr}]},textOptions:MBE.types.text.options.common.textOptions}},init:function(){var t=MBE.types.controls,n;MBE.DnD.onDrop.push(MBE.types.controls._drop);n=MBE.toolbar.menu;n.controls={};n.controls["button-dropdown"]={allowFor:t.isDropdown,items:[{type:"text",label:"ADD TO MENU"},{type:"button",label:"ITEM",callback:t.dropdownAddItem},{type:"button",label:"HEADER",callback:t.dropdownAddHeader},{type:"button",label:"DIVIDER",callback:t.dropdownAddDivider},{type:"text",label:"MENU"},{type:"button",label:"SHOW",callback:t.dropdownShowMenu,allowFor:t.dropdownIsMenuHidden},{type:"button",label:"HIDE",callback:t.dropdownHideMenu,allowFor:t.dropdownIsMenuVisible},]};n.controls["split-button"]=n.controls["button-dropdown"];n.controls.button=n.controls["button-dropdown"];n.controls["dropdown-menu"]=n.controls["button-dropdown"];n.controls["dropdown-menu-item"]=n.controls["button-dropdown"];n.controls["dropdown-menu-header"]=n.controls["button-dropdown"];n.controls["dropdown-menu-divider"]=n.controls["button-dropdown"];n.controls.link=n.controls["button-dropdown"]},_drop:function(){($(this).is('[data-uic="controls|button-dropdown"]:empty')||$(this).is('[data-uic="controls|split-button"]:empty'))&&MBE.types.controls.dropdownBuild.apply(this,[])},isDropdown:function(){return $(this).is('[data-uic="controls|button-dropdown"]')||$(this).parents('[data-uic="controls|button-dropdown"]').length||$(this).is('[data-uic="controls|split-button"]')||$(this).parents('[data-uic="controls|split-button"]').length},dropdownBuild:function(){var n=MBE.types.controls,t=$(this),r=$(n.templates.button),f=$(n.templates["dropdown-menu"]),e=$(MBE.types.misc.templates.caret),o=t.is('[data-uic="controls|split-button"]'),s,h,i,u,c;for(e.attr("data-uic","misc|caret"),r.attr({locked:!0,"data-uic":"controls|button","data-toggle":"dropdown"}).addClass("dropdown-toggle").html(o?"":"Dropdown "),r.append(e),o&&(s=$(n.templates.button),s.attr({locked:!0,"data-uic":"controls|button"}).html("Action").appendTo(t)),h=["First item","Second item","Third item"],i=0;i<3;i++)u=$(n.templates["dropdown-menu-item"]),c=$(n.templates.link),c.attr({"data-uic":"controls|link",locked:!0}).html(h[i]).appendTo(u),u.appendTo(f);t.append(r);t.append(f);MBE.DnD.updateDOM()},dropdownGetTarget:function(){var n=$(this);return n.is('[data-uic="controls|button-dropdown"]')?$(this):n.parents('[data-uic="controls|button-dropdown"]').length?n.parents('[data-uic="controls|button-dropdown"]').eq(0):n.is('[data-uic="controls|split-button"]')?$(this):n.parents('[data-uic="controls|split-button"]').length?n.parents('[data-uic="controls|split-button"]').eq(0):$("<div><\/div>")},dropdownAddItem:function(){var n=MBE.types.controls,t=n.dropdownGetTarget.apply(this,[]),i=$(n.templates["dropdown-menu-item"]),r=$(n.templates.link);r.attr({"data-uic":"controls|link",locked:!0}).html("Menu item").appendTo(i);t.find("ul.dropdown-menu").append(i);MBE.DnD.updateDOM();setTimeout(function(){t.addClass("open")},1)},dropdownAddHeader:function(){var n=MBE.types.controls,t=n.dropdownGetTarget.apply(this,[]),i=$(n.templates["dropdown-menu-header"]);t.find("ul.dropdown-menu").append(i);MBE.DnD.updateDOM();setTimeout(function(){t.addClass("open")},1)},dropdownAddDivider:function(){var n=MBE.types.controls,t=n.dropdownGetTarget.apply(this,[]),i=$(n.templates["dropdown-menu-divider"]);t.find("ul.dropdown-menu").append(i);MBE.DnD.updateDOM();setTimeout(function(){t.addClass("open")},1)},dropdownIsMenuHidden:function(){var n=MBE.types.controls,t=n.dropdownGetTarget.apply(this,[]);return!t.find("ul.dropdown-menu").is(":visible")},dropdownIsMenuVisible:function(){var n=MBE.types.controls,t=n.dropdownGetTarget.apply(this,[]);return t.find("ul.dropdown-menu").is(":visible")},dropdownShowMenu:function(){var n=MBE.types.controls,t=n.dropdownGetTarget.apply(this,[]);t.addClass("open");MBE.toolbar._select.apply($(".mbe-active",MBE.workspace)[0],[])},dropdownHideMenu:function(){var n=MBE.types.controls,t=n.dropdownGetTarget.apply(this,[]);t.removeClass("open");MBE.toolbar._select.apply($(".mbe-active",MBE.workspace)[0],[])}};MBE.onInit.push(MBE.types.controls.init);MBE.types.grid={templates:{row:'<div class="row"><\/div>',column:'<div class="col-xs-12"><\/div>',clearfix:'<div class="clearfix"><\/div>'},options:{column:{columnSize:{name:"Column size",type:"group",groupItems:[]},columnOffset:{name:"Column offset",type:"group",groupItems:[]},columnPush:{name:"Column push",type:"group",groupItems:[]},columnPull:{name:"Column pull",type:"group",groupItems:[]}}},initColumnOptions:function(){var s={columnSize:"col-{l}-{c}",columnOffset:"col-{l}-offset-{c}",columnPush:"col-{l}-push-{c}",columnPull:"col-{l}-pull-{c}"},f=["xs","sm","md","lg"],i,e,t,r,u,n,o;for(i in MBE.types.grid.options.column)for(e=s[i],t=0;t<f.length;t++){for(r=f[t],u={label:r.toUpperCase(),type:"select",options:{"null":"None"},get:MBE.options.hasClass,set:MBE.options.toggleClass},n=1;n<=12;n++)o=e.replace(/\{l\}/,r).replace(/\{c\}/,n),u.options[o]=n;MBE.types.grid.options.column[i].groupItems.push(u)}}};$("body").hasClass("mozaicBootstrapEditorModule")&&$(MBE.types.grid.initColumnOptions);MBE.types.page={templates:{"page-header":'<div class="page-header" data-uic="containers|div"><h1 data-uic="text|heading">Page header <small data-uic="text|small">Subtext<\/small><\/h1><\/div>',header:"<header><\/header>",footer:"<footer><\/footer>",hgroup:"<hgroup><\/hgroup>",section:"<section><\/section>",article:"<article><\/article>",aside:"<aside><\/aside>"},options:{}};MBE.types.table={templates:{table:'<table class="table"><\/table>',tr:'<tr data-uic="table|tr"><\/tr>',cell:"<td><\/td>",td:'<td data-uic="table|td">Column<\/td>',th:'<th data-uic="table|th">Cell<\/th>',thead:'<thead data-uic="table|thead" locked><\/thead>',tbody:'<tbody data-uic="table|tbody" locked><\/tbody>',tfoot:'<tfoot data-uic="table|tfoot" locked><\/tfoot>',caption:'<caption data-uic="table|caption" locked>Caption<\/caption>'},options:{table:{tableOptions:{name:"Table options",type:"group",groupItems:[{label:"Style",type:"boolean",options:{"table-striped":"Striped","table-bordered":"Bordered","table-hover":"Hover","table-condensed":"Condensed"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{name:"Responsive",type:"boolean",options:{"table-responsive":"Responsive"},get:function(n){return $(MBE.options.target).parent().is("."+n)},set:function(n){n.checked?$(this).wrap('<div class="table-responsive"><\/div>'):$(this).unwrap()}},{name:"Show",type:"boolean",options:{thead:"Show table header",tfoot:"Show table footer",caption:"Show caption"},get:function(n){return $("> "+n,MBE.options.target).length>0},set:function(n){if(n.checked)switch(n.value){case"caption":$(this).prepend($(MBE.types.table.templates.caption));break;case"thead":$("tbody",this).before(MBE.types.table.createTHead.apply(this,[]));break;case"tfoot":$("tbody",this).after(MBE.types.table.createTFoot.apply(this,[]))}else $("> "+n.value,this).remove();MBE.DnD.updateDOM()}}]}},caption:{captionOptions:{name:"Caption options",type:"boolean",options:{lead:"Lead"},set:MBE.options.toggleClass,get:MBE.options.hasClass},textOptions:MBE.types.text.options.common.textOptions},tr:{trOptions:{name:"Table row options",type:"group",groupItems:[{label:"Style",type:"select",options:{"null":"Defaut",active:"Active",success:"Success",info:"Info",warning:"Warning",danger:"Danger"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},td:{tdOptions:{name:"Table cell options",type:"group",groupItems:[{label:"Style",type:"select",options:{"null":"Defaut",active:"Active",success:"Success",info:"Info",warning:"Warning",danger:"Danger"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"Rowspan",type:"number",attr:"rowspan",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Colspan",type:"number",attr:"colspan",get:MBE.options.hasAttr,set:MBE.options.setAttr}]},textOptions:MBE.types.text.options.common.textOptions}},init:function(){var n=MBE.types.table,t=MBE.toolbar.menu;n.options.th=n.options.td;MBE.DnD.onDrop.push(n._drop);t.table={};t.table.table={items:[{type:"text",label:"ADD ROW"},{type:"button",label:"ABOVE",callback:n.rowAddAbove,allowFor:n.isCellOrRow},{type:"button",label:"BELOW",callback:n.rowAddBelow,allowFor:n.isCellOrRow},{type:"button",label:"TOP",callback:n.rowAddTop},{type:"button",label:"BOTTOM",callback:n.rowAddBottom},{type:"text",label:"ADD COLUMN"},{type:"button",label:"LEFT",callback:n.columnAddLeft,allowFor:n.isCell},{type:"button",label:"RIGHT",callback:n.columnAddRight,allowFor:n.isCell},{type:"button",label:"BEGIN",callback:n.columnAddBegin},{type:"button",label:"END",callback:n.columnAddEnd}]};t.table.thead=t.table.tbody=t.table.tfoot=t.table.tr=t.table.td=t.table.th=t.table.table},_drop:function(){$(this).is('[data-uic="table|table"]:empty')&&MBE.types.table.build.apply(this,[]);$(this).is('[data-uic="table|cell"]')&&MBE.types.table.insertCell.apply(this,[])},build:function(){var r=MBE.types.table,f=$(this),e=$(r.templates.thead),o=$(r.templates.tbody),s=$(r.templates.tr),n,t,u,i;for(f.append(e),f.append(o),t=s.clone(),e.append(t),n=1;n<=3;n++)i=$(r.templates.th),i.html("Column "+n),i.appendTo(t);for(n=0;n<2;n++){for(t=s.clone(),u=1;u<=3;u++)i=$(r.templates.td),i.html("Cell "+u),i.appendTo(t);o.append(t)}MBE.DnD.updateDOM()},insertCell:function(){var t=MBE.types.table,n=$(this);n.parent().parent().is("thead")?n.replaceWith($(t.templates.th)):n.replaceWith($(t.templates.td))},getCellCount:function(){var n=0;return $("tbody tr",this).each(function(){var t=0;$("td",this).each(function(){t+=this.colSpan?Number(this.colSpan):1});t>n&&(n=t)}),n},createTHead:function(){for(var u,n=MBE.types.table,i=$(n.templates.thead),r=$(n.templates.tr),f=n.getCellCount.apply(this,[]),t=1;t<=f;t++)u=$(n.templates.th),u.html("Column "+t).appendTo(r);return i.append(r),i},createTFoot:function(){for(var u,n=MBE.types.table,i=$(n.templates.tfoot),r=$(n.templates.tr),f=n.getCellCount.apply(this,[]),t=1;t<=f;t++)u=$(n.templates.td),u.html("Summary "+t).appendTo(r);return i.append(r),i},isCell:function(){return $(this).is("td, th")},isCellOrRow:function(){return $(this).is("td, th, tr")},addRow:function(n){for(var o,u=MBE.types.table,t=$(this),s=t.is("table")?t:t.parents("table").eq(0),i=t.is("table")?t.find("tbody"):t.parents("tbody, thead, tfoot").eq(0),e=t.is("tr")?t:t.is("td, th")?t.parent():null,r=$(u.templates.tr),h=u.getCellCount.apply(s[0],[]),f=1;f<=h;f++)o=$(u.templates[i.is("thead")?"th":"td"]),o.html((i.is("thead")?"Column":i.is("tfoot")?"Summary":"Cell")+" "+f).appendTo(r);switch(n){case"top":i.prepend(r);break;case"bottom":i.append(r);break;case"above":e.before(r);break;case"below":e.after(r)}MBE.DnD.updateDOM()},addColumn:function(n){var r=MBE.types.table,t=$(this),u=t.is("table")?t:t.parents("table").eq(0),i=t.is("th, td")?t[0].cellIndex:null;u.find("> thead, > tbody, > tfoot").each(function(){var u=$(this),t=$(r.templates[u.is("thead")?"th":"td"]);t.html(u.is("thead")?"Column":u.is("tfoot")?"Summary":"Cell");u.find("> tr").each(function(){switch(n){case"begin":$(this).prepend(t.clone());break;case"end":$(this).append(t.clone());break;case"left":$(this).find("> td, > th").eq(i).before(t.clone());break;case"right":$(this).find("> td, > th").eq(i).after(t.clone())}})});MBE.DnD.updateDOM()},rowAddAbove:function(){MBE.types.table.addRow.apply(this,["above"])},rowAddBelow:function(){MBE.types.table.addRow.apply(this,["below"])},rowAddTop:function(){MBE.types.table.addRow.apply(this,["top"])},rowAddBottom:function(){MBE.types.table.addRow.apply(this,["bottom"])},columnAddLeft:function(){MBE.types.table.addColumn.apply(this,["left"])},columnAddRight:function(){MBE.types.table.addColumn.apply(this,["right"])},columnAddBegin:function(){MBE.types.table.addColumn.apply(this,["begin"])},columnAddEnd:function(){MBE.types.table.addColumn.apply(this,["end"])}};MBE.onInit.push(MBE.types.table.init);MBE.types.form={templates:{form:'<form class="form-horizontal" method="post"><\/form>',"form-group":'<div class="form-group"><\/div>',label:'<label for="">Label<\/label>',"input-text":'<input type="text" name="" value="" class="form-control">',"input-email":'<input type="email" name="" value="" class="form-control">',"input-color":'<input type="color" name="" value="" class="form-control">',select:'<select name="" class="form-control"><\/select>',"input-tel":'<input type="tel" name="" value="" class="form-control">',"input-date":'<input type="date" name="" value="" class="form-control">',"input-number":'<input type="number" name="" value="" class="form-control">',"input-range":'<input type="range" name="" value="" class="form-control">',"input-hidden":'<input type="hidden" name="" value="">',"input-url":'<input type="url" name="" value="" class="form-control">',"input-search":'<input type="search" name="" value="" class="form-control">',"input-password":'<input type="password" name="" value="" class="form-control">',"input-file":'<input type="file" name="" value="" class="form-control">',textarea:'<textarea class="form-control" name="" value=""><\/textarea>',"checkbox-group":'<div class="checkbox"><\/div>',"radio-group":'<div class="radio"><\/div>',checkbox:'<input type="checkbox" name="" value="">',"checkbox-label":'<label for="" data-uic="form|label"><input type="checkbox" name="" value="" data-uic="form|checkbox"> Checkbox<\/label>',radio:'<input type="radio" name="" value="">',"radio-label":'<label for="" data-uic="form|label"><input type="radio" name="" value="" data-uic="form|radio"> Radio<\/label>',"static-control":'<p class="form-control-static">Static value<\/p>',"help-text":'<p class="help-block">Help text for field<\/p>',"input-group":'<div class="input-group"><div class="input-group-addon" data-uic="form|left-addon" locked><span data-uic="text|span">prefix<\/span><\/div><input type="text" name="" value="" class="form-control" data-uic="form|input-text"><div class="input-group-addon" data-uic="form|right-addon" locked><span data-uic="text|span">suffix<\/span><\/div><\/div>',fieldset:'<fieldset><legend data-uic="form|legend" locked>Field group<\/legend><\/fieldset>',legend:'<legend data-uic="form|legend" locked>Field group<\/legend>',"left-addon":'<div class="input-group-addon" data-uic="form|left-addon" locked><span data-uic="text|span">prefix<\/span><\/div>',"right-addon":'<div class="input-group-addon" data-uic="form|right-addon" locked><span data-uic="text|span">suffix<\/span><\/div>',"form-control-feedback":'<span class="glyphicon glyphicon-remove form-control-feedback"><\/span>'},options:{form:{formOptions:{name:"Form options",type:"group",groupItems:[{label:"Type",type:"select",options:{"null":"Default","form-horizontal":"Horizontal","form-inline":"Inline"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"Method",type:"select",options:{"null":"Default",get:"GET",post:"POST"},attr:"method",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Encoding",type:"select",options:{"null":"Default","application/x-www-form-urlencoded":"URL Encoded","multipart/form-data":"Multipart","text/plain":"Plain"},attr:"enctype",get:MBE.options.hasAttr,set:MBE.options.setAttr}]}},label:{labelOptions:{name:"Label options",type:"group",groupItems:[{label:"For",type:"text",attr:"for",get:MBE.options.hasAttr,set:MBE.options.setAttr}]},labelSize:{name:"Label size",type:"group",groupItems:MBE.types.grid.options.column.columnSize.groupItems,get:MBE.options.hasClass,set:MBE.options.toggleClass}},select:{selectOptions:{name:"Select options",type:"group",groupItems:[{label:"Default option",type:"text",get:function(){return $("option",MBE.options.target).length==1?$("option",MBE.options.target).eq(0).text():""},set:function(n){$("option",this).remove();n.value&&$(this).append('<option value="">'+n.value+"<\/option>")}}]}},"static-control":{staticControlOptions:{name:"Static control options",type:"group",groupItems:[MBE.types.text.options.paragraph.paragraphOptions]}},"help-text":{helpTextOptions:{name:"Help text block options",type:"group",groupItems:[MBE.types.text.options.paragraph.paragraphOptions]},textOptions:MBE.types.text.options.common.textOptions},"input-group":{inputGroupOptions:{name:"Input group options",type:"group",groupItems:[{label:"Size",type:"select",options:{"null":"Default","input-group-lg":"Large","input-group-sm":"Small"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"Addons",type:"boolean",options:{left:"Show left addon",right:"Show right addon"},get:function(n){return $('[data-uic="form|'+n+'-addon"]',this).length>0},set:function(n){n.checked?n.value=="left"?$(this).prepend(MBE.types.form.templates["left-addon"]):$(this).append(MBE.types.form.templates["right-addon"]):$('[data-uic="form|'+n.value+'-addon"]',this).remove();MBE.DnD.updateDOM()}}]}},fieldset:{FieldsetOptions:{name:"Fieldset options",type:"group",groupItems:[{label:"Name",type:"text",attr:"name",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"State",type:"boolean",options:{disabled:"Disabled"},get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Legend",type:"boolean",options:{legend:"Show legend"},get:function(n){return $('[data-uic="form|'+n+'"]',this).length>0},set:function(n){n.checked?n.value=="legend"&&$(this).prepend(MBE.types.form.templates.legend):$('[data-uic="form|'+n.value+'"]',this).remove();MBE.DnD.updateDOM()}}]}},"checkbox-group":{checkboxGroupOptions:{name:"Checkbox group options",type:"group",groupItems:[{label:"Type",type:"select",options:{checkbox:"Default","checkbox-inline":"Inline"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},"radio-group":{radioGroupOptions:{name:"Radio group options",type:"group",groupItems:[{label:"Type",type:"select",options:{radio:"Default","radio-inline":"Inline"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},"form-control-feedback":{formControlFeedbackOptions:{name:"Form control feedback options",type:"group",groupItems:[{label:"Icon",type:"icon",fontSets:{glyphicon:"Glyphicons"},set:MBE.options.setIcon}]}},"form-group":{formGroupOptions:{name:"Form group options",type:"group",groupItems:[{label:"Size",type:"select",options:{"null":"Default","form-group-lg":"Large","form-group-sm":"Small"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},common:{mainOptions:{name:"Main",allowFor:["input-text","input-email","input-color","select","input-tel","input-number","input-range","input-hidden","input-url","input-search","input-password","input-file","input-date","textarea","checkbox","radio"],type:"group",groupItems:[{label:"Name",type:"text",attr:"name",id:"AttrName",get:MBE.options.hasAttr,set:MBE.options.setAttr,change:function(n){$(this).is("[type=radio]")?n.value.length&&$("#AttrValue input").val().length&&$("#AttrID input").val(n.value+"_"+$("#AttrValue input").val()):$("#AttrID input").val(n.value).change()}},{label:"Rows",allowFor:["textarea"],type:"number",attr:"rows",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Min",allowFor:["input-number","input-range","input-date"],type:"number",attr:"min",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Max",allowFor:["input-number","input-range","input-date"],type:"number",attr:"max",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Step",allowFor:["input-number","input-range","input-date"],type:"number",attr:"step",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Size",disallowFor:["input-hidden","checkbox","radio"],type:"select",options:{"null":"Default","input-lg":"Large","input-sm":"Small"},get:MBE.options.hasClass,set:MBE.options.toggleClass},{label:"Placeholder",allowFor:["input-text","input-email","input-tel","input-url","input-search","input-password","textarea"],type:"text",attr:"placeholder",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Type",allowFor:["input-date"],type:"select",attr:"type",options:{date:"Date",time:"Time","datetime-local":"Datetime local",month:"Month",week:"Week"},get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Value",allowFor:["radio"],type:"text",attr:"value",id:"AttrValue",get:MBE.options.hasAttr,set:MBE.options.setAttr,change:function(n){$(this).is("[type=radio]")&&n.value.length&&$("#AttrName input").val().length&&$("#AttrID input").val($("#AttrName input").val()+"_"+n.value)}},{label:"Checked",allowFor:["checkbox","radio"],type:"boolean",options:{checked:"Checked"},get:MBE.options.hasProp,set:MBE.options.setProp}]},stateOptions:{name:"State",disallowFor:["input-hidden","static-control","help-text","legend","checkbox","radio"],type:"boolean",options:{readonly:"Readonly",disabled:"Disabled"},get:MBE.options.hasAttr,set:MBE.options.setAttr},crStateOptions:{name:"State",allowFor:["checkbox","radio"],type:"boolean",options:{disabled:"Disabled"},get:MBE.options.hasAttr,set:MBE.options.setAttr},inputOptions:{name:"Input",allowFor:["input-text","input-email","select","input-tel","input-number","input-url","input-search","input-password","input-file","textarea"],type:"group",groupItems:[{label:"Autofocus",allowFor:["input-text","input-email","select","input-tel","input-number","input-url","input-search","input-password","textarea"],type:"boolean",options:{autofocus:"Autofocus"},get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Autocomplete",allowFor:["input-text","input-email","input-tel","input-number","input-url","input-search","input-password","textarea"],type:"select",options:{"null":"Default",on:"On",off:"Off"},attr:"autocomplete",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Multiple",allowFor:["input-file","select"],type:"boolean",options:{multiple:"Multiple"},get:MBE.options.hasAttr,set:MBE.options.setAttr}]},validationOptions:{name:"Validation",type:"group",disallowFor:["form","label","form-group","input-hidden","input-range","form-control-feedback","static-control","help-text","input-group","fieldset","legend","left-addon","right-addon"],groupItems:[{label:"Required",type:"boolean",options:{required:"Required"},get:MBE.options.hasAttr,set:MBE.options.setAttr},{disallowFor:["checkbox","radio","input-color","select","input-file"],label:"Min length",type:"text",attr:"minlength",get:MBE.options.hasAttr,set:MBE.options.setAttr},{disallowFor:["checkbox","radio","input-color","select","input-file"],label:"Max length",type:"text",attr:"maxlength",get:MBE.options.hasAttr,set:MBE.options.setAttr}]}}},init:function(){MBE.DnD.onDOMUpdate.push(MBE.types.form._domUpdate);MBE.DnD.onDrop.push(MBE.types.form._drop)},_drop:function(n){n.is(".input-group-addon")&&$(this).is("input, button, select, div")&&n.toggleClass("input-group-addon input-group-btn");n.is(".input-group-btn")&&!$(this).is("input, button, select, div")&&n.toggleClass("input-group-addon input-group-btn");$(this).is(".form-control-feedback")&&n.addClass("has-feedback")},_domUpdate:function(){$(".input-group-btn:empty").each(function(){$(this).removeClass("input-group-btn").addClass("input-group-addon")})}};MBE.onInit.push(MBE.types.form.init);MBE.options.getProgressBarClass=function(n){return $(".progress-bar",this).hasClass(n)};MBE.options.setProgressBarClass=function(n){if(n.type=="select"){var t=[];if($(n).find("option").each(function(){t.push(this.value)}),$(".progress-bar",this).removeClass(t.join(" ")),n.value=="null")return}$(".progress-bar",this).toggleClass(n.value)};MBE.types.misc={templates:{"custom-code":"<div><\/div>",modal:'<div class="modal fade" tabindex="-1" role="dialog"><\/div>',"modal-header":'<div class="modal-header" data-uic="misc|modal-header" locked><\/div>',"modal-body":'<div class="modal-body" data-uic="misc|modal-body" locked><\/div>',"modal-footer":'<div class="modal-footer" data-uic="misc|modal-footer" locked><\/div>',badge:'<span class="badge">4<\/span>',tag:'<span class="label label-default">label<\/span>',caret:'<span class="caret"><\/span>',close:'<button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button>',hr:"<hr />","responsive-embed":'<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" src=""><\/iframe><\/div>',progressBar:'<div class="progress"><div class="progress-bar" role="progressbar" style="min-width:2em; width:0%"><\/div><\/div>',breadcrumbs:'<ol class="breadcrumb"><\/ol>',"breadcrumbs-item":'<li data-uic="misc|breadcrumbs-item"><\/li>',"breadcrumbs-active":'<span data-uic="misc|breadcrumbs-active" locked><\/span>',"breadcrumbs-inactive":'<a data-uic="misc|breadcrumbs-inactive" locked><\/a>'},options:{"custom-code":{customCodeOptions:{name:"Custom code",type:"cm",get:function(){var n=$(this.innerHTML),t;return n.find(".mbe-text-node").contents().unwrap(),t=$("<div><\/div>").html(n),t.html()},set:function(n){this.innerHTML=n.value;MBE.DnD.updateDOM()}}},modal:{modalOptions:{name:"Modal options",type:"group",groupItems:[{label:"Size",type:"select",options:{"null":"Default","modal-lg":"Large","modal-sm":"Small"},get:function(n){return $(".modal-dialog",this).hasClass(n)},set:function(n){$(".modal-dialog",this).removeClass("modal-sm modal-lg");n.value!="null"&&$(".modal-dialog",this).addClass(n.value)}},{label:"Options",type:"boolean",options:{fade:"Fade","show-header":"Show header","show-footer":"Show footer"},get:function(n){switch(n){case"fade":return $(this).is(".fade");case"show-header":return $(".modal-header",this).length>0;case"show-footer":return $(".modal-footer",this).length>0}},set:function(n){var t=MBE.types.misc;switch(n.value){case"fade":$(this).toggleClass("fade");break;case"show-header":n.checked?t.modalCreateHeader().prependTo($(".modal-content",this)):$(".modal-header",this).remove();break;case"show-footer":n.checked?t.modalCreateFooter().appendTo($(".modal-content",this)):$(".modal-footer",this).remove()}MBE.DnD.updateDOM()}}]}},tag:{tagOptions:{name:"Label options",type:"group",groupItems:[{label:"Style",type:"select",options:{"label-default":"Default","label-primary":"Primary","label-success":"Success","label-info":"Info","label-warning":"Warning","label-danger":"Danger"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},progressBar:{progressBarOptions:{name:"Progress bar options",type:"group",groupItems:[{label:"Percentage",type:"number",get:function(){return parseInt($(".progress-bar",this).css("width"))},set:function(n){$(".progress-bar",this).css("width",n.value+"%");$(".progress-bar",this).text().length>0&&$(".progress-bar",this).html(n.value+"%")}},{label:"Style",type:"select",options:{"null":"Default","progress-bar-success":"Success","progress-bar-info":"Info","progress-bar-warning":"Warning","progress-bar-danger":"Danger"},get:MBE.options.getProgressBarClass,set:MBE.options.setProgressBarClass},{label:"Options",type:"boolean",options:{"progress-bar-striped":"Striped",active:"Animated"},get:MBE.options.getProgressBarClass,set:MBE.options.setProgressBarClass},{label:"Show label",type:"boolean",options:{"show-label":"Show label"},get:function(){return $(".progress-bar",this).text().length>0},set:function(n){n.checked?$(".progress-bar",this).html($(".progress-bar",this)[0].style.width):$(".progress-bar",this).html("")}}]}},"responsive-embed":{responsiveEmbedOptions:{name:"Responsive embed options",type:"group",groupItems:[{label:"Source URL",type:"text",get:function(){return $("> iframe",MBE.options.target).attr("src").length?$("> iframe",MBE.options.target).attr("src"):""},set:function(n){$("> iframe",this).attr("src",n.value)}},{label:"Aspect ratio",type:"select",options:{"embed-responsive-16by9":"16 by 9","embed-responsive-4by3":"4 by 3"},get:MBE.options.hasClass,set:MBE.options.toggleClass}]}},"breadcrumbs-item":{breadcrumbsItemOptions:{name:"Breadcrumbs item options",type:"boolean",options:{active:"Active"},get:MBE.options.hasClass,set:function(n){var t,i,r;$(this).toggleClass(n.value);t=$(this).find("a[locked], span[locked]").eq(0);n.checked?(i=$(MBE.types.misc.templates["breadcrumbs-active"]),i.html(t.html()),t.replaceWith(i)):(r=$(MBE.types.misc.templates["breadcrumbs-inactive"]),r.html(t.html()),t.replaceWith(r));MBE.DnD.updateDOM()}}},"breadcrumbs-inactive":MBE.types.controls.options.link,"breadcrumbs-active":MBE.types.text.options.common},init:function(){var n=MBE.types.misc,t=MBE.toolbar.menu;MBE.DnD.onDrop.push(n._drop);t.misc={};t.misc.breadcrumbs={items:[{type:"text",label:"Add item"},{type:"button",label:"BEFORE",callback:n.bcAddBefore,allowFor:n.bcIsItemSelected},{type:"button",label:"AFTER",callback:n.bcAddAfter,allowFor:n.bcIsItemSelected},{type:"button",label:"BEGIN",callback:n.bcAddToBegin},{type:"button",label:"END",callback:n.bcAddToEnd},{type:"text",label:"Item"},{type:"button",label:"ACTIVATE",callback:n.bcActivate,allowFor:n.bcIsInactiveItemSelected},{type:"button",label:"DEACTIVATE",callback:n.bcDeactivate,allowFor:n.bcIsActiveItemSelected},{type:"button",label:"DELETE",callback:n.bcDelete,allowFor:n.bcIsItemSelected}]};t.misc["breadcrumbs-item"]=t.misc.breadcrumbs;t.misc["breadcrumbs-active"]=t.misc.breadcrumbs;t.misc["breadcrumbs-inactive"]=t.misc.breadcrumbs;t.misc.modal={items:[{type:"text",label:"Modal"},{type:"button",label:"Show",callback:n.modalShow,allowFor:n.modalIsInActive},{type:"button",label:"Hide",callback:n.modalHide,allowFor:n.modalIsActive}]};t.misc["modal-header"]=t.misc.modal;t.misc["modal-body"]=t.misc.modal;t.misc["modal-footer"]=t.misc.modal},_drop:function(){$(this).is('[data-uic="misc|breadcrumbs"]')&&$(this).is(":empty")&&MBE.types.misc.buildBreadCrumbs.apply(this,[]);$(this).is(".modal")&&$(this).is(":empty")&&MBE.types.misc.buildModal.apply(this,[])},buildModal:function(){var t=MBE.types.misc,u=$(this),i=$('<div class="modal-dialog" role="document"><\/div>'),n=$('<div class="modal-content"><\/div>'),r=$(t.templates["modal-body"]);t.modalCreateHeader().appendTo(n);r.append('<p data-uic="text|paragraph">The content of your modal<\/p>');r.appendTo(n);t.modalCreateFooter().appendTo(n);n.appendTo(i);i.appendTo(u);MBE.DnD.updateDOM()},modalCreateHeader:function(){var t=MBE.types.misc,n=$(t.templates["modal-header"]);return n.append('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;<\/span><\/button>'),n.append('<h4 class="modal-title" data-uic="text|heading">Modal title<\/h4>'),n},modalCreateFooter:function(){var t=MBE.types.misc,n=$(t.templates["modal-footer"]);return n.append('<button type="button" class="btn btn-default" data-dismiss="modal" data-uic="controls|button">Close<\/button>'),n.append('<button type="button" class="btn btn-primary" data-uic="controls|button">Save changes<\/button>'),n},modalGetTarget:function(){return $(this).is(".modal")?$(this):$(this).parents(".modal").eq(0)},modalIsActive:function(){return MBE.types.misc.modalGetTarget.apply(this,[]).is(".in")},modalIsInActive:function(){return MBE.types.misc.modalGetTarget.apply(this,[]).is(":not(.in)")},modalShow:function(){var n=MBE.types.misc.modalGetTarget.apply(this,[]);n.addClass("in").show().after('<div class="modal-backdrop fade in" bs-hidden="" bs-system-element="" style="display: block;"><\/div>');MBE.selection.select.apply(n[0],[])},modalHide:function(){var n=MBE.types.misc.modalGetTarget.apply(this,[]);n.removeClass("in").hide().next(".modal-backdrop").remove();MBE.selection.select.apply(n[0],[])},buildBreadCrumbs:function(){for(var r,t,u=MBE.types.misc,f=$(this),i=["Home","Library","Data"],n=0;n<i.length;n++)r=$(MBE.types.misc.templates["breadcrumbs-inactive"]),t=$(u.templates["breadcrumbs-item"]),r.html(i[n]).appendTo(t),f.append(t)},bcGetItem:function(){return $(this).is('[data-uic="misc|breadcrumbs-item"]')?$(this):$(this).parents('[data-uic="misc|breadcrumbs-item"]').eq(0)},bcIsItemSelected:function(){return $(this).is('[data-uic="misc|breadcrumbs-item"]')||$(this).parent().is('[data-uic="misc|breadcrumbs-item"]')},bcIsActiveItemSelected:function(){return $(this).is('.active[data-uic="misc|breadcrumbs-item"]')||$(this).parent().is('.active[data-uic="misc|breadcrumbs-item"]')},bcIsInactiveItemSelected:function(){return $(this).is('[data-uic="misc|breadcrumbs-item"]:not(.active)')||$(this).parent().is('[data-uic="misc|breadcrumbs-item"]:not(.active)')},bcDelete:function(){var n=MBE.types.misc.bcGetItem.apply(this,[]);n.length&&(n.remove(),$(".mbe-drag-handle").remove(),MBE.DnD.updateDOM())},bcToggleState:function(n){var r=MBE.types.misc,t=r.bcGetItem.apply(this,[]),u=$("> a, > span",t),i=$(r.templates["breadcrumbs-"+n]);i.html(u.html());u.replaceWith(i);t.toggleClass("active");MBE.DnD.updateDOM();MBE.selection.select.apply(t.is(".mbe-active")?t[0]:i[0],[])},bcAdd:function(n){var i=MBE.types.misc,r=$(this).is(".breadcrumb")?$(this):$(this).parents(".breadcrumb").eq(0),t=$(i.templates["breadcrumbs-item"]),u=$(i.templates["breadcrumbs-inactive"]);u.html("Item").appendTo(t);switch(n){case"before":i.bcGetItem.apply(this).before(t);break;case"after":i.bcGetItem.apply(this).after(t);break;case"begin":r.prepend(t);break;case"end":r.append(t)}MBE.DnD.updateDOM()},bcActivate:function(){MBE.types.misc.bcToggleState.apply(this,["active"])},bcDeactivate:function(){MBE.types.misc.bcToggleState.apply(this,["inactive"])},bcAddBefore:function(){MBE.types.misc.bcAdd.apply(this,["before"])},bcAddAfter:function(){MBE.types.misc.bcAdd.apply(this,["after"])},bcAddToBegin:function(){MBE.types.misc.bcAdd.apply(this,["begin"])},bcAddToEnd:function(){MBE.types.misc.bcAdd.apply(this,["end"])}};MBE.onInit.push(MBE.types.misc.init);MBE.types.ui={templates:{"horizontal-form-row":"<div><\/div>","nv-list":'<table class="table name-value-list"><\/table>',"data-table":'<table class="table data-table"><\/table>',countdown:'<div class="countdown-component"><span class="countdown-row countdown-show3"><span class="countdown-section"><span class="countdown-amount">0<\/span><span class="countdown-period">Hodin<\/span><\/span><span class="countdown-section"><span class="countdown-amount">29<\/span><span class="countdown-period">Minut<\/span><\/span><span class="countdown-section"><span class="countdown-amount">59<\/span><span class="countdown-period">Sekund<\/span><\/span><\/span><\/div>',wizzard:'<div class="wizard-phases wizard-phases-frame"><\/div>',"wizzard-body":'<div class="wizzard-body" data-uic="ui|wizzard-body" locked><\/div>',"wizzard-phase":'<div class="phase" data-uic="ui|wizzard-phase" locked><div class="phase-icon-circle"><div class="phase-icon-number">1<\/div><\/div><div class="phase-label">Fáze 1<\/div><\/div>'},templatesName:{"horizontal-form-row":"Horizontal form row","nv-list":"Name - Value list","data-table":"Data table",countdown:"Countdown",wizzard:"Wizzard phases","wizzard-body":"Wizzard body#hide","wizzard-phase":"Wizzard phase#hide"},options:{"data-table":{dataTableOptions:{name:"Data table options",type:"group",groupItems:[{label:"Options",type:"boolean",options:{"data-dtpaging":"Show pagination","data-dtinfo":"Show informations","data-dtfilter":"Show filter","data-dtcolumnfilter":"Show column filter","data-dtordering":"Enable ordering","data-dtserverside":"Server-side proccessing"},get:function(n){return $(this).attr(n)=="1"},set:function(n){$(this).attr(n.value,n.checked?"1":"0");MBE.types.ui.updateDataTable.apply(this,[])}},{label:"Order",type:"text",attr:"data-dtorder",get:MBE.options.hasAttr,set:MBE.options.setAttr},{label:"Actions",type:"builder",builder:function(n,t){var u,f;if(!MBE.options.isAllowed(n))return"";var i=$('<div class="option-group form-group"'+(n.id?' id="'+n.id+'"':"")+"><\/div>"),c=n.set,s=$('<label class="control-label col-xs-2">'+n.label+"<\/label>"),r=$('<table class="table table-stripped table-condensed dt-action-list"><\/table>'),o=$("<thead />"),e=$("<tbody />"),h=$('<tr class="info" />');if(h.html('<th>Icon<\/th><th>Action ID<\/th><th>ID param<\/th><th>Action title<\/th><th class="text-center"><span data-action="dt-add-action" class="fa fa-plus-circle" style="cursor: pointer"><\/span><\/th>').appendTo(o),o.appendTo(r),e.appendTo(r),i.append(s),i.append(r),r.wrap('<div class="col-xs-10"><\/div>'),t&&i.css("display","none"),e.sortable({cursor:"move",forceHelperSize:!0,forcePlaceholderSize:!0,handle:".handle",helper:function(n,t){return t.children().each(function(){$(this).width($(this).width())}),t},update:function(){MBE.types.ui.dataTableBuildActions.apply(MBE.options.target,[!1])}}),u=$(MBE.options.target).attr("data-actions"),u&&u.length)for(actionList=JSON.parse(u.replace(/'/g,'"')),f=0;f<actionList.length;f++)MBE.types.ui.dataTableAddAction.apply(e[0],[null,actionList[f]]);return i},get:function(){},set:function(){}}]}},wizzard:{wizzardOptions:{name:"Wizzard options",type:"group",groupItems:[{label:"Phases",type:"text",attr:"data-phases",get:MBE.options.hasAttr,set:function(n){$(this).attr("data-phases",n.value);MBE.types.ui.wizzardBuildPhases.apply(this,[])}},{label:"Active phase",type:"number",attr:"data-activephase",get:MBE.options.hasAttr,set:function(n){$(this).attr("data-activephase",n.value);MBE.types.ui.wizzardBuildPhases.apply(this,[])}}]}}},init:function(){var n=MBE.types.ui,u=$("<li><\/li>"),i,t,r;u.html('<span class="fa fa-caret-right fa-fw"><\/span>UI').prependTo("ul.category");i=$('<ul data-type="ui" style="display: none"><\/ul>');for(template in n.templatesName)t=n.templatesName[template].split(/#/),r=$("<li><\/li>"),r.html('<span class="fa fa-square fa-fw"><\/span>'+t[0]).attr({"data-template":template,draggable:!0}).data("type","ui").appendTo(i),t.length==2&&r.addClass(t[1]);i.appendTo(u);MBE.io.onLoad.push(MBE.types.ui._onLoad);MBE.DnD.onDrop.push(MBE.types.ui._drop);MBE.onBeforeDelete["ui|data-table"]=MBE.types.ui._beforeDelete;$(document).on("click",'span[data-action="dt-add-action"]',n.dataTableAddAction).on("click",'span[data-action="dt-remove"]',n.dataTableRemoveAction).on("click",'span[data-action="dt-advanced"]',n.dataTableAdvancedAction).on("click",'[data-action="dt-select-icon"]',n.dataTableOpenIconDialog).on("change","input[name=action_id]",n.dataTableFillIdParam).on("change","input[name=action_id], input[name=action_title], input[name=action_idParam], input[name=action_confirm]",n.dataTableBuildActions)},_drop:function(){$(this).is('[data-uic="ui|horizontal-form-row"]')&&MBE.types.ui.buildHorizontalFormRow.apply(this,[]);$(this).is('[data-uic="ui|nv-list"]:empty')&&MBE.types.ui.buildNVList.apply(this,[]);$(this).is('[data-uic="ui|data-table"]')&&($(this).is(":empty")?MBE.types.ui.buildDataTable.apply(this,[]):MBE.types.ui.updateDataTable.apply(this,[]));$(this).is('[data-uic="ui|wizzard"]:empty')&&MBE.types.ui.buildWizzard.apply(this,[])},_beforeDelete:function(){$(this).is('[data-uic="ui|data-table"]')&&$(this).parents(".dataTables_wrapper").eq(0).replaceWith(this)},_onLoad:function(){$("table.dataTable",MBE.workspace).each(function(){MBE.types.ui.initDataTable.apply(this,[])})},buildHorizontalFormRow:function(){var r=MBE.types.grid,t=MBE.types.form,n=$(t.templates["form-group"]),u=$(t.templates.label),f=$(t.templates["input-text"]),i=$(r.templates.column);n.attr("data-uic","form|form-group");u.attr("data-uic","form|label").addClass("col-sm-2").appendTo(n);i.attr("data-uic","grid|column").addClass("col-sm-10").appendTo(n);f.attr("data-uic","form|input-text").appendTo(i);$(this).replaceWith(n)},buildNVList:function(){for(var i=$("<tbody />"),r=["Platform","Country","Year"],u=["Omnius","Czech Republic","2006"],n=0;n<r.length;n++){var t=$("<tr />"),f=$("<td />"),e=$("<td />");f.addClass("name-cell").html(r[n]).appendTo(t);e.addClass("value-cell").html(u[n]).appendTo(t);t.appendTo(i)}i.appendTo(this)},buildDataTable:function(){for(var r,o,i,f=$("<tbody />"),e=$("<thead />"),u=["Column 1","Column 2","Column 3"],t=$("<tr />"),n=0;n<u.length;n++)i=$("<th />"),i.html(u[n]).appendTo(t);for(t.appendTo(e),n=1;n<=3;n++){for(t=$("<tr />"),r=1;r<=u.length;r++)o=n*r,i=$("<td />"),i.html("Value "+o).appendTo(t);t.appendTo(f)}e.appendTo(this);f.appendTo(this);$(this).is("[data-dtpaging]")||$(this).attr({"data-dtpaging":"1","data-dtinfo":"1","data-dtfilter":"1","data-dtordering":"1","data-dtcolumnfilter":"0","data-dtserverside":"0"});MBE.types.ui.initDataTable.apply(this,[]);$(this).is("[data-actions]")&&MBE.types.ui.dataTableBuildActions.apply(this,[!0])},updateDataTable:function(){MBE.types.ui.initDataTable.apply(this,[])},initDataTable:function(){var i={destroy:!0,paging:$(this).attr("data-dtpaging")=="1",info:$(this).attr("data-dtinfo")=="1",filter:$(this).attr("data-dtfilter")=="1",ordering:$(this).attr("data-dtordering")=="1"},n,t;$(this).DataTable(i);$("> tfoot",this).remove();$(this).attr("data-dtcolumnfilter")=="1"&&($("> tfoot",this).length||(n=$("<tfoot />"),t=$("<tr />"),$("> thead > tr:first-child > th",this).each(function(){var n=$("<th />"),i;$(this).hasClass("actionHeader")?n.html("&nbsp;"):(i=$('<input type="text" value="" class="form-control input-sm" placeholder="Hledat v &quot;'+$(this).text()+'&quot;" />'),i.appendTo(n));n.appendTo(t)}),t.appendTo(n),$("> thead",this).after(n)))},dataTableAddAction:function(n,t){var h=$(this).parents("table").eq(0),r=$("tbody",h),c=t?t.icon:"fa fa-pencil",l=t?t.action:"",u=t&&t.idParam?t.idParam:"modelId",a=t?t.title:"",v=t&&t.confirm?t.confirm:"",f,e,o,s;t&&t.action=="delete"&&(u="deleteId");var i=$("<tr />"),y=$('<button type="button" class="btn btn-default" style="padding: 3px 10px" data-action="dt-select-icon"><span class="'+c+'"><\/span> <span class="caret"><\/span><\/button>'),p=$('<input type="text" class="form-control input-sm" value="'+l+'" name="action_id" />'),w=$('<input type="text" class="form-control input-sm" value="'+u+'" name="action_idParam" />'),b=$('<input type="text" class="form-control input-sm" value="'+a+'" name="action_title" />'),k=$('<input type="hidden" value="'+v+'" name="action_confirm" />'),d=$('<span class="fa fa-arrows-v fa-fw handle" title="move..." style="margin-right: 5px; margin-top: 9px; cursor: pointer"><\/span>'),g=$('<span class="fa fa-gear fa-fw" title="advanced..." data-action="dt-advanced" style="margin-right: 5px; margin-top: 9px; cursor: pointer"><\/span>"'),nt=$('<span class="fa fa-times fa-fw" title="remove..." data-action="dt-remove" style="margin-top: 9px; cursor: pointer"><\/span>'),tt=$("<td />");tt.append(y).appendTo(i);f=$("<td />");f.append(p).appendTo(i);e=$("<td />");e.append(w).appendTo(i);o=$("<td />");o.append(b).append(k).appendTo(i);s=$("<td />");s.append(d).append(g).append(nt).appendTo(i);i.appendTo(r);r.sortable("refresh")},dataTableRemoveAction:function(){$(this).parents("tr").eq(0).remove();MBE.types.ui.dataTableBuildActions.apply(MBE.options.target,[!1])},dataTableAdvancedAction:function(){var t=$(this).parents("tr").eq(0),i=$("<div />"),r=$("<fieldset />"),n=$('<div class="option-group form-group"><\/div>');r.append("<legend>Advanced action settings<\/legend>");n.append('<label class="control-label col-xs-2">Confirm message<\/label>');n.append('<div class="col-xs-10"><input type="text" value="" class="form-control input-sm"><\/div>');n.find("input").val(t.find('input[name="action_confirm"]').val()).change(function(){t.find('input[name="action_confirm"]').val(this.value).change()});r.append(n).appendTo(i);i.dialog({appendTo:"body",modal:!0,closeOnEscape:!0,draggable:!1,resizable:!1,width:"40%",maxHeight:"60%",title:"Properties...",dialogClass:"dialog-options",close:function(){$(this).remove()}})},dataTableOpenIconDialog:function(){var p=$(this),w="",t={},tt=document.styleSheets,c={fa:"Font Awesome",glyphicon:"Glyphicons"},b=$("<div />"),k=$("<fieldset />"),i=$('<div class="option-group form-group"><\/div>'),f,e,l,o,a,v,s,d,g,r,nt,h,u,y,n;k.append("<legend>Icon<\/legend>");for(n in c){for(f=$('<div class="icon-list col-xs-12 font-set-'+n+'"><\/div>'),e=0;e<tt.length;e++)for(l=document.styleSheets[e].cssRules,o=0;o<l.length;o++)for(a=l[o].selectorText,v=a?a.split(/, ?/):[],s=0;s<v.length;s++)d=v[s],g=new RegExp("^.("+n+"-[^ ]+)::before$"),(m=g.exec(d))&&(r=$('<a href="#"><\/a>'),r.append('<span class="'+n+" "+m[1]+'"><\/span>'),r.append('<span class="icon-name">'+n+" "+m[1]+"<\/span>"),f.append(r),nt="."+n+"."+m[1],p.find("span").eq(0).is(nt)&&(r.addClass("active"),w=n));f.on("click","a",function(){return p.find("span").eq(0).removeClass().addClass($(this).find("span").eq(0)[0].className),$(".icon-list a").removeClass("active"),$(this).addClass("active"),MBE.types.ui.dataTableBuildActions(),!1});t[n]=f}h=$('<input type="text" value="" placeholder="Find icon..." class="form-control input-sm">');h.on("input",function(){var n=this.value;n.length?$(".icon-list").find("a").hide().each(function(){$(".icon-name",this).text().indexOf(n)!=-1&&$(this).show()}):$(".icon-list").find("a").show()});u=$('<select class="form-control input-sm"><\/select>');for(n in c)y=$("<option><\/option>"),y.val(n).html(c[n]).appendTo(u),w==n?(y.attr("selected",!0),t[n].show()):t[n].hide();u.change(function(){$('[class*="font-set-"]').hide();$(".font-set-"+this.value).show()});i.append(u);i.append(h);i.append('<div class="clearfix"><\/div>');for(n in t)i.append(t[n]);u.wrap('<div class="col-xs-4"><\/div>');h.wrap('<div class="col-xs-6"><\/div>');k.append(i).appendTo(b);b.dialog({appendTo:"body",modal:!0,closeOnEscape:!0,draggable:!1,resizable:!1,width:"40%",maxHeight:"60%",title:"Select icon...",dialogClass:"dialog-options",close:function(){$(this).remove()}})},dataTableFillIdParam:function(){var n=$(this).parent().next().find("input");n.val().length?this.value=="delete"&&n.val()!="deleteId"&&n.val("deleteId"):n.val(this.value=="delete"?"deleteId":"modelId")},dataTableBuildActions:function(n){var t=$(this),i,u,r,f;if(t.is("table")||(t=$(MBE.options.target)),i=[],n!==!0?$("tbody > tr",".dt-action-list").each(function(){var n=$("td",this).eq(0).find("button > span").eq(0)[0].className,t=$("td",this).eq(1).find("input").val(),r=$("td",this).eq(2).find("input").val(),u=$("td",this).eq(3).find('input[type="text"]').val(),f=$("td",this).eq(3).find('input[type="hidden"]').val();n&&t&&r&&u&&i.push({icon:n,action:t,idParam:r,title:u,confirm:f})}):(u=$(this).attr("data-actions").replace(/'/g,'"'),u&&u.length&&(i=JSON.parse(u))),i.length)for($("tbody > tr > td.actionIcons",t).length||($("thead > tr",t).append('<th class="actionHeader">Akce<\/th>'),$("tbody > tr",t).append('<td class="actionIcons"><\/td>'),$("tfoot > tr",t).append('<th class="actionFooter">&nbsp;<\/th>')),$("tbody > tr > td.actionIcons",t).html(""),r=0;r<i.length;r++)$("tbody > tr > td.actionIcons",t).each(function(){$(this).append('<i class="'+i[r].icon+'" data-action="'+i[r].action+'" data-idparam="'+i[r].idParam+'" data-confirm="'+i[r].confirm+'" title="'+i[r].title+'"><\/i>')});else $("tbody tr td.actionIcons",t).length&&(f=$("tbody tr td.actionIcons",t).eq(0)[0].cellIndex,$("> tbody > tr, > thead > tr, > tfoot > tr",t).each(function(){$("> td, > th",this).eq(f).remove()}));t.attr("data-actions",JSON.stringify(i).replace(/"/g,"'"))},buildWizzard:function(){var t=MBE.types.ui,n=$(this),i=n.attr("data-phases")?n.attr("data-phases"):"Fáze 1,Fáze 2,Fáze 3",r=n.attr("data-activephase")?n.attr("data-activephase"):"1",u=$(t.templates["wizzard-body"]),f=$(t.templates["wizzard-phase"]);n.append("").append(u).attr({"data-phases":i,"data-activephase":r});t.wizzardBuildPhases.apply(this,[])},wizzardBuildPhases:function(){var f=MBE.types.ui,t=$(this),r=t.attr("data-phases").split(";"),u=Number(t.attr("data-activephase"))-1,n,i;for(t.find(".phase").remove(),n=0;n<r.length;n++)i=$(f.templates["wizzard-phase"]),i.find(".phase-icon-number").html(n+1).end().find(".phase-label").html(r[n]).end().appendTo(t.find(".wizzard-body")),n<u&&i.addClass("phase-done").find(".phase-icon-number").addClass("fa fa-check phase-icon-symbol").removeClass("phase-icon-number").html(""),n==u&&i.addClass("phase-active");MBE.DnD.updateDOM()}};MBE.onInit.push(MBE.types.ui.init);